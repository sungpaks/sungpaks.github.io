{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/look-into-react-18-streaming-and-rsc-payload/","result":{"data":{"site":{"siteMetadata":{"title":"조성개발실록"}},"markdownRemark":{"id":"7b15f256-1799-562a-8ba5-91dcd5317715","excerpt":"저번 글에서 React 18에서 무슨 일이 있었는지, 동시성 업데이트를 중심으로 살펴봤는데요 근데 그냥 \"이런게 나왔어요~\" 만 하고 넘어갔는데  말만 해서는 잘 모르곘으니깐 뭐라도 만들어보고 찍어먹어보고 해봅시다 먼저 : 간단하게 서버 컴포넌트를 구현 서버 컴포넌트와 Suspense…","html":"<p><a href=\"https://sungpaks.github.io/react-18-concurrency-and-streaming-with-rsc/\">저번 글</a>에서 React 18에서 무슨 일이 있었는지, 동시성 업데이트를 중심으로 살펴봤는데요<br>\n근데 그냥 \"이런게 나왔어요~\" 만 하고 넘어갔는데</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 225px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/169acbabbbc94d1a3647d480027cd0e2/3684f/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAADbklEQVR42n2UCUwTURCGXxEEQuKBBhMJ0YAg0ngrAgoSioCltAXqBYJBI8aAmGDUiKJRS9EaBDXeVSMWEDkkRqOiRhNPekBpRSQi4H2gYGnpBfvGt6UWkOhmd7LZfd8/M+/NDIIRF8YU1d9HHvIC/73QMIwA1CCAaSHaAK1CWT/8E8bWpdD1/cOdq4ekRZs/tqnAxtuX9A+VQHaO2J9vyosP87N47qsWIME8tEMw/odiO7QL8ccrYGgDWxbYGoUdxhSNdlaI08YkzEUbIpA43SMvzX11EDq5ZSLII6nn4ZSMQ2kyqXcSbPwygAzANIj1raDi3y1kbuW6bGAxROvdz27zTF/mkMF21j/nwOsV+GU8NHJAxQLNWtCqrI4pZAumrQDqIkCdqHsc0ygNTF6MjqRPaq8Jay4P+XaHpS5ZdP/4zOq86SV7p32+uRga+NjKW8O2dIMqGeRsLI+Dei5o4r/eZXU/jIIWQdl+n9QwlBrGSA1F65YyYgJQ8W5f0HCo+jVg/GSFtUqQRYGCB4o4cvfJONpH0aZnbAJXi/yyYh2z451TQlFm7OgqoW9nLQtU8fhFBLTkDMAqqGMRmOwKcXvryAwS9u7VbsU5UxqlizrvRRqesgs2TSRC8FqAlVws54CSCwrOn3N+KyY8peBDI//xqVkZbEfiKnEBIio7Ba5Epf5yYO+T5eQvUSepETckR9tuQ78eNBtBHm2U+pjPe/TcC1eXBJXumZqz0jVlCUqYh5KCUTbP6Uz25LoL8w1Pl0NTAjTwkP3QQNsAsmjDOY+e/FGWG7OhNQmaV5jlvFeVoWUH/HJTxqVFOpBYkkLoWEr3eXc9WIbsZU3brlpjiY9O7GSQTDbVzDFVMi2VTLgeAFX+uoteTUVelULfnFVuqaGMGCaqyvO3w9ZSMXX3Svz0ha76ojG6AlddgYtOPForcvglGqUTMSznJoCab6zjKi4trDro/f12MBrSQiRzo0EaohMh/VFnfaGL/thYg8TTXME0Xwswlc+w1C6h5GyQkVriQHMytOejoU1FG+174+31vRL/XolvjxCZrniCJg6UMaCMBkUUXUsdJ6huJWXWkl5CI2cBLdNnwoZOi/J0v1oILbugJRc6zsDPh9D3azBMGAmTnfv/ALEtwH9PkmH+SRak9enup2zA8EkAAL8BcMV9YDbu4lYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"흠..\"\n        title=\"\"\n        src=\"/static/169acbabbbc94d1a3647d480027cd0e2/3684f/image.png\"\n        srcset=\"/static/169acbabbbc94d1a3647d480027cd0e2/c26ae/image.png 158w,\n/static/169acbabbbc94d1a3647d480027cd0e2/3684f/image.png 225w\"\n        sizes=\"(max-width: 225px) 100vw, 225px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>말만 해서는 잘 모르곘으니깐 뭐라도 만들어보고 찍어먹어보고 해봅시다</p>\n<p>먼저 :</p>\n<ul>\n<li>간단하게 서버 컴포넌트를 구현</li>\n<li>서버 컴포넌트와 Suspense를 함께 사용하여 Streaming</li>\n<li>클라이언트 컴포넌트는 이제 어떻게 쓰는지</li>\n<li>클라이언트 컴포넌트와 Suspense를 함께 사용하여 Streaming</li>\n</ul>\n<p>이런걸 해보고</p>\n<ul>\n<li>React가 Suspense를 갈아끼우는 법</li>\n<li>Next.js가 RSC Payload를 다루는 법</li>\n<li>Next.js가 당신의 프로젝트를 두 배 무겁게 만듭니다??</li>\n</ul>\n<p>머 이런 비밀?에 대해 알아보겠습니다</p>\n<p><a href=\"https://sungpaks.github.io/react-18-concurrency-and-streaming-with-rsc/\">저번 글</a>에서 소개한 <strong>React 18 동시성 업데이트</strong>가 뭐였는지 기억이 안 나시거나, 아직 안보셔서 모르신다면 쓱 갔다오시면 좋겠습니다.</p>\n<h1 id=\"서버-컴포넌트를-만들어보기\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B2%84-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EB%A5%BC-%EB%A7%8C%EB%93%A4%EC%96%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"서버 컴포넌트를 만들어보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서버 컴포넌트를 만들어보기</h1>\n<p>서버 컴포넌트를 만들어볼텐데요<br>\nNext.js 13 이상 App Router를 사용한다면, 모든 컴포넌트들이 기본적으로 서버 컴포넌트가 됩니다<br>\n서버 컴포넌트를 사용한답시고 컴포넌트 상단에 <code class=\"language-text\">'use server'</code> 지시어를 쓰는건 하지맙시다.<br>\n컴포넌트는 지시어가 없으면 서버 컴포넌트, <code class=\"language-text\">'use client'</code> 지시어가 있으면 클라이언트 컴포넌트고<br>\n<code class=\"language-text\">'use server'</code>는 <a href=\"https://react.dev/reference/rsc/server-functions\">서버 함수</a>에 사용합니다.</p>\n<p>서버 컴포넌트가 뭐가 좋은거지? 에 대해서는 <a href=\"https://nextjs.org/docs/app/building-your-application/rendering/server-components#benefits-of-server-rendering\">관련 Next.js 문서</a>를 참고하세요</p>\n<p>아무튼간에 서버 컴포넌트를 사용할 수 있고 심지어는 아래처럼 비동기로 만들 수 있습니다 :</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> fetchJson <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/utils/fetchJson\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> sleep <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/utils/sleep\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Page</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchJson</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 더미 데이터를 fetch하는 함수</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 5000ms동안 이 비동기함수의 진행을 중단</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">RSC ONLY:</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">ONLY REACT SERVER COMPONENT!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h5</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">data fetched:</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h5</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        id: </span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> | userId: </span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>userId<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">title: </span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이러면 모든게 편해지는데<br>\n<code class=\"language-text\">useEffect</code>와 <code class=\"language-text\">useState</code>로 첫 렌더링 이후에 fetch하고.. 그 전에는 fallback을 리턴하고..<br>\n이런거 그냥 <code class=\"language-text\">await</code> 딸깍으로 데이터가 준비될 때까지 렌더링을 잠깐 멈춰둘 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 610px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3d191c7da74036c47fbbace061ef9854/5aae9/image-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 11.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdElEQVR42k2K0Q6CIABF/ZeMGiCwbAW5pUnpjOn//81J2Vo9nN2ze2+hl0TZXXHzgBxbdp3HvCM2PSkfIXdufiFikzktI3Jo82ZSXOmR94m6vnEODYX1HqElolIcbcXB6Oxbfv1/26/fn28/hQk9xl2otOIDlu4/+OiQfFIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5초 기다린 모습\"\n        title=\"\"\n        src=\"/static/3d191c7da74036c47fbbace061ef9854/5aae9/image-1.png\"\n        srcset=\"/static/3d191c7da74036c47fbbace061ef9854/c26ae/image-1.png 158w,\n/static/3d191c7da74036c47fbbace061ef9854/6bdcf/image-1.png 315w,\n/static/3d191c7da74036c47fbbace061ef9854/5aae9/image-1.png 610w\"\n        sizes=\"(max-width: 610px) 100vw, 610px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">await sleep(5000)</code>으로 인해 5초 지난 후 렌더링이 재개되어 HTML을 받을 수 있구요</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 254px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8035e4d07b7aa96a459e850225a6b47b/6a91e/image-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 103.79746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAADDklEQVR42qVU127bQBDUv0is4om99yqKkphYduDAsB0kgP//EyZ7J8lAmg04D4M9HrnDLbO7SMsBWX8HP4igKArW6/UrdF0Xd9yqqgpN017t71DVMxZXx6Taou4PuD3doKoqPDw8oG5qNG2LrPsE148grVaQZQUrshzL5ZKe5QskYRe6zgk1ZM2EbneDHz++oyxLzPOM+/t7FEWB3TTh8fEJN58/oaJ3z8/f8PT0hJeXF9ze3tI3OYr+BlFSnCPUVAVpPaHojkTyBeM4Yrvd4nQ64Xg8EtFnjLsJ2/kBcZLBdRy4rosgCGDbNhhjYKZLZTIuhJqKrB7RjwfMxwMccrAsSziFYQjf92GR48YOYLDNJXUZknROk9dZudhXwrzqUFLt4jgWf1SUs8MVwpHqxJ00aoz6D1wINXieK5rDzzy6P7uoXjqpvolXwiiKxAXvIo/iPcc3CfmB10nUiwrNO3vV3ocIeURRHFFHZ+z3exwOR5E2L/SHCHnKvh8IEv7MpfBfKSt0aOoK9XCE7Xg0BcsP1/EibBXtOGPcz5imHWE6p8wl8tduv9cUnnKYCCGbpknNiUTUVw3ymeWzK0kroc83CflfuWCHvkXXdWhpGeR5jizLBHLCdjugaxsSfy9KohIpHwae2S+gu4XvewjzHgONXZGnFF1AIqe7KIbj+fAo2jQvBJwwg2HaWEoylnzrcFBZ+FmSz3ZR1R3CYk/YQTc2YJYnCO01aZOpSEwd7lpBTOdoo8IzNKS2gdpjyBwDCZ1Lb4PIMlC5DIs4b+GlPaL2DmHWI0hK2igpYouR0wZDYKESdoOObElODdkxtND7FkqHYRea6HxGdyYWQZzDDgpk7YyyGcCMtWgAYwoMg7pM0Sl8hmk1MdOCpFDNad0Z9F5fy2Rpq+sGTMuhb9m1y1yHNYZhRJokyGMFd5OMXS0jDTXaeyH6rkXbNHApxamR8fUoo0lXyFOPNlSChrZ7nmdYlFWNuJxgx1uk3Ymk42CtU5EllSRylgLX43n/UURUW50CWK1UEYhykct1xf0E0rGUFBS8yCoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RSC ONLY의 HTML\"\n        title=\"\"\n        src=\"/static/8035e4d07b7aa96a459e850225a6b47b/6a91e/image-2.png\"\n        srcset=\"/static/8035e4d07b7aa96a459e850225a6b47b/c26ae/image-2.png 158w,\n/static/8035e4d07b7aa96a459e850225a6b47b/6a91e/image-2.png 254w\"\n        sizes=\"(max-width: 254px) 100vw, 254px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>5초 후 받은 HTML에는 이미 값이 다 차있는 상태네요<br>\n비교를 위해 클라이언트 사이드에서 전통적인 방식(<code class=\"language-text\">useEffect, useState</code>사용)으로 대충 구현해보면</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Page</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">,</span> setData<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>JsonPlaceholder<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetchJson</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>res <span class=\"token operator\">=></span> <span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">RCC ONLY:</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">ONLY CLIENT COMPONENT!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h5</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">data fetched:</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h5</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>data <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            id: </span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> | userId: </span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>userId<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">title: </span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이런 식으로 될까요? 클라이언트 컴포넌트는 <em>렌더링을 중단</em> 까지는 할 수 없으니, 데이터만 5초 기다렸다가 가져오도록 해봤습니다<br>\n아무튼 이런 식으로 데이터가 필요한 부분은 나중에 데이터가 준비되어야 추가하도록 하면</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 278px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/348133cc71007625ea32e2ee7b7dd430/4e29d/image-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.93670886075949%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABw0lEQVR42mWR2XLiMBBF/THY8ibJkvcF8MZgY4dUCAEe+P/fuNM2qUpN5uFUS2qpb+u2keYV8uYNOgxhbjawLEZYK4wx4hUdx1mxbfs7vta/MYQIIAKNbNujPYzo+w7DMOB0OqEsS1TNgCitSMCEaZo/YrRfxP4r6HkebEoU9Yj544HH/Yamadai9/sdbXfA5fOK2+2K5/OJiYS2uxplOyNQmgr/W9RwXQ8OM7HtZoxv9PDrirqucTwecblcME2ndX08P7CvWwjBIaUElwqe71MzZMdiwzdGlqZrdzl9WdBFpcgCIcAJESjqQsHnHI4vYTKbvm1hQyzfN8nv9Yz9RCMrKmT7iQZzhtQpedlhn2fYKRfHhKOLOIZUYkwF+lhgLgKcC4U/icScK4zZa/9eqvWekZc7JNsRaXuhLjt4Hoft+PBpkoL8FR5F1yYccMJ3XEiyibtLdAgbgcso74JTzuBckJkumd/ThHtEoURdmBhaC1VmIY4D5EWJHfmqtcBhv8HQ0RATC0kSoaF34zShrhg+RhNGUeRIyxZ5PWN/eEcSK2jJCFIWNrxFmTxcfFXSQ6goF7xynIaitUYcxQjpLNIMfwGcHyHpegIN5AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RCC ONLY의 HTML\"\n        title=\"\"\n        src=\"/static/348133cc71007625ea32e2ee7b7dd430/4e29d/image-3.png\"\n        srcset=\"/static/348133cc71007625ea32e2ee7b7dd430/c26ae/image-3.png 158w,\n/static/348133cc71007625ea32e2ee7b7dd430/4e29d/image-3.png 278w\"\n        sizes=\"(max-width: 278px) 100vw, 278px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이렇게 <code class=\"language-text\">data</code>가 필요한 부분은 뚝 끊긴 채로 HTML이 전달되고, 그 밑은 나중에 클라이언트 사이드에서 JavaScript를 사용하여 채워집니다</p>\n<h1 id=\"서버-컴포넌트에-suspense를-사용하여-streaming하기\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B2%84-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EC%97%90-suspense%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EC%97%AC-streaming%ED%95%98%EA%B8%B0\" aria-label=\"서버 컴포넌트에 suspense를 사용하여 streaming하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서버 컴포넌트에 Suspense를 사용하여 Streaming하기</h1>\n<p>마법은 이제부터 시작인데요<br>\n아까처럼.. 데이터 준비하는데 오래 걸린답시고 진짜 5초 뒤에나 페이지가 그려지면 아주 끔찍하죠?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 233px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/376faea1dab2b6769714720dbebb599f/a1d58/image-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEh0lEQVR42iVR61OSeRT+wfu+3NG8JJiSCggqlhdQNEsiMkC8oNkaiIi63kW8o4QgmGMikEp2ESnEy3oNL7ma7WhW1rbONn3Y2Q+7Ozv7p+zb9Mz5cOac8zznOXOAfUi/u7OSLxLGM+nK8sLamor+dqXdVNvd26FSF6vvlgyZfuzr0pn628ZGBnxPJnY25t7sL3862Ts7fQ02V3zbQf9NSR4j7kJRibyu9k6vXllfKSoQ59wqENU3VY/Y2kfM+vFR09xT1/bG/NHrzQ8nu7++Pzj7+AYcH66fvt2x23oaG3VW64DZapKKsy01t3yDmqpbuYVSyaTTOOUcmp+b2tteen+8+/vnoz++nn4PsL888/nD7tHh+tezt//+9WV58YlUkPiLp/Otx+DrV/OTE6ZcRte4+dlj9+KCd3XFv74aWP3Jv7T8fCEwBw7XvJ9Otvd2lt4db/3958d7vc1qUdpvPvPLodote1uFJHuwr+Z2uazV0NpnHjRZzfdH74+OjTmcjofTbrAxbfr4/tX+7uKXs4P//jkLPBmb0lecPjW96KkO9Gr7aottw82NDRrHpPORb252YWElGFzb3NgMBoPbW+Cesflwf/3l+tPHntFJ98i83zNrqTuYMBiKCiwq6R1FjqFD066vd3umZvz+2Vnv3IRzYT6w8XJra2cPDFjsa4veafeQy2EdHTWb7vU+aC5es2oXjdo6aXYiO1GnU+k7qqy27tmAb6KjU8W4+GhsPPhqeea5FXg9Y8MW/ZTLOjN9v6u7xTPj2px3P9SXaPKYMuGlQWOvydituiux9Au98xNexwPNVf7MM6fTWa9Rc8Gka7hLX5uXKyCRiAAAOp2mqVYZ2moa1LISRQGHww6hhvD56Z31+frGiuaKQmUqY+SBzaZvLU3hgpOTA5lcgtLweByFQsThIDSnhpLPR0VAEEQkEiPCI4gkUnxsdAQBoZNhDitWoRAXyW801KuAY9wGwYBAwCMITCLhYRxMC6dGhZFQCQqJFBYZRgkNgREkMjzsrpg/cPuaUpSZKRJflck1NSpwRchH53A4mEqlhlDJWBhSiwXZSTGlEsFlTkIMkUJHCDAMUyik61yGVpjUpMgp17WUN3VrdNUgMjwUg8XAMJTE5aAq6cwYn77SUnlzSJnfcCXndmy4loagvrEIjn8xpkmUpsxgsjg8hapOrdUAEpmIhSAEQVAmOyXZb29rE1xS09hGVmpHQnw790IHJ6aKx9RWZZgG8js1WZmR5wAGSyTihUIBQGAEA0M0IomFhVRZmS/6dW0s9i4rz8rk1aVFP05hrvG4Rmmcezr93Sdxj5bfkhwdfY6MbopPiAXfgQEgEsJVZqYUsegGWuLPSbkNDHaLgBFI4zrYcTXSxHGXMLCUWyJJLE6hsULxMISNj2eA1NTkrOyMsrLi0jLZDck1AkKQ0hkF56N55yJ44RE36FESWlRmEuvODxlyBY93mYkn4DAYDBaLpVCooFVbJpeKC+WSQlk+nRaJmsAT8ABtY74BPQ+GYDz6DBiPxaIvQ1CP3+oAkMnk/wGDNYFEAgq6WwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"울화통!!\"\n        title=\"\"\n        src=\"/static/376faea1dab2b6769714720dbebb599f/a1d58/image-4.png\"\n        srcset=\"/static/376faea1dab2b6769714720dbebb599f/c26ae/image-4.png 158w,\n/static/376faea1dab2b6769714720dbebb599f/a1d58/image-4.png 233w\"\n        sizes=\"(max-width: 233px) 100vw, 233px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>다행히도 저번시간에 <code class=\"language-text\">Suspense</code>를 사용하여 Streaming하면 컴포넌트들을 <strong>준비되는 대로</strong> 가져다줄 수 있다고 했습니다<br>\n어떻게 하는지 봅시다</p>\n<p>먼저 n초동안 잠들어버리는 간단한 컴포넌트를 만들게요</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> sleep <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/utils/sleep\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> seconds <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> seconds<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>seconds <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>seconds<span class=\"token punctuation\">}</span><span class=\"token plain-text\">초 잤어요</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>비동기 서버 컴포넌트로 만들어서 렌더링이 중단가능하게 합니다<br>\n그런 다음 이 컴포넌트를 사용할 때는 <code class=\"language-text\">Suspense</code>로 경계를 만듭니다</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> Sleep <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/components/Sleep\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Suspense <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Page</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">잠에들어라....얍</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Suspense</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">zzzZZ</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Sleep</span></span> <span class=\"token attr-name\">seconds</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">5</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Suspense</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Suspense</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">zzzzzZZZZZ</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Sleep</span></span> <span class=\"token attr-name\">seconds</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">10</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Suspense</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이러면 처음에는 <code class=\"language-text\">&lt;Suspense></code>를 만났을 때, fallback으로 먼저 HTML을 채웁니다.<br>\n그러고 나중에 서스펜스 경계 내부의 컴포넌트가 준비되었다면, fallback을 갈아끼웁니다.</p>\n<p><img src=\"https://i.imgur.com/4bB7l9m.gif\" alt=\"RSC Streaming 결과 \"></p>\n<p>5초 뒤에 <code class=\"language-text\">zzzZZ</code>가 <code class=\"language-text\">5초 잤어요</code>로 바뀌고,<br>\n10초 뒤에 <code class=\"language-text\">zzzzzZZZZZ</code>가 <code class=\"language-text\">10초 잤어요</code>로 바뀌는거십니다</p>\n<h2 id=\"suspense끝나면-fallback을-어떻게-갈아끼우나요\" style=\"position:relative;\"><a href=\"#suspense%EB%81%9D%EB%82%98%EB%A9%B4-fallback%EC%9D%84-%EC%96%B4%EB%96%BB%EA%B2%8C-%EA%B0%88%EC%95%84%EB%81%BC%EC%9A%B0%EB%82%98%EC%9A%94\" aria-label=\"suspense끝나면 fallback을 어떻게 갈아끼우나요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Suspense끝나면 fallback을 어떻게 갈아끼우나요?</h2>\n<p>근데 HTML은 이미 fallback으로 채워서 내려갔는데, 어떻게 fallback자리를 새로 도착한 HTML조각들로 갈아끼울 수 있을까요?<br>\n밑에다 붙이는 것도 아니고..<br>\n이를 알아보기 위해, 위에서 봤던 예시 코드를 실행하면 HTML이 어떻게 변하는지 열어봅시다.</p>\n<h3 id=\"1-suspense가-둘-다-안-끝남\" style=\"position:relative;\"><a href=\"#1-suspense%EA%B0%80-%EB%91%98-%EB%8B%A4-%EC%95%88-%EB%81%9D%EB%82%A8\" aria-label=\"1 suspense가 둘 다 안 끝남 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Suspense가 둘 다 안 끝남</h3>\n<p>먼저 위 예시에서 두 Suspense가 모두 완료되지 않은 타이밍(~5초 미만)의 HTML을 열어봅시다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2113ffaaa9aa6323accb7cff623d22ae/738b8/image-6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.37974683544303%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBUlEQVR42pWUa3KbQBCEdRpg308WJKFYduI4979QZ2YWyUrFldg/uga2oPl6ZpeDtQ5aKzgf8fT8g/SCNlfSDG09tLGYpum/UkphHEccDL1gtCZTjeP2jO3pFXNKyMHBpwXWBXph/IKhfTdcjmespw3BWXhrYJhQm68R9sgazjmio8gvb7icN6SYYGODIcKBHhzHCQO9OIwfaDcdhoEJHblPqOsFZbkgBY9iFarTqFQb1TUYNG/kmusarGih9WO0mL2mFnlJJJE14cbcsG4vmLMWpZixFNXvS8axGcxzgSISrbrUTUxIHgx3sM53wuWM7foLJU3IcUTOHpGI5OueaKJBJapotSiRsjOkfs1qtfTI/LUyn3C8fEchs0qmJffBcPQixkZqkntzX2NV359buuEt8kwTvhIdmSUyLY4IrfRMDKhyz4LpNGzQAq9z7X1c2fA98obz9U0MRcnC7S+zYZKoSmIyJUetvsfmFgRD/RbDfcq5rjjzps4ToZOaR6LerZHJuFqZaN1jLnc6c187tXqLPCGR4UKRox8R/IRADzJhNP3rQeqf18n26mmN1f4i/PaKmke0QroR8h4kQiZZHsT7cEvuTsg9XefHHrYTRf5JA1EylEJD4SnnfZvkfdppv+aI6baF9slzIvk58DmcJiVVPWzYD8/sP86yHL3PHPzP/hzY8Dcy8OoCya9x7QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Suspense 둘 다 안끝난 경우 HTML\"\n        title=\"\"\n        src=\"/static/2113ffaaa9aa6323accb7cff623d22ae/f058b/image-6.png\"\n        srcset=\"/static/2113ffaaa9aa6323accb7cff623d22ae/c26ae/image-6.png 158w,\n/static/2113ffaaa9aa6323accb7cff623d22ae/6bdcf/image-6.png 315w,\n/static/2113ffaaa9aa6323accb7cff623d22ae/f058b/image-6.png 630w,\n/static/2113ffaaa9aa6323accb7cff623d22ae/738b8/image-6.png 639w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>보면 이렇게 일단 fallback(<code class=\"language-text\">zzzZZ</code> 등)으로 HTML이 채워지고, 그 뒤로는 아직 HTML이 닫히지 않았는데</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/df06f5a414230e6afa4004d0ec6a72cb/6af66/image-7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.34177215189873%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQUlEQVR42l2Py26CYBCFeYm6YQFEgV+5yk8stUKCJViVmxZtxVK1iXWBpBt3LjSNC+PaB+6oaaL9cjKLk8yZM8TxeJzNPrPlcjKdRlEvSZI0/YjjwXD4Oholb6Ok1+//00scP7fb+/2eWK1W1WpV0zSaYU6iaZZlDcMAUxAESZKZi3+lYql0Vyh8LRbEer22LMt1XYxxGUAIghzH0XUd9mVZBq9yiyiKFEXleU5sNpuHeh3rOo8QiON5SZbbna7bajWbTcit1Wo8z3NXIIRIksyyjPjZbp8sy7Hte4ylchmkq2o/DLqmqSkK/IP/gC6XCXGwf7r8necMSVbgUYZhabpIUQLH2Y2GaRiPZxRFgedFAcqKwhlVVaH2fD4nDodDPBgk47Hn+6Cu54VR9J6mMIMgCMPQ9/3OLZ7n2ba92+1+Af3TZwMBtzqSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"chuncked로 HTML을 스트리밍\"\n        title=\"\"\n        src=\"/static/df06f5a414230e6afa4004d0ec6a72cb/f058b/image-7.png\"\n        srcset=\"/static/df06f5a414230e6afa4004d0ec6a72cb/c26ae/image-7.png 158w,\n/static/df06f5a414230e6afa4004d0ec6a72cb/6bdcf/image-7.png 315w,\n/static/df06f5a414230e6afa4004d0ec6a72cb/f058b/image-7.png 630w,\n/static/df06f5a414230e6afa4004d0ec6a72cb/6af66/image-7.png 640w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이 HTML의 응답헤더에 <code class=\"language-text\">Transfor-Encoding: chuncked</code>와 같이 지정하여 HTML을 Streaming중임을 알 수 있습니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 141px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/208d3ccc8223833ea53054f8e0a8aea4/b8677/image-14.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 108.51063829787235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAErElEQVR42m1TXSycWRj+CGX8jApTwjB2sK0LTaiUC3SJ9kJskNJ01ygZle1ebHX1orTSqxJRbUNC1n/9JmirnemFsumg2KC2rZ9timbbClGmaIpFq8+e97VDm+yZnJzznTnf8z4/7yetra1hZmYGz0aeYWxsDIuLi6Dx+fNnXmdnZzHx4sVXZ2KHDx8+YHR0DCMjI5iamsLExAT09+9DWl1dxadPnzA/v4ClpWW+vrGxwevHjx9hNC7g9evXvP8SlN67ebMWpaWlaGtrQ319PerrGiCtrKx8dZHWra2tnf309DSeP39OD1yYxoxg/fjxEF69esWqnj59ijdv3kCv/4+h6eVdSbsFCHx8/K8dMDof/nMYDfUNLLW7uxtVVVVC/ija29shkYdfArx7946rmZ7XVtdgXFgA3SM2w8PDbEFfXz8GBgbw9u1b8c6isMYInU4PiQBMY3Nzk8Pp6u7aBhU/kjs/P48nT56gpbUVnb938r6ivBx1dXUwGAwc3NzcHHspEW3TIBCi3tvbi56eHkxOTnIYNJeXl/l/YkQMaV1fX8c/Yprs6OjogEQpmnwcHx9Hq2BxJfcKp0YSiSGpIBZ/ixAqhV9nzvyEmpoaDsfUDduAndspUx/SIVXU6XSorq7mdVowWn7/Hjq9Hp2dncjJyUFcXBwqKirYS2JJsskCGg8fGnZDMdE2LhhF/Ho0NTVxikODQygsLMTZs2cRExOD8+fPIyUlBUePHsWlS5cQHBzMz7m5uUhJTf3/tlkRZ496HjHLX8+d48vpp9MRFBSExsZGlJWVwdlZAUmSYGlpAQcHB96HhYVDoujbHzxAcXExsyKmi6INsrOzhVdncO+eDpcvX2Zv4+Pjme2t27dQWVkJlacnLCwsYGtry4BRUVGQ+vr6kJGRgejoaPwsAIoE8On0dDg5OSE8LAwtLS3MqL//DzQ3N6OoqIgDMxi6cPvOHahUKlhZWTHgkSPfQaLWIFn+/v44ePAgSktKodFouLKHhwdiY2Nx48YNZkhyQ0JCRJFWZjg4OIhTp04xmLm5GSIiIiC9fDkFrVYLd3d3qLy84OvrCxcXF9jY2EChUECbpkVi4gkcO3aMVRw+fHgnhLLfynDggB8XJ9BwYkjpaTRJLNHb2xtubm7Yu9eB2SmVSgQEBCAyMgKhoaEMSukSk+TkZFZkYbnrIYeSn5+PVIpbHBAjYqfYp4CrqwuUxNpThW/374efnx/bQsEEBgZCZm3NzEgJzR0Pr127hrt325CmTeP4HR0dYWdnB7mDXLSGswDfx3bQOamg6SWsUavVkMvlsBbABGhubi6YR0Ki3qJGXlpaYi/t7e1hL7eHrQDdK0AIyNXVlQGOH0/gr4hCCzp0COpv1NizZw/fNzMzQ3j4EUjXr19ng/Py8nBIXHIRL1NlmUwmZMlYFvnaIFqlUnxy1BUXsi6gpKQEmZmZLNVGZgO5IBIT8z2kAOGHj48PT6W7kn0kCSSFQKnHyIqsrCxcvHiRE05MTBSf4i/QJGtw9Woh+0pMf0xKgkTJ7hM+eau3EyZ2VJEATaDEora2FgUFBdwJlHJwSDBLLyoqRrlgnpiQgJMnf8C/ExGHzvwk15cAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"아직 멀었니\"\n        title=\"\"\n        src=\"/static/208d3ccc8223833ea53054f8e0a8aea4/b8677/image-14.png\"\n        srcset=\"/static/208d3ccc8223833ea53054f8e0a8aea4/b8677/image-14.png 141w\"\n        sizes=\"(max-width: 141px) 100vw, 141px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"2-suspense가-하나-끝남\" style=\"position:relative;\"><a href=\"#2-suspense%EA%B0%80-%ED%95%98%EB%82%98-%EB%81%9D%EB%82%A8\" aria-label=\"2 suspense가 하나 끝남 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Suspense가 하나 끝남</h3>\n<p>이제 Suspense가 하나 끝난 타이밍(5초 이상 ~ 10초 미만)을 봅시다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/22e09ecd6e64d3a5855f9e31f9fd460c/dba9a/image-9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACN0lEQVR42pWU23LaMBCGeZZObJ0lW/IBbCAJJTNNJze96Ps/yt/dNZC0SQO52JGtlT7teeVDhDUa3bjFtHtEThW6bNE0AW2wyCIOXXTI3srak1x0tFdoHRPvOawWoEHpJwH2xWDdkZKAfLj1Ti62J1grgNMDYYHH4FFrDUOcVYwJ1pJFucd8f0TfZQyNh7MGjiy3IvxtLnvu9M86L6uBPgOd9wuw7TDPOwR64NtdhapWqJWCIuHD6hPRJ/nLwrYMGNYTutSjKx1KDmiSldfP0GuyWOg8PFmptUIbGzwf93h53uPXT4vfLwaH+0z6IPqbgHxYgBILh3HYYN4kbHqNsVOwzohO32jlypKFzjmhGwpyChnHfcDDRmGdPTrKZBODhOUzEIclxrhYeAFSFhk4rUf8OCgcd5xNK7prrlZVhVIKVoHqkF3mTUtA7wL6do1xzJQULh962eur0LqukXN+jeECtCdxGPKMw8MeT4eMPuurLl+AfPns8iuQ3NQGU7/FUNZSkxwj9SZeXwZ6k5BckRB47hBOnuiWc/+G4FNgTJH62eP7zmLaFKpPj7ZtaQ3UtwEpJbnz1lIG8pkPgaUt2E8J82gQqPHvKiUX1KkV/9c5UtjvgQ6bbsYTdchhq2n6BBpntUwffUP5vANyce4njWnwyI2TDDdpKambWu8MZBivkWdfpNoLTqRNivYtuXnrcJBO4XlYKAEzDVCDhupyiRUFW+mvTRu2UMqALaRvrj/u6VsAHwH/ACPJW0r+Vf6oAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Suspense가 하나 끝난 경우 HTML\"\n        title=\"\"\n        src=\"/static/22e09ecd6e64d3a5855f9e31f9fd460c/f058b/image-9.png\"\n        srcset=\"/static/22e09ecd6e64d3a5855f9e31f9fd460c/c26ae/image-9.png 158w,\n/static/22e09ecd6e64d3a5855f9e31f9fd460c/6bdcf/image-9.png 315w,\n/static/22e09ecd6e64d3a5855f9e31f9fd460c/f058b/image-9.png 630w,\n/static/22e09ecd6e64d3a5855f9e31f9fd460c/dba9a/image-9.png 652w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Suspense로 기다리던 <code class=\"language-text\">5초 잤어요</code> 블록이 도착했는데,<br>\n웬 <code class=\"language-text\">$RC</code>라는 함수의 선언과 호출이 있는 이상한 스크립트가 같이 왔어요<br>\n이게 React가 <strong>Suspense 경계를 갈아끼우는 비결</strong>입니다</p>\n<h4 id=\"rcb-c-e--completeboundary\" style=\"position:relative;\"><a href=\"#rcb-c-e--completeboundary\" aria-label=\"rcb c e  completeboundary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">$RC(b, c, e)</code> : completeBoundary</h4>\n<p>이 <code class=\"language-text\">$RC</code>라는 함수는 Suspense 경계를 갈아끼우기 위한 함수인데, 원본은 <a href=\"https://github.com/facebook/react/blob/b9be4537c2459f8fc0312b796570003620bc8600/packages/react-dom-bindings/src/server/fizz-instruction-set/ReactDOMFizzInstructionSetShared.js?ref=hackernoon.com#L46\">React fizz instruction 중 하나인 completeBoundary</a>입니다<br>\n원본 코드에 정말 자세한 주석이 친절하게 써있긴한데요<br>\n위 코드를 기준으로 어떤 일이 일어났는지 다시 봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>잠에들어라....얍<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">&lt;!--$?--></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>B:0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>zzzZZ<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">&lt;!--/$--></span>\n  <span class=\"token comment\">&lt;!--$?--></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>B:1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>zzzzzZZZZZ<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">&lt;!--/$--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>일단 fallback으로 채워진 HTML이 왔었는데, 사실 <code class=\"language-text\">&lt;!--$?-->, &lt;!--/$--></code>와 같이 수상하고 이상한 주석이 있고<br>\n<code class=\"language-text\">&lt;template id=\"B:0\"></code>처럼 수상해보이는 <a href=\"https://developer.mozilla.org/ko/docs/Web/HTML/Element/template\">콘텐츠 템플릿 요소</a>도 있습니다<br>\n이 <code class=\"language-text\">B:0</code>이라는 id는 나중에 <strong>제거할 fallback이 어디있는지</strong>를 위한 마킹이고,<br>\n<code class=\"language-text\">&lt;!--$?--></code>는 Suspense경계의 시작점, <code class=\"language-text\">&lt;!--/$--></code>는 종료점을 나타냅니다</p>\n<p>그리고 첫 번째 Suspense가 끝나고 도착한 HTML조각은 아래와 같았습니다</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">hidden</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>S:0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>\n    5\n    <span class=\"token comment\">&lt;!-- --></span>\n    초 잤어요\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>여기에도 <code class=\"language-text\">S:0</code>이라는 수상한 id가 붙어있고, hidden으로 숨겨놓았네요</p>\n<p>이제 아까 그 스크립트(<code class=\"language-text\">$RC</code>)를 다시 봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token comment\">/**\n   * Suspense되었던 부분이 도착하면 갈아끼우는 스크립트 ($RC함수)\n   * b : fallback경계의 id (ex. B:0)\n   * c : 새로 도착한 노드의 id (ex. S:0)\n   * e : errorDigest\n   */</span>\n  <span class=\"token function-variable function\">$RC</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">b<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    c <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 새로 도착한 노드를 get</span>\n    c<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 원래 있던 자리에서 제거</span>\n    <span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// fallback 노드를 get</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      b <span class=\"token operator\">=</span> a<span class=\"token punctuation\">.</span>previousSibling<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> <span class=\"token string\">\"$!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"data-dgst\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        e <span class=\"token operator\">=</span> b<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">;</span>\n        a <span class=\"token operator\">=</span> b<span class=\"token punctuation\">.</span>nextSibling<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> f <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// 기존 fallback 노드를 삭제.</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>a <span class=\"token operator\">&amp;&amp;</span> <span class=\"token number\">8</span> <span class=\"token operator\">===</span> a<span class=\"token punctuation\">.</span>nodeType<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// a타입이 8 => 주석노드</span>\n            <span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> a<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"/$\"</span> <span class=\"token operator\">===</span> d<span class=\"token punctuation\">)</span>\n              <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> <span class=\"token operator\">===</span> f<span class=\"token punctuation\">)</span>\n                <span class=\"token comment\">// 종료태그 \"/$\" 가 나올때까지 노드 삭제를 반복</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n              <span class=\"token keyword\">else</span> f<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// 시작 태그는 \"$?\"</span>\n            <span class=\"token keyword\">else</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"$\"</span> <span class=\"token operator\">!==</span> d <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">\"$?\"</span> <span class=\"token operator\">!==</span> d <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">\"$!\"</span> <span class=\"token operator\">!==</span> d<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> f<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n          d <span class=\"token operator\">=</span> a<span class=\"token punctuation\">.</span>nextSibling<span class=\"token punctuation\">;</span>\n          e<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          a <span class=\"token operator\">=</span> d<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>\n          <span class=\"token punctuation\">;</span>\n          c<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">;</span> <span class=\"token comment\">//받아온 노드를 추가하기.</span>\n\n        <span class=\"token punctuation\">)</span>\n          e<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        b<span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> <span class=\"token string\">\"$\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"$\"는 완료되었음을 표시함.</span>\n      <span class=\"token punctuation\">}</span>\n      b<span class=\"token punctuation\">.</span>_reactRetry <span class=\"token operator\">&amp;&amp;</span> b<span class=\"token punctuation\">.</span><span class=\"token function\">_reactRetry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 혹시 실패하면 재시도</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  $<span class=\"token constant\">RC</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B:0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"S:0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// $RC(fallback노드, 새로도착한노드) 를 실행하여 노드를 갈아끼우기</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>(1) Suspense fallback의 시작점 플래그 주석인<code class=\"language-text\">&lt;!--$?--></code>부터 종료점 플래그 주석인 <code class=\"language-text\">&lt;!--/$--></code>까지 노드를 삭제합니다<br>\n(2) Suspense가 완료되고 새로 받아온 노드를 fallback이 있던 자리에 추가합니다</p>\n<p>그럼 이후 개발자도구의 Elements를 보면 교체된 자리는</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 126px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/06f22376a81cd96fe1948cb104d71b74/d93f7/image-10.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.06349206349206%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACYElEQVR42pVUyXLaQBDVryAE2lmENoQlIWGWQgYDiUmAMjYpDnZyDs7Nzg/wyy/TQ4GhcgAOXdNq6Dfv9TLC8vERo68zDB9/Y/y0weD7L/S/rBCFIeI45hZF0X8Wx3s/PjpjCJQQxgmanXtEaQ9Rq48gbMJ1XW61Wg2O43Df87wT4zHXhu85h1OQZRmyXGRWQNCawEsfMJ2v8PfjHW9vf7DdbvH6+hMf7x94mE5hmAaq1SpL9rDZbNC9X8C/nSK+e0bFCSEoigIyWVZQ9VuwwzvcxCmGgwFaaQvL5RJBEKDdbnNpxwzH4xG8RgL7pg8/GcIoWZ+Auq7jJqijXndhWRaSJGF+HZVKhUsTxRwkSUKxWDyYKIooSHkUC8wkkasUduxkFAoFuI6FkqFC1zTeDNdh4DWLATr8UlVVoRIBVTl8K8fGYgLdRCxGo3u4zRHCbMWkJ8jnxRM2eyXnjDdFY3KrDLRWv0XUm8EoW9A0dcfgQqAD4F4ysZBYnRqshj9Wz5hMJjANk//GpV4ILhx/UJLEaulTM8pl3oT9ZVRj8q8CpEQa5Lrvw7Yd3m3TNHksZJtDtT5XzxNAYkBDS0CUXGYsKVYqlTgonedYfgIyufRnGuKnp2d0Oh10u128vLxgNpthvV7z2BWSWa34kErotlMkzZhvx3w+R5ZlWCwWVzDko2PACXvw0zHbzW/QSzXWlDzEnMhmMo9cLnd9UypuwkAzNLpzdoHJARV5V9tLwE4AaWQagQ/PsWHqCl+3fj+Dw7rts67TE3bJxhwANVXj82fb9uHtS9OUPxDkU5cvAfwHV0o7H95RanIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Suspense 교체 이후 HTML Elements\"\n        title=\"\"\n        src=\"/static/06f22376a81cd96fe1948cb104d71b74/d93f7/image-10.png\"\n        srcset=\"/static/06f22376a81cd96fe1948cb104d71b74/d93f7/image-10.png 126w\"\n        sizes=\"(max-width: 126px) 100vw, 126px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이렇게 <code class=\"language-text\">&lt;!--$--></code>로 마킹하여 \"교체됨\"을 나타냈네요.</p>\n<figure>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 299px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/543e1f23b3e1890eb60815336b5836c7/aeb78/image-11.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVR42gGfAmD9AFxhXXh9e83OzrS7t5unoJ6so2R/aq66sfr5++nq6enp6efl54GKiTpQRIWWjp6ppp2noz5WT3aMdmBqWgBHS0jg4OD////9/f3p7OmElYqRn5nNzs7i4eLq6urz9PPx7/BzjYGInpH29fX8+/u3vrtBWVNzh3JdaFYAZWhn8/Lz9PT08vLy9fX1bXl0Ljg0pK2p19jX29rb7Ons7O3tTWRao62q4dzh3tze+Pf3YnFwUmRUZXFcAF9iYO7t7vT09PPz8/b19m6BeoeOi4SUjY6djLm6uM3Jzq2vsLW5utna2s7Kz+fk6Lm6uzZCQlxqWWx5ZAA7Pj6dnZ/QzM/GxMepsLHW3dyjqKc/Vk5tgG/U1NGoqKpxdHT7+/r5+vnc2NzIwciytbVld2xygm1fbF0AQU1CO0E8QUZGSFdRiJqT6unro6WmM0Y/iJWLvb+7aHJrh4yKwsXEz87Q0c/T5ePl////1tzUX21cS1ZRAGCCX2eEX1psWVZjXefm57a4uYSQiUVYT2FxaWRrYmpzbL6/wa61s1BfWtnb2u/v79vW3NbX2VViXD5KRgBihl9jhWJ7l3d7lHzU1NfBwsOIloZWZVVjb2OEiIO5uLdbZGKLkI66v73S0tLw8PDIwsmWnZlNW1NDT0oAWnxWXXpaa4hjZoJim6mbvsHAs7m2g4yCbXVqtLm0wMC/dHp4ycXI8O/v09HT1tPY1NLUZ3ZsTV1VPkRDAFx/Wl18XmaFX3WNaXmKZ4KKaHp+ZWhyWX2FcMC9uMC6vcO6wcG3w7+8v6Ssn5aglam1pmN2ZkZWTz1GQgBljWBfhF5mhl9ukGRukGd4kGiBimaMjGqZm3WLkGuRl3CSl3WLj3aPl35ziGped1hbeFdae1pggVxffVrKKI8xVewVbAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"퍼엉~\"\n        title=\"\"\n        src=\"/static/543e1f23b3e1890eb60815336b5836c7/aeb78/image-11.png\"\n        srcset=\"/static/543e1f23b3e1890eb60815336b5836c7/c26ae/image-11.png 158w,\n/static/543e1f23b3e1890eb60815336b5836c7/aeb78/image-11.png 299w\"\n        sizes=\"(max-width: 299px) 100vw, 299px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<figcaption>\n바꿔치기\n</figcaption>\n</figure>\n<h3 id=\"3-suspense-둘-다-끝남\" style=\"position:relative;\"><a href=\"#3-suspense-%EB%91%98-%EB%8B%A4-%EB%81%9D%EB%82%A8\" aria-label=\"3 suspense 둘 다 끝남 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Suspense 둘 다 끝남</h3>\n<p>Suspense Boundary를 바꿔치기하는 인술이 있는걸 알았으니 이제 이해가 편하겠네요<br>\n두 번째 Suspense가 끝나도 똑같습니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 554px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/579d2afee587c34ed876ff36b2114f7c/04abd/image-12.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.11392405063291%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAu0lEQVR42p2R2w7CIBBE+y8+cL8JLZZGW23U//+iceklMdGnPkxmmSWHBRopJZRS6MoDOSe04YScBGL0SIZyqxCNREtelX3NNDpHNeni9LKv1tEZNEIIGGPR314o4xMdgfLZLIco6ikpVt9Fa71l+qvee02dsEJjTJjuM4x14JyDMw5Gznb/J/bbXybUWqO/zhiGAd45SMFX6AE1koDOB5TpjZIzrGQI9EaHgT7QR/QjXdWDE5xvox8FfgAUsLUR4BVC0AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"두 번째 Suspense까지 끝난 html\"\n        title=\"\"\n        src=\"/static/579d2afee587c34ed876ff36b2114f7c/04abd/image-12.png\"\n        srcset=\"/static/579d2afee587c34ed876ff36b2114f7c/c26ae/image-12.png 158w,\n/static/579d2afee587c34ed876ff36b2114f7c/6bdcf/image-12.png 315w,\n/static/579d2afee587c34ed876ff36b2114f7c/04abd/image-12.png 554w\"\n        sizes=\"(max-width: 554px) 100vw, 554px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이제 <code class=\"language-text\">$RC</code>함수 선언이 이미 있으니 <code class=\"language-text\">$RC(\"B:1\", \"S:1\")</code>이라고 호출만 해주면 되겠죠?<br>\n그리고는 Streaming이 끝났고 html이 닫혔습니다</p>\n<h1 id=\"suspense로-클라이언트-컴포넌트를-기다릴-수도-있어요\" style=\"position:relative;\"><a href=\"#suspense%EB%A1%9C-%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EB%A5%BC-%EA%B8%B0%EB%8B%A4%EB%A6%B4-%EC%88%98%EB%8F%84-%EC%9E%88%EC%96%B4%EC%9A%94\" aria-label=\"suspense로 클라이언트 컴포넌트를 기다릴 수도 있어요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Suspense로 클라이언트 컴포넌트를 기다릴 수도 있어요</h1>\n<p>제곧내<br>\n클라이언트 컴포넌트가 Promise를 반환하는 함수를 받아서 <a href=\"https://ko.react.dev/reference/react/use\"><code class=\"language-text\">use</code>훅</a>으로 이를 읽으면 됩니다</p>\n<blockquote>\n<p>use에 전달된 Promise가 대기Pending하는 동안 use를 호출하는 컴포넌트는 Suspend됩니다.</p>\n</blockquote>\n<p>이제 아래처럼 Promise를 props로 받는 간단한 클라이언트 컴포넌트를 만들고</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token string\">\"use client\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> use <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token constant\">RCC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> cb <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> cb<span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">use</span><span class=\"token punctuation\">(</span>cb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>result<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 이 <code class=\"language-text\">&lt;RCC></code>에 Promise를 전달하고 Suspense로 감싸면?</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Page</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Client Component + Suspense</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Suspense</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">큰거온다 ....</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RCC</span></span> <span class=\"token attr-name\">cb</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">getSomething</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Suspense</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>결과는?</p>\n<p><img src=\"https://i.imgur.com/U4IPxeY.gif\" alt=\"RCC + Suspense\"></p>\n<p>이러면 Streaming되는 형태도 위에서 서버 컴포넌트를 Suspense할 때와 정말 아주 비슷하게 이루어집니다<br>\n너무 비슷해서 굳이 또 안보여줘도 될 정도</p>\n<h1 id=\"아까부터-자꾸-보이는-self__next_fpush\" style=\"position:relative;\"><a href=\"#%EC%95%84%EA%B9%8C%EB%B6%80%ED%84%B0-%EC%9E%90%EA%BE%B8-%EB%B3%B4%EC%9D%B4%EB%8A%94-self__next_fpush\" aria-label=\"아까부터 자꾸 보이는 self__next_fpush permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>아까부터 자꾸 보이는 <code class=\"language-text\">self.__next_f.push</code></h1>\n<p>저는 이거 해보다가 되게 궁금한게 있었는데</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 463px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/08065e68c0f359d2f0cf7c3c4b6f35ec/71ce0/image-15.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.55696202531645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/ElEQVR42k1T2XLcMAzL19iydZ+Wj026mUk7TfP/v4OQkrLdBw11giBAvUi5woWC4/UDwWtsaYKzGs4FBCeQwgxrLFK02ItCygmLEP/HIiAorqLHFwYMeUd9/U2AFt5MUEpCawNvBYELSMkJNLxfYayFmPvjmePc48RrBlRSIqSK4+0DNStkYnSUGTk7GDrbrMJuJbJecVEFiWJ1CoX2Dq/a/KT9i+a7k51h2i5c71/IUSO6CVsUiME2QAbIRiJq2eJGQEYucGqlvX7G4GncaQzTduD89RclGdJtQiHAwID0qBg5ACmxIXb02A7A0EDlI2HSg6ELGdt5JwPowM8NsDNc2yXOngaoV2ubM0igNTMuT2sCpIvDlBgUnJmpbNFMkOvSygsEykA8mJmVfc5nP3tOLY15L7mcuL1/ohZNpkxkikBOnoBUy76T8Jz9FnSb/7BMppvmnqR5AF73z2HKjJqoZOo7r7sJhR6xfhzzExBLsA+X+Z4l4AbIJe9UMgNyH0YvqOdMM4UfMbtmAms4dOx7yzCr68sSdFN8QiVTcpStD2umHxIdtOxtEUZJcZjQkqg+r0MCdpn3G8Ncbzjv/whEd1OIoSVTGJCFZrc5ux3DPcxZHmZZ9WDIP6XgfPtDphhqmQknm5LJFMOmrE+69VhJPx7cUu3HuLE2Et+97ZPr+YMVpwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"self.__next_f.push\"\n        title=\"\"\n        src=\"/static/08065e68c0f359d2f0cf7c3c4b6f35ec/71ce0/image-15.png\"\n        srcset=\"/static/08065e68c0f359d2f0cf7c3c4b6f35ec/c26ae/image-15.png 158w,\n/static/08065e68c0f359d2f0cf7c3c4b6f35ec/6bdcf/image-15.png 315w,\n/static/08065e68c0f359d2f0cf7c3c4b6f35ec/71ce0/image-15.png 463w\"\n        sizes=\"(max-width: 463px) 100vw, 463px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이 <code class=\"language-text\">self.__next_f.push</code>가 대체 뭐하는 애들인지?<br>\n<code class=\"language-text\">next</code>라는 단어가 들어가는걸 보니 Next.js에서 몰래 집어넣는 것 같긴 한데요..<br>\n하나 적당히 골라서 알아보기 쉽게 포맷팅해보면</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">self<span class=\"token punctuation\">.</span>__next_f<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'24:[\"$\",\"p\",null,{\"children\":[5,\"초 잤어요\"]},\"$25\"]\\n'</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이렇게 생겼습니다<br>\n여기 문자열은 <strong>RSC Payload</strong>인데, RSC Payload에 대해서는 이전 글에서 소개했으니 넘어가고<br>\n이를 Next.js는 <code class=\"language-text\">self.__next_f</code>라는 배열에 플래그(<code class=\"language-text\">1</code>)와 함께 집어넣습니다<br>\n<a href=\"https://github.com/vercel/next.js/blob/78dc2db916e93ddcffb7418972b40e8d6006fb06/packages/next/src/client/app-index.tsx#L147\"><code class=\"language-text\">next/src/client/app-index.tsx</code></a>에 관련 소스코드가 있으니 들여다보면</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> nextServerDataLoadingGlobal <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>self <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__next_f <span class=\"token operator\">=</span>\n  <span class=\"token punctuation\">(</span>self <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__next_f <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nnextServerDataLoadingGlobal<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>nextServerDataCallback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nnextServerDataLoadingGlobal<span class=\"token punctuation\">.</span>push <span class=\"token operator\">=</span> nextServerDataCallback<span class=\"token punctuation\">;</span></code></pre></div>\n<p>(1) 먼저 <code class=\"language-text\">self.__next_f</code> 배열을 만들고<br>\n(2) <code class=\"language-text\">nextServerDataCallback</code>을 배열의 기존 원소들에 대해 <code class=\"language-text\">forEach</code>로 호출<br>\n(3) <code class=\"language-text\">push</code>메서드를 오버라이드하여 <code class=\"language-text\">__next_f.push</code>로 새로 들어오는 원소들에 대해 모두 똑같이 <code class=\"language-text\">nextServerDataCallabck</code>을 호출합니다</p>\n<p><code class=\"language-text\">nextServerDataCallback</code>은 이렇게 생겼어요</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">let</span> initialServerDataBuffer<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> Uint8Array<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">undefined</span>\n<span class=\"token keyword\">let</span> initialServerDataWriter<span class=\"token operator\">:</span> ReadableStreamDefaultController <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">=</span>\n  <span class=\"token keyword\">undefined</span>\n\n<span class=\"token operator\">...</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">nextServerDataCallback</span><span class=\"token punctuation\">(</span>\n  seg<span class=\"token operator\">:</span>\n    <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span>isBootStrap<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span>isNotBootstrap<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> responsePartial<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span>\n    <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span>isFormState<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> formState<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">]</span>\n    <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span>isBinary<span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> responseBase64Partial<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>seg<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    initialServerDataBuffer <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>seg<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>initialServerDataBuffer<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Unexpected server data: missing bootstrap script.'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>initialServerDataWriter<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      initialServerDataWriter<span class=\"token punctuation\">.</span><span class=\"token function\">enqueue</span><span class=\"token punctuation\">(</span>encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>seg<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      initialServerDataBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>seg<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ... else seg[0] === 2이거나 3일 때의 로직</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">0~3</code>까지 4가지 플래그 중 0은 초기화를 나타내어 버퍼를 만들고<br>\n1은 그 이후로 Payload 데이터가 들어온 경우 이를 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/ReadableStreamDefaultController\">ReadableStreamDefaultController</a>에 밀어넣어줍니다(payload 또한 함께 스트리밍되므로 RedableStream으로 다루어야 함).</p>\n<p>일전에 React Server Component들은 클라이언트에 전달되지 않고 렌더링 결과만이 전달된다고 했습니다<br>\n근데 이 <em>렌더링 결과</em>라는게 HTML만 브라우저에 전달하고 끝이라면 일개 HTML 자판기겠죠 RSC는?<br>\nReact 어플리케이션으로서 역할을 하게 하려면 Hydration 등을 위한 React Tree 구성 정보를 보내줘야 하고, 이를 위한 설명서가 RSC Payload입니다.<br>\n이 RSC Payload는</p>\n<figure>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ddd2c849886d39d4ed73c8d2ccf6c43d/9b29b/image-16.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.59493670886076%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3ElEQVR42nWRa2sTURCG86f0g6Ig+BMEvwn2R6gUQfpB0RZEKIoXaihGA2oxlio1YSNNI9nG9uzlnD1dZSW3utvsJdltLtvsZnOcFBvqNsJwOMzMy7zzTALb4SRkM5APhrTDZCsQjL7shIo3gj/EuKq3ieVjezjpTxz/AuIMkd77uvKZ3/mhehFfd0vir7KoyZA3erQ94stru42a7DBojolDbAWSy3IPF9Pnzi49fo4go/e26Z5kDpDeVewAqYg4DmkzbJ0Sw2Sw+h1XBHWPU6qlisPXHNoZl4ravuSFZVorJtOi0YfOuG14pVb06dZs+vLF1Zcp7DEOqR+4kuKyTdpYuXHzxaXzydnb4Igc9yf+AQbhBaiI3q1x5bqHzYGgd3ErKuLq0tzdQnYTWBIHFowBs/4Cy796m8+sE62xbXTzolYgVTiBZPlqwGhvNPE4BZjssvyz5OsLZ57emYMVSj+N7BaBgyE4mzmQm4cnbcZti81D6ocAqaCZfLWl+JFou7k374W6R1rRBPIp8ZFtoelnFx5lHswLpLLzu/Mts748cy21+EQ4Aek/k49sb3z8snr1yvK9eW6LpGau5+4vSPqBaA1isim2IXb7jPYZsgNx3xe9iAZjvLDwVPEfqIZo/ne4sGAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"레고 조립법\"\n        title=\"\"\n        src=\"/static/ddd2c849886d39d4ed73c8d2ccf6c43d/f058b/image-16.png\"\n        srcset=\"/static/ddd2c849886d39d4ed73c8d2ccf6c43d/c26ae/image-16.png 158w,\n/static/ddd2c849886d39d4ed73c8d2ccf6c43d/6bdcf/image-16.png 315w,\n/static/ddd2c849886d39d4ed73c8d2ccf6c43d/f058b/image-16.png 630w,\n/static/ddd2c849886d39d4ed73c8d2ccf6c43d/40601/image-16.png 945w,\n/static/ddd2c849886d39d4ed73c8d2ccf6c43d/78612/image-16.png 1260w,\n/static/ddd2c849886d39d4ed73c8d2ccf6c43d/9b29b/image-16.png 3840w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<figcaption>\n<p><a href=\"https://www.lego.com/ko-kr/family/activities/build-a-racing-car\">레고® 레이스카 조립법</a> - LEGO.com</p>\n</figcaption>\n</figure>\n<p>레고 한 상자 사면 블록(HTML)과 조립법(RSC Payload)들이 같이 오는 것 처럼요?<br>\n괜찮은 비유인지는 모르곘는데 대충 이래서 RSC Payload가 필요하다고 이해하면 편할 듯 싶습니다</p>\n<p>아무튼 그리고 이제 이 RSC Payload를 클라이언트 사이드에서 갖고 써먹기 위해 Next.js는 <code class=\"language-text\">self.__next_f</code> 배열로 관리하는 셈이구요</p>\n<p>이에 대해 더 자세한 딥다이브가 낋여오르신다면 <a href=\"https://edspencer.net/2024/7/1/decoding-react-server-component-payloads\">Decoding React Server Component Payloads</a>라는 글이 있으니 보시면 좋을 것 같아요</p>\n<blockquote>\n<p>It's not likely to be something you need to worry about in your day-to-day work, but if you're a curious geek like me, read on.</p>\n</blockquote>\n<p>또는 <a href=\"https://saengmotmi.netlify.app/react/what-is-rsc/\">[A는 B] 1. RSC란?</a> 이라는 글도 있는데 여기도 내용이 아주 좋와요</p>\n<h1 id=\"self__next_fpush가-어플리케이션을-두-배-무겁게-합니다\" style=\"position:relative;\"><a href=\"#self__next_fpush%EA%B0%80-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EC%9D%84-%EB%91%90-%EB%B0%B0-%EB%AC%B4%EA%B2%81%EA%B2%8C-%ED%95%A9%EB%8B%88%EB%8B%A4\" aria-label=\"self__next_fpush가 어플리케이션을 두 배 무겁게 합니다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">self.__next_f.push</code>가 어플리케이션을 두 배 무겁게 합니다?</h1>\n<p>방금 살펴본 이 <code class=\"language-text\">self.__next_f.push</code>가 왜 무엇을 위해 필요한지, Next.js가 이런 방식을 왜 선택했는지 알 수 있는 Github Discussion이 있는데요<br>\nNext.js 13버전이 막 나왔을 때 있었던 <a href=\"https://github.com/vercel/next.js/discussions/42170#discussioncomment-8137079\">NEXTJS 13: self.__next_f.push</a>이라는 Discussion이 재미있어서 소개하려고 합니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0ea0f3ac30fc5e94fd7ad343815fa3be/6da96/image-17.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC40lEQVR42lVT20uTYRz+yjTTzW06v003t7mTmzt9znlIQyyKghLUZQlZiJlIQVdhCV73b3RguqaSXUR00bUgpjDXjl5MxW3fNgkMukue3vcdU/zg4feevuf3PL/393KDA2Pw33sBX89tuHx96Bu4CZvTC2/3NQhk3tN/HXaXD8Y2F1pabZAqVAx1NMp5gtK4DK7PPYHxG29hMPZDrTNDq7dAa7CCbzYwNDbpCXTgSVQ0ahhJ+WeFshmyevV5QpPVDMErgNfo0cC3QKnWobZOeQZZYwlkzJRRAgJK7hC6WXIJ2T8lVGlaYbK6yIYNGnMH1C1WpogpI+RlULVUUdmyrKEJzcSRQqlhCahSmUINjloxWpyw2D0MJqsTZpv7bE5qR9eoEjklJGqobTkhNJjbmVIJrSWrKVFIF+kFeDqvwkksOIUuODxdcHt72aXYXZ1sjyahZ2nUEGVUkUZvhqG1jSWq57VMLbOsJYu0fswmsVZdq0BFlQQVl6W4REBj5RUZqmrkDBerpMQej7tDI/CPjGDMP4rh4TG4hF5wt+4MYXnlC4KLISwFVrC4uIrQ8ipWVtewFFzDu/efyXoIocAnBD4EEfgYxPdvPzA5PYPRh4/wbHYK4/f9GOz2wWG1g5uansWf33+xt5dD7lBEIStCzBaQPSzgYC+LHBnnM0cQ0/vYj4eRzxVBv9dvFlAtqYeKOKLqa0gX0Fpyj588ReYwg2g0ilQyhd3kLpIkJhJJxBMJEktIJpPYTaWQTqdxcvIPr+bmUS1VwmTzkNo60KSzoEGlAzc5NYOjoyIODvaRyWQg5kRks1nk83kUiwWIYu40Hh8fszP0m5tfgIS0iUPoYTC2uUkP68E9GJ9ALBbD5uYWNjbWsb7+FT+3thGJ/EI4vIOdnUgJ4Qji8QSisThLNvv8JS5UStgLksj40jOkja0mt2yxC3ALHbC1O+F0O9hb1pGbPwej7dycEtFmp/1Ybmwa/wNJtPZCQOMgKgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"self.__next_f.push에 대한 Github Discussion\"\n        title=\"\"\n        src=\"/static/0ea0f3ac30fc5e94fd7ad343815fa3be/f058b/image-17.png\"\n        srcset=\"/static/0ea0f3ac30fc5e94fd7ad343815fa3be/c26ae/image-17.png 158w,\n/static/0ea0f3ac30fc5e94fd7ad343815fa3be/6bdcf/image-17.png 315w,\n/static/0ea0f3ac30fc5e94fd7ad343815fa3be/f058b/image-17.png 630w,\n/static/0ea0f3ac30fc5e94fd7ad343815fa3be/6da96/image-17.png 922w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p><code class=\"language-text\">self.__next_f.push</code>가 제 웹페이지의 모든 컨텐츠에 두 배 이벤트를 적용중임 ㅜㅜ</p>\n</blockquote>\n<p>이러시는데, 이 밑에 메인테이너의 답변이 달리기 전까지 다른 사람들도 막.. 걱정을 토로하셨는데</p>\n<p><img src=\"https://i.imgur.com/H2E49RN.png\" alt=\"(반응 1)업데이트가 필요해요\"></p>\n<p>\"업데이트가 필요한듯 ㅜㅜ 이거때문에 페이지가 두 배 커져서 새 Next.js를 떼어냈어요..\"</p>\n<p><img src=\"https://i.imgur.com/i69taeI.png\" alt=\"(반응 2) 서버 컴포넌트가 많을 수록 페이로드도 너무 커요\"></p>\n<p>\"서버 컴포넌트가 많으면 (아이러니하게도) 페이로드가 너무 커지네용;;\"</p>\n<p>이런 반응들이 달렸습니다</p>\n<h2 id=\"메인테이너의-답변--필요한가-왜-이런-방법을-썼는지\" style=\"position:relative;\"><a href=\"#%EB%A9%94%EC%9D%B8%ED%85%8C%EC%9D%B4%EB%84%88%EC%9D%98-%EB%8B%B5%EB%B3%80--%ED%95%84%EC%9A%94%ED%95%9C%EA%B0%80-%EC%99%9C-%EC%9D%B4%EB%9F%B0-%EB%B0%A9%EB%B2%95%EC%9D%84-%EC%8D%BC%EB%8A%94%EC%A7%80\" aria-label=\"메인테이너의 답변  필요한가 왜 이런 방법을 썼는지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메인테이너의 답변 : 필요한가? 왜 이런 방법을 썼는지?</h2>\n<p>그러다 Maintainer이신 gnoff라는 분의 <a href=\"https://github.com/vercel/next.js/discussions/42170#discussioncomment-8880248\">답변</a>으로 이 discussion을 종식시켰는데</p>\n<p><img src=\"https://i.imgur.com/LKqn421.png\" alt=\"메인테이너의 답변\"></p>\n<p>본문이 꽤 길고 다 영어라서 막막합니다.<br>\n그래서 정리해서 가져왔어요<br>\n지금부터는 완전히 원문 번역&#x26;정리입니다.</p>\n<h3 id=\"self__next_fpush는-꼭-필요한건가요\" style=\"position:relative;\"><a href=\"#self__next_fpush%EB%8A%94-%EA%BC%AD-%ED%95%84%EC%9A%94%ED%95%9C%EA%B1%B4%EA%B0%80%EC%9A%94\" aria-label=\"self__next_fpush는 꼭 필요한건가요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(<code class=\"language-text\">self.__next_f.push</code>는) 꼭 필요한건가요?</h3>\n<p>짧게 이야기하면, 네. 필요합니다.</p>\n<p>React가 상호작용 가능하려면 브라우저에서 Hydration하는데<br>\n이전에는 <em>클라이언트에서 어플리케이션을 렌더링하는 방법에 대한 모든 지침이 포함된 코드 번들</em> 을 다운로드하게 하여 RSC Hydration을 수행했는데,<br>\n이는 규모가 커짐에 따라 번들이 증가하고 브라우저에 훨씬 더 많은 바이트를 전송한다는 단점이 있습니다.</p>\n<p>RSC는 일종의 동적 번들링으로 생각할 수도 있는데 :<br>\n서버 렌더링은 <strong>트리</strong>로 표현되는 <code class=\"language-text\">클라이언트 코드 청크</code>와 <code class=\"language-text\">서버 HTML 마크업</code> 세트를 생성합니다(이 트리는 개념적으로 \"번들\"입니다).<br>\n이는 더이상 완전한 정적이 아니라 런타임에 생성되며 브라우저에서 로드되어야 Hydration이 이루어집니다.</p>\n<h4 id=\"html에-이미-있는-내용과-중복되는-것-같은데-html에-있는-정보들을-써서-hydration하면-안되나요\" style=\"position:relative;\"><a href=\"#html%EC%97%90-%EC%9D%B4%EB%AF%B8-%EC%9E%88%EB%8A%94-%EB%82%B4%EC%9A%A9%EA%B3%BC-%EC%A4%91%EB%B3%B5%EB%90%98%EB%8A%94-%EA%B2%83-%EA%B0%99%EC%9D%80%EB%8D%B0-html%EC%97%90-%EC%9E%88%EB%8A%94-%EC%A0%95%EB%B3%B4%EB%93%A4%EC%9D%84-%EC%8D%A8%EC%84%9C-hydration%ED%95%98%EB%A9%B4-%EC%95%88%EB%90%98%EB%82%98%EC%9A%94\" aria-label=\"html에 이미 있는 내용과 중복되는 것 같은데 html에 있는 정보들을 써서 hydration하면 안되나요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HTML에 이미 있는 내용과 중복되는 것 같은데, HTML에 있는 정보들을 써서 Hydration하면 안되나요?</h4>\n<p>일단 첫 번째 챌린지는 <em>클라이언트 컴포넌트를 발견하고 HTML 트리 내에서 컴포넌트가 구성되는 위치를 파악</em> 할 수 있어야 한다는 것입니다.<br>\n그런데 이를 표시하기 위해 HTML 트리에 메타 데이터를 추가하면 이것도 추가 byte고, SSR된 HTML 마크업에 React만을 위한 속성을 집어넣는거라 낫 굿이예요</p>\n<p>그리고 초기 데이터(원문에서도 갑자기 initial data라는 말을 계속 쓰기 시작하는데, 맥락상 페이로드라고 보시면 될 듯)가 Hydration Data뿐만 아니라 <em>상호작용으로 로드된 UI</em>일 수도 있다는 점이 문제입니다.</p>\n<ul>\n<li>ex. 숨겨진 컨텐츠가 있는 툴팁이 있고, 클릭핸들러로 이를 표시하는 경우</li>\n<li>이 경우 트리의 해당 부분은 HTML에 포함되지 않으므로 이 위치를 복구할 방법이 없습니다.</li>\n</ul>\n<p>그래도 리프 HTML트리(클라이언트 컴포넌트를 포함하지 않는 HTML)의 hydration 데이터를 제거하기 위해 React에서 가능한 몇 가지 최적화 방안이 있긴합니다.<br>\nReact 팀은 언젠가 이 작업을 할 예정은 있는데, 구체적인 ETA는 정해지지 않았습니다.</p>\n<h3 id=\"초기-데이터를-가져오기-위한-최적의-방법은-뭔가요\" style=\"position:relative;\"><a href=\"#%EC%B4%88%EA%B8%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0-%EC%9C%84%ED%95%9C-%EC%B5%9C%EC%A0%81%EC%9D%98-%EB%B0%A9%EB%B2%95%EC%9D%80-%EB%AD%94%EA%B0%80%EC%9A%94\" aria-label=\"초기 데이터를 가져오기 위한 최적의 방법은 뭔가요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>초기 데이터를 가져오기 위한 최적의 방법은 뭔가요?</h3>\n<p>위에서 React가 Hydration하고 페이지의 (개념적)<strong>번들</strong>을 가져오기 위해 초기 데이터가 필요함을 확인했습니다.<br>\n그럼 문서를 로드할 때 Next.js가 초기데이터를 제공하기 위한 가장 좋은 방법이 뭐가 있을까요?</p>\n<p><strong>데이터 일관성 및 캐시 수명</strong></p>\n<ul>\n<li>Next.js에서 한 가지 보장하려는 것은 <code class=\"language-text\">(SSR에 사용되는 초기 데이터) == (페이지를 Hydration하기 위해 React에 제공하는 초기 데이터)</code> 이 일관성입니다.\n<ul>\n<li>이를 구현하기 위한 가장 좋은 방법은 HTML문서에 초기 데이터를 주입하는 것입니다.</li>\n<li>반면 별도의 리소스를 로드해야 한다면 고려할게 많은데, 예를 들어 write가 너무 느리거나, 요청 오류가 발생하거나, ...</li>\n</ul>\n</li>\n<li>static한 페이지를 캐시하는 경우, 문서와 초기 데이터가 함께 존재하면 캐싱 라이프사이클동안 항상 함께 존재하므로 캐싱 무효화 타이밍에 동기화 걱정도 없습니다.</li>\n</ul>\n<h3 id=\"페이지-성능-core-web-vital\" style=\"position:relative;\"><a href=\"#%ED%8E%98%EC%9D%B4%EC%A7%80-%EC%84%B1%EB%8A%A5-core-web-vital\" aria-label=\"페이지 성능 core web vital permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>페이지 성능 (Core Web Vital)</h3>\n<p>Core Web Vital은 중요하며, 페이지가 커져서 중요한 시각정보가 표시되지 않는 경우를 원하지 않습니다.<br>\n초기 데이터는 스트리밍 가능하며, 시각적 컨텐츠보다 우선순위가 낮습니다.<br>\nNext.js에서 렌더링되는 모든 HTML문서에는 항상 다음이 포함되는데 :</p>\n<ul>\n<li>문서 <code class=\"language-text\">head</code>와 <code class=\"language-text\">body</code>, 그리고\n<ul>\n<li>중단된 내용이 없거나 Suspense같은게 없으면 => 전체 페이지 컨텐츠</li>\n<li>로딩 상태가 있는(Suspense) 일부 페이지 컨텐츠 => HTML 껍데기</li>\n</ul>\n</li>\n</ul>\n<p>그리고 Next.js에서 추가로 스트리밍할 HTML이 있다면, 초기 데이터보다 이 우선순위를 높입니다.\n초기 데이터가 전송되는 유일한 경우는 \"<em>렌더링이 시각적인 컨텐츠를 추가로 계속 표시하기 위해 IO에서 대기중</em>\"인 경우입니다.<br>\n이 경우 가능한 대역폭을 최대로 활용하기 위해 초기 데이터의 일부를 전송합니다.<br>\n또한 static한 페이지는 항상 완전한 HTML이 먼저 생성되며 마지막에 초기 데이터를 추가합니다.</p>\n<p>그래서 이게 Core Web Vital에 무슨 의미가 있냐면 :</p>\n<ul>\n<li>초기 데이터는 <em>시각적 컨텐츠</em>의 앞에 위치하지 않으므로 브라우저는 HTML을 받자마자 이를 빠르게 파싱하고 렌더링할 수 있습니다.</li>\n<li>초기 데이터를 문서 자체에 인코딩하면 다른 리소스의 로딩도 시각적 HTML도 차단하지 않으면서 가장 낮은 우선순위로 데이터가 도착하게 만들 수 있습니다.</li>\n</ul>\n<p>연관된 이슈로 <strong>Page Weight</strong>라는게 있는데.. 페이지 자체의 무게가 크면 Core Web Vital이 저하된다는 개념입니다.<br>\n근데 이건 <code class=\"language-text\">페이지가 클 수록 \"로드할 내용\"이 많아진다</code> ==> <code class=\"language-text\">그럼 더 많은 내용을 로드하는데 더 많은 시간이 든다</code>라는 상관관계가 있을 때 성립하지만,<br>\n초기 데이터의 추가 페이지 무게는 <code class=\"language-text\">\"로드할 내용\"</code>이 아니라서 Core Web Vital 저하와 관계가 없습니다.</p>\n<h3 id=\"앞으로의-react-방향성\" style=\"position:relative;\"><a href=\"#%EC%95%9E%EC%9C%BC%EB%A1%9C%EC%9D%98-react-%EB%B0%A9%ED%96%A5%EC%84%B1\" aria-label=\"앞으로의 react 방향성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>앞으로의 React 방향성</h3>\n<p>장래에 React는 initial data에 대해 [일급](first-class citizens) 지원을 제공하고자 합니다.<br>\n앞으로는 <code class=\"language-text\">__next_f.push</code> 대신에, 이와 완전히 동등한 React 구현체가 있을 예정이며,<br>\n그 때에도 현재 Next.js가 이 방식으로 초기 데이터를 임베드하는 것과 동일한 이유로 여전히 데이터를 문서에 임베드할 것입니다.</p>\n<h3 id=\"요약\" style=\"position:relative;\"><a href=\"#%EC%9A%94%EC%95%BD\" aria-label=\"요약 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>요약</h3>\n<p>React는 상호작용을 위해 Hydration해야 합니다. 이는 React 모델의 한 부분으로, Next.js가 손 댈 부분이 없습니다.</p>\n<p>RSC는 동적 번들링의 한 형태이므로 hydration(그리고 update)를 위한 <strong>초기 데이터</strong>는 더이상 CDN에서 정적으로 제공될 수 없습니다.<br>\n이 <em>동적 번들링 형태</em>에는 장단점이 있지만, 앱 크기와 복잡성이 커질 수록 요청별 동적 번들링이 더 낫다는 것이 React의 판단이며, Next.js는 이를 따릅니다.</p>\n<p>Next.js는 Core Web Vital에 큰 영향을 미치는 하위 리소스 및 HTML은 먼저 보내고, 초기 데이터는 상대적으로 늦게 스트리밍하여 최상의 Core Web Vital을 제공할 수 있도록 최적화합니다.<br>\n지금처럼 초기 데이터를 HTML 문서에 임베드하는 것은 나쁘지 않을 뿐 아니라 다른 모든 옵션보다 유리합니다.<br>\npages router나 non-rsc 프레임워크가 이렇게 하지 않는 것은 초기 데이터가 \"완전히 정적\"이기 때문입니다.</p>\n<hr>\n<p><br>\n여기까지 전부 메인테이너의 답변 원문으로부터 정리한 내용입니다.</p>\n<p>이렇게 지금까지 Post-React 18 기능들인 Suspense, Streaming, RSC 등에 대한 간단히 예제를 알아봤고<br>\nReact가 어떻게 Suspense를 갈아끼우는지, Next.js가 RSC Payload를 어떻게 다루는지 등에 대해서도 조금 더 알아봤습니다<br>\n게다가 Github Discussion 하나 잡고 탈탈 털어서 Next.js의 설계 의도까지 맛봤네요</p>\n<figure>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 210px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c58ef8b7a03fe6c62b88419775e519db/65ed1/image-19.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC3ElEQVR42o1T+0tTYRjePxVRUCQhKWQlav2QFSwKU4lmkNQPm+YlUbAZKYnSaqzpEmPu7mab5i4qZ+3szI7ufm33iyw3T3PH9W5Hp02lnh8+Pt7ved7n/d73+2iFEvZKKPwLFTTa0VA6nY5Go/F4HMMwrVarPwDsTSZTKpUiSZLi74upXSKR+FGCzWbbLCEYDPr9/kAgQK0bJaAo6na7y/qiczablUgkwC7XBg67u7sVNUOQIAi1Wu3xeChaUWyxWEKhkEKh4HA4DodDo9Gsra0plcqFhQWxWAyr0WhUqVRAEwqFyWTSbDYfisE2k8nAmVQqRRCko6NDJpNNTU2BiVwuhyAQ+Hw+1AxBuBqO44dil8slEomgW7lcbmdnJxwOw0WgC1Dkb6IIOIJugafBYIACgbYvpq5utVrn5+ftdjskdjqd0JVYLBaJRH4G/B6fLxSO+Hw+M4ri+AbV8BNGBemhuVtbKUjP5XIjkajD49MuqoUzAqMJPT5q2tEOl2fg9/vANhGPCwaZY/Q6bsuNsfbb+HekSKhwLuthjQUDvKEufN3yi8hN9r3ovXqm79blT20NgkfXhpprUNREzaxSTIXWUdNA/bnhBw3dTdXPas72NFVN0Gu76y+yGqu+tNbxh1iUzzHnkniW90HAfChmtSn6W5fZT+d6nyjZnf13a7sbL/HoV94x6ESe/OuFlW0dLo/k48CeXZbGxDPcV5OjzC1srhDVbeh4nXXn2Yz7GuncCc5UpmAoPM0Z1CnGE159yI18Q5GYS7soGROMsybuVav4709tGJVPKeIZ1LMxL5YI4psuS9BhXFkSyaffTjZXCcdfny4uFMX65a9ENryddL5hPR7tYXitqxD8PMLsun6BepXkiWIqatDrWAz6klygEPL0GrFWOdP/vKX9zk0MWd07MDh1zn6vZ2TgJaTYzmzDk15dMQz3ddntNjjK5/MVn5RW+A+QZP5otWXxH77ZCh7Hd81eAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"먹을만하네요\"\n        title=\"\"\n        src=\"/static/c58ef8b7a03fe6c62b88419775e519db/65ed1/image-19.png\"\n        srcset=\"/static/c58ef8b7a03fe6c62b88419775e519db/c26ae/image-19.png 158w,\n/static/c58ef8b7a03fe6c62b88419775e519db/65ed1/image-19.png 210w\"\n        sizes=\"(max-width: 210px) 100vw, 210px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<figcaption>from 안아줘요 동물맨션</figcaption>\n</figure>\n<p>이만 마치겠습니다</p>","frontmatter":{"title":"🤫 React(^18)와 Next.js(App Router)가 당신 몰래 하는 일","date":"March 04, 2025","description":"Suspense와 Streaming의 동작 방법, Next.js가 RSC Payload를 다루는 방법, ..","tag":["React","Next.js"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%84%9C%EB%B2%84-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EB%A5%BC-%EB%A7%8C%EB%93%A4%EC%96%B4%EB%B3%B4%EA%B8%B0\">서버 컴포넌트를 만들어보기</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%84%9C%EB%B2%84-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EC%97%90-suspense%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EC%97%AC-streaming%ED%95%98%EA%B8%B0\">서버 컴포넌트에 Suspense를 사용하여 Streaming하기</a></p>\n<ul>\n<li>\n<p><a href=\"#suspense%EB%81%9D%EB%82%98%EB%A9%B4-fallback%EC%9D%84-%EC%96%B4%EB%96%BB%EA%B2%8C-%EA%B0%88%EC%95%84%EB%81%BC%EC%9A%B0%EB%82%98%EC%9A%94\">Suspense끝나면 fallback을 어떻게 갈아끼우나요?</a></p>\n<ul>\n<li>\n<p><a href=\"#1-suspense%EA%B0%80-%EB%91%98-%EB%8B%A4-%EC%95%88-%EB%81%9D%EB%82%A8\">1. Suspense가 둘 다 안 끝남</a></p>\n</li>\n<li>\n<p><a href=\"#2-suspense%EA%B0%80-%ED%95%98%EB%82%98-%EB%81%9D%EB%82%A8\">2. Suspense가 하나 끝남</a></p>\n<ul>\n<li><a href=\"#rcb-c-e--completeboundary\"><code class=\"language-text\">$RC(b, c, e)</code> : completeBoundary</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#3-suspense-%EB%91%98-%EB%8B%A4-%EB%81%9D%EB%82%A8\">3. Suspense 둘 다 끝남</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#suspense%EB%A1%9C-%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EB%A5%BC-%EA%B8%B0%EB%8B%A4%EB%A6%B4-%EC%88%98%EB%8F%84-%EC%9E%88%EC%96%B4%EC%9A%94\">Suspense로 클라이언트 컴포넌트를 기다릴 수도 있어요</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%95%84%EA%B9%8C%EB%B6%80%ED%84%B0-%EC%9E%90%EA%BE%B8-%EB%B3%B4%EC%9D%B4%EB%8A%94-self__next_fpush\">아까부터 자꾸 보이는 <code class=\"language-text\">self.__next_f.push</code></a></p>\n</li>\n<li>\n<p><a href=\"#self__next_fpush%EA%B0%80-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EC%9D%84-%EB%91%90-%EB%B0%B0-%EB%AC%B4%EA%B2%81%EA%B2%8C-%ED%95%A9%EB%8B%88%EB%8B%A4\"><code class=\"language-text\">self.__next_f.push</code>가 어플리케이션을 두 배 무겁게 합니다?</a></p>\n<ul>\n<li>\n<p><a href=\"#%EB%A9%94%EC%9D%B8%ED%85%8C%EC%9D%B4%EB%84%88%EC%9D%98-%EB%8B%B5%EB%B3%80--%ED%95%84%EC%9A%94%ED%95%9C%EA%B0%80-%EC%99%9C-%EC%9D%B4%EB%9F%B0-%EB%B0%A9%EB%B2%95%EC%9D%84-%EC%8D%BC%EB%8A%94%EC%A7%80\">메인테이너의 답변 : 필요한가? 왜 이런 방법을 썼는지?</a></p>\n<ul>\n<li>\n<p><a href=\"#self__next_fpush%EB%8A%94-%EA%BC%AD-%ED%95%84%EC%9A%94%ED%95%9C%EA%B1%B4%EA%B0%80%EC%9A%94\">(<code class=\"language-text\">self.__next_f.push</code>는) 꼭 필요한건가요?</a></p>\n<ul>\n<li><a href=\"#html%EC%97%90-%EC%9D%B4%EB%AF%B8-%EC%9E%88%EB%8A%94-%EB%82%B4%EC%9A%A9%EA%B3%BC-%EC%A4%91%EB%B3%B5%EB%90%98%EB%8A%94-%EA%B2%83-%EA%B0%99%EC%9D%80%EB%8D%B0-html%EC%97%90-%EC%9E%88%EB%8A%94-%EC%A0%95%EB%B3%B4%EB%93%A4%EC%9D%84-%EC%8D%A8%EC%84%9C-hydration%ED%95%98%EB%A9%B4-%EC%95%88%EB%90%98%EB%82%98%EC%9A%94\">HTML에 이미 있는 내용과 중복되는 것 같은데, HTML에 있는 정보들을 써서 Hydration하면 안되나요?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%B4%88%EA%B8%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0-%EC%9C%84%ED%95%9C-%EC%B5%9C%EC%A0%81%EC%9D%98-%EB%B0%A9%EB%B2%95%EC%9D%80-%EB%AD%94%EA%B0%80%EC%9A%94\">초기 데이터를 가져오기 위한 최적의 방법은 뭔가요?</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%8E%98%EC%9D%B4%EC%A7%80-%EC%84%B1%EB%8A%A5-core-web-vital\">페이지 성능 (Core Web Vital)</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%95%9E%EC%9C%BC%EB%A1%9C%EC%9D%98-react-%EB%B0%A9%ED%96%A5%EC%84%B1\">앞으로의 React 방향성</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%9A%94%EC%95%BD\">요약</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/react-18-concurrency-and-streaming-with-rsc/"},"frontmatter":{"title":"🌐 나는 Post-React18 시대에 산다"}},"next":null},"pageContext":{"id":"7b15f256-1799-562a-8ba5-91dcd5317715","previousPostId":"0106321e-2cce-52cd-aab4-f3ec91c286f0","nextPostId":null}},"staticQueryHashes":["2841359383"],"slicesMap":{}}