{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/producer-consumer-problem-and-readers-writers-problem/","result":{"data":{"site":{"siteMetadata":{"title":"조성개발실록","siteUrl":"https://sungpaks.github.io"}},"markdownRemark":{"id":"fdea2e54-3b29-55c2-8bd8-021cfabb8b4c","excerpt":"예.. 저번에 Semaphore와 Monitor에 대해 알아봤는데 또 새로운 문제를 해결하는 데에도 쓰인다고 했었죠? 하나는 Producer-Consumer Problem이고 다른 하나는 Readers-Writers Problem…","html":"<p>예.. 저번에 Semaphore와 Monitor에 대해 알아봤는데<br>\n또 새로운 문제를 해결하는 데에도 쓰인다고 했었죠?<br>\n하나는 Producer-Consumer Problem이고<br>\n다른 하나는 Readers-Writers Problem입니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b82ea41429b93c264638fabd253d96bc/d67ca/image-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACmklEQVR42jWSSW/bVhSF+SsSW6JIPmqIZGqsLIkaOIiTJGqkZddpkxhGE7TopgXaAkE2QZb9B1101W666I/8emOkiwO8xcN3zzn3ap6lEzXq/JDNeYynzJoNskmHZNzGH7YIooih62KYl1TtCrYy5G0w7tUp4j6nuM0p6/LtTU66vkELqxb3UciP+4S3K59oOGA9H7NajEi9MWGa4AlwGyxIPJ9Bp4tl2Xz67Q3//Pmev/74lX///sjvHx6YT0O0QCb6ZZ1ZqczoUmdUNhl+Ud9UhHHE93cnfnl84N39a3I/pNuqMui3mE57jCddhkOHTtNivgjEoaoQWQaRsvBlsmvYTAz1pL6l2K0zfn51K7CCx9s7jktfqnAwpYKL0jPK5WfYVom6XcK9HqJF4jA2TYFaeKbN7LMEOq0oru0avufyZudLDX3W/oRzuqRIIr7qNDGtMkqVqSqdivEcx3HQ4iegRWx9dmg9AedPUMVIgEma8XD+hu+KLe+KDY+nPfvAZ9Ju0qsbXDcNRlcKvfKcK6eJlggwla5SiRdY/8MsFgIc21UO2w1F6PP2mPPTywM3Xo+4X8Nz5F/TJGgrBi8McXiB026gpbZJ9gUYiua6zcJ2mFdquNWWnEJOkcbcJSGv1gtOwYh81icetFn2O8w6DVpVHd0sMTx6aJkAVxJ1paoE0lt8PeZYFET+hsBP2exfsj0l5K7ADmv221tCcbyKM1bLLcGgRVdil/QLesMu2sq22AhwrWwCWUbqBixnEYkb4gtkLYDT10fu85TbfEe2PHLY5eTpTv5OJbJJu6FzKcArcaytbUWulACVnI4tm1aynBoLuUO3Vme7v6E4v+Z4vuNwPLM/pHizLlH/BdmgJtFtmrUSF+USC3/CfxTfakbVwRBHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"두뇌 풀 가동\"\n        title=\"\"\n        src=\"/static/b82ea41429b93c264638fabd253d96bc/f058b/image-1.png\"\n        srcset=\"/static/b82ea41429b93c264638fabd253d96bc/c26ae/image-1.png 158w,\n/static/b82ea41429b93c264638fabd253d96bc/6bdcf/image-1.png 315w,\n/static/b82ea41429b93c264638fabd253d96bc/f058b/image-1.png 630w,\n/static/b82ea41429b93c264638fabd253d96bc/d67ca/image-1.png 714w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>어떤 프라브람이고, 어떻게 해결할 수 있는지 함 봅시다</p>\n<h1 id=\"producer-consumer-problem\" style=\"position:relative;\"><a href=\"#producer-consumer-problem\" aria-label=\"producer consumer problem permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Producer-Consumer Problem</h1>\n<p>I/O버퍼나 Ready Queue 등등와 같이<br>\n하나의 버퍼, 말하자면 어떤 창고가 있다고 해봅시다<br>\n그리고 작업자인 프로세스들은 딱 두 종류만 있는데<br>\n버퍼라는 창고에 넣을 물건인 데이터를 만들어서 버퍼에 집어넣는 생산자인 Producer와<br>\n버퍼에서 데이터를 가져가는 소비자인 Consumer가 있습니다<br>\n이런 특성의 버퍼는 되게 자주 접할 수 있는데<br>\n레디 큐나 I/O버퍼같은 것들이 그것입니다</p>\n<p>아무튼 이제 데이터를 주르륵.. 저장한다고 치면<br>\n다음에 Producer가 버퍼에 쓸 위치는 포인터 <code class=\"language-text\">in</code>으로,<br>\n다음에 Consumer가 버퍼에서 읽을 위치는 포인터 <code class=\"language-text\">out</code>으로 나타내면</p>\n<p>초기 상태는 아래와 같이 버퍼가 빈 상태로 시작한다고 하면</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 591px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/832ffa40fb28d4b16e8dac1df5589b3f/e4c9a/image-26.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.746835443037973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAfElEQVR42q2RywrFIAxE8/+/6MYnuhNcKKiYMpaU0sK9mwrDGWOCjFIphdda/NUipRS31njOuTXGeHnw6Z/qve9z8t6z1pqttZeMMS865zbFY0Yo9RgjE4oYAiFcIERd9iEEll74O2U2pXRGrrX+jPMv8v15KOe8zVefcgBE6M3miXyV+wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"과정 1\"\n        title=\"\"\n        src=\"/static/832ffa40fb28d4b16e8dac1df5589b3f/e4c9a/image-26.png\"\n        srcset=\"/static/832ffa40fb28d4b16e8dac1df5589b3f/c26ae/image-26.png 158w,\n/static/832ffa40fb28d4b16e8dac1df5589b3f/6bdcf/image-26.png 315w,\n/static/832ffa40fb28d4b16e8dac1df5589b3f/e4c9a/image-26.png 591w\"\n        sizes=\"(max-width: 591px) 100vw, 591px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이렇게 <code class=\"language-text\">in</code>과 <code class=\"language-text\">out</code>은 동일한 위치에 있다가</p>\n<p>이제 Producer가 데이터를 좀 쓰고 나면\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 586px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/044eaeb11a078426807616efdaf7696e/a76f4/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.0126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAlUlEQVR42q2QywqEMAxF8/+/1434qlahlEo3RVzYeocEKjo4MAMTOOR1U5oQfrQYI3LOH/uUUsITPHT1zHEcqKoK67pKfd/3k6Il772I2rYV6rpG0zQ3uq47+0opjOOIYRiEEmut4ZwDlSFjzKOw7/tbfZomWGvFz/N8wvmyLCAWbdsm6/CXv+H9LCXmNyiEIDf4l70ARhXNCNxHMSUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"과정 2\"\n        title=\"\"\n        src=\"/static/044eaeb11a078426807616efdaf7696e/a76f4/image.png\"\n        srcset=\"/static/044eaeb11a078426807616efdaf7696e/c26ae/image.png 158w,\n/static/044eaeb11a078426807616efdaf7696e/6bdcf/image.png 315w,\n/static/044eaeb11a078426807616efdaf7696e/a76f4/image.png 586w\"\n        sizes=\"(max-width: 586px) 100vw, 586px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<code class=\"language-text\">in</code>이 쭉 이동한 상태고,</p>\n<p>이제 Consumer가 데이터를 읽어가면\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/31ca312d4345a82a9779809b9dcc4bb6/7c1cd/image-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.278481012658226%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAmklEQVR42pWR2QrEIAxF/f+vKz4K0rpAlxcRX9xohhuwzAx0ygQOifHeBFTQn5FSot777b1orVEp5aLW+nF+B4OUUhRjpG8fQE/s+07LsjDWWjLG0DzPXCM757intWaklJce/ZGhXdeVxHEcbAYwj6Hee65hmKaJ81iEO2iGfizdto3EeZ50ByLnzIMQv7QD8fQJeNMQwrXgKV5hgc1E0KDvSgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"과정 3\"\n        title=\"\"\n        src=\"/static/31ca312d4345a82a9779809b9dcc4bb6/7c1cd/image-3.png\"\n        srcset=\"/static/31ca312d4345a82a9779809b9dcc4bb6/c26ae/image-3.png 158w,\n/static/31ca312d4345a82a9779809b9dcc4bb6/6bdcf/image-3.png 315w,\n/static/31ca312d4345a82a9779809b9dcc4bb6/7c1cd/image-3.png 582w\"\n        sizes=\"(max-width: 582px) 100vw, 582px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<code class=\"language-text\">out</code>또한 쭉 이동한 상태가 됩니다</p>\n<p>다시 Producer가 폭주해서 데이터를 쓰되<br>\n만약 버퍼 크기가 <code class=\"language-text\">n</code>이고 버퍼의 끝에 도달하면<br>\n0부터 <code class=\"language-text\">out</code>직전까지는 <code class=\"language-text\">out</code>이 이미 데이터를 읽어갔으니 여기를 또 채워야겠죠?<br>\nRound하게, 끝에 도달하면 <code class=\"language-text\">in = (in+1)%n</code>처럼 해서 0으로 돌아오도록 하고<br>\n다시 쭉 데이터를 씁니다<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 583px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cacd2d9ffae5c08f6bb04f4f2023ecc4/9fc4b/image-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.746835443037973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAlUlEQVR42o1QwQ6FIAzj/7/PiMgBhYMxwQMeMAGlL1sCMe+CS5p1XdfDBDqVUsJ5nsxLKT07RM6ZjwjE3/N93wghQEqJ53ma/vb/d7FtG8ZxxDzPUEq1Xvk0TYyqa62Z113ViTvnILz3WJYF67oyrLUNZKCAYRiYv3fkNca0mTL2fYfo/STGyIeff9gzXNeF4zg+B/4AAS7MD4bPVsQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"과정 4\"\n        title=\"\"\n        src=\"/static/cacd2d9ffae5c08f6bb04f4f2023ecc4/9fc4b/image-4.png\"\n        srcset=\"/static/cacd2d9ffae5c08f6bb04f4f2023ecc4/c26ae/image-4.png 158w,\n/static/cacd2d9ffae5c08f6bb04f4f2023ecc4/6bdcf/image-4.png 315w,\n/static/cacd2d9ffae5c08f6bb04f4f2023ecc4/9fc4b/image-4.png 583w\"\n        sizes=\"(max-width: 583px) 100vw, 583px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n버퍼가 꽉 찼네요..<br>\n더 이상 쓰면 Consumer가 읽어가야 할 '니', '다', 등등..의 글자를 덮어쓰게 되니<br>\n이제 버퍼에 데이터를 쓰는 것은 멈추고<br>\n어떤 문제가 발생할 수 있는지 생각해봅시다</p>\n<p><br>\n일단, 한 번에 여러 Producer가 <code class=\"language-text\">in</code>위치에 데이터를 쓰면 안 될 것 같습니다<br>\n당연하죠? \"바보\"를 둘이서 나눠 쓸건데, 같은 칸에 쓰면 \"바\" 또는 \"보\"만 남게 될 것입니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 537px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9986433f2cf215fe4704a53dff4cda66/b1cde/image-6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 223.41772151898732%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAtCAIAAAAhntw/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJuElEQVR42h2WaWxU1xXHn2d5+76v82bem328jmfxrH4z9mAbMGDiBe/GGwYbG1IDISlNwxoSlobQBkJ2iNKSNkqqFiWoKVloPyRdyMcoaZUoUqWo6peqUr/2Ueno6lzd+78695yr+zuAz98EQx5JIDVVbPIBEOSBYE8TCLjmgzw+qMkLNoGgxw81uTv9rg81ERSKYKDrA0ATsKuv4+VnlvrqWa8HUEhQJPwg4ocQ0D0FRbw44qVQL4X5SNzHED6BArPtieaoLlF+AIeaGpngUG+HIFAa6e9QkaCIEwwhqRJLgTzulUhQZfw6CwU52OKQkIC6TljEwjIO8LivU4Y1zAtB/pSMFE1EU1he4gmRVUUqKsJRAU2ISErFmxW8RSXSJpUO0A8tSAIBBswZuC1iMAolJbQQIAUWwyi81Bkb6Ip1algmQOY0PBegcgaZCxC5ENVlkZUQlbcoIMSC1RDZpqIsCbeqaJfFPP7YxqmNsdPLW3YV7RYZzQSIjI5nDCJnUgWT7ApSOYsq2kwuxAFhHq5ahBMm3XnM5FmZ2zk2+tEHbzfa1VYFSxtEh06kdSJj4jmTKFl0l0VlQ0zeZrIWA8REuB7G+qJEUoJREpMMA6WpiZnpNkvO6VjRpkpBsjtEVMJ4xSI6daQSppwo223TBTfsGA86EWqsaPYMpAc2plhTABBMVqVMIpBWwLJF1sNEzcJrNmHLhGHIioDV40x/kqnEGCBIeea2dVw/v/ep1y9e+M0f504f3XHi/OD+A+NHj7TF1IKBFINkyU2SgVbT9umDI4mI0awTPQmuGGYBFfeOOuGrjw4PL4y88PEnv7jz8Xv3/3z7gz9c/+xLp6/ayQGlEFmLUOUQNlqwz6/uGK01VyNsPc522QygEh6nWR3f0mrG4vNPXzt+5dpTL7/xw2s3Zi5cNdtSu/Khrc1C3UYrNt4ZIBd25GtdyWYV7U+ybsEAGPUmE8HBbQ2QQN2n2uT3QTgGUYSbvIhtzI4NHt7T40RImYNFVbr63PlUe7O7GtLogk0BEImDBIYxlI/A/TDs9blqvweGMm3Ry6ePLW0cDim8jIMQjsgBc3ZunhE5mCRRmjBZGJAlWnTfI09yLCaIpCjRAkewDGapdLEjGomYMo9bIh7QeDOgNKciqsYFdN4yFZVBgdG8uKekTJX1tYHoQrfu2lzJmKoEJ5zwdCU0XLJyKT2fUoYL1kJvfKonvtBIrW5tWR1omXUSwFgne2K+69Wnp88s9x6oSsvd2kJFW3CMfY1QvVWRFIaRWIzFBRaZccJLWxILPYlTS/3HR7v2VqPAngx3ZDLz1FpjtT+86kiLVWW+qi05xnTV5DmEV7lEKmaYCoz7wgY974p7E2sDyUPbU9NOFBjP81MlYSrPLTnyakNbqavzVWV/I7inqCXDynPHpz+8cfzNc/Pbe9p5XZqqRda3xdcHEz/YmRgv28COdmG6LE8UpeGsMFaQRvLyUFaeKGkzZe3Uvq23z+1/88zyqz+eqxWiHtgzWjLne+2Zmr3ciAzlAsB4TpitytMlebaiLDnKXPlh2PPdqnvnd89M/f7ygfcvrr56YrKrRQ+pxFg1ONVtL/ZYa32RmUoImC5w02VhuigtV+TVmrxSkw/U1MVuZa6uXVptvLAy9MGFpQvrfevDub01e7RiztWCq43gRr+12B0ExjLsZFGYKYqLVWmf447isqMsVOV5Rz4y2n5xse/0UvURJzrSZSzVjTFX7ARW6oGDveZCtwFMZpjJIj9b5PfmuH1VaaUqrNakyaJYa5PntqdXH2k/MV8d7MsmQ+y2nDpeNhbdKtaNg70Bt5xAtYWfLnFTeXp5u76vLgxnxVxC0AMcxpHPnFx/+/L+e799rViraJau21o8qvZlzQVHX+sxHoojHclMjFleazxx8/b85rjI+yiRYmUKRIAzl8/++z//fP76FU5jraSpBARZFxiZ7e+UDw2Y4yUFsFORkZ3dx68eO3/n/ql3bs0df2zP+ubo6uGZ9cMnb/78zU8/O/3i9Ymjx0Ye3Zw5+eTyudOjP3py67bcsUF9T1EGJoZK3905e+/u6+9/89f733xx78uvXrz94U/fuPvS7Q+v3bpz6aV3z1+788p7n954596dv/39d999d+urb/ODW6uix/2PgW+//tN/v//is19fOXfh7Nz62tD64V371yc3jw1vHH7iyvM/uXV758GNyR8eH9k8Mnjo4O4jmwObR0KpaNIHxOAm4Fe/vHXztRcenynubMF0DiQ4guYxxRQFg27rSFZKOVFnJZVjRBKnIE3n9YAUUNko5rURD4DjkM/jwtHPCTSI+HDMj6A+H+LzuSPk9fg9EOKDMR+I+iDUj2IQgoIuImHYg7hil5P1YvzSialtfQXMBxiUj8G8XqjJZSqKeHDMi6MeCvPSuJ91EUn4JBoqZVuaw6rG+AEG9gxVEnN7apGgaDO+vIHZPIIgXo70sRTEC4TKYwYNBTgw5CKSR2wRDYtoXCXiKgmYNJRV3EA8NA6mNdQJ4e06prGgJqCcwNAiT3BUQsZadcJFZLtOZoJ0p0u8IJ23WJdVYMHAWQqmcLBDxcsh0l2LS3BMIyASo2QxFTUzJu1a3qRcy9l0MUhVLTZv04C7r27hCQlTGMSFYCP+EGVBAW2Jh9YOzB0cq67syqUDTNqkC0Eqa1JZi3QpW7DZjM0CKRntCeP1KOOysx6ht8TpiE5poQBIECfPnrz4+GJX6P98DZLu0ZUwXYwwuSDnIjVrcw/FvWGsbhPFIN2Xop0YyUo8b+oAiVvJWDUTL2pQ3carYaIepiIi3BYgeqO8E6GLUQ5IiuBIJTzdlyrbxJYoGTM5WtejPL2DRHfjWEpjnDDhWERPzE0ElGmNJMJaziK3NvOlKAukQ/TPzu598dl9w9Vwq4KwIotwVJeAXUqIJzvkiEy3yljZ5bNNbi21XNycHd2SjqpEPe5SkgZSOn5orHD50fHdXeGUgngQrJIxXjna8snN/N3n04eHwo2cRpBIr1N64sDMvvGBESfeE2cbCTbnlspgoIn+7K5ae5uO122Mo5Dl0fCDy60P3ur4+m7uwesdu/s1kUIjBhtRiJWJvkK22ZJgJ8ZkQy7oMHjbQE+iNQlikMQh5YT40Zn05zdaPr2Y+stbnfefTV0/0FqL8W6XqIb0peV5ThZAkgyqbk9DAwiJ4wxOiTzOMgAKkRRxdCr2j8/L3z+o/utB+b1zzfO9AZnG/Bgsa0pzawqnSYrnGI4yKBBACQwhMBhHvZDbMsJNKNVdMR/ZYvSU5I3poG5Qfr/bQfr9KAKhMMWQOEFQLIMSCOxt+h+JYB4eiWCoXwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"가만히 계세요\"\n        title=\"\"\n        src=\"/static/9986433f2cf215fe4704a53dff4cda66/b1cde/image-6.png\"\n        srcset=\"/static/9986433f2cf215fe4704a53dff4cda66/c26ae/image-6.png 158w,\n/static/9986433f2cf215fe4704a53dff4cda66/6bdcf/image-6.png 315w,\n/static/9986433f2cf215fe4704a53dff4cda66/b1cde/image-6.png 537w\"\n        sizes=\"(max-width: 537px) 100vw, 537px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Consumer의 상황도 마찬가지겠죠?<br>\n그러니 어떤 순간에 데이터를 읽거나 쓰거나 하나만 하도록 해야 할 것 같습니다.</p>\n<p>근데 이 경우는 이미 앞에서 질리도록 살펴봤던 Mutual Exclusion 문제네요<br>\nWell-Known 입니다만? 🥸</p>\n<p><br>\n또 다른 문제는 일단<br>\nProducer는 버퍼가 가득 차면 데이터를 더 이상 집어넣을 수 없고<br>\nConsumer는 비슷하게, 버퍼가 비어 있다면 데이터를 더 이상 꺼내갈 수 없습니다<br>\n라는 사실에서부터 시작하는데<br>\n그럼 그냥 버퍼가 가득 차면 Producer는 기다리고,<br>\n버퍼가 비어 있으면 Consumer는 기다리면 되지 않을까요?</p>\n<p>근데 위 그림을 다시 자세히 들여다보면<br>\n버퍼가 비어 있는 경우 <code class=\"language-text\">in</code>과 <code class=\"language-text\">out</code>이 같은 자리에 있는데<br>\n버퍼가 가득 찬 경우에도 <code class=\"language-text\">in</code>과 <code class=\"language-text\">out</code>이 같은 자리에 있습니다??<br>\n그렇기 때문에 <code class=\"language-text\">if (in == out)</code> 이렇게 쓰는 것만으로는 버퍼가 비어 있는지 가득 찬건지 확인을 할 수가 없습니다 ㅜㅜ</p>\n<p>그래서 이걸 구분하기 위해 어쩔 수 없이 Producer와 Writers 각각은 다음과 같이 작성해왔습니다</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> producer<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\tv <span class=\"token operator\">=</span> <span class=\"token function\">produce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//대충 data 하나를 만들어 냄</span>\n\t\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>in<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">%</span>n <span class=\"token operator\">==</span> out<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 다음 칸이 out과 겹치면 대기</span>\n\t\t\t<span class=\"token comment\">/* do nothing */</span><span class=\"token punctuation\">;</span>\n\t\tbuffer<span class=\"token punctuation\">[</span>in<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v<span class=\"token punctuation\">;</span>\n\t\tin <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>in<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">%</span>n<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> consumer<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>in <span class=\"token operator\">==</span> out<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 현재 칸이 in과 겹치면 대기</span>\n\t\t\t<span class=\"token comment\">/* do nothing */</span><span class=\"token punctuation\">;</span>\n\t\tw <span class=\"token operator\">=</span> buffer<span class=\"token punctuation\">[</span>out<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\tout <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>out<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">%</span>n<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">consume</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//대충 꺼내온 데이터를 소비함</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그냥 버퍼를 아무리 꽉 채워도 한 칸은 비우도록 한 것이죠......<br>\n그리고 OS를 잘 공부한 독자라면<br>\nbusy-waiting이잖아? 를 바로 떠올리시겠죠?</p>\n<p>이 문제를 semaphore와 monitor로 잘 해결해볼 수 있습니다<br>\n게다가 얘네를 쓰면 꼭 한 칸 비우도록 하지 않아도 됩니다!</p>\n<h2 id=\"semaphore로-producer-consumer-problem-해결하기\" style=\"position:relative;\"><a href=\"#semaphore%EB%A1%9C-producer-consumer-problem-%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0\" aria-label=\"semaphore로 producer consumer problem 해결하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Semaphore로 Producer-Consumer Problem 해결하기</h2>\n<p>코드 형태를 바로 봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> sizeofbuffer <span class=\"token operator\">=</span> <span class=\"token comment\">/* buffer size */</span><span class=\"token punctuation\">;</span>\nsemaphore s <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nsemaphore n <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\nsemaphore e <span class=\"token operator\">=</span> sizeofbuffer<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">producer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">produce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//대충 데이터 만드는 함수</span>\n\t\t<span class=\"token function\">semWait</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//데이터 집어넣기 전에, 버퍼 꽉 찼는지 확인</span>\n\t\t<span class=\"token function\">semWait</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//C.S 잠그기</span>\n\t\t<span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//데이터 집어넣기.</span>\n\t\t<span class=\"token function\">semSignal</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// C.S 잠금 해제</span>\n\t\t<span class=\"token function\">semSignal</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 데이터를 집어넣었으니, 하나 넣었다고 알리기</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">consumer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">semWait</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 데이터 꺼내기 전에, 버퍼 비었는지 확인</span>\n\t\t<span class=\"token function\">semWait</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//C.S 잠그기</span>\n\t\t<span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//데이터 꺼내가기.</span>\n\t\t<span class=\"token function\">semSignal</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//C.S 구현</span>\n\t\t<span class=\"token function\">semsignal</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//데이터를 꺼냈으니, 하나 꺼냈다고 알리기</span>\n\t\t<span class=\"token function\">consume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//대충 데이터 소비하는 함수</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">parbegin</span><span class=\"token punctuation\">(</span>producer<span class=\"token punctuation\">,</span> consumer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 때, 가상의 함수 <code class=\"language-text\">append()</code>와 <code class=\"language-text\">take()</code>는 대충 데이터를 집어넣고 꺼내가는 동작이라고 보시면 됩니다</p>\n<p>세 가지 semaphore가 쓰이는데..</p>\n<ul>\n<li><code class=\"language-text\">semaphore s</code> => C.S를 잠가 Mutual Exclusion을 보장하기 위함. 초기값 1</li>\n<li><code class=\"language-text\">semaphore n</code> => 버퍼에 꺼내갈 수 있는 데이터가 얼마나 있는지 나타낸다. 초기값 0 (처음에는 데이터가 없음)</li>\n<li><code class=\"language-text\">semaphore e</code> => 버퍼에 데이터를 넣을 공간이 얼마나 남았는지 나타낸다. 초기값은 <code class=\"language-text\">sizeofbuffer</code>. (처음에는 버퍼 전체가 비어있으므로)</li>\n</ul>\n<p>이렇게 해서,<br>\nproducer는 빈 자리(<code class=\"language-text\">e</code>)를 하나 줄이고 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\rightarrow</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">→</span></span></span></span></span> 데이터 개수(<code class=\"language-text\">n</code>)를 하나 늘리고,<br>\nconsumer는 빈 자리(<code class=\"language-text\">e</code>)를 하나 늘리고 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\rightarrow</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">→</span></span></span></span></span> 데이터 개수(<code class=\"language-text\">n</code>)를 하나 줄이고,<br>\n를 지속적으로 수행하게 합니다.<br>\n이 때,<br>\n만약 더 넣을 빈 자리가 없다면(<code class=\"language-text\">e</code>값 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≤</mo></mrow><annotation encoding=\"application/x-tex\">\\le</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mrel\">≤</span></span></span></span></span> 0) producer는 <code class=\"language-text\">semWait(e)</code>에서 걸려 대기하고,<br>\n만약 더 가져갈 데이터가 없다면(<code class=\"language-text\">n</code>값 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≤</mo></mrow><annotation encoding=\"application/x-tex\">\\le</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mrel\">≤</span></span></span></span></span> 0) consumer는 <code class=\"language-text\">semWait(n)</code>에서 걸려 대기합니다.</p>\n<p>이 때 <code class=\"language-text\">semWait()</code>또는 <code class=\"language-text\">semSignal()</code>의 순서가 중요한데<br>\n<code class=\"language-text\">semWait(s)</code>를 <code class=\"language-text\">semWait(e)</code> 또는 <code class=\"language-text\">semWait(n)</code>보다 먼저 놓거나, 하면.. 참사가 벌어집니다<br>\n예를 들어, 제가 실수로 consumer를 <code class=\"language-text\">semWait(s)</code> 다음 <code class=\"language-text\">semWait(n)</code>이 나오도록 작성했다고 칩시다.<br>\n그러면 만약..</p>\n<p>버퍼가 비어 있는 상황이라고 가정하고 흐름을 한 번 봅시다</p>\n<ol>\n<li>먼저 consumer가 <code class=\"language-text\">take()</code>를 위해 접근\n<ul>\n<li><code class=\"language-text\">semWait(s)</code>가 먼저 나왔다고 가정했으므로, <code class=\"language-text\">s==1 -> 0</code></li>\n<li>그 다음, 버퍼가 비어있으므로 <code class=\"language-text\">semWait(n)</code>에 걸려 대기</li>\n</ul>\n</li>\n<li>그 다음, producer가 <code class=\"language-text\">append()</code>를 위해 접근\n<ul>\n<li>버퍼에 빈 공간이 있으므로, <code class=\"language-text\">semWait(e)</code>를 통과</li>\n<li>그 다음, <code class=\"language-text\">semWait(s)</code>에서, <code class=\"language-text\">s==0 -> -1</code>, 값이 음수가 되었으므로 대기</li>\n</ul>\n</li>\n</ol>\n<p>헉.. 둘 다 Block 상태를 빠져나오지 못하는, Deadlock에 걸려버렸습니다<br>\n서로가 서로를 기다리게 되었네요 ㅜㅜ</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 287px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9c8a4d8900efd2b7951f164681a7a63a/480fd/image-7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC50lEQVR42gHcAiP9AMCVWcmaWMeeW8qjXIaGhbvEy6aIWsCbYcuiZ8WeY7+ZYMadYsafZ6iGUrWzp973/9Tp8N3x+uH4/+D3/gC7mGDMmlvCmVvIoVqAf37Cyc+niFjAm2LMpGfMo2bLo2fLomfEoGWnhE66uKrm///Y7PPa8Pjg+P/h+P0AtpllzZpYwJhcxp9ceHp4pay4qoxavplhupVfuZRdvpdivZhhvphkqodTrqqdy+H0xdfi3/T54vr/4vr+ALKYZs2bWsGYWs2mYnV1bYB6X7acX8amYs6rZNazatSxasakYcikYsOiYJuLYpKHa46CZsPPzuv//+b6/ACul2XPoVvFnV2Pd0+womniyWrawWnpz3Czn1pWSiyGdkXjyGvjxWfjxWvfxGvfwmbZuF6kmXnc8Pbp/v8AsZlp1qlimn5Tp5BV48Zi4sBh6MZlwaZbCwoIAAAAAAAAf25B7clq4MBk48Rm4sNk5MFmxqlZrrGm6P7/ALGccJ2IZJSJbMq+fc/EfcG5gNLKirGcfzwbGSgVDygMCIlrWdfJjce6ds3Cf8m+gsi7gc7AgKWliKOzugCjpJGewuGoz+yrz+yt0e2xysWjvaimvKnGWknPOyvMPiypk3eoyLu4zcywx7+ww7Kv0Oer0e+02PGw0uwAprOqs97/ttz5s9z+w9zlusmSj6+HocvMw6OHzGQ8yoFYpsGvttrir9LQiq+MorZ6wtbQs9v7vuP7v+T+AKq2rLvh+bre9bbZ9cHRvLDAm7TLx7fOypymhWt2U5Gcf8LVzbLJvaO3lZ+1j62+lMPRtrXZ86zP6brd9wCfp6Ssvsmvwc6wxNGvwcqyxdC1z9+xwsSluMKAjpiLmaK20uCuxc2xxc+2y9iqtry1ydWvx9elusqsyNwAnqejrsrbsMzfr87kuNTqtdPptNjwr9DluNjtwOLvq8vkr9PvuNfruNbqu9jorsnXq8zhtdbpttLmstTsjX/iBpZSovcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"기다릴거야\"\n        title=\"\"\n        src=\"/static/9c8a4d8900efd2b7951f164681a7a63a/480fd/image-7.png\"\n        srcset=\"/static/9c8a4d8900efd2b7951f164681a7a63a/c26ae/image-7.png 158w,\n/static/9c8a4d8900efd2b7951f164681a7a63a/480fd/image-7.png 287w\"\n        sizes=\"(max-width: 287px) 100vw, 287px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Semaphore가 이전의 Software나 Hardware 방식과 비교하여 강력한 것은 맞지만<br>\n문을 잠그고, 키를 두고 가고, 값을 통제하고, .. 를 관리하는 것은 여전히 사람이기 때문에<br>\n이렇게 잘못 사용할 여지가 충분히 남아있습니다<br>\n그럼 Monitor를 사용해본다면?</p>\n<h2 id=\"monitor로-producer-consumer-problem-해결하기\" style=\"position:relative;\"><a href=\"#monitor%EB%A1%9C-producer-consumer-problem-%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0\" aria-label=\"monitor로 producer consumer problem 해결하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Monitor로 Producer-Consumer Problem 해결하기</h2>\n<p>저번시간에 말한 Monitor란<br>\n한 번에 한 프로세스만 Monitor에 진입하므로 그 자체로 Critical Section이고<br>\n<code class=\"language-text\">cwait</code>, <code class=\"language-text\">csignal</code> 함수와 Block Queue를 가지는 <code class=\"language-text\">condition</code> 변수를 가진다고 했습니다<br>\n그런 Monitor의 특성을 이용하여<br>\n아까 semaphore로 감쌌던, 데이터를 집어넣거나 꺼내는 동작인, <code class=\"language-text\">take()</code>와 <code class=\"language-text\">append()</code>를 작성해봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">monitor boundedbuffer<span class=\"token punctuation\">;</span> <span class=\"token comment\">//유한한 버퍼 자체가 모니터 안에 포함됨</span>\n<span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span>N<span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">int</span> nextin<span class=\"token punctuation\">,</span> nextout<span class=\"token punctuation\">;</span> <span class=\"token comment\">//다음에 쓸, 또는 읽을 위치</span>\n<span class=\"token keyword\">int</span> count<span class=\"token punctuation\">;</span> <span class=\"token comment\">//버퍼에 있는 데이터 갯수</span>\ncond notfull <span class=\"token comment\">//버퍼가 가득 찬 경우 producer가 기다리는 큐를 포함</span>\ncond notempty<span class=\"token punctuation\">;</span> <span class=\"token comment\">//버퍼가 비어 있는 경우 consumer가 기다리는 큐를 포함</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">append</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">==</span> N<span class=\"token punctuation\">)</span> <span class=\"token function\">cwait</span><span class=\"token punctuation\">(</span>notfull<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//버퍼가 꽉 참. 기다리기</span>\n\tbuffer<span class=\"token punctuation\">[</span>nextin<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n\tnextin <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>nextin <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> n<span class=\"token punctuation\">;</span>\n\tcount<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">csignal</span><span class=\"token punctuation\">(</span>notempty<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//버퍼에 데이터 하나 넣어뒀으니 consumer 하나를 깨운다</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">take</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token function\">cwait</span><span class=\"token punctuation\">(</span>notempty<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//버퍼가 비어 있음. 기다리기</span>\n\tx <span class=\"token operator\">=</span> buffer<span class=\"token punctuation\">[</span>nextout<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\tnextout <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>nextout <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> n<span class=\"token punctuation\">;</span>\n\tcount<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">csignal</span><span class=\"token punctuation\">(</span>notfull<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//버퍼에서 데이터 하나 꺼내갔으니 producer 하나를 깨운다</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">append</code>할 때는 혹여 버퍼가 꽉 찼다면 condition 변수인 <code class=\"language-text\">notfull</code>에 producer를 기다리게 하고,<br>\n<code class=\"language-text\">take</code>할 때는 혹여 버퍼가 비어있다면 condition 변수인 <code class=\"language-text\">notempty</code>에 consumer를 기다리게 합니다.<br>\n<code class=\"language-text\">csignal</code>은 조건을 묻지도 따지지도 않고 실행하는데,<br>\n전에도 말했 듯이 condition 변수에는 값이 없으므로<br>\n그저 큐에 기다리는 프로세스가 있으면 깨우고, 없으면 말고, 를 하면 됩니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 221px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d46de6777f7296102e9507a6fc617447/cccdc/image-8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 103.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAAsTAAALEwEAmpwYAAADo0lEQVR42iWUyS9rURzHzz9ibaMbEQuxMCwsikgkNiIaISLCgpgS00KNMVNq5hYdzENLS1VbrSnmmF+JFyJ9IVggIbxPuYube8+5v993+p0rqqqqEhMTMzMz8/LyVCpVW1vb/v7+y8vL1dXV4eFhX19fSUnJ359rZmbGaDRubW0tLS1NTk6ura2JpKQkPz8/uVyemppaWFg4MDBweXl5f3/v9Xo1Gk1GRsbU1JTNZqPX8/Pz4+Pj0NDQ8vIyAKyI3Nzc2NjYxsZGQJqbm+vr600m0/j4+Pr6Oivx8fF3d3c3NzeUfX5+fn19PTw8uN3ui4uL3d1dASvaK5XKrq6u4eHhjo4OWn5/f398fOh0uuDgYLvdDib1R0dHT09P1PBAfU9Pj8jOzu7t7a2srOzs7BwZGRkdHZ2ent7b29vY2FCr1XFxcbiAPABBpml5eXl/f//KyorD4RBIog2Nq6ur29vbkVRQUMAzZbW1tbOzs01NTS0tLd3d3RiGLnoBRhV2iuvr67e3N1pqtVqZTBYeHh4YGBgaGurv749h4JvNZrwtKytLT0+PiIigHczn5+etVquYmJhobW2tqakhhsXFRVbZhhVSFxYWIIIXiIck61BDC3bCglwEPkdGRqIZJmTAnV6gzc3NUcl3FovF5XJhR05ODiadn5/TFC4+wxgSKO3s7CAMJgCyigSg4OJ0Oo+Pjzc3NymAFBpx/vX1lS29Xi+IBzK8sAcmn2I7lCij0e884b/ZbKG1yWSUNBLFpAUpgStQPTs7g0lFRcXq6qokSSATAQmdnp7SBYckSWMw6O12G8Uut5uVsbExQQHggDDYFNCPIcvPz9/e3kYq9sD/4OAAkgaDwev9Ry4wh46vGJ/DwsIIE3v4jpHEG1QgEvIJCQmYQqSDg4Msws7j+cNga7U6vhfkHhMTw1QQCZpBpiujCwsMZ5iioqIwBRz0W38uHnCBXR8yU8Fs05X28GSDU+HxeE5OTkiBc8J3SCNn+LMCQRSx7isGOTo6mmFkSBhdLMQz7iR8e3vLHRbckY2W33bOn0sUFxdzqtLS0hQKRV1dHUca8kRN7AwWRmIsxSQMHQ42tDEIa2gk0INgpqeoqIicsrKySktLgUUtgZMisQGLThpRwzotAPe5zXHhAIWEhPAzwU9OTFBQEPjsIRVjgeIbRDHPHCmm7f39nVnyDQm0gYVzSkpKcnIyrwEBAbwiHlJQBZw/BM8IaWho4Kjzn/pV8R8aWECfj3CTwgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"일어나\"\n        title=\"\"\n        src=\"/static/d46de6777f7296102e9507a6fc617447/cccdc/image-8.png\"\n        srcset=\"/static/d46de6777f7296102e9507a6fc617447/c26ae/image-8.png 158w,\n/static/d46de6777f7296102e9507a6fc617447/cccdc/image-8.png 221w\"\n        sizes=\"(max-width: 221px) 100vw, 221px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이렇게 간단히 <code class=\"language-text\">append()</code>와 <code class=\"language-text\">take()</code>라는 일종의 proceduer가 작성되었습니다<br>\n이제 producer와 consumer는 단순히 아래와 같이 동작하면 됩니다 :</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">producer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> x<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">produce</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//대충 x라는 데이터를 하나 만들어서</span>\n\t\t<span class=\"token function\">append</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//집어넣기</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">consumer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> x<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">take</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//꺼내와서</span>\n\t\t<span class=\"token function\">consume</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//대충 x라는 데이터를 소비</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">parbegin</span><span class=\"token punctuation\">(</span>producer<span class=\"token punctuation\">,</span> consumer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>진짜 단순해졌습니다<br>\n어랍쇼? Mutual Exclusion은 엿바꿔먹었나요? 라는 생각이 잠깐 들 수도 있지만<br>\n<code class=\"language-text\">append()</code>와 <code class=\"language-text\">take()</code>는 Monitor 내에 정의된 <em>proceduer</em>라서, 이미 그런 것은 보장이 다~ 됩니다.<br>\n또한 저렇게 한 번 정의하고 나면, semaphore에서와 같이 저같은 바보가 잘못 써놓을 일은 없습니다.<br>\n그냥 함수만 콜하면 끝이니까요</p>\n<p>어? 근데<br>\n이전에 semaphore에서 동기화할 때는,<br>\nC.S를 먼저 통과하고 버퍼의 상태를 확인하면 데드락이 발생했었는데..<br>\n이렇게 Monitor로 구현한 방법 역시<br>\nMonitor 내부는 이미 혼자서만 들어가는 C.S인 셈이고<br>\n그 안에서 버퍼의 상태를 확인하므로 데드락 위험이 있는 것이 아닐까요? 싶지만</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 227px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/977e923fba832aae65f871793c8329ee/9b5be/image-10.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEn0lEQVR42i3R+VMaZxgH8P07+gd0pp02GkV3QUUQFUg8F3YXMKhBo4IX8cDWIyKiCCzKERAV4pFU8Qh4gdyCaBCbGLVWTTKTjk3aTqfTtNPp9Jx2ujideef97fN+n+f7Avc7UXMHZulADS2l7YICcRktuGj9PLC873UkfIt77ocRlyWyanbbVXIO1FuSMgCnKRGSCoH0PBCYaIetMmyijWuWlvfW3rzDzp43yON+R9y7kAgsx71zMZcp4jS6plQD3Kz+0tRhDknFzdCgkFEAApMtRbZ2xNaBWFtKh0TMmkJo7BPxE7/jILjyLOo62LLFVrSRFZ1zalCBZing6yoOaQTJ1PAgUwUITDXeeNDGsbeV2aVluprCGkZ6dzUcc88ehhe/2F0+9NsSrtG9x/iarU+BZQ9xSFoUVKOQlkc28jOBiXrmTCd3tgOebmQbRfTWIkhSSvc4zMfRhdPd+dPo7NGWObGmf2zuUmIUNZKJY5AGI/DV2MYqur25eKa1ZLaRZallyOCcKga0Mmc8eeI6jy+eRaePA1OJTfOySabEIBz9H+N8chLjQupkfeFca/H83WLrnfxefi6fdn3a0P/qcP0iNnvuszz3mOKbeoexQ8XPHsVIWiw5Ns6nmAQUQC2kGqvpDyQ3HW1F9oZCdTWjiplRixR4lvQvgpOJhXs7M12bU7LWStYgnKHnQVoilkfW8Sl6QRYwUkHVV+Y+kLAX7t6Ya2IRDzWwSYKifHln4+mmMWyUbFuaPdZ7LSJMiUBjV1jHI4/ys8YIPIgRmGarY8w1MR82s8y3aZL81B6x8Nhte7Wueb5hukhsfH3ijzqntMK85M5EbBJTkrhHwNAIqOPVjGkxe0ZSaK2l32WnSW+VfHfkOdxe6u6U9vT1n7w89y7ZBtEcHTEzBhK/peNd4dWF0REhwyCk2u8wp8VMc3XOpyVpWCH57duLR85lJp3GomYvhRN7B7uqWwwtSlajZA0CEp0T4UB4Q2ORoSoEtN7OI/Bkbb6CA6J5qftP4/vnrwvKOMW8qsDZ5XrArRXd0PFzRpAsIhm/2hywDtWvTst7S0jGapq9oYDY3FBJq6B/ZNT0RQ/iDm9gYcu/GvB+5rCNiTlalKKroGqQDDzZOQT0im7u+icU/FwcI4/X0SfEDEMVpabgGt7X5Nlc9oV8gVjIE/K5A5t4ffkQTML5VDWXjKOgBiEDYmaK34WbZCguYh9vr12ePT3f9w803ZK3CMP+NW/I69vZCcT2traDmrpyRXm6ikvWcClaFCJuQJz34cSwaO1Rz8vT49/++Ovy8s1PP//y7ZtLbZfkyfZGMOwJ7kSCO1FP0EMkK0vThzlEYZAaAYdgEGgs+LiLnx3xDb/68vDvf/794cd3v/7+5+uX58NtNS9ODnYj7kjQHQq5w6F1QxM3iblkVfJARK+AlJUqynk/MN8zq2hYMaueh5xx57ipuUwK08JB71Ov49nS/diS+ewoZpVVyYtTB7iQEgaV5eAAgTtZKRUZ71mk2NZot5TxwQg33STMHK+ht8PUnvpKvK7sxNrx7sD5/TdfWbtq+4pTCDzIgQbgTDkX/A+f2lMxGDe4zQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"꺼내줘\"\n        title=\"\"\n        src=\"/static/977e923fba832aae65f871793c8329ee/9b5be/image-10.png\"\n        srcset=\"/static/977e923fba832aae65f871793c8329ee/c26ae/image-10.png 158w,\n/static/977e923fba832aae65f871793c8329ee/9b5be/image-10.png 227w\"\n        sizes=\"(max-width: 227px) 100vw, 227px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Monitor에서 버퍼의 상태를 확인하고 <code class=\"language-text\">cwait</code>으로 인해 블락되어 queue에 들어가면, 이 queue는 보호되는 구역 바깥에 있어서<br>\nC.S를 잠그고 들어가서 멈추는 것이 아니라 바깥으로 나간 상태이므로 다시 C.S는 풀리고, 새로운 프로세스가 들어올 수 있습니다<br>\ncondition 변수의 queue(또는 urgent queue)들은 Mutual Exclusion의 보호 대상이 아니라는 점이 중요했네요</p>\n<h1 id=\"readers-writers-problem\" style=\"position:relative;\"><a href=\"#readers-writers-problem\" aria-label=\"readers writers problem permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Readers-Writers Problem</h1>\n<p>비슷한 것 같지만 또 다른 문제가 있습니다<br>\nfile이나 공유 메모리 공간처럼, C.S 내에 데이터가 주르륵 있고, 이 것을 읽거나 쓰려고 하는데 이번에는</p>\n<ul>\n<li>reader : 데이터를 읽기만 한다</li>\n<li>writer : 데이터를 읽은 뒤, 쓴다</li>\n</ul>\n<p>이 두 종류의 작업자가 있습니다</p>\n<p>이 경우 동시에 여러 reader들이 작업하는 것은 괜찮습니다. 데이터를 수정하지 않고 읽기만 하기 때문이고<br>\n그런데 둘 이상의 writer들은 동시에 작업하면 당연히 안 되겠죠?<br>\nreader와 writer가 동시에 작업하는 것은 어떨까요? 좀 애매해 보이기는 하는데..<br>\n이것도 막도록 합시다. 동시에 작업하면 reader가 읽은 값이 수정 전 값인지 수정 후의 값인지 모를 뿐더러<br>\n더 운이 나쁘면 수정되는 사이에 값을 읽어버릴 수도 있습니다<br>\n아무튼 정리하면 조건은 아래와 같습니다</p>\n<ul>\n<li>reader는 한 번에 둘 이상 동시에 파일을 읽기 가능</li>\n<li>writer는 한 번에 단 하나의 writer만이 파일에 쓰기 가능</li>\n<li>하나의 writer가 파일에 쓰기 작업을 진행중이면, reader는 파일을 읽기 불가</li>\n</ul>\n<p>이렇게 됩니다.<br>\n따라서, 이전에 살펴본 producer-consumer 문제와 달리, 코드가 대칭적으로 생겨먹지 않습니다<br>\n아무튼, 이제 reader와 writer를 위한 <code class=\"language-text\">reader()</code> 함수와 <code class=\"language-text\">writer()</code>함수를 작성할건데<br>\nsemaphore를 이용하여 위 세 가지 조건을 모두 충족시키도록 해봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/* program readersAndWriters */</span>\n<span class=\"token keyword\">int</span> readcount<span class=\"token punctuation\">;</span>\nsemaphore x<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nsemaphore wsem<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">reader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">semWait</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\treadcount<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>readcount <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token function\">semWait</span><span class=\"token punctuation\">(</span>wsem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">semSignal</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">READUNIT</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//대충 read한다는 뜻</span>\n\t\t<span class=\"token function\">semWait</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\treadcount<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>readcount <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token function\">semSignal</span><span class=\"token punctuation\">(</span>wsem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">semSignal</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">writer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">semWait</span><span class=\"token punctuation\">(</span>wsem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">WRITEUNIT</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//대충 write한다는 뜻</span>\n\t\t<span class=\"token function\">semSignal</span><span class=\"token punctuation\">(</span>wsem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\treadcount <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">parbegin</span><span class=\"token punctuation\">(</span>reader<span class=\"token punctuation\">,</span> writer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">readcount</code>나 <code class=\"language-text\">semaphore x, semaphore wsem</code>같은 각각의 요소들을 한 줄로 정리하기는 좀 애매해서 주석을 많이 달지 않았습니다</p>\n<p>일단 좀 더 짧은 <code class=\"language-text\">writer()</code>부터 살펴보면, 전형적인 C.S 코드인게 보입니다.<br>\nwriter든 reader든, writer와 함께 작업할 수 없으므로 <code class=\"language-text\">wsem</code>이라는 semaphore로 C.S를 잠가놓고 작업합니다.</p>\n<p>그 다음 <code class=\"language-text\">reader()</code>는, 일단 대충 read하는 문장인 <code class=\"language-text\">READUNIT</code>을 중심으로 위쪽과 아래쪽인, 작업 전과 후로 나눠서 살펴봅시다</p>\n<ul>\n<li>작업 전에는, <em>reader</em> 하나 추가요~ <code class=\"language-text\">readcount++</code>. 이 때, <code class=\"language-text\">semaphore x</code>로 C.S를 잠그고 진행</li>\n<li>작업 후에는, <em>reader</em> 하나 나가요~ <code class=\"language-text\">readcount--</code>. 이 때, <code class=\"language-text\">semaphore x</code>로 C.S를 잠그고 진행</li>\n</ul>\n<p>그럼 이제 <code class=\"language-text\">semaphore x</code>와 <code class=\"language-text\">semaphore wsem</code>에 의해 각각 C.S 영역이 생겨서 두 개의 방이 생긴다는 뜻인데<br>\n잠깐 그림으로 살펴보면\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/29fdfe1fcdd06467e881f4d2a7787e5d/5a791/image-12.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.0632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFElEQVR42rWVSYviUBDH+1MPPR/DBdSb4E1RSUjo0wzjdhMPCh7cxQ1xV1yiT6vrX2PSia0zMkMHftRb8v6vql695OXlK57D4fDNsqyfjM4YbpRSxvF4FIjoHjrP/WCNV0fwfD5rPEGXy0XRzcNjYvkdms1mNJ1OPUwmE3uN4QjyDimMsLUYZcO7qm63q5bLpZrP5yqfz6tCoeAhm81aPIfluiPIoWlXQXU6nQhwqOLVdruVPtr7/Z52u50HnhcPkZ6HghDDrghpPB6LXSwWzkZueOzvgna+er0eDYdDGgwGYvk9siOwwZqnPIRHEIRYv9+n0Wj0f4LIHR8GrVYrYb1eY/7fBN0H484bUnGH5wXtfEIM3tneukFJPRRki/ojG65DarfbzolzzVEul3Ms1yVlMhnUqbewbcF7N2Wz2TieXm+GgHK6VoC6Rue5KSJYLpdVrVajZrNJjUZDbLVapXq9Lu1OpyO0Wi0Rv17JzyHjLqPqo9GoSiQSlEqlKJlMCmjf9uPxOBWLRfEa1/OTICddQ1i6rqtgMEh+v59gA4GAgD5A2+fzYWOqVCoiiLzf9RBFm06nVSQSoVAoRLDhcFhA3x6DjcViSI98iR4JphCypmmWYRjqT5imqbBxqVRSyJ8FT34LfnxtuC+HwqLq9mvyCJSVuzJY/MNDfuGVd8jyoMm8PQPn/Y3XAJP5xYfz/Ut+J+/uCuo+yfKPZAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"과정 0\"\n        title=\"\"\n        src=\"/static/29fdfe1fcdd06467e881f4d2a7787e5d/f058b/image-12.png\"\n        srcset=\"/static/29fdfe1fcdd06467e881f4d2a7787e5d/c26ae/image-12.png 158w,\n/static/29fdfe1fcdd06467e881f4d2a7787e5d/6bdcf/image-12.png 315w,\n/static/29fdfe1fcdd06467e881f4d2a7787e5d/f058b/image-12.png 630w,\n/static/29fdfe1fcdd06467e881f4d2a7787e5d/40601/image-12.png 945w,\n/static/29fdfe1fcdd06467e881f4d2a7787e5d/5a791/image-12.png 1248w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n이렇게 시작을 합니다.<br>\n각 semaphore (<code class=\"language-text\">x</code>와 <code class=\"language-text\">wsem</code>)에 의해 제한되는 C.S 영역과 해당 영역이 잠기면 들어가기 위해 대기하는 큐가 존재하고<br>\n<code class=\"language-text\">wsem</code> 내에는 데이터가 읽고 쓰여지는 공간이 존재합니다</p>\n<p>이제 writer인 <code class=\"language-text\">w1, w2, w3</code>가 차례대로 도착했다고 해봅시다.<br>\n그럼 당연히 처음 도착한 <code class=\"language-text\">w1</code>만 <code class=\"language-text\">wsem</code> 내로 들어가 작업을 시작하고, <code class=\"language-text\">w2</code>와 <code class=\"language-text\">w3</code>은 대기하겠죠?\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/730b9c9e695a55da7cd074eab4c1bc45/5a791/image-11.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.0632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACTklEQVR42rVVWYvaUBSeX12mP8OFiRYKgm+KStKkUwodaqrTlooPWnxwFzdEjVHHJXr09JyrySSOUmmZwMe563eW+92bm5vX+Nbr9RvLsh4ICkF1AwDUzWYjgIjnoNDcF+K4dQh3u51ME7jf7wFPPhoTltbgeDzG0WjkwXA4tPeoDiF5SPIIWYsANsgrtFotME0TDMOATCYD2WzWA13XLZrj7YpDSKnJR0LYbrfIoFRFVIvFQvS5vVqtcLlcekDzIkIuz0VCJmOvnNJgMBB2Mpk4jtygsb8T2vVqt9vY6/Ww2+0KS+vQzsAG77kqQo6ICZms0+lgv9//P0KuHR0GTqdTgdlsxvP/Rug+GHfddjaoJC5cT2jXk8k4uqflE84J09nUiZwldZGQLOsPbZAOsdFsihM3TAPTxe+o//6Jj79+4DddR9IlptNp1qlX2DbhuZsyn8+dSI25icZsgqPxQU5HBcAxO89NEYSFQgHK5TLWajWsVqvClkolrFQqot2oN7DZaGK9XhfaPF7JlynzXWbVRyIRiMfjmEwmMZFICHD7tB+LxTCXy4mo+Xq+IKSiy5yWoigQDAbR7/cj24A/gIFAQPQZ3Pb5fOwYi8WiIOS6n42QRZtKpSAcDqMkScg2FA5h8L2Ed+8kDB3HeC4ajXJ5xEt0iTDJKcuybKmqCgIfVNA+apD4LIPy6dDncU3TgB3n83ng+lkcyYHw+bWhvjgUIoXT12S1Xp19ZVhWbmUQ+XOEtOCWPOg0qBHurwHV/Z72MDTCVzqct6/yO/kDSJ7qul4f8ckAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"과정 1\"\n        title=\"\"\n        src=\"/static/730b9c9e695a55da7cd074eab4c1bc45/f058b/image-11.png\"\n        srcset=\"/static/730b9c9e695a55da7cd074eab4c1bc45/c26ae/image-11.png 158w,\n/static/730b9c9e695a55da7cd074eab4c1bc45/6bdcf/image-11.png 315w,\n/static/730b9c9e695a55da7cd074eab4c1bc45/f058b/image-11.png 630w,\n/static/730b9c9e695a55da7cd074eab4c1bc45/40601/image-11.png 945w,\n/static/730b9c9e695a55da7cd074eab4c1bc45/5a791/image-11.png 1248w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n이렇게, <code class=\"language-text\">wsem</code>은 닫혀있습니다. writer는 대문자 I라서 혼자 작업하고 싶어하네요~</p>\n<p>이제 <code class=\"language-text\">r1</code>이라는 reader가 하나 와서 <code class=\"language-text\">reader()</code>를 실행한다고 해봅시다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/73c44f1121e9e4e9c63ef5372d52a2f2/5a791/image-15.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.0632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACm0lEQVR42rVVa2saURDNry7pz4hKjYVCIN8SNLjZbUqhxVglpUgKStPE9zYxDx/rqutjk6unc27dvFTSLxEOd+7rzMyZueva2mv8JpPJG9/3vwoMgfkYSinz9vZWA8AyGLL3RTjW7wmn02lSNjCbzRSe/WRNj3IGnU4H7Xb7CVqtVnDHvCcUDwmuyOgLVADxqmzbVq7rKsdxVCaTUdls9gnS6bQve7xu3BNKask5obq7uwMhqeqohp6n57RHo9EChsOhjpDyrCQkGb22JcWbZgsdsXu9nialBNwPIOdXE8rIVDGVg9Tr4tzG1Wka9tlPlKt1uN2uJhYpEGTCIFYSikcVRNGVyxfnf3B5dgS7lEe1ZqPf78ETCZrNJoleJqT4jICXBoMBXLF7fU8wELK+JqAzVpdRMuWlhLKoCUulkiqXy7i+vtaCM1qt6VxXYiZrjD4gZ1YvphwQBdXlHeknDEYevPEQxdNfcERjRs2sVhKy78TmptaIadXqdV1xx3WQKnxHppDF7x/7yB2lkP6WweFhin36tLEDwmUvhVoGkToDF06/C8+9kcLcoHF5iUajoeYtt6hhPp9XxWIRlUoF1JLjyckJtdV2rVpDvVZHuVLVhZk/ycWU+ZZZhK2tLbW7u4tEIoF4PK5B+/l8Z2cHuVxOR02ZFghF9CTTMgxDRSIRhEIhcAyHwgiHw3pO0N7Y2KBjFAoFTcjHsDRCFmJvb0/FYjFEo1Fw3IxtIvIhinfvo9icr3Fve3ub8ui2WUWYYMrJZNI3TVNp7JvK+mip+OekMj79m3PdsixFx8fHx2wxdoU/J3z42shcF0VI1fOvyXgyxng8XvjKsK0ed4aQP0QoB9bFQ1oWLcHB/0B0P5A7hCVISXHevsrfyV9jAed/05/qxwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"과정 2\"\n        title=\"\"\n        src=\"/static/73c44f1121e9e4e9c63ef5372d52a2f2/f058b/image-15.png\"\n        srcset=\"/static/73c44f1121e9e4e9c63ef5372d52a2f2/c26ae/image-15.png 158w,\n/static/73c44f1121e9e4e9c63ef5372d52a2f2/6bdcf/image-15.png 315w,\n/static/73c44f1121e9e4e9c63ef5372d52a2f2/f058b/image-15.png 630w,\n/static/73c44f1121e9e4e9c63ef5372d52a2f2/40601/image-15.png 945w,\n/static/73c44f1121e9e4e9c63ef5372d52a2f2/5a791/image-15.png 1248w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n이해를 돕기 위해 <code class=\"language-text\">readcount</code> 변수를 값과 함께 띄웠습니다<br>\n<code class=\"language-text\">r1</code>은 <code class=\"language-text\">x</code>를 잠그고 들어가서는 <code class=\"language-text\">readcount++</code>을 진행했고,<br>\n그런데 그러고 나니 <code class=\"language-text\">readcount==1</code>이므로,<br>\n<code class=\"language-text\">r1</code>은 <code class=\"language-text\">wsem</code>에 가서 <strong>줄을 섭니다. <code class=\"language-text\">x</code>를 잠근 상태 그대로.</strong></p>\n<p>그럼 이제 다른 reader 친구들, <code class=\"language-text\">r2</code>, <code class=\"language-text\">r3</code>, <code class=\"language-text\">r4</code>, <code class=\"language-text\">r5</code>가 주르륵.. 들어오면 어떻게 될까요?\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2dfe029415edbfa7b14bd68daf0dad46/5a791/image-16.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.0632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACw0lEQVR42rVV+08aQRD2r27snyGQIk2amJi0CQbM4V1tmrTFR0vTEJpAapX3iVjlcXc8j5M5vs4snFKV2F+85Mvuzu5+M/PNLKytPcc3mUxeeJ73mZFi6MsgIv3m5oZBug/otATMkeL9T8yxfkvo+77GG5jNZoR7H9vU6PtTuE4Drn3OMNVod1totdvBHf2WkD0kxcKjx6AA7JVM0yTbdqhnt6n0LU7VzFuFSuYd5TJfKH1w5NmWJddTt4ScmrYgpOl0CgGnylH5GA2Hai3ziTtS8BTGGI/HGI3GKkKRZyWhkFnstdPt4rrVRpfnvV6P7T58lmDK45TPyDk+v5qQR0kVPh/sMtlFw8Sf00OYZz9Rrtbh2LYiZikQZCJBrCRkjySpSSFsvnzROMflWQZmKY9qzUS/38OQJWi1WkL0NKHjsPi9+aXBYACH573+kDFgsr4iEGedTkdFKSk/SshGRVgqlahcLuPq6koJLtEqTRe6CmZsk+gDcsnqyZQDoqC6cof7CYPxEEOucPH0FyzWWKKWrFYSSt/xXDaVRpJWrV5XFbccC+nCdxwXvuL3jz1kM2kcHh3j4CBNTPpvYweEj70U0TKI1Bo4sPo2hs41F+YazctLNJtNWrTcQw3z+TwVi0VUKhWIljKenJyItmpeq9ZQr9VRrlRVYeZP0n+YsrxlKcLW1hbt7OwgmUwikUgoyPz+Oh6PI5vNzl8Py/SAkEXXJK1UKkWRSAShUAgyhkNhhMNhtRbIfGNjQxyjUCgoQnkMj0Yohdjd3aVYLIZoNAoZN2ObiLyJ4tXrKDYXNtnb3t4WeVTbrCJMSsqapnm6rpPCnk7Ge4MSHzVKfZivxW4YBonjXC4nLSZd4S0I735teK2KwqQkxMtwJy5c18V9u7TVcmcw+V2EfGCdPRyy0WDs/w9Y932+IzAYaS7Oy2f5O/kLbBHngRb2/XgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"과정 3\"\n        title=\"\"\n        src=\"/static/2dfe029415edbfa7b14bd68daf0dad46/f058b/image-16.png\"\n        srcset=\"/static/2dfe029415edbfa7b14bd68daf0dad46/c26ae/image-16.png 158w,\n/static/2dfe029415edbfa7b14bd68daf0dad46/6bdcf/image-16.png 315w,\n/static/2dfe029415edbfa7b14bd68daf0dad46/f058b/image-16.png 630w,\n/static/2dfe029415edbfa7b14bd68daf0dad46/40601/image-16.png 945w,\n/static/2dfe029415edbfa7b14bd68daf0dad46/5a791/image-16.png 1248w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<code class=\"language-text\">readcount</code>를 ++하려고 호기롭게 들어왔지만,<br>\n우리 reader 친구들은 <code class=\"language-text\">x</code>가 닫혀있어서 하는 수 없이 줄을 서게 됩니다..<br>\n즉 writer가 <code class=\"language-text\">wsem</code>을 잠그고 들어가 작업중인 경우, <strong>reader들은 단 하나만 <code class=\"language-text\">wsem</code>에 가서 대표로 줄을 서고, 나머지는 <code class=\"language-text\">x</code>에서 기다립니다.</strong>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 210px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/423ef583b90ea1d5f78cc3a5ba5d72c5/65ed1/image-17.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAADX0lEQVR42o1UaU8TURTtz/ELGokRpAVl6zKdsrRMKS0twkBLQawGBQRXhCBgYqImfAJB0SA70ZiwmJCwmQBRo6WlyFa0LGGxhcIUunjoABYSE++H5rxz73l3eXfK8Xq9Ozs7m5ubLpdrY2Nje3vb6XQC7O3tMQxjt9tx3NragndtbQ084sGD2d3d5UxNTX30m9lsrqysbG9v7+joqKmpQWh9fX1dXd3AwEBnZ+fg4GBDQ0NLS8v09PTo6GhfX5/RaOSsrKz09vbCh+impqaRkRGTydTa2upwOLq7u9va2nDp8PDw2NhYT09Pf3//3Nzc0NDQ+Pg4auT4fD6UhNpQBhwAKGx2dnZpacnj8aAd1A8X6lxcXFxfX0c82gQDwPH6zXdoYCcmJhBntVotFov30I4CAhlOIIvf+fn55eVllgHGLYECNuborr9ilkXDR0FoBw0Hpj1hnMC0aGxmZgYAw4ASAM1jkIHZ/inGkNg6V1dXbTYbAB4Wb/NfYnaeuKK2tra5uRkMBj45OYmB78f4Tg7vmBijghhpq6qq8LasC1uEdgDcHs9B8CE4EHv8Z4iRFgBrg61iXSAXFqxsjNO5+dtuBzj2VOxhxW/sGsDcbjcwVs1sMn/68qmotLCwXJ+gS3jV1sBKOKzM8sPyoqWx68M7k2nCP23nz58LAHa7o+n9m8xbaTFaYVgcV26QiDNjlXnkN/P3g8wM47pffSMmMURM8wlVXGn17b6PXb/XHa/fNvJTJafJc9l3KJVWoiyUibVxWQVUqj624tmTA7FtyaYplD18mnatJIUrjw5L4sakXHzwKD+KijoVeVaoITLKlOXPL+cVK0KpyOjLBD89+nFNKaa/LzZOGiOocCKXJHPIRIOYyhULM4nUbIFaH0cXUNoKRWx61CXNRZ78grookb4pi1RcMtzVe9x7++LP374GESEFVSq6SHo+PpSv5IUnRQTFcPW3pXUvdfJscZAgmL4mUhlEsjxhSYWaK+WRacm7jGtf/GvRmnxVoi6W0fnS4PgIUTYh1hGJNJmkF1N0vCqLUN2QaYqlV0oUZ0iexCARZQrS8jMYxv89448nw6AJloaRqQLtdUnuPfkFMlyoiFbr4gUKUU5ZCqnmh8oj5boE2pCQ90DBk/AoWsm4dv4AQnucmFNVri4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"내 짬에 해야겠냐?\"\n        title=\"\"\n        src=\"/static/423ef583b90ea1d5f78cc3a5ba5d72c5/65ed1/image-17.png\"\n        srcset=\"/static/423ef583b90ea1d5f78cc3a5ba5d72c5/c26ae/image-17.png 158w,\n/static/423ef583b90ea1d5f78cc3a5ba5d72c5/65ed1/image-17.png 210w\"\n        sizes=\"(max-width: 210px) 100vw, 210px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n막내가 아닌 짬킹이 줄을 서는 선진병영이네요</p>\n<p>이제 <code class=\"language-text\">w1</code>이 끝났다고 해봅시다.<br>\n그리고, 이 semaphore는 강한 semaphore라서 큐에서 꺼내오는 순서는 곧 죽어도 FIFO라고 가정하면<br>\n<code class=\"language-text\">w2</code>가 들어가서 작업, .. 끝나면 <code class=\"language-text\">w3</code>가 들어가서 작업, .. 끝나면 <code class=\"language-text\">r1</code>이 들어가니까...?\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/03afc902aa9ff81475c4af7c1eb3decf/5a791/image-19.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.0632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACkklEQVR42rWVW2/aQBCF86ur9Cf0pRWQBlBfkKI2Eikgu0bpS9sAUVK1EQ+hQooMhEu4X0xaIBjGOZ1ZbEITkOhDLH1aey9nz8zOws7OczzT6fSFbdtfGZ0xViEiYzabMWQ4gEErYIHO419YY3cp6DiOxgO4v78nPHq4T7WOM8fdsIY7q8pUVGv1O+h0u94aYynIO8Slh1ubIQ/elSqVClnWkG6tLplnUSqdf1AUzw8pe/6NTlIZ2xoMZLm+FOTQNFeQ5vM5BA6VXTkYj0bqW97tuwkzdplgMplgPJ4oh5KejYIiNuBde70+2u2Oai3LwmxOPOZgTqTmCDx/syC3Eiq7IfT7fdzUamiaP1EvX6HRbPH4FF4EHmJioyDvSBKaHIQ4qtWqKP46Q71iuoL2/wkOh5z821uMOG9Cp9NBvd7E7z8jSL+430qQO5WgaZpUKBTQai3ciEtJvLj2DmkN24Usgr1ebykm7sTlYySqjYJSd16eZLIcTLVadU+8h3Q6jUwms2xPT0+RSqWIRf8tbE9w9abIJHE2WqlDEe12u4p2u41Go8E5rpNbck9zeHl5SaZZwFU+hx/fz3B9fY18Pi+5RbFYRLlcVpRKJSW+uJJrcih3WZIfiUTo6OgjPh++gfb+LWIJHfF4jIkjFosp5D0ajeLi4kK5ljQ9EeTQNAlL13UK7O1h3/cKocBr+AN7CAQC8Pv9Cnn3+XyyMXK53OI68mVY61AOI5FIUDgcxn4wjHD4HUKhkCIYDCpkTNqDgwNJj1cNawXjErKmabZhGGQYn1yMJySTSZKNs9mslJhUhe0KPvza8Lc6FBYlEd4GqcvVymDxB4c8YZd3SHNnkjneBs77Ma8RkswJH87LZ/k7+Qv/t+cgPikhUAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"과정 4\"\n        title=\"\"\n        src=\"/static/03afc902aa9ff81475c4af7c1eb3decf/f058b/image-19.png\"\n        srcset=\"/static/03afc902aa9ff81475c4af7c1eb3decf/c26ae/image-19.png 158w,\n/static/03afc902aa9ff81475c4af7c1eb3decf/6bdcf/image-19.png 315w,\n/static/03afc902aa9ff81475c4af7c1eb3decf/f058b/image-19.png 630w,\n/static/03afc902aa9ff81475c4af7c1eb3decf/40601/image-19.png 945w,\n/static/03afc902aa9ff81475c4af7c1eb3decf/5a791/image-19.png 1248w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<code class=\"language-text\">r1</code>의 <code class=\"language-text\">semWait(wsem)</code>이 풀린 것이고, <code class=\"language-text\">semSignal(x)</code>로 <code class=\"language-text\">x</code>의 잠금을 풀었습니다.<br>\n이제 <code class=\"language-text\">READUNIT()</code>에서 읽기 작업 중인데, 오래 걸리는 작업이라 여기서 한동안 머무른다고 생각해봅시다.</p>\n<p>이 때 <code class=\"language-text\">x</code>은 값이 1로 열려 있고, <code class=\"language-text\">wsem</code>은 <code class=\"language-text\">r1</code>이 0인 채로 지나왔습니다<br>\n이 경우 writer는 <code class=\"language-text\">semWait(wsem)</code>을 먼저 실행하기 때문에 값이 -1이 되어 기다리게 되지만,<br>\nreader는 <code class=\"language-text\">x</code>를 잠근다 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\rightarrow</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">→</span></span></span></span></span> <code class=\"language-text\">readcount++</code> <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\rightarrow</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">→</span></span></span></span></span> <code class=\"language-text\">readcount</code>가 1보다 큰, 2 이상이다 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\rightarrow</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">→</span></span></span></span></span> <code class=\"language-text\">x</code>의 잠금을 푼다<br>\n이 과정을 반복하며 <code class=\"language-text\">READUNIT()</code>에 얼마든지 도달할 수 있습니다<br>\n그럼 이 이후로 <code class=\"language-text\">r2, r3, r4, r5</code>가 모두 <code class=\"language-text\">READUNIT()</code>에 도달하고, 새로운 writer인 <code class=\"language-text\">w4</code>가 들어왔다고 해봅시다\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/885c2a1b28ea282cd4cf17898e284807/5a791/image-20.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.0632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC00lEQVR42rWV2U8aURTG/asb+9zWtD40wRphsGlosA9qIgWHGpuUyCZi0bTQWjaLLAOy78vIha/njA5QlZSXTvLlZu6953eWe+7M0tL/eAaDwRNVVV0kB0melRBCvrm50TQaQRYzAjQ5aO0LMZYnwNFoZKcFjMdjgXsPzd2OI4F+63qqZh71ahmlUlm3kSdA8rDHMzSqJKGLvIp0Oi1qtbpo1qvi4mRfXBzbRMS7J6JBhzgLesWR26PWazU2d0yAlJr9DiiGwyFYlCoocnS7XS1KJZ9H+Ps3JOIxMEAd9NDr9Xhdi5DLMxfIsBoZVatVXBcKCARO4HK5kM8XIMgJO+I9LNo/H0gjp6ptrFSqUHJZ5H75sL31DulMVgewY+iZcBBzgWQg2DunSHWjiBSc+Q+RvUriulhCv9+fgBYCNhoN0Wq10Ol0wGOz2YTH60cimdRqSfsWA9KkBozH4+Ly8hIFqlu73aaIh4hGo0ilrrSo9YO6p3+nrIsjpbYhYArUQuj0u1rUs+Ks5gK57zgtNuboyuUyQmchxGMxZJUcfD+COD4NwOP2wOv1wufzwe12C4L+3dg6UL8pY9zejlarjZySR4nA3EK1dgPlSllzVCwW6dDyUBRF3LXcwxqGw2ERi8eR+p1AMvYTX4N++L1uBAN+nAZ8SEQvkMlkwHWuVCqa00dryHeZu95isYjd3V0c7qzj84cVOK2rONx6gU/vn0O2PIPd+hofbTZsb+8gFAppdeYyPQDSWdi5BRwOh3izvo4NwytIay9hotG8tgLJsKKNprVVGAwGdoxIJKIB+TI8GiEfhs1mE5IkwWiUYDK/hdFkJm1iwySRzDBJm7RmhNVq5fJorTQPuMcp2+12VZZlcav9GU3fnU6nYMfn5+fcYtwV6h1w+rWhd+1QCCoYvIj4Ps92BsGnEdKGZfLgoUkn6WARUd0PyIblJB3R4Tz9L7+TPytq37SYPuprAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"과정 5\"\n        title=\"\"\n        src=\"/static/885c2a1b28ea282cd4cf17898e284807/f058b/image-20.png\"\n        srcset=\"/static/885c2a1b28ea282cd4cf17898e284807/c26ae/image-20.png 158w,\n/static/885c2a1b28ea282cd4cf17898e284807/6bdcf/image-20.png 315w,\n/static/885c2a1b28ea282cd4cf17898e284807/f058b/image-20.png 630w,\n/static/885c2a1b28ea282cd4cf17898e284807/40601/image-20.png 945w,\n/static/885c2a1b28ea282cd4cf17898e284807/5a791/image-20.png 1248w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\nreader들은 너무 외향적이라 다같이 파티를 해버리네요<br>\nwriter인 <code class=\"language-text\">w4</code>는 너무 내향적이라 파티에 끼지 못하고 그냥 밖에서 기다립니다..</p>\n<p>게다가 여기서 새 reader인 <code class=\"language-text\">r6</code>가 들어와도,<br>\n밖에서 기다리는 <code class=\"language-text\">w4</code>는 신경도 쓰지 않고 그냥 <code class=\"language-text\">READUNIT()</code>하러 들어가버릴 수 있습니다\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4fc6b4b2120d3bebbed2789570d87172/5a791/image-24.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.0632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACtElEQVR42rWV2U8TURTG+asNPppoLNEHEUI7aEgJilEipO00uARjp20UhSqUQIU2bYEC3RfagaFn+nnO7UJZKvjATX6529zvnu22Q0N30U5PT+9ZlvWF8TJ6P0Skn52dKWwbug3ouIiX95ZYY7gnaNu2hzfQarUIlxqvtXubYFaPUC7mkS8UUOiQz+e7Z/SeIN8wLyvcWwx14VspnU5TuVyhSilPm998FFk2KBgKUzgcYsJkGIZVKpXkuLcnyK55OoLUbDYhsKtgy9FomGpcLBZhNuo4MU9gmmaPRqOhLJTwDBQUAblVRI4ODxGLxXDIPZGt9vrh7wcLci+uqg8LhSL293eR2Qpjc+0Hsrk8OAToetBFjBgoyEIkbkoiOG4suIf9+G/sJnfYwiM59H+ClUqFarUa6vU6atUqqjwulqtIpdOQdbH+VoK8qAS3t7cpkUjg4OBACShrmSqLyxxcQbJ2iZtdFjoBV2OxLJfLoW42lHg/4tVAQak7iZMgIpKEZDIph7CX2cPSioHvq8swAgEEg0GEQiEEAgGS/QuF3RXsvpRWB2nHx3VIZTTZ4hRnPdd+Hchmsyo0mUyGOiV3NYbr6+vEcUQywcRjqo9tbSC+E+NMxxFd+4U/mxtIpVLq2Um7NobylqXq3W43zc3N4eO7cXyedeDD66dYeuPg8Qg+zT6Bb/oxfFMP8P7tK/xcWVXxlTBdEeQEeCQBXq+XxsbHMTE6Au25A65RB7TRR3A9a6ONyfwhpt1TiEajSlAew7UWSiIWFhZI0zQ4nRpcky/hdE3Cqb3ABPeCS8bOSczMzEh41AMYJDgvLns8HkvXdWrj6+N87vfrJBdHIhEpMakKqyN4/mvDc5UUFqX+X5J/IWXVXxksfm4hfzDMNxi86GcWbwPHfZHPCH7mKyfn/p38nfwFewHlr+HMwz8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"과정 6\"\n        title=\"\"\n        src=\"/static/4fc6b4b2120d3bebbed2789570d87172/f058b/image-24.png\"\n        srcset=\"/static/4fc6b4b2120d3bebbed2789570d87172/c26ae/image-24.png 158w,\n/static/4fc6b4b2120d3bebbed2789570d87172/6bdcf/image-24.png 315w,\n/static/4fc6b4b2120d3bebbed2789570d87172/f058b/image-24.png 630w,\n/static/4fc6b4b2120d3bebbed2789570d87172/40601/image-24.png 945w,\n/static/4fc6b4b2120d3bebbed2789570d87172/5a791/image-24.png 1248w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n이러한 특성때문에, <strong>reader들이 우선순위를 가진다</strong>고 말합니다.</p>\n<p>그렇게 reader들의 왁자지껄 웅성웅성 👥👤👥👥👤 파티가 끝나고\n모든 reader들이 나가서 <code class=\"language-text\">readcount=0</code>이 되고 나면, 마지막에 나가는 reader가 <code class=\"language-text\">semSignal(wsem)</code>으로 이제 <code class=\"language-text\">wsem</code>에 아무도 없음을 알립니다.</p>\n<p><a href=\"https://www.youtube.com/watch?v=KNp2VyF0qHY\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 300px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACYklEQVR42jWRW08TQRiG92cYEyUmHMLudk/d0nZ3dmd3Z6YNS0FTiQVaWVrOlIPUSjkJSKwcNCoYlBrFiiZW1ESONwox0RtDYmK89Mp/4lIleW7m4nm/d76PiiT67WgCAU2VRALUFru+M9qUH+6LIkMFQCbYaxmChUQLc4blgchFsLD75C1CXYz3h+1L9RhjoLjmZF9qeXTgYP1+1mlBdbIfWTImEiKuzxknPm8iEREJExETKtLagwyk+eRWGxUXZtdmJr69LR6/e7maG+mwkQ8EJRIWkQsWETqFlAlRjVccCyhSTc3cYNev/a0/h3vHH14dFh//3tl6MX2DEzhvOPxvVHmaa1qnEZhqgwT6ZK6mOpOMf3ld+F7a2HmwtJEdOXq6sjo25GFq3dpu25N/olDZtE59VwYQSKLE0LFI6OP6vYPCw6PCo90786WlmeH4ZYFhZIxZXWd1WI44cYT/MqGaVeD3sH6eCwj0YqZne235a+n5p2crmwuThpdTRL4OmbQGPbrugZrHMHkTl1u4O0dUJOAXqiplmlYFNt3SMNcbX0yn8r2ODeoqz1WEggHFNGkdshqsBToPIQsNd+FuhAuli3zl2TO1FRWGxN9MX50fTOacxutOA1t1QWSqTdmHTY3RFI+hqPWABZqEAA9N9/gSRpTGewkkXkFsULz5a53LY0NzOXtmUqWrz4+OBnuSgekJcPtWl+PE0iPBWFJrSwXau/2ZnAqbTGq3uPfj88/VlUJ2sPvJbGYjP353qn0qY8s0k+oQ483BWJN/f7OwXSyNT0dK799kJ7qdgUQ0YYHG0F/qItY3AQD16AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"잘 놀다 갑니다\"\n        title=\"\"\n        src=\"/static/ce4188060316f1eb94aab3616d62e9f3/5a46d/image-27.png\"\n        srcset=\"/static/ce4188060316f1eb94aab3616d62e9f3/c26ae/image-27.png 158w,\n/static/ce4188060316f1eb94aab3616d62e9f3/5a46d/image-27.png 300w\"\n        sizes=\"(max-width: 300px) 100vw, 300px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></a></p>\n<p>그러고 나면, 이제 조용해진 <code class=\"language-text\">wsem</code>에 드디어 <code class=\"language-text\">w4</code>가 들어갑니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d742d223b9694fca8a6464eadd03d0e7/5a791/image-25.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.0632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACb0lEQVR42rVVWWtaURDOry7pX7APxQVcngTBB0Wtt/c29KGlbrSloqCQB0mCIS6k7rvXjE7nm6pxpelDhI+5Z8693yznm+PFxWv85vP5G9u2vwoMgbkLIjIXi4WCmU/BkL0vwnG5JVwul0nZ4NVqRXzwE59aeYc7nQ632+09tFqtzTfmllAixOERawtoA4lK9/f31O/3qdvtUjabpVwut4d0Om3LHj43toRSWnJNSE9PTwxIqZrVZDLRNZ5nsxlPp9M9yL5miPacJQQZoqKkx8dHtb1ebxtoF+I7TygWpeqLIHl4eOBGo8H1el2t7POmgg2QxFlCISKUhoNARiAEWa1W42az+f+EaP5wOOTxeMywg8FgC6yR/YsIxamElUqFbm9vtTwQINPdvi1pqYdzgH+XDGwywDPIkN1kOuHBcLCXOao6SwjdoU8ACGTN1WpVT7zb63K2+IO///rJ6VSKM5kMiy45lUpBp/vC3hCempTRaKSlQo+N302dFpkOldNaAbSW3HEPS6USSR8Zfby5uVF7fX2tz8ViUdcyOXx3d6eyWo/kccmYZag+GAxSNBrleDzOsVhMkUgkOBKJcDgcVj+AdT6f1/6iTUeE0vQkDsAwDPJ4POxyufivdbPb7WaHw8FOp1N9sBKYy+WyEmIYTmaIg5BsyO/3s9frZdhAIMDv3U52vHNwwB9gn8+ne6FQCO1RWZ0jjKPkZDJpm6ZJio8mWZ8sin5O0Icrg6y137IsQuBCoQCJQRX2mvD5tpG1HoqQ0uFtMsUNc+KWgax2lSHkzxnKC5cSIS1OS3D1Ekjfr+QbwBJ8k8N5+yp/J38AOg/odxa17uQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"과정 7\"\n        title=\"\"\n        src=\"/static/d742d223b9694fca8a6464eadd03d0e7/f058b/image-25.png\"\n        srcset=\"/static/d742d223b9694fca8a6464eadd03d0e7/c26ae/image-25.png 158w,\n/static/d742d223b9694fca8a6464eadd03d0e7/6bdcf/image-25.png 315w,\n/static/d742d223b9694fca8a6464eadd03d0e7/f058b/image-25.png 630w,\n/static/d742d223b9694fca8a6464eadd03d0e7/40601/image-25.png 945w,\n/static/d742d223b9694fca8a6464eadd03d0e7/5a791/image-25.png 1248w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n아 시끄러운 <code class=\"language-text\">wsem</code>에 차마 들어가지 못하고 밖에서 기다린 <code class=\"language-text\">w4</code>에 과몰입했는지 이 그림조차 너무 고요하게 느껴집니다...</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 225px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3d9be0d015ab779259049099e2022f2c/3684f/image-28.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEvUlEQVR42hXP+U9TBwDA8ZclS7bFMeoBAnK0tXf7Xq/Xvrbvvfb19T6gFEppqcVa2gKlpYcccsmNoCBFUQQ8hm0VUQSGbuKxZdG4BGc0cdmy/bJsP+zfmP4Bn2/yBdZvXm3xeU2kyWoyz08PbeZvZGbOtcb6mgOdfn+7z9fadKLV1hD0BpKeQNIfSqVjsUi0x3sq6fFHgXtry6e8HqvRhqOGicGhR/dz2dWlYDBeVQkWHWW6CMurBzuz5y8TRDWudZDG+kS03VHrU5NOndYJbOZW/S6XUWsmMONIb8+znQfrN5dJwqRDCTtpfL28+GHjzv7e0+aT7ShRZzC5Y62ReldAa3DbLL5POOz3kziplGuGu3qfbd3NLV8d707HG+xWVHFnfPT1YmZ75ry33kPjKDRqezwSInU1dC6CqquB3fyt0x1tGpyUyzUDqfSzrTvZa4uTfamgXVenJS6n2vYX5x4Oj4+me1kCjNQ64pEwoa9hCjUoXgP8cDd7prNdo9LgqGVqcOin79a3czcanQ0tDtNSovn9tbF3V8+t9/X2J7t4IgzXWGLhkJa0MwT4J7y3kR9IxaSQCJao5sbH3r18/mRzr9baWPT1oaBZnx/oeHG+dzIcZvIQKhchSHsqGjGbXRVMWIVVA7/s7Z5NJ7QohsCqzExm5crtOmdAIlQVH+Z89nlBYWEps4Lek+6amFrw+OKhcCIVbT3hj9rqw/WN7cB///452pM2aQhSo3e5Q1KJlM3mgEJIDtcdLeYXfHPkWBnXajENDwzMz18jjI7gCXdb/LQv0u0JJIDf3rxaXZi1ESSmVMBygwrTqlQIJOLqtG4LmT5IKT10kGY2euwOz9DI9MjYhZXrucXlXGbx28amELBzL780N23RkRocQZQojJAYLlfhMgw3BFwZp6mLz9Vj6ia+2ICpa5y1zSdDg519Sy3RifJD5cDLp3uXZsY1KkSNKz+Og5AQw5UYjqhQ1GE8E/Vd1Khq2TyMwUGlMjObj3KFalzvVet8ZUWVwET34Nz4WYVMJFfAUhji8XhiqViOSHBUKYcwGUcg5rIKDxyroipYIrXcXI3qbHwRASM2AR8DUI445PPrcBSCBHyIB4FMAyFvqNVZCUTMoppRyKASiXgCRE6YTcapSCIZPCWW6yUyPYPJA+hHaHoMV8BCiRhElEhbwP720bkPP6/cXmm5eMGxkR3dyV/aymY2cxf+erv55smcv8kulZoFoKSishSgUmEZKBYJ2DJYqFRKI37T+6dX/th/+HhrOns7lc2Nbdxd2Ht8a+fh6j9/v/p9P+tvbBSKzSUlpRRKASCqAkE2W8hnCkHmx0TIZ8ktja0tT77YvbV9vzszb19b8+1uD+Svz/74/c1fn1/xulzU4yC1qgoSSAD6FxQhgykTC/hMGpdNxZRgh9/S31HfF3cMJdyzQ8mF0dOXxvpm+pOTZ4LDqQYJyCspK4cEUpAPA4VfUqDjdL1GLZPI6JUVRYcLaZVlLEZVefnRyjK+Fe12G0dqyX6tNMaiSal0WnFxOYVSUnaM8dWBw0BBQaFDh3ZGWhC5GuQLRCIOjsu0WiUMC1h0oV4R9VlGPKazdnQAERv4EOs4g2cyOpUqoxTR/Q83taJicwjEAQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"혼자가 좋아\"\n        title=\"\"\n        src=\"/static/3d9be0d015ab779259049099e2022f2c/3684f/image-28.png\"\n        srcset=\"/static/3d9be0d015ab779259049099e2022f2c/c26ae/image-28.png 158w,\n/static/3d9be0d015ab779259049099e2022f2c/3684f/image-28.png 225w\"\n        sizes=\"(max-width: 225px) 100vw, 225px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>아무튼, 그래서 정리하자면</p>\n<p><code class=\"language-text\">readcount</code>는</p>\n<ul>\n<li>reader가 작업 중이면 읽기 작업을 진행 중인 reader의 수</li>\n<li>writer가 작업 중이면 기다리는 reader의 수 (하나는 <code class=\"language-text\">wsem</code>에 대표로 줄 서고, 나머지는 <code class=\"language-text\">x</code>에서 줄 선다)</li>\n</ul>\n<p>그리고 또 <code class=\"language-text\">semaphore x</code>의 역할은</p>\n<ul>\n<li><code class=\"language-text\">readcount</code>의 조정을 한 번에 한 프로세스만 하게 하기 위함</li>\n<li>reader들이 C.S에 들어가고자 하는데 이미 writer가 작업중이라 들어가지 못할 때, 짬킹을 제외한 나머지를 줄세우는 역할</li>\n</ul>\n<p>마지막으로 <code class=\"language-text\">semaphore wsem</code>은</p>\n<ul>\n<li>writer가 작업중이면, <code class=\"language-text\">wsem</code>을 아예 잠그고 들어간다</li>\n<li>reader가 들어가 있으면, <code class=\"language-text\">wsem</code>은 reader에게만 열려있다</li>\n</ul>\n<p>이렇게 됩니다</p>\n<hr>\n<p>휴.. 생각보다 글이 길어져서 햄드네요<br>\n사실 내일 운영체제 중간고사입니다<br>\n아좌좍~\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 347px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b268d0733d1cccb1892d7c687c8d8828/39e45/image-31.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABV0lEQVR42j2QWYuCYBSGv///B7prLqWyFaWiBiMqqIsITRJbBiOLotX2xZxnvmAOeFDPebcjhsNhFEWn02m32z2fz/l87nmebdv7/T4IAkY/so7H43g89n1/Op2yMxqNrtercBzn/X4vl0vAs9nMlmVZFnubzeYDhg4wMt1ul1G/3zdNMwxDAQeYarVqGAZ7iF8ul/v9vt1uD4fDP5h31s7nMyw4ut1ujASzb1m6rnc6nUBWq9VijIKqqr1eDzAp6HiMZD0eD+gESdrtdjqdzuVy6GMEw4lEAopYLAZjpVIh5AfMSyqVwuN6vcadWCwWCCaTScTz+Xy9Xs9ms4qifMkqFotQcAWOAt1gMIjH47VaDaI/2zwcsFQqwUckPrkEHUeqrEwmg6lms4na6/VqNBqaprmuy/EEq/z6dDAkISqDcrnM3mQyQY0gdA62Wq2QKRQKcFmW9QspsZpufbFxqwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"자퇴서\"\n        title=\"\"\n        src=\"/static/b268d0733d1cccb1892d7c687c8d8828/39e45/image-31.png\"\n        srcset=\"/static/b268d0733d1cccb1892d7c687c8d8828/c26ae/image-31.png 158w,\n/static/b268d0733d1cccb1892d7c687c8d8828/6bdcf/image-31.png 315w,\n/static/b268d0733d1cccb1892d7c687c8d8828/39e45/image-31.png 347w\"\n        sizes=\"(max-width: 347px) 100vw, 347px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이만 마칩니다.</p>","frontmatter":{"title":"✍️ Producer-Consumer Problem 그리고 Readers-Writers Problem","date":"April 23, 2024","description":"Semaphore와 Monitor로 해결해봅시다","tag":["OS"],"ogImage":null},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#producer-consumer-problem\">Producer-Consumer Problem</a></p>\n<ul>\n<li><a href=\"#semaphore%EB%A1%9C-producer-consumer-problem-%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0\">Semaphore로 Producer-Consumer Problem 해결하기</a></li>\n<li><a href=\"#monitor%EB%A1%9C-producer-consumer-problem-%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0\">Monitor로 Producer-Consumer Problem 해결하기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#readers-writers-problem\">Readers-Writers Problem</a></p>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/mutual-exclusion-by-os/"},"frontmatter":{"title":" 🕹️ OS 툴로 Critical Section 통제하기 : Mutual Exclusion By Semaphore & Monitor"}},"next":{"fields":{"slug":"/linear-fit-by-python-scipy/"},"frontmatter":{"title":"🪢 scipy의 curve_fit 적당히 써보기"}}},"pageContext":{"id":"fdea2e54-3b29-55c2-8bd8-021cfabb8b4c","previousPostId":"d998cde2-9647-5fad-bb23-819aa08899d1","nextPostId":"bef85955-7b50-5eb3-924f-e75629a2f0ff"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}