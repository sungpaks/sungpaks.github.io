{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/til/how-to-threejs-3/","result":{"data":{"site":{"siteMetadata":{"title":"조성개발실록"}},"markdownRemark":{"id":"458fb8ce-c67f-5c20-a2bc-bd1c509c772e","excerpt":"! 주의 : TIL 게시글입니다. 다듬지 않고 올리거나 기록을 통째로 복붙했을 수 있는 뒷고기 포스팅입니다. 저번에는 오브젝트를 폐기하는 방법까지 했는데요 이번에는 후처리 사용 방법부터 남은 매뉴얼들을 모두 끝내겠습니다 후처리 (Post Processing…","html":"<blockquote>\n<p>! 주의 : TIL 게시글입니다. 다듬지 않고 올리거나 기록을 통째로 복붙했을 수 있는 뒷고기 포스팅입니다.</p>\n</blockquote>\n<p>저번에는 <a href=\"https://threejs.org/docs/#manual/ko/introduction/How-to-dispose-of-objects\">오브젝트를 폐기하는 방법</a>까지 했는데요<br>\n이번에는 <a href=\"https://threejs.org/docs/#manual/ko/introduction/How-to-use-post-processing\">후처리 사용 방법</a>부터 남은 매뉴얼들을 모두 끝내겠습니다</p>\n<h1 id=\"후처리-post-processing\" style=\"position:relative;\"><a href=\"#%ED%9B%84%EC%B2%98%EB%A6%AC-post-processing\" aria-label=\"후처리 post processing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>후처리 (Post Processing)</h1>\n<p><a href=\"https://threejs.org/docs/#manual/ko/introduction/How-to-use-post-processing\">후처리 사용방법</a>에 대해 다룹니다.<br>\n포스트 프로세싱이라는 말이 더 익숙하신 분도 있곘는데요(사양 좀 있는 게임이면 포스트 프로세싱 최저로 하는거 국룰)<br>\n렌더링한 화면에 다양한 그래픽 효과나 안티 엘리어싱을 적용하는 등의 후처리를 말합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/56eef0aaa2af823fd1e72d3e32b86b5b/aa440/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.911392405063296%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABtklEQVR42gGrAVT+AJqcoerp6bG1v6aturi+yJuisJWfr32OpHaDlGNmcVlYZJKOj66op3J0iaGhrpSUpYqLnYKKpHSAom10jQBAOTWjmpKFg4OFh5GprLOTlp5rb3lOVmQ4QlI9PUIrIiRxYFeaiH5tanWSkqGtq7SLiJRqbIJNVHM3PlsANy4tNiwoMSknTUM+a15WbVtPbVhJRDo2PDMuSkE9Qzc2Rjg3QzU0Sjw8fl9Qj2pWnWdDj19AU0A8Tzw2AFhLQ2ZXTXZkWIpzYY50X4RqV2NSRUA2MjkyLVJFPmRKPHxbRpBpTql4UsmHUMmCSL58R4ZeRFdFP1lDOACCa1mTeWSZfWaEbVliUEM8Mi0xKCY0KygnJiVwVkGzeEjFhEzXkFDQikyvdUN/WTxPPTdGODdGODY8MjAAfWZTa1ZHSjwzMSgjKSIfKyMgLiYjKyQgHhwbbVA6s3I8rnA8iFw3XEEwQzMuOy4tQDIuQzQwNyspMSckADMpIh0YFR4YFiQdGSUeGyUeGyMcGTcyMDAvL1xDMWdCJzQmHiMcHSwjITImIjEmIi4kIS4kIT43NSwnJV2Cky8zAR67AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"포스트 프로세싱\"\n        title=\"\"\n        src=\"/static/56eef0aaa2af823fd1e72d3e32b86b5b/f058b/image.png\"\n        srcset=\"/static/56eef0aaa2af823fd1e72d3e32b86b5b/c26ae/image.png 158w,\n/static/56eef0aaa2af823fd1e72d3e32b86b5b/6bdcf/image.png 315w,\n/static/56eef0aaa2af823fd1e72d3e32b86b5b/f058b/image.png 630w,\n/static/56eef0aaa2af823fd1e72d3e32b86b5b/40601/image.png 945w,\n/static/56eef0aaa2af823fd1e72d3e32b86b5b/78612/image.png 1260w,\n/static/56eef0aaa2af823fd1e72d3e32b86b5b/aa440/image.png 1500w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이 과정이 <strong>후처리</strong>라고 이름이 붙은 이유는..</p>\n<ul>\n<li>먼저 비디오 카드의 메모리 버퍼에 있는 대상을 렌더링하기 위해 장면(Scene)이 그려집니다(우리가 지금까지 한 일들).</li>\n<li>그 다음(또는 최종적으로 렌더링되기 직전)에 필터와 효과(후처리 효과)를 이미지 버퍼에 적용합니다.</li>\n</ul>\n<p>three.js에서는 <a href=\"https://threejs.org/docs/index.html#examples/en/postprocessing/EffectComposer\">EffectComposer</a>를 통해 이를 구현합니다.</p>\n<h2 id=\"후처리-작업하기\" style=\"position:relative;\"><a href=\"#%ED%9B%84%EC%B2%98%EB%A6%AC-%EC%9E%91%EC%97%85%ED%95%98%EA%B8%B0\" aria-label=\"후처리 작업하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>후처리 작업하기</h2>\n<p>three.js에서는 <code class=\"language-text\">EffectComposer</code>로 구현한다고 했는데요<br>\n이를 위해 <code class=\"language-text\">Composer</code>와 <code class=\"language-text\">Pass</code> 객체들을 import해와야 합니다</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> EffectComposer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"three/addons/postprocessing/EffectComposer.js\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> RenderPass <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"three/addons/postprocessing/RenderPass.js\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> GlitchPass <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"three/addons/postprocessing/GlitchPass.js\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> OutputPass <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"three/addons/postprocessing/OutputPass.js\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이런 식으로</p>\n<p>그 다음에는, <code class=\"language-text\">WebGLRenderer</code> 객체를 넣어서 composer 객체를 만듭시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> composer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EffectComposer</span><span class=\"token punctuation\">(</span>renderer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>composer를 사용할 때는 앱의 애니메이션 루프를 변경해줘야 합니다.<br>\n기존에는 <code class=\"language-text\">WebGLRenderer</code>의 <code class=\"language-text\">render()</code>메서드 호출로 렌더링했던 반면<br>\n이제 각각의 <code class=\"language-text\">EffectComposer</code>에 대응되는 렌더링 방법을 사용합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">animate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>animate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  composer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 composer를 준비했으니, 후처리 과정을 설정합니다.<br>\n이는 앱을 만드는 최종 화면 출력을 담당하며, 코드를 작성한 순서대로 처리됩니다.</p>\n<p>공식문서에서는 <code class=\"language-text\">glitchPass</code>라는 찌지직효과를 쓰는데, 저는 <code class=\"language-text\">RenderPixelatedPass</code>를 써봤습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> renderPass <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RenderPass</span><span class=\"token punctuation\">(</span>scene<span class=\"token punctuation\">,</span> camera<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> renderPixelatedPass <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RenderPixelatedPass</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> scene<span class=\"token punctuation\">,</span> camera<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> outputPass <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OutputPass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncomposer<span class=\"token punctuation\">.</span><span class=\"token function\">addPass</span><span class=\"token punctuation\">(</span>renderPass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncomposer<span class=\"token punctuation\">.</span><span class=\"token function\">addPass</span><span class=\"token punctuation\">(</span>renderPixelatedPass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncomposer<span class=\"token punctuation\">.</span><span class=\"token function\">addPass</span><span class=\"token punctuation\">(</span>outputPass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol>\n<li><code class=\"language-text\">RenderPass</code> : 일반적으로 가장 먼저 호출하여 기본 렌더링 장면을 담아냅니다.</li>\n<li><code class=\"language-text\">RenderPixelatedPass</code> : 이미지 데이터 전반에 걸쳐 픽셀 효과를 줍니다. 인자로 각 pixel의 단위, <code class=\"language-text\">scene</code>, <code class=\"language-text\">camera</code>를 받습니다.</li>\n<li><code class=\"language-text\">OutputPass</code> : 일반적으로 가장 마지막에 위치하여 <code class=\"language-text\">sRGB</code>변환 또는 <a href=\"https://docs.unity3d.com/kr/530/Manual/script-Tonemapping.html\">톤 매핑</a>등을 수행합니다.</li>\n</ol>\n<p>기본적으로 <code class=\"language-text\">renderPass</code> --> 원하는 프로세스를 끼워넣고 --> <code class=\"language-text\">outputPass</code> 이런 구조를 가지겠네요<br>\n<a href=\"https://github.com/mrdoob/three.js/tree/dev/examples/jsm/postprocessing\">여기</a>에서 기본 내장된 post-processing 방식을 확인해볼 수 있습니다.<br>\n또는 만약 쉐이더를 직접 작성했고 이를 후처리에서 사용하려면, <code class=\"language-text\">ShaderPass</code>를 사용합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ShaderPass <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"three/addons/postprocessing/ShaderPass.js\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> LuminosityShader <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"three/addons/shaders/LuminosityShader.js\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// boilerplate 초기화 루틴 이후</span>\n\n<span class=\"token keyword\">const</span> luminosityPass <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ShaderPass</span><span class=\"token punctuation\">(</span>LuminosityShader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncomposer<span class=\"token punctuation\">.</span><span class=\"token function\">addPass</span><span class=\"token punctuation\">(</span>luminosityPass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>처음 <code class=\"language-text\">Shader</code>를 만들 때는 <code class=\"language-text\">CopyShader</code>를 사용하면 좋은게, <code class=\"language-text\">EffectComposer</code>에 아무 효과를 적용하지 않고 이미지 컨텐츠만 복사해줍니다.</p>\n<h3 id=\"샘플\" style=\"position:relative;\"><a href=\"#%EC%83%98%ED%94%8C\" aria-label=\"샘플 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>샘플</h3>\n<p><a href=\"/til/how-to-threejs-2/#%EC%83%98%ED%94%8C\">저번에 만든 예제 코드</a>에다가 픽셀효과 후처리를 적용해봤습니다.</p>\n<iframe src=\"https://stackblitz.com/edit/vitejs-vite-gnik1n?embed=1&file=utils.js&hideExplorer=1&hideNavigation=1&view=preview\" width=\"100%\" height=\"400px\"></iframe>\n<p>개짱귀여운데요??;; 맘에듭니다</p>\n<h1 id=\"행렬-변환\" style=\"position:relative;\"><a href=\"#%ED%96%89%EB%A0%AC-%EB%B3%80%ED%99%98\" aria-label=\"행렬 변환 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>행렬 변환</h1>\n<p><a href=\"https://threejs.org/docs/index.html#manual/ko/introduction/Matrix-transformations\">행렬 변환</a>에 대해 다룹니다.<br>\nThree.js는 행렬을 이용해 3D 변형(위치 변환, 회전, 확대 등)합니다.<br>\nThree.js에서 거의 모든 3D물체는 <a href=\"https://threejs.org/docs/index.html#api/ko/core/Object3D\">Object3D</a> 슈퍼클래스를 구현하므로, <code class=\"language-text\">matrix</code> 속성을 가집니다.<br>\n이 <code class=\"language-text\">matrix</code> 속성은 행렬 정보를 나타내며, 오브젝트의 위치, 회전, 확대 정보를 가집니다.</p>\n<h2 id=\"오브젝트를-변형하는-방법-두-가지\" style=\"position:relative;\"><a href=\"#%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8%EB%A5%BC-%EB%B3%80%ED%98%95%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95-%EB%91%90-%EA%B0%80%EC%A7%80\" aria-label=\"오브젝트를 변형하는 방법 두 가지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>오브젝트를 변형하는 방법 두 가지</h2>\n<p>오브젝트를 변형하려면 두 가지 방법이 있는데,<br>\n하나는 속성만 변경하면 내부에서 행렬 재계산이 일어나는 방식,<br>\n하나는 행렬을 직접 수정하는 방식입니다.</p>\n<ol>\n<li>전자의 경우, 오브젝트의 <code class=\"language-text\">position, quaternion, scale</code>같은 속성을 조절합니다. 그럼 내부에서 알아서 그에 맞는 행렬 재계산이 일어납니다.\n<ul>\n<li>ex: <code class=\"language-text\">object.position.copy(start_position)</code></li>\n<li><code class=\"language-text\">matrixAutoUpdate</code> 속성을 <code class=\"language-text\">false</code>로 꺼버리면 재계산이 일어나지 않습니다. 이를 이용하여 오브젝트를 고정하거나 직접 재계산합니다.\n<ul>\n<li>이 속성을 껐으면 <code class=\"language-text\">object.updateMatrix()</code>메서드로 행렬을 수동 업데이트합니다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>오브젝트의 행렬을 직접 수정합니다. (<a href=\"https://threejs.org/docs/index.html#api/en/math/Matrix4\">Matrix4</a>클래스의 행렬 수정 메서드를 사용하면 굿)\n<ul>\n<li><code class=\"language-text\">object.matrix.setRotationFromQuaternion(quaternion)</code>처럼..</li>\n<li>이 경우 무조건 <code class=\"language-text\">object.matrixAutoUpdate=false</code>로 자동 재계산을 꺼둬야 합니다.</li>\n<li>또한 <code class=\"language-text\">updateMatrix()</code>메서드를 사용하지 않습니다. 이걸 쓰면 수동 변경한 행렬을 덮어버리고 <code class=\"language-text\">position, scale</code> 등의 행렬이 재계산됩니다.</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"오브젝트와-월드-행렬\" style=\"position:relative;\"><a href=\"#%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8%EC%99%80-%EC%9B%94%EB%93%9C-%ED%96%89%EB%A0%AC\" aria-label=\"오브젝트와 월드 행렬 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>오브젝트와 월드 행렬</h2>\n<p>오브젝트의 <code class=\"language-text\">matrix</code> 속성이 업데이트되면 이 오브젝트의 변형 정보는 관련된 <a href=\"https://threejs.org/docs/index.html#api/ko/core/Object3D.parent\">parent</a>에 저장됩니다.<br>\n오브젝트의 변형 정보를 <strong>world 좌표</strong>에서 가져오려면, <a href=\"https://threejs.org/docs/index.html#api/ko/core/Object3D.matrixWorld\">Object3D.matrixWorld</a>에 접근합니다.<br>\n자식 또는 부모 오브젝트가 변형된 경우, <code class=\"language-text\">updateMatrixWorld()</code> 메서드를 호출하여 자식 오브젝트의 <code class=\"language-text\">matrixWorld</code>도 업데이트되게 해줘야 합니다.</p>\n<h3 id=\"world-행렬\" style=\"position:relative;\"><a href=\"#world-%ED%96%89%EB%A0%AC\" aria-label=\"world 행렬 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>World 행렬??</h3>\n<p>근데 문서에는 딱히 world 행렬에 대한 일말의 소개도 없었습니다<br>\n그래서 대충 찾아보고 GPT한테도 물어보고 하니<br>\n3D 렌더링 좌표를 나타낼 때는 <strong>local 행렬</strong>과 <strong>world 행렬</strong>이라는게 있더라구요<br>\n이는 거의 상대 좌표와 절대 좌표같은 개념이네요<br>\nworld행렬은 절대적인 기준점으로 모든 대상에 대해 동일하게 적용되고,<br>\nlocal행렬은 상대적인 기준을 가집니다. 예를 들어 three.js에서는 위 내용으로 미루어보았을 때 <code class=\"language-text\">parent</code>가 기준이 될 수 있겠네요</p>\n<p><img src=\"https://i.imgur.com/91Heags.png\" alt=\"\"></p>\n<p>이런 그림을 생각해봅시다<br>\n노란 공을 기준으로 하는 local 좌표에서는 사람의 좌표가 변하여 더 가까워졌습니다<br>\n그러나 world 기준에서는 사람은 움직이지 않고 그대로입니다. 움직인건 노란 공이구요<br>\n이런 식으로 <strong>물리학에서 상대/절대 좌표계</strong>를 뜻하듯이 하는 개념으로 받아들여집니다</p>\n<p>라는 정리에 대해 GPT(Three.js expert)에게 \"잘 이해한거 맞아?\"라고 물어봤습니다<br>\n대충 비슷하다고 하면서 추가 설명을 해줬네요</p>\n<p><strong>Three.js에서 로컬 -> 월드 변환 흐름</strong></p>\n<ol>\n<li><strong>로컬 행렬 (Local Matrix)</strong>:\n<ul>\n<li>각 오브젝트는 자신의 <strong>위치, 회전, 스케일</strong>을 기반으로 <strong>로컬 행렬</strong>을 계산합니다.</li>\n</ul>\n</li>\n<li><strong>월드 행렬 (World Matrix)</strong>:\n<ul>\n<li>이 로컬 행렬이 부모 객체의 행렬과 곱해지면서 월드 행렬로 변환됩니다.</li>\n<li><strong><code class=\"language-text\">matrixWorld</code></strong> 속성은 이 최종 월드 좌표계를 나타내는 행렬입니다.</li>\n</ul>\n</li>\n<li><strong>부모-자식 관계</strong> 예제:\n<ul>\n<li>만약 사람이 <strong>노란 공의 부모</strong>라고 하면, 공의 위치는 사람의 로컬 좌표계에 상대적으로 존재하게 됩니다.<br>\n→ 공의 위치가 <code class=\"language-text\">(2, 0, 0)</code>이고 사람이 <code class=\"language-text\">(10, 0, 0)</code>에 있다면, 월드 좌표계에서 공은 <code class=\"language-text\">(12, 0, 0)</code>이 됩니다.</li>\n</ul>\n</li>\n</ol>\n<p>어라.. 어떤 오브젝트의 로컬 행렬과 부모 객체의 행렬을 행렬곱연산을 내면 월드행렬이라네요???<br>\n아무튼 이런 개념이 있었습니다</p>\n<h2 id=\"회전과-사원수quaternion\" style=\"position:relative;\"><a href=\"#%ED%9A%8C%EC%A0%84%EA%B3%BC-%EC%82%AC%EC%9B%90%EC%88%98quaternion\" aria-label=\"회전과 사원수quaternion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>회전과 사원수(Quaternion)</h2>\n<p>three.js에서는 3D회전을 나타내기 위해 두 가지 방법이 존재합니다</p>\n<ul>\n<li><a href=\"https://ko.wikipedia.org/wiki/%EC%98%A4%EC%9D%BC%EB%9F%AC_%EA%B0%81\">Euler angles</a>: 보통 아는 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mi>y</mi><mi>z</mi></mrow><annotation encoding=\"application/x-tex\">xyz</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">yz</span></span></span></span></span>를 중심으로 회전하여 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi><mi>β</mi><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha\\beta\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span></span></span></span></span>를 나타내는 체계</li>\n<li><a href=\"https://namu.wiki/w/%EC%82%AC%EC%9B%90%EC%88%98\">quaternion</a>: 사원수라는 다른 체계인데.. 옛날에 역학 수업에서 헤밀토니안이라는게 좀 비슷해보이는데 도저히 잘 모르겠습니다;;</li>\n</ul>\n<p>아무튼 그런데 오일러 각도 체계는 gimbal lock이라는 문제 때문에 항상 가능하진 않고, 그래서 내부에선 quaternion속성으로 저장한다고 합니다.<br>\n이 gimbal lock은 다른 각 회전때문에 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>β</mi></mrow><annotation encoding=\"application/x-tex\">\\beta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span></span>각 범위가 제한되는 경우가 생긴다나 뭐시기인데 아폴로 11호도 이거때문에 자세조정이 힘들었다고 하네요<br>\n아무튼 둘 사이의 변환 메서드를 제공하니까 편한거 쓰면 된다고 합니다.<br>\n예를 들어, <code class=\"language-text\">setRotationFromEuler</code>로 quaternion을 업데이트할 수 있습니다.</p>\n<h1 id=\"애니메이션-시스템\" style=\"position:relative;\"><a href=\"#%EC%95%A0%EB%8B%88%EB%A9%94%EC%9D%B4%EC%85%98-%EC%8B%9C%EC%8A%A4%ED%85%9C\" aria-label=\"애니메이션 시스템 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>애니메이션 시스템</h1>\n<p><a href=\"https://threejs.org/docs/index.html#manual/ko/introduction/Animation-system\">애니메이션 시스템</a>에 대해 다룹니다.</p>\n<p>three.js 애니메이션 시스템에서는 모델의 다양한 속성을 설정할 수 있습니다. <a href=\"https://threejs.org/docs/index.html#api/en/objects/SkinnedMesh\">Skinned Mesh</a>뼈대, 물체 변형, 재질 속성, 가시성 등..<br>\n애니메이션의 속성은 페이드 인, 페이드 아웃, 크로스페이드, 랩 등의 종류가 존재합니다<br>\n한 오브젝트에 대한 변화 속도나 가중치도 조절할 수 있고, 서로 다른 오브젝트 간의 애니메이션도 전부 개별적으로 변화시킬 수 있습니다.<br>\n또는 오브젝트들 간의 다양한 애니메이션에 대해 싱크를 맞추기도 가능합니다</p>\n<p>저는 개인적으로 이 파트 읽기 시작할 당시에는 잘 이해가 안 갔는데, 그냥 눈 딱 감고 문서 쭉 읽어보고 다시 생각해보는게 그나마 이해가능했습니다</p>\n<h2 id=\"애니메이션-클립\" style=\"position:relative;\"><a href=\"#%EC%95%A0%EB%8B%88%EB%A9%94%EC%9D%B4%EC%85%98-%ED%81%B4%EB%A6%BD\" aria-label=\"애니메이션 클립 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>애니메이션 클립</h2>\n<p>애니메이션 3D 오브젝트를 불러왔으면(ex: <a href=\"https://threejs.org/docs/index.html#examples/en/loaders/GLTFLoader\"><code class=\"language-text\">GLTFLoader</code></a>로 gltf 모델을 불려오기), 그 오브젝트에 <code class=\"language-text\">animations</code>라는 배열이 있는걸 확인할 수 있습니다.<br>\n여기에는 해당 모델애 대한 <a href=\"https://threejs.org/docs/index.html#api/en/animation/AnimationClip\"><code class=\"language-text\">AnimationClips</code></a>가 존재합니다.</p>\n<p>이 <code class=\"language-text\">AnimationClips</code>는 보통 해당 오브젝트의 특정 행동에 대한 데이터를 가집니다.<br>\n예를 들어, \"걷는 모션 한 사이클\", \"점프\", \"춤추기\" 등..</p>\n<h2 id=\"키프레임-트랙\" style=\"position:relative;\"><a href=\"#%ED%82%A4%ED%94%84%EB%A0%88%EC%9E%84-%ED%8A%B8%EB%9E%99\" aria-label=\"키프레임 트랙 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>키프레임 트랙</h2>\n<p>각 <strong>애니메이션 클립</strong>에 대한 애니메이션 속성 데이터는 <a href=\"https://threejs.org/docs/index.html#api/ko/animation/KeyframeTrack\">KeyframeTrack</a>에 저장됩니다.</p>\n<blockquote>\n<p>KeyframeTrack은 시간 리스트와 관련 값으로 구성되어 있고 오브젝트의 특정 프로퍼티를 동작시키는 데 사용되는 <a href=\"https://en.wikipedia.org/wiki/Key_frame\">keyframes</a>의 시간별 시퀀스입니다.</p>\n</blockquote>\n<p>이 <code class=\"language-text\">KeyframeTrack</code>은 <code class=\"language-text\">times</code> 리스트와 그 각 순간에 대응하는 <code class=\"language-text\">values</code>리스트로 구성됩니다.<br>\n각 애니메이션 클립은 그리고 여러 키프레임 트랙으로 구성될 수도 잇습니다. 예를 들어, 1번 키프레임 트랙은 팔을 뻗고, 2번 키프레임 트랙은 팔을 회전하고, ..</p>\n<h2 id=\"애니메이션-믹서\" style=\"position:relative;\"><a href=\"#%EC%95%A0%EB%8B%88%EB%A9%94%EC%9D%B4%EC%85%98-%EB%AF%B9%EC%84%9C\" aria-label=\"애니메이션 믹서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>애니메이션 믹서</h2>\n<p>이렇게 저장된 데이터들은 아직 그냥 애니메이션에 대한 기본 정보를 나타내는 데이터 쪼가리입니다.<br>\n실제 플레이백은 <a href=\"https://threejs.org/docs/index.html#api/ko/animation/AnimationMixer\">AnimationMixer</a>가 담당합니다.</p>\n<blockquote>\n<p>AnimationMixer는 Scene에 있는 특정 오브젝트의 애니메이션 플레이어입니다.</p>\n</blockquote>\n<p>게다가 단순한 애니메이션 플레이어가 아닌, 여러 애니메이션 동시재생, 혼합, 병합재생 등을 수행할 수 있습니다.</p>\n<h2 id=\"애니메이션-액션\" style=\"position:relative;\"><a href=\"#%EC%95%A0%EB%8B%88%EB%A9%94%EC%9D%B4%EC%85%98-%EC%95%A1%EC%85%98\" aria-label=\"애니메이션 액션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>애니메이션 액션</h2>\n<p><strong>애니메이션 믹서</strong>는 속성과 메서드가 많지 않고, 일반적인 구성요소만 존재합니다.<br>\n대신 <a href=\"https://threejs.org/docs/index.html#api/ko/animation/AnimationAction\">AnimationActions</a>를 사용하여, 특정 <strong>애니메이션 클립</strong>이 언제, 어떤 믹서에서, 실행/정지/중지되어야 하는지 설정할 수 있습니다(예약).<br>\n나아가 얼마나 반복할거고, 페이드가 필요한지, 그럼 페이드 인인지 아웃인지, 등등 디테일한 설정이 가능합니다</p>\n<p>공식문서에서는 애니메이션 믹서를 생성자로 직접 생성하기보다는 <code class=\"language-text\">AnimationMixer.clipAction</code>으로 인스턴스화하는 것이 좋다고 합니다.<br>\n더 나은 성능을 위한 캐싱 등을 제공한다 등의 이유가 있습니다</p>\n<h2 id=\"애니메이션-오브젝트-그룹\" style=\"position:relative;\"><a href=\"#%EC%95%A0%EB%8B%88%EB%A9%94%EC%9D%B4%EC%85%98-%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8-%EA%B7%B8%EB%A3%B9\" aria-label=\"애니메이션 오브젝트 그룹 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>애니메이션 오브젝트 그룹</h2>\n<p>같은 애니메이션 효과를 공유하는 오브젝트 그룹을 만들려면 <a href=\"https://threejs.org/docs/index.html#api/ko/animation/AnimationObjectGroup\">AnimationObjectGroup</a>를 사용합니다.</p>\n<h2 id=\"활용해보기\" style=\"position:relative;\"><a href=\"#%ED%99%9C%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"활용해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>활용해보기</h2>\n<p>사실 애니메이션 시스템 문서나 Keyframes 등등 관련 문서에서 예시 코드가 너무 빈약합니다..<br>\n샘플이라고 적어놓은 것들은 사실 생략한 것도 많고 하더라구요<br>\n그리고 예를 들어 <code class=\"language-text\">Three.VectorKeyframeTrack()</code>으로 키프레임 트랙을 만들거면 예시로 어떻게 코드를 구성하는지도 잘 안 나와있습니다.<br>\n내가 못찾았나?</p>\n<p>아무튼 문서 파헤쳐보고 GPT한테도 물어물어서 간단한 애니메이션 클립을 활용하는 샘플을 만들어봤습니다</p>\n<p>먼저, <a href=\"https://sketchfab.com/3d-models?features=downloadable&#x26;sort_by=-likeCount\">이런 사이트</a>에서 적당한 에셋을 하나 구해왔습니다.<br>\n그중에서도 매우 귀염둥이인 시바견을 하나 가져왔어요<br>\n이걸 가져다가 프로젝트 내부(저는 <code class=\"language-text\">/public/gltf/</code> 폴더를 만들고 그 밑에 넣었습니다)에 가져다둡니다.<br>\n이제 <a href=\"https://threejs.org/docs/#manual/ko/introduction/Loading-3D-models\">3D 모델 불러오기</a>에서 말하는 것처럼 로드해오면 됩니다. 아래처럼</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> loader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GLTFLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nloader<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"/gltf/scene.gltf\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//path to asset</span>\n  <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">gltf</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 로드 성공 콜백</span>\n    model <span class=\"token operator\">=</span> gltf<span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">;</span>\n    gltf<span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span>scale<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//좀 작아서 확대함</span>\n    scene<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//로드 중 콜백</span>\n  <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//에러 콜백</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>저는 애셋을 <code class=\"language-text\">public/gltf/scene.gltf</code>와 같이 두었으니까 저렇게 path를 쓰는겁니다<br>\n이러면 귀여운 시바견이 나오구요</p>\n<p>이제 gltf를 로드한 콜백 내에서 애니메이션 로직을 추가합니다<br>\n먼저 mixer, model(얘는 이미 있지만)을 콜백 바깥에서 만들어줍시다. 나중에 필요해서요</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> mixer<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">;</span>\n\nloader<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이제 load의 콜백 내에서 <code class=\"language-text\">scene.add(model)</code> 뒤에 애니메이션 클립을 정의해줍니다.<br>\n저는 불투명도를 조절하는 <code class=\"language-text\">NumberKeyframeTrack</code>과, 회전을 주는 <code class=\"language-text\">VectorKeyframeTrack</code>을 만들겠습니다</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">mixer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">THREE<span class=\"token punctuation\">.</span>AnimationMixer</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 시바견에 대한 애니메이션 믹서 생성</span>\nmodel<span class=\"token punctuation\">.</span><span class=\"token function\">traverse</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">child</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">.</span>isMesh <span class=\"token operator\">&amp;&amp;</span> child<span class=\"token punctuation\">.</span>material<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    child<span class=\"token punctuation\">.</span>material<span class=\"token punctuation\">.</span>transparent <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//불투명도 키프레임</span>\n    <span class=\"token keyword\">const</span> opacityKF <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">THREE<span class=\"token punctuation\">.</span>NumberKeyframeTrack</span><span class=\"token punctuation\">(</span>\n      <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>child<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.material.opacity</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 이름(중요)</span>\n      <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// times // values</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//회전 키프레임</span>\n    <span class=\"token keyword\">const</span> rotateKF <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">THREE<span class=\"token punctuation\">.</span>VectorKeyframeTrack</span><span class=\"token punctuation\">(</span>\n      <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>child<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.rotation[z]</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">*</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">*</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">*</span> <span class=\"token number\">8</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> clip <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">THREE<span class=\"token punctuation\">.</span>AnimationClip</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"OpacityAnimation\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n      opacityKF<span class=\"token punctuation\">,</span> <span class=\"token comment\">//이 배열에 키프레임을 삽입</span>\n      rotateKF\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// clipAction 생성, play</span>\n    <span class=\"token keyword\">const</span> action <span class=\"token operator\">=</span> mixer<span class=\"token punctuation\">.</span><span class=\"token function\">clipAction</span><span class=\"token punctuation\">(</span>clip<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    action<span class=\"token punctuation\">.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>키프레임의 첫 번째 인자에는 이름 프로퍼티가 들어갑니다. <a href=\"https://threejs.org/docs/index.html#api/ko/animation/KeyframeTrack.name\">KeyframeTrack의 이름</a>문서를 참고하세요. 이름 잘못쓰면 동작하지 않습니다</p>\n<p>저는 처음에 이걸 traverse 순회가 아닌 단일 <code class=\"language-text\">model</code>에 대해 저 코드를 작성했더니</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">THREE.PropertyBinding: Can not bind to objectName of node undefined.</code></pre></div>\n<p>이런 에러가 떴습니다. 찾아보니 GLTF모델 구조때문에 매터리얼 그잡채에 직접 접근할 수 없어서 그렇다네요.<br>\nGLTF모델은 복잡한 렌더링 모델을 생성하므로 여러 계층 구조로 구성될 수 있다고 합니다.<br>\n그러니 GLTF모델의 모든 매쉬 조각들에 대해 순회하면서 애니메이션 클립을 적용해줘야 합니다</p>\n<p>이제 액션클립을 만들었으니 <code class=\"language-text\">animate</code> 루프에서 액션믹서를 업데이트합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> clock <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">THREE<span class=\"token punctuation\">.</span>clock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">animate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>animate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> delta <span class=\"token operator\">=</span> clock<span class=\"token punctuation\">.</span><span class=\"token function\">getDelta</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mixer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    mixer<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>delta<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">orbitCamera</span><span class=\"token punctuation\">(</span>camera<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> radius<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  renderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>scene<span class=\"token punctuation\">,</span> camera<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">Three.clock()</code>은 애니메이션 실행 중 경과한 시간(delta time)을 측정하는 데 사용됩니다.<br>\n컴퓨터 로컬 elapsed time을 갖다 쓰면 성능에 따라 차이가 발생할 수 있는데,<br>\n이걸 사용하면 일관적인 속도로 프레임을 측정하고 애니메이션을 실행할 수 있습니다.</p>\n<p>이제 <code class=\"language-text\">animate()</code>루프에서 <code class=\"language-text\">mixer.update(delta)</code>와 같이 작성하여 경과한 시간만큼 애니메이션 클립을 진행시킵니다.<br>\n예를 들어, 1/60프레임이 지났으면 <code class=\"language-text\">delta=0.016</code>이고, <code class=\"language-text\">mixer.update(0.016)</code>이 되고, 애니메이션이 0.016초만큼 진행됩니다.</p>\n<p><img src=\"https://github.com/sungpaks/sungpaks.github.io/blob/master/content/blog/til/how-to-threejs-3/%E1%84%92%E1%85%AA%E1%84%86%E1%85%A7%E1%86%AB%20%E1%84%80%E1%85%B5%E1%84%85%E1%85%A9%E1%86%A8%202024-10-25%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2010.28.11.gif?raw=true\" alt=\"결과\"></p>\n<p>플레이그라운드를 올리려다가 시바견 용량이 초과돼서 ㅜㅜ 그냥 녹화해서 gif로 변환 땄습니다<br>\n그래도 기엽죠?</p>\n<p>아무튼.. 이렇게 매뉴얼은 대충 톺아봤으니 강의라도 하나 좀 들어봐야겠습니다<br>\n이만 마칩니다</p>","frontmatter":{"title":"Three.js 공식문서로 시작해보기. - 3","date":"October 28, 2024","description":"Post Processing, 행렬 변환, 애니메이션 시스템","tag":["TIL","Three.js"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%ED%9B%84%EC%B2%98%EB%A6%AC-post-processing\">후처리 (Post Processing)</a></p>\n<ul>\n<li>\n<p><a href=\"#%ED%9B%84%EC%B2%98%EB%A6%AC-%EC%9E%91%EC%97%85%ED%95%98%EA%B8%B0\">후처리 작업하기</a></p>\n<ul>\n<li><a href=\"#%EC%83%98%ED%94%8C\">샘플</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%96%89%EB%A0%AC-%EB%B3%80%ED%99%98\">행렬 변환</a></p>\n<ul>\n<li>\n<p><a href=\"#%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8%EB%A5%BC-%EB%B3%80%ED%98%95%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95-%EB%91%90-%EA%B0%80%EC%A7%80\">오브젝트를 변형하는 방법 두 가지</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8%EC%99%80-%EC%9B%94%EB%93%9C-%ED%96%89%EB%A0%AC\">오브젝트와 월드 행렬</a></p>\n<ul>\n<li><a href=\"#world-%ED%96%89%EB%A0%AC\">World 행렬??</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%9A%8C%EC%A0%84%EA%B3%BC-%EC%82%AC%EC%9B%90%EC%88%98quaternion\">회전과 사원수(Quaternion)</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%95%A0%EB%8B%88%EB%A9%94%EC%9D%B4%EC%85%98-%EC%8B%9C%EC%8A%A4%ED%85%9C\">애니메이션 시스템</a></p>\n<ul>\n<li><a href=\"#%EC%95%A0%EB%8B%88%EB%A9%94%EC%9D%B4%EC%85%98-%ED%81%B4%EB%A6%BD\">애니메이션 클립</a></li>\n<li><a href=\"#%ED%82%A4%ED%94%84%EB%A0%88%EC%9E%84-%ED%8A%B8%EB%9E%99\">키프레임 트랙</a></li>\n<li><a href=\"#%EC%95%A0%EB%8B%88%EB%A9%94%EC%9D%B4%EC%85%98-%EB%AF%B9%EC%84%9C\">애니메이션 믹서</a></li>\n<li><a href=\"#%EC%95%A0%EB%8B%88%EB%A9%94%EC%9D%B4%EC%85%98-%EC%95%A1%EC%85%98\">애니메이션 액션</a></li>\n<li><a href=\"#%EC%95%A0%EB%8B%88%EB%A9%94%EC%9D%B4%EC%85%98-%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8-%EA%B7%B8%EB%A3%B9\">애니메이션 오브젝트 그룹</a></li>\n<li><a href=\"#%ED%99%9C%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0\">활용해보기</a></li>\n</ul>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/contributing-tanstack-query/"},"frontmatter":{"title":"🤨 이슈 해결해준다고? 너 누군데"}},"next":null},"pageContext":{"id":"458fb8ce-c67f-5c20-a2bc-bd1c509c772e","previousPostId":"5cec790c-dd3b-5cde-a78e-058b36b77b03","nextPostId":null}},"staticQueryHashes":["2841359383"],"slicesMap":{}}