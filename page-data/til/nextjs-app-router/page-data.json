{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/til/nextjs-app-router/","result":{"data":{"site":{"siteMetadata":{"title":"조성개발실록"}},"markdownRemark":{"id":"b67c9c82-9720-5820-af62-bb4b04583e24","excerpt":"! 주의 : TIL 게시글입니다. 다듬지 않고 올리거나 기록을 통째로 복붙했을 수 있는 뒷고기 포스팅입니다. Next.js에 대해 쓰는건 처음이네요 최근에 처음 배웠기 때문입니다? Next.js 13 이전에는 Next.js에서 Route를 만들기 위해 Pages Router…","html":"<blockquote>\n<p>! 주의 : TIL 게시글입니다. 다듬지 않고 올리거나 기록을 통째로 복붙했을 수 있는 뒷고기 포스팅입니다.</p>\n</blockquote>\n<p>Next.js에 대해 쓰는건 처음이네요<br>\n최근에 처음 배웠기 때문입니다?</p>\n<p>Next.js 13 이전에는 Next.js에서 Route를 만들기 위해 <a href=\"https://nextjs.org/docs/pages\">Pages Router</a> 방식이 사용되었는데요<br>\nNext.js 13 이후로 새로 나와서 지금 밀고 있는게 <a href=\"https://nextjs.org/docs/app\">App Router</a>입니다<br>\n지금 두 방식을 모두 지원해요. App Router를 조금 더 권장할 뿐<br>\n아직 많은 프로덕트들이 Pages Router를 여전히 사용중입니다</p>\n<p>오늘은 App Router방식으로 Next.js 코드 짜는 법을 기록하것습니더잉</p>\n<h1 id=\"폴더구조\" style=\"position:relative;\"><a href=\"#%ED%8F%B4%EB%8D%94%EA%B5%AC%EC%A1%B0\" aria-label=\"폴더구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>폴더구조</h1>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- /app\n\t- /about\n\t- /blog\n\t\t- /post-1</code></pre></div>\n<p><code class=\"language-text\">/app/</code> 경로 밑에 웹사이트에 넣을 페이지들을 위치시킵니다<br>\n<code class=\"language-text\">/app/</code>밑에 존재하는 모든 <code class=\"language-text\">page.js</code>파일들은 그에 해당하는 route를 만듭니다.<br>\n예를 들어, <code class=\"language-text\">/app/about/page.js</code> => <code class=\"language-text\">\"http://my-domain.com/about\"</code></p>\n<p>그리고 이 app폴더 밑에 위치하는 리액트 컴포넌트들은 이제 Next.js에서 특별한 대우를 받게 됩니다.<br>\n<strong>서버 컴포넌트</strong>가 되는 것인데요..<br>\n확인하고 싶으시면 <code class=\"language-text\">console.log</code>를 컴포넌트함수 내에서 찍어봅시다. 브라우저가 아닌 개발서버에 찍힙니다</p>\n<h1 id=\"페이지-간-이동\" style=\"position:relative;\"><a href=\"#%ED%8E%98%EC%9D%B4%EC%A7%80-%EA%B0%84-%EC%9D%B4%EB%8F%99\" aria-label=\"페이지 간 이동 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>페이지 간 이동</h1>\n<p>만약 지금 <code class=\"language-text\">http://my-domain.com/</code>애 있는데, <code class=\"language-text\">http://my-domain.com/about/</code>으로 가고 싶다면 우뜩할까요?<br>\n<code class=\"language-text\">&lt;a href=\"/about\"></code> 이러면 되겠죠?<br>\n라고 생각할 수는 있는데 딱히 이상적이진 않습니다. 적어도 이 도메인(이 프로젝트)내의 다른 경로로 이동할거면요</p>\n<p><code class=\"language-text\">&lt;a></code>태그로 이동하는 것은 <strong>새로운 페이지를 로드</strong>합니다.<br>\n이는 리액트가 렌더링을 다시 하는 수준이 아닌, 페이지를 갈아엎게 되는 것인데<br>\nNext.js는 그렇지 않고도 리액트의 장점을 살리고 SPA로 머무는 것을 허용합니다.<br>\n<strong>클라이언트 측의 JS코드로 UI를 업데이트할 수 있게</strong>한다는 것인데 (기존 리액트 like하게)</p>\n<p>이를 위해서는 <code class=\"language-text\">&lt;Link href=\"\"></code>라는 next.js에거 제공하는 특별한 컴포넌트를 사용합니다.<br>\n명력적인 방법도 있는데, <code class=\"language-text\">next/navigation</code>에서 <code class=\"language-text\">redirect()</code>함수를 import하고,<br>\n<code class=\"language-text\">redirect('/about')</code> 이렇게 쓰면 됩니다</p>\n<h1 id=\"컴포넌트-추가하기\" style=\"position:relative;\"><a href=\"#%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\" aria-label=\"컴포넌트 추가하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>컴포넌트 추가하기</h1>\n<p>Next.js의 <code class=\"language-text\">app</code>폴더 밑에서는 특별한 컴포넌트로 취급되는, <a href=\"https://nextjs.org/docs/app/api-reference/file-conventions\">예약된 파일 명</a>들이 있습니다.<br>\n예를 들면..</p>\n<ul>\n<li><code class=\"language-text\">page.js</code> 신규페이지</li>\n<li><code class=\"language-text\">layout.js</code> 형제/중첩 페이지의 레이아웃 (바로 뒤에 알아보겠습니다)</li>\n<li><code class=\"language-text\">not-found.js</code> 404 Not Found에 대한 폴백 페이지</li>\n<li><code class=\"language-text\">error.js</code> 기타 오류에 대한 폴백 페이지</li>\n<li><code class=\"language-text\">loading.js</code> 형제 또는 중첩 페이지에서 데이터를 가져올 때 표시되는 폴백 페이지</li>\n<li><code class=\"language-text\">route.js</code> : API 경로를 생성합니다. (jsx가 아닌 JSON 등의 데이터를 반환합니다)</li>\n</ul>\n<p>이런게 아니고 막 <code class=\"language-text\">title-header.jsx</code>처럼 대충 제목을 지으면 그냥 커스텀 컴포넌트입니다<br>\n그리고 이제 <code class=\"language-text\">app</code> 폴더 밑에는 페이지와 route의 생성 관련한 파일만 남길거고,<br>\n다른 커스텀 컴포넌트는 루트에서 <code class=\"language-text\">component/</code> 폴더를 하나 더 두는게 좋겠네요<br>\n그리고 이제 import할 때, <code class=\"language-text\">from '@/components/header'</code>와 같이 @로 프로젝트의 루트 경로를 조회할 수 있습니다</p>\n<p><code class=\"language-text\">app</code>폴더 밑에서는 예약된 파일명들이 소문자로 시작하니까, 기존 리액트 컴포넌트 파일명의 컨벤션과 다르게, 여기서는 소문자로 시작하게 하면 좋겠네요<br>\n기타등등, <a href=\"https://nextjs.org/docs/app/building-your-application/routing/colocation\">공식문서 보면 다양한 구조가 있습니다</a></p>\n<h2 id=\"layoutjs\" style=\"position:relative;\"><a href=\"#layoutjs\" aria-label=\"layoutjs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>layout.js</h2>\n<p>아까 말한 <code class=\"language-text\">layout.js</code>에 대해 살짝 더 알아봅시다\napp폴더를 위한 <code class=\"language-text\">layout.js</code>파일이 최소 하나는 있어야 합니다.<br>\n최소 하나의 근본 레이아웃이 있어야 한다는 뜻입니다</p>\n<p>이 <code class=\"language-text\">layout.js</code>는 그 하위의 중첩된 경로에 대해 모두 적용됩니다<br>\n새로운 <code class=\"language-text\">layout.js</code>를 만나지 않는 한은 말이죠<br>\n만약 <code class=\"language-text\">/about/layout.js</code>를 또 만들었다면, 이는 <code class=\"language-text\">/about/</code>이 중첩된 경로에 대해 모두 적용됩니다</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token string\">\"./globals.css\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> metadata <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"NextJS Course App\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Your first NextJS app!\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">RootLayout</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>루트 <code class=\"language-text\">layout.js</code>의 코드는 대충 이런식으로 쓸건데요<br>\n보시다시피 루트 layout은 웹사이트의 뼈대 HTML을 정의합니다</p>\n<p>그리고 <code class=\"language-text\">&lt;head></code>내에 들어갈 메타데이터들이 있을건데<br>\n이건 <code class=\"language-text\">export const metadata={}</code>라는 이름으로 객체로써 내보내면 됩니다.<br>\n그리고 favicon은 metadata설정 안 해도, <code class=\"language-text\">app</code>폴더에 <code class=\"language-text\">icon.png</code>라는 이름으로 하나 넣어두면 알아서 이거 가져갑니다.</p>\n<h1 id=\"dynamic-route-동적-경로\" style=\"position:relative;\"><a href=\"#dynamic-route-%EB%8F%99%EC%A0%81-%EA%B2%BD%EB%A1%9C\" aria-label=\"dynamic route 동적 경로 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dynamic Route (동적 경로)</h1>\n<p>예를 들어, 블로그 포스트를 생각해봅시다<br>\n각 포스트들에 대한 slug는 정해져있지 않고, 매번 다르게 추가됩니다<br>\n이걸 미리 다 폴더를 만들고 그럴 수는 없어요<br>\n대신 동적으로 route를 만들어내는 방법이 있습니다</p>\n<p>폴더 이름에 <code class=\"language-text\">[]</code>(대괄호)를 쓰면 됩니다. 그리고 그 안에는 임의의 식별자를 추가하구요<br>\n예를 들어, <code class=\"language-text\">/[slug]</code>처럼 쓴다는 의미입니다<br>\n그리고 그 밑에는 <code class=\"language-text\">page.js</code>를 두면 됩니다<br>\n아래처럼</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/app\n\t/about\n\t/blog\n\t\t/[slug]\n\t\t\tpage.js\n\t\tpage.js</code></pre></div>\n<p>이 경우 <code class=\"language-text\">/blog/something-slug</code>, <code class=\"language-text\">/blog/another-slug</code>, ...와 같이 동적으로 경로분할이 이루어집니다<br>\n그리고 이제 <code class=\"language-text\">/[slug]/page.js</code>에서는 <code class=\"language-text\">[slug]</code>에 해당하는 식별자 값을 알아야 할건데<br>\n<code class=\"language-text\">/[slug]/page.js</code>에는 Next.js가 알아서 props를 넣어줍니다.<br>\n<code class=\"language-text\">BlogPostPage({ params })</code> params라는 이름으로요<br>\n이 params는 동적 경로에 넣은 식별자들이 <code class=\"language-text\">key-value</code>로 들어가있습니다<br>\n즉 <code class=\"language-text\">params.slug</code>와 같이 써서 slug값을 가져올 수 있는거십니다잉</p>\n<h1 id=\"server-component-vs-client-component\" style=\"position:relative;\"><a href=\"#server-component-vs-client-component\" aria-label=\"server component vs client component permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Server Component VS. Client Component</h1>\n<p>기본적으로 컴포넌트들은 서버에서 실행됩니다.<br>\n이건 처음 로드될 때 뿐만 아니라, <code class=\"language-text\">&lt;Link></code>로 네비게이션할 때도 그렇고요<br>\n서버 컴포넌트를 사용하면 <a href=\"https://nextjs.org/docs/app/building-your-application/rendering/server-components\">많은 이점</a>들을 가져갈 수 있습니다</p>\n<p>그런데 useEffect같은 훅을 쓰는 경우 서버 컴포넌트로 실행될 수 없습니다<br>\nlocalStorage, Geolocaion API 등 웹브라우저(클라이언트 사이드)에서만 가능한 기능도 또한 그렇습니다<br>\n당연히 우리는 컴포넌트를 클라이언트에서 렌더링해야 할 필요가 생기는 시점이 생깁니다<br>\n이 경우 <strong>클라이언트 사이드 컴포넌트임을 명시하기 위해 \"use client\" 지시어</strong>를 파일 맨 위에 적어줍시다.</p>\n<p>근데 <code class=\"language-text\">use client</code>를 항상 매 컴포넌트마다 써버린다면 기존 리액트랑 다를게 별로 없겠죠?<br>\n<a href=\"(https://nextjs.org/docs/app/building-your-application/rendering/server-components)\">서버 컴포넌트의 이점</a>을 활용하려면 최대한 클라이언트 컴포넌트는 컴포넌트 트리의 하단부에 넣는게 좋겠습니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4d0fc753683698f5e0d2e9dab85e1688/da952/image-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.050632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxklEQVR42lWOaxKCIBRGXU2mAvLqRaKoKIOoe2gBtYTW3k2dxs4Phrmc7/JFaAfGmBCi1N05570PYZzn2VqrtcYL6J8oW4AbnEmSZChjPL+cL7rQFVCWUghM6fa6k7/h30rGqDGNG8zjaYuW5jm+Xm8wJ40vX2/VeVsbzsVacI1Efd9DybZtQwjTNJVVcf86UJ8I+BMjIk60dlVjxzCABnLXdZCilEZgcM6VUjAyBnL8GCdLqa0bytI0PoAkpOSMgS+lXPbiDzbxPwpYF+FnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"컴포넌트 어디에\"\n        title=\"\"\n        src=\"/static/4d0fc753683698f5e0d2e9dab85e1688/f058b/image-1.png\"\n        srcset=\"/static/4d0fc753683698f5e0d2e9dab85e1688/c26ae/image-1.png 158w,\n/static/4d0fc753683698f5e0d2e9dab85e1688/6bdcf/image-1.png 315w,\n/static/4d0fc753683698f5e0d2e9dab85e1688/f058b/image-1.png 630w,\n/static/4d0fc753683698f5e0d2e9dab85e1688/40601/image-1.png 945w,\n/static/4d0fc753683698f5e0d2e9dab85e1688/78612/image-1.png 1260w,\n/static/4d0fc753683698f5e0d2e9dab85e1688/da952/image-1.png 1872w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1 id=\"데이터베이스와-통신하기\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EC%99%80-%ED%86%B5%EC%8B%A0%ED%95%98%EA%B8%B0\" aria-label=\"데이터베이스와 통신하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터베이스와 통신하기</h1>\n<p>데이터베이스와 통신하여 데이터를 가져오거나 데이터를 전송하는 일은 매우 흔합니다<br>\n보통은 DB를 따로 두고 CRUD가 가능한 api를 열든지 어쩌든지 하고, <code class=\"language-text\">useEffect</code>에서 <code class=\"language-text\">fetch</code>같은 것으로 통신할텐데요<br>\nNext.js는 풀스택 프레임워크니까 그런거 필요없습니다.<br>\nSQLite를 사용하는 경우를 예시로 한번 살펴봅시다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b9388a087df730cf3cc414ef879000a9/8b69f/image-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.316455696202528%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0klEQVR42k2PzW6DMBCEeZsQG/CPgNohxnYwGAHiBdpTc4l6zPsfOsFK1Tms9/DNzDor3ioPYdFKe+/XdVkP7fvunVXq449JGJSlh1JKCDkGEZIxVml1sdZer+aiNeOiZJz8E/iXOcUIIYZh8N51uv/6cZ8PU1Tnpmnquj4z0Xw/1f15641zzh9q2xb+rOu6GGMIARcuyzJNsfetNhyJUkrOsZTM3IQNc5zmeQa8bRtIGDN0IgYNmKhSShW0yk8k/SWdR/NTSfIhhHEcUQMGpJTyF/JpQMw+zsvjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"데이터 가져오기\"\n        title=\"\"\n        src=\"/static/b9388a087df730cf3cc414ef879000a9/f058b/image-5.png\"\n        srcset=\"/static/b9388a087df730cf3cc414ef879000a9/c26ae/image-5.png 158w,\n/static/b9388a087df730cf3cc414ef879000a9/6bdcf/image-5.png 315w,\n/static/b9388a087df730cf3cc414ef879000a9/f058b/image-5.png 630w,\n/static/b9388a087df730cf3cc414ef879000a9/8b69f/image-5.png 912w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"데이터-꺼내오기\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EA%BA%BC%EB%82%B4%EC%98%A4%EA%B8%B0\" aria-label=\"데이터 꺼내오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터 꺼내오기</h2>\n<p>데이터베이스에서 직접 꺼내올 수 있는 것은 서버 컴포넌트의 특권입니다<br>\n데이터를 꺼내오려면 다음과 같은 과정을 밟습니다. \"식사에 대한 정보\"를 가져온다고 생각하겠습니다</p>\n<ol>\n<li>일단 데이터 가져오는 함수를 만듭시다. 보통 <code class=\"language-text\">/lib/meals.js</code>처럼 하는가봅니다</li>\n<li>그 안에서 <code class=\"language-text\">const db = sql('meals.db')</code>와 같이, db파일을 가져다 데이터베이스를 준비합니다</li>\n<li><code class=\"language-text\">getMeals()</code>라는, 데이터 가져오기 함수를 정의할건데, <code class=\"language-text\">db.prepare(sql문).all();</code>처럼 하면 됩니다.\n<ul>\n<li><code class=\"language-text\">prepare(sql).all()</code>은 조회, <code class=\"language-text\">prepare(sql).run()</code>은 데이터 수정입니다</li>\n</ul>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> sql <span class=\"token keyword\">from</span> <span class=\"token string\">\"better-sqlite3\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> db <span class=\"token operator\">=</span> <span class=\"token function\">sql</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"meals.db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getMeals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SELECT * FROM meals\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이런 식이겠네요</p>\n<p>그리고 이제 컴포넌트에서 이걸 사용할건데<br>\n서버 컴포넌트인 컴포넌트 함수는 <strong>async</strong>가 가능합니다 (원래 안 됐음)<br>\n따라서 Promise에 대해 <code class=\"language-text\">await</code>도 가능하죠<br>\n그래서 이제</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MealsPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> meals <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getMeals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MealsGrid</span></span> <span class=\"token attr-name\">meals</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>meals<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 쓸 수 있습니다.</p>\n<h3 id=\"꺼내오는-동안-폴백-보여주기\" style=\"position:relative;\"><a href=\"#%EA%BA%BC%EB%82%B4%EC%98%A4%EB%8A%94-%EB%8F%99%EC%95%88-%ED%8F%B4%EB%B0%B1-%EB%B3%B4%EC%97%AC%EC%A3%BC%EA%B8%B0\" aria-label=\"꺼내오는 동안 폴백 보여주기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>꺼내오는 동안 폴백 보여주기</h3>\n<p>근데 당연히 꺼내오는 시간은 여전히 존재합니다<br>\n그럼 기다리는 동안 뭔가 보여주고 싶은데\n전에 배운 <code class=\"language-text\">&lt;Suspense></code>블록이 유용합니다.<br>\n또는 <code class=\"language-text\">loading.js</code>를 만들어둘 수도 있겠고요</p>\n<p><code class=\"language-text\">&lt;Suspense></code>로 하려면 먼저 <code class=\"language-text\">meals</code> 데이터를 가져오고 렌더하는 코드를 따로 분리합시다</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">async function Meals() {\n  const meals = await getMeals();\n  return &lt;MealsGrid meals={meals} />;\n}</code></pre></div>\n<p>이제 이를 <code class=\"language-text\">&lt;Suspense></code>로 래핑하여 사용합니다</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Suspense</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MealsLoading</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Meals</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Suspense</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>이러면 데이터를 가져오는 부분만 쏙 빼서 \"준비중입니다 ^^;;\"를 하고<br>\n다른 상관없는 부분들은 바로 보여줘버릴 수 있습니다</p>\n<h3 id=\"errorjs\" style=\"position:relative;\"><a href=\"#errorjs\" aria-label=\"errorjs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>error.js</h3>\n<p>이 타이밍에 <code class=\"language-text\">error.js</code>가 슬슬 있어야겠습니다<br>\n조회가 실패할 수도 있고 말이죠?<br>\n아, <code class=\"language-text\">error.js</code>는 꼭 클라이언트 컴포넌트여야 합니다. 서버 뿐만 아니라 브라우저에서의 에러까지 모두 잡기 위함입니다</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token string\">\"use client\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Error</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> error <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>main</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>error<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">An error occurred!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>error<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>main</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>대충 이런식으로 하면 되겠는데<br>\n이러면 이제 중첩 route에서 에러 발생 시 이 폴백페이지를 띄웁니다<br>\nprops로는 <code class=\"language-text\">error</code>객체를 받아서 디테일을 추가할 수도 있구요</p>\n<p>NotFound도 비슷하게 <code class=\"language-text\">not-found.js</code>륾 만들면 되는데, 서버컴포넌트여도 됩니다</p>\n<h3 id=\"값-하나만-꺼내오기\" style=\"position:relative;\"><a href=\"#%EA%B0%92-%ED%95%98%EB%82%98%EB%A7%8C-%EA%BA%BC%EB%82%B4%EC%98%A4%EA%B8%B0\" aria-label=\"값 하나만 꺼내오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>값 하나만 꺼내오기</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getMeal</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">slug</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SELECT * FROM meals WHERE slug = ?\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>slug<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>아까 <code class=\"language-text\">prepare().all()</code>했던 것과 다르게 <code class=\"language-text\">.get()</code>하면 되는데<br>\n그 하나를 식별할 paramter를 넣어서 <code class=\"language-text\">.get(slug)</code>처럼 하겠죠?<br>\n근데 이 경우 <code class=\"language-text\">.get(slug)</code>가 아닌 단순히 <code class=\"language-text\">\"SELECT * FROM meals WHERE slug=\"+slug</code> 하면 안 됩니다. SQL Injection 당하기 딱좋습니다</p>\n<p>없는 값인가? 를 확인하려면 일단 저 반환값을 <code class=\"language-text\">if(!meal)</code>처럼 확인하고<br>\n<code class=\"language-text\">notFound()</code>함수를 Next.js에서 제공하니까 이걸 호출하면 제일 가까운 NotFound폴백이 나타납니다</p>\n<h2 id=\"데이터-수정하기\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%88%98%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"데이터 수정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터 수정하기</h2>\n<p>응당 데이터를 가져왔다면 다시 집어넣어야겠습니다. 때로는 삭제하고 싶을수도 있고요<br>\n이것도 다이렉트로 서버에 넣어버리거나 하면 좋겠네요<br>\n이를 위해서는 임의의 js함수를 만들고, <code class=\"language-text\">'use server'</code> 지시어를 씁니다.<br>\n이제 그 파일 안에서 <code class=\"language-text\">async</code>함수를 만들면 <strong>Server Action</strong>으로 생성됩니다.<br>\n그럼 서버 컴포넌트가 서버단에서 실행되는 것이 보장되듯이 이 함수도 그렇게 됩니다.</p>\n<h3 id=\"폼-제출\" style=\"position:relative;\"><a href=\"#%ED%8F%BC-%EC%A0%9C%EC%B6%9C\" aria-label=\"폼 제출 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>폼 제출</h3>\n<p>폼 제출을 위한 함수를 만듭니다.<br>\n그리고 파일 맨 위에 <code class=\"language-text\">use server</code> 지시어를 써도 되지만<br>\n그냥 함수 정의 맨 위에 <code class=\"language-text\">use server</code>를 써서 개별 함수를 Server Action으로 만들 수 있습니다</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">shareMeal</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">formData</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token string\">\"user server\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">const</span> meal <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token operator\">...</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token comment\">// meal 객체를 DB에 저장하기.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Form이 있는 컴포넌트 함수에서는..</span>\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>shareMeal<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>이제 server action인 함수를 <code class=\"language-text\">&lt;form></code>의 action 프로퍼티로 넣어줍니다.<br>\n이게 근데 컴포넌트가 클라이언트 컴포넌트면 오류가 발생하는데<br>\n당연히 서버액션을 클라이언트에서 실행하려면 그렇죠</p>\n<h4 id=\"제출중입니다-기달\" style=\"position:relative;\"><a href=\"#%EC%A0%9C%EC%B6%9C%EC%A4%91%EC%9E%85%EB%8B%88%EB%8B%A4-%EA%B8%B0%EB%8B%AC\" aria-label=\"제출중입니다 기달 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>제출중입니다.. 기달</h4>\n<p>이제 제출중임을 표현하고 싶으면 <code class=\"language-text\">useFormState()</code>훅을 사용하는데<br>\n아? 훅이라서 클라이언트 컴포넌트여야만 하죠?<br>\n그러니 제출버튼만 따로 빼서 아래와 같이 합시다</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token string\">\"use client\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useFormStatus <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-dom\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MealsFormSubmit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> pending <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useFormStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">disabled</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>pending<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>pending <span class=\"token operator\">?</span> <span class=\"token string\">\"Submitting...\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"Share Meal\"</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 <code class=\"language-text\">useFormStatus</code>는 form 양식 내부에서만 가능합니다</p>\n<h4 id=\"양식-제출-시-값이-유효하지-않은-경우-그대로-머무르기\" style=\"position:relative;\"><a href=\"#%EC%96%91%EC%8B%9D-%EC%A0%9C%EC%B6%9C-%EC%8B%9C-%EA%B0%92%EC%9D%B4-%EC%9C%A0%ED%9A%A8%ED%95%98%EC%A7%80-%EC%95%8A%EC%9D%80-%EA%B2%BD%EC%9A%B0-%EA%B7%B8%EB%8C%80%EB%A1%9C-%EB%A8%B8%EB%AC%B4%EB%A5%B4%EA%B8%B0\" aria-label=\"양식 제출 시 값이 유효하지 않은 경우 그대로 머무르기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>양식 제출 시 값이 유효하지 않은 경우 그대로 머무르기</h4>\n<p>Server Action에서 값이 유효하지 않으면 <code class=\"language-text\">throw Error</code>해버릴 수 있지만,<br>\n그럼 페이지를 나가버리는게 단점입니다. 유저들은 이런걸 원하지 않을것인데<br>\n따라서 값이 유효하지 않은 경우 그냥 <code class=\"language-text\">return { message: \"Invalid input.\" }</code>처럼 직렬화 가능한 객체를 반환합시다</p>\n<p>이제 Form이 있는 페이지에서, <code class=\"language-text\">useFormState</code>를 사용해야합니다.<br>\n흠.. 그럼 어쩔 수 없이 그 페이지가 이제 클라이언트 컴포넌트가 되어야 하겠네요 ㅜㅜ<br>\n그럼 Server Action은 이제 어떻게 쓰죠?</p>\n<p><code class=\"language-text\">const [state, formAction] = useFormState(serverActionFn, initValue)</code><br>\n이렇게 훅을 쓸거라서, 원래 <Form action={serverActionFn}><code class=\"language-text\">처럼 전달했던 </code>serverActionFn<code class=\"language-text\">을 이제 </code>useFormState<code class=\"language-text\">훅에 전달합니다  \n이를 위해 server action 함수는 이제 </code>(prevState, formData) => {}`와 같은 형태가 되어야 합니다<br>\n받아오는건 두 가지인데,</p>\n<ul>\n<li><code class=\"language-text\">state</code>는 상태 (initValue로 넣은 초기값이거나, 제출에 의한 상태값)</li>\n<li><code class=\"language-text\">formAction</code> : 이걸 이제 form의 action으로 넣어줍니다. <code class=\"language-text\">&lt;form action={formAction}></code> 이렇게</li>\n</ul>\n<h1 id=\"nextjs-캐싱\" style=\"position:relative;\"><a href=\"#nextjs-%EC%BA%90%EC%8B%B1\" aria-label=\"nextjs 캐싱 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next.js 캐싱</h1>\n<p>Next.js는 매우 공격적으로 페이지를 캐시합니다<br>\n사실상 한 번 방문한 페이지는 모두 캐싱해놓고 새로 로드하기 전까지는 이걸 보여주죠<br>\n특히 Next.js는 <strong>build할 때 가능한 모든 페이지를 모두 사전 렌더링하고 생성</strong>해둡니다.<br>\n사실상 정적 사이트가 되는건데 이 덕분에 첫 방문시에도 매우 빠르게 페이지를 보여줄 수 있습니다.</p>\n<p>근데 이거때문에 위에서 살펴본 폼 제출로 DB에 새 값을 넣어도, 모든 데이터를 보여주는 페이지에는 변화가 없게 됩니다<br>\n따라서 데이터가 변경되거나 그럴 때 <strong>캐시 유효성을 재확인</strong>하도록 트리거해야만 하는데<br>\nserver action함수가 끝날 때 (redirect 직전에) 함수를 호출합니다. Next.js에서 제공하는 함수를<br>\n<code class=\"language-text\">revalidatePath</code>입니다. <code class=\"language-text\">revalidatePath('/meals')</code>와 같이 호출하여 해당 경로의 캐시를 폐기합니다.<br>\n그럼 이제 다시 <code class=\"language-text\">/meals</code>경로의 페이지를 사용자가 요청하면, 새로 페이지를 렌더링합니다.</p>\n<p>저렇게 하면 딱 저 route만 영향을 받고, 중첩 페이지는 영향받지 않는데<br>\n만약 중첩페이지까지 모두 갱신하려면 두 번째 인자로 <code class=\"language-text\">layout</code>이라고 넘겨줍니다.<br>\n<code class=\"language-text\">revalidatePath(\"/meals\", \"layout\")</code> 이렇게. 그러면 중첩페이지를 모두 재검사합니다.<br>\n기본값은 <code class=\"language-text\">page</code>라서 그 페이지만 갱신합니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f801df1bf40f56e7a6a24a4a2f77f51e/a6d36/image-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABc0lEQVR42l2S6Y6CUAyF78soAl4EIwLihhpBAy5xBeMP3/8l5hvqMMb+aMppT5dzUd0/01qbprlara7Xa57n+/2+LMvdbvd8PouieDweaZpS0P0w9UWeTqcQttvtYrGgGp9l2Ww2w4/HY8uyvsn6wzqdTqvVarfbBIZh4CXGf439JdOsqSOGb9s2dfLZIARmbcT/ZJY5nU632w3PknDwcjOebSGs12tizuH40WjULK9c1wWtqoqE53k07vf7HIlaYRgOBgOKwKMoOh6PIMTNjUouWS6Xvu9zGGROoHeSJODEgvR6PZAmK6akK8Pn8zkzGUUXJiA4OJ/D4RCE6zabDXFUG0gQBAqCQHzjX68XW8AhBxLH8eFwgEkNHfGTyYQDw9qUKCmasycJKmR/EMdxeG12Jm72B6ES5P3OJBCJf+t+vyMeA0GQGpHO5zMnIDjqoDmPcrlceAvWef9hTGZJaCxJjgSlXm2McmsT2WnEQ3Ca1voHPLWbjMh6W2oAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Next.js 캐싱\"\n        title=\"\"\n        src=\"/static/f801df1bf40f56e7a6a24a4a2f77f51e/f058b/image-4.png\"\n        srcset=\"/static/f801df1bf40f56e7a6a24a4a2f77f51e/c26ae/image-4.png 158w,\n/static/f801df1bf40f56e7a6a24a4a2f77f51e/6bdcf/image-4.png 315w,\n/static/f801df1bf40f56e7a6a24a4a2f77f51e/f058b/image-4.png 630w,\n/static/f801df1bf40f56e7a6a24a4a2f77f51e/a6d36/image-4.png 650w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1 id=\"메타데이터\" style=\"position:relative;\"><a href=\"#%EB%A9%94%ED%83%80%EB%8D%B0%EC%9D%B4%ED%84%B0\" aria-label=\"메타데이터 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메타데이터</h1>\n<p>위에서 살펴봤듯이 페이지 컴포넌트에서 <code class=\"language-text\">export const metadata</code>로 메타데이터를 설정할 수 있습니다<br>\n이건 더 구체적인 페이지에 존재하는 metadata가 우선적용되는데<br>\n동적페이지에서는 다르게 합니다</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">generateMetadata</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> params <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> meal <span class=\"token operator\">=</span> <span class=\"token function\">getMeal</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>meal<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">notFound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> meal<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> meal<span class=\"token punctuation\">.</span>summary\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이런 식으로, <code class=\"language-text\">generateMetaData({ params })</code>라는 함수에서 객체를 반환하도록 하고, 이를 내보냅니다<br>\n경로 파라미터가 필요하면 인자로 주니까 그거 쓰면 됩니다<br>\n서버에서 실행할거라 <code class=\"language-text\">async</code>도 되고, 서버액션으로 값을 가져올 수도 있습니다</p>\n<hr>\n<p><br>\n여기까지인데요<br>\n사실 App Router는 너무 MZ식이라 아직도 Pages Router는 유효하고 많이 남아있습니다<br>\n다음 시간에는 Pages Router로 Next.js를 다시 알아보겠습니다</p>\n<p>그리고 <a href=\"https://www.napkin.ai/\">Napkin AI</a>너무 좋은데요?<br>\n그림 자료들은 다 얘가 해줬습니다</p>\n<p>이만 마칩니다</p>","frontmatter":{"title":"Next.js 먹어보기 (1) : App Router","date":"October 05, 2024","description":"Next.js 13부터는 App Router가 권장됩니다","tag":["TIL","Next.js"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%ED%8F%B4%EB%8D%94%EA%B5%AC%EC%A1%B0\">폴더구조</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%8E%98%EC%9D%B4%EC%A7%80-%EA%B0%84-%EC%9D%B4%EB%8F%99\">페이지 간 이동</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\">컴포넌트 추가하기</a></p>\n<ul>\n<li><a href=\"#layoutjs\">layout.js</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#dynamic-route-%EB%8F%99%EC%A0%81-%EA%B2%BD%EB%A1%9C\">Dynamic Route (동적 경로)</a></p>\n</li>\n<li>\n<p><a href=\"#server-component-vs-client-component\">Server Component VS. Client Component</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EC%99%80-%ED%86%B5%EC%8B%A0%ED%95%98%EA%B8%B0\">데이터베이스와 통신하기</a></p>\n<ul>\n<li>\n<p><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EA%BA%BC%EB%82%B4%EC%98%A4%EA%B8%B0\">데이터 꺼내오기</a></p>\n<ul>\n<li><a href=\"#%EA%BA%BC%EB%82%B4%EC%98%A4%EB%8A%94-%EB%8F%99%EC%95%88-%ED%8F%B4%EB%B0%B1-%EB%B3%B4%EC%97%AC%EC%A3%BC%EA%B8%B0\">꺼내오는 동안 폴백 보여주기</a></li>\n<li><a href=\"#errorjs\">error.js</a></li>\n<li><a href=\"#%EA%B0%92-%ED%95%98%EB%82%98%EB%A7%8C-%EA%BA%BC%EB%82%B4%EC%98%A4%EA%B8%B0\">값 하나만 꺼내오기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%88%98%EC%A0%95%ED%95%98%EA%B8%B0\">데이터 수정하기</a></p>\n<ul>\n<li>\n<p><a href=\"#%ED%8F%BC-%EC%A0%9C%EC%B6%9C\">폼 제출</a></p>\n<ul>\n<li><a href=\"#%EC%A0%9C%EC%B6%9C%EC%A4%91%EC%9E%85%EB%8B%88%EB%8B%A4-%EA%B8%B0%EB%8B%AC\">제출중입니다.. 기달</a></li>\n<li><a href=\"#%EC%96%91%EC%8B%9D-%EC%A0%9C%EC%B6%9C-%EC%8B%9C-%EA%B0%92%EC%9D%B4-%EC%9C%A0%ED%9A%A8%ED%95%98%EC%A7%80-%EC%95%8A%EC%9D%80-%EA%B2%BD%EC%9A%B0-%EA%B7%B8%EB%8C%80%EB%A1%9C-%EB%A8%B8%EB%AC%B4%EB%A5%B4%EA%B8%B0\">양식 제출 시 값이 유효하지 않은 경우 그대로 머무르기</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#nextjs-%EC%BA%90%EC%8B%B1\">Next.js 캐싱</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%A9%94%ED%83%80%EB%8D%B0%EC%9D%B4%ED%84%B0\">메타데이터</a></p>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/til/animation-in-react/"},"frontmatter":{"title":"React 프로젝트에 애니메이션 넣기"}},"next":{"fields":{"slug":"/til/nextjs-pages-router/"},"frontmatter":{"title":"Next.js 먹어보기 (2) : Pages Router"}}},"pageContext":{"id":"b67c9c82-9720-5820-af62-bb4b04583e24","previousPostId":"e48260dc-1804-5812-9e43-62a6c009a430","nextPostId":"8b696e31-282d-5c99-9358-426690e94717"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}