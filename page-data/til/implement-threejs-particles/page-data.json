{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/til/implement-threejs-particles/","result":{"data":{"site":{"siteMetadata":{"title":"조성개발실록"}},"markdownRemark":{"id":"b0ae8c83-3748-5603-a96a-7347195a01d7","excerpt":"! 주의 : TIL 게시글입니다. 다듬지 않고 올리거나 기록을 통째로 복붙했을 수 있는 뒷고기 포스팅입니다. 제 블로그 대문에 보면 웬 솟아오르는 로켓이 있는데요  This work is based on \"Rocket 🚀\"\n(https://sketchfab.com/3d-models…","html":"<blockquote>\n<p>! 주의 : TIL 게시글입니다. 다듬지 않고 올리거나 기록을 통째로 복붙했을 수 있는 뒷고기 포스팅입니다.</p>\n</blockquote>\n<p>제 블로그 대문에 보면 웬 솟아오르는 로켓이 있는데요</p>\n<figure>\n<p><img src=\"https://i.imgur.com/neJyyfb.gif\" alt=\"\"></p>\n<figcaption>\n<p>This work is based on \"Rocket 🚀\"\n(<a href=\"https://sketchfab.com/3d-models/rocket-9b9b64b138f24e4a908238c0b471930e\">https://sketchfab.com/3d-models/rocket-9b9b64b138f24e4a908238c0b471930e</a>)\nby lizlancaster (<a href=\"https://sketchfab.com/lizlancaster\">https://sketchfab.com/lizlancaster</a>) licensed under\nCC-BY-4.0 (<a href=\"http://creativecommons.org/licenses/by/4.0/\">http://creativecommons.org/licenses/by/4.0/</a>)</p>\n</figcaption>\n</figure>\n<p>이거 React-Three-Fiber로 만들어본 데모입니다. 로켓은 무료사이트에서 퍼왔구요<br>\n로켓을 잡아서 이리저리 돌려보면 로켓 방향을 바꿀 수도 있습니다(사실 카메라가 움직이는거심)<br>\n아무튼간에 오늘은 여기에 쓰인 파티클 효과 구현에 대해 알아보겠습니다</p>\n<h1 id=\"점을-여러개-생성하려면\" style=\"position:relative;\"><a href=\"#%EC%A0%90%EC%9D%84-%EC%97%AC%EB%9F%AC%EA%B0%9C-%EC%83%9D%EC%84%B1%ED%95%98%EB%A0%A4%EB%A9%B4\" aria-label=\"점을 여러개 생성하려면 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>점을 여러개 생성하려면</h1>\n<p>3D 오브젝트를 생성할 때 우리는 mesh를 사용했습니다</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mesh</span> <span class=\"token attr-name\">visible</span> <span class=\"token attr-name\">position</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">rotation</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>sphereGeometry</span> <span class=\"token attr-name\">args</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meshStandardMaterial</span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hotpink<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">transparent</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mesh</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>근데 이번에 구현할 파티클 시스템에서는 <code class=\"language-text\">&lt;points></code>를 씁니다.<br>\n<strong>입자</strong>에 해당하는 점만 있으면 되니깐요<br>\n그럼 저런 효과를 구현하려면 아주 많은 수의 입자를 생성해야 할 것 같습니다<br>\n300개정도 한다고 생각해봅시다.<br>\n그럼 이런건 어떤가요? ㅋㅋㅋ</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token builtin\">Array</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> length<span class=\"token operator\">:</span> <span class=\"token number\">3000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>points</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>i<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">points</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fooGeometry</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fooMaterial</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>points</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>택도없습니다. 이러면 300개의 <code class=\"language-text\">&lt;points></code> 를 위한 메모리를 할당하고, 300개의 WebGL draw call을 유발하고, 300번의 렌더링 처리가 필요합니다.</p>\n<p>대신 <a href=\"https://threejs.org/docs/?q=bufferGeo#api/en/core/BufferGeometry\"><code class=\"language-text\">bufferGeometry</code></a>로 커스텀 기하학 정보를 담아서, 이를 단일 <code class=\"language-text\">&lt;points></code>에서 사용합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>points</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bufferGeometry</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bufferAttribute</span>\n      <span class=\"token attr-name\">attach</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>attributes-position<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">count</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">array</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>positions<span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">itemSize</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">3</span><span class=\"token punctuation\">}</span></span>\n    <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bufferGeometry</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pointsMaterial</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>points</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>그럼 이 300개 점들의 위치정보 배열을 만들러 가봅시다</p>\n<h1 id=\"파티클들의-위치와-속도를-초기화하기\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%ED%8B%B0%ED%81%B4%EB%93%A4%EC%9D%98-%EC%9C%84%EC%B9%98%EC%99%80-%EC%86%8D%EB%8F%84%EB%A5%BC-%EC%B4%88%EA%B8%B0%ED%99%94%ED%95%98%EA%B8%B0\" aria-label=\"파티클들의 위치와 속도를 초기화하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파티클들의 위치와 속도를 초기화하기</h1>\n<p>먼저 <code class=\"language-text\">&lt;points></code> 오브젝트를 참조할 ref와, 파티클들의 위치와 속도를 담을 ref를 만들어줍니다</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> count <span class=\"token operator\">=</span> <span class=\"token number\">300</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 파티클 수</span>\n<span class=\"token keyword\">const</span> particles <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">useRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Points<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> particlesData <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    positions<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Float32Array</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    velocities<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Float32Array</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">...</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>points</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>particles<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  // ...\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>points</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>300개만큼의 파티클 입자들 위치와 속도를 유지하기 위해 <code class=\"language-text\">Float32Array</code>를 두 개 만들어줍니다.<br>\n이 때 배열의 크기는 300 x 3입니다. 3차원 공간이니깐여</p>\n<p>이제 각 입자들의 초기 위치와 속도를 정해줍니다</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> getRandomPositionFromCenter <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1.4</span> <span class=\"token operator\">-</span> <span class=\"token number\">0.7</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 초기화</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">REDUCTION_FACTOR</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> count<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> z <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n\n  particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">getRandomPositionFromCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">getRandomPositionFromCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">getRandomPositionFromCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>velocities<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> x <span class=\"token operator\">*</span> <span class=\"token constant\">REDUCTION_FACTOR</span><span class=\"token punctuation\">;</span>\n  particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>velocities<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> <span class=\"token constant\">REDUCTION_FACTOR</span><span class=\"token punctuation\">;</span>\n  particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>velocities<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> z <span class=\"token operator\">*</span> <span class=\"token constant\">REDUCTION_FACTOR</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>일단 중심 위치로부터 적당~한 랜덤 범위를 뽑아서 위치를 할당해줍시다.\n사실은 로켓을 월드좌표의 0,0,0에 둘거라 그냥 0,0,0기준으로 Center가 뽑히기만 하면 됩니다<br>\n그리고 속도는 로켓이 바라보는 방향(Y) 반대로 갈 수 있도록 정해줍니다.<br>\n근데 Y축으로만 움직이게 하면 좀 재미없는 직선이 되니까 X, Z축에 랜덤을 좀 섞어줍니다</p>\n<h1 id=\"useframe으로-파티클들이-움직이도록-업데이트\" style=\"position:relative;\"><a href=\"#useframe%EC%9C%BC%EB%A1%9C-%ED%8C%8C%ED%8B%B0%ED%81%B4%EB%93%A4%EC%9D%B4-%EC%9B%80%EC%A7%81%EC%9D%B4%EB%8F%84%EB%A1%9D-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8\" aria-label=\"useframe으로 파티클들이 움직이도록 업데이트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useFrame으로 파티클들이 움직이도록 업데이트</h1>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token function\">useFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>particles<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> positions <span class=\"token operator\">=</span> particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>positions<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> velocities <span class=\"token operator\">=</span> particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>velocities<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> count<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> particlePosition <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span>\n      positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    particlePosition<span class=\"token punctuation\">.</span>x <span class=\"token operator\">+=</span> velocities<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    particlePosition<span class=\"token punctuation\">.</span>y <span class=\"token operator\">+=</span> velocities<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    particlePosition<span class=\"token punctuation\">.</span>z <span class=\"token operator\">+=</span> velocities<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> dist <span class=\"token operator\">=</span> particlePosition<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> minProbability <span class=\"token operator\">=</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> maxProbability <span class=\"token operator\">=</span> <span class=\"token number\">0.99</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> probability <span class=\"token operator\">=</span>\n      Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>dist <span class=\"token operator\">/</span> maxDistance<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>maxProbability <span class=\"token operator\">-</span> minProbability<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n      minProbability<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> probability<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">getRandomPositionFromCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">getRandomPositionFromCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">getRandomPositionFromCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> particlePosition<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">;</span>\n      positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> particlePosition<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">;</span>\n      positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> particlePosition<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  particles<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>geometry<span class=\"token punctuation\">.</span>attributes<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span>needsUpdate <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>useFrame을 사용하여 애니메이션 프레임을 요청해줍니다<br>\n여기서는 300개의 위치, 속도 값 각각에 대해 (각 파티클에 대해)</p>\n<ul>\n<li><code class=\"language-text\">new Vector3(x,y,z)</code>와 같이 현재 파티클의 위치를 벡터객체로 생성합니다</li>\n<li>이제 이 위치에서 속도를 더해주어(<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>v</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">x = x_i + vt</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">t</span></span></span></span></span>) 속도에 따른 위치 변화를 업데이트합니다</li>\n<li>파티클이 너무 멀리 가면 사라지도록 해줍니다. : 거리에 따라 확률적인 particle 초기화 구현\n<ul>\n<li>먼저 <code class=\"language-text\">Vector3.length()</code>로 원점으로부터의 거리를 구할 수 있습니다</li>\n<li>이 거리에 비례하는 파티클 초기화 확률 계산식을 세웁니다</li>\n<li>이제 난수를 하나 뽑아보고, 이 확률보다 크면 살려주고 작으면 위치를 다시 원점으로 돌려보냅니다.</li>\n</ul>\n</li>\n</ul>\n<p>그리고 마지막에는 <code class=\"language-text\">particles</code>(<code class=\"language-text\">&lt;points></code>를 참조함)의 위치 속성을 업데이트해야 한다고 플래그를 켜줍니다.<br>\n지금처럼 <code class=\"language-text\">bufferGeometry</code>의 <code class=\"language-text\">attribute</code>를 직접 수정했다면 <code class=\"language-text\">needsUpate</code>로 업데이트해야함을 알려야 합니다.</p>\n<h1 id=\"이제-buffergeometry에-위치값을-전달해요\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EC%A0%9C-buffergeometry%EC%97%90-%EC%9C%84%EC%B9%98%EA%B0%92%EC%9D%84-%EC%A0%84%EB%8B%AC%ED%95%B4%EC%9A%94\" aria-label=\"이제 buffergeometry에 위치값을 전달해요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이제 <code class=\"language-text\">bufferGeometry</code>에 위치값을 전달해요</h1>\n<p>이제 마지막인데요, <code class=\"language-text\">&lt;points></code>의 geometry로 <code class=\"language-text\">bufferGeometry</code>를 전달해줍시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>points</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>particles<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bufferGeometry</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bufferAttribute</span>\n      <span class=\"token attr-name\">attach</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>attributes-position<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">count</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">array</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>positions<span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">itemSize</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">3</span><span class=\"token punctuation\">}</span></span> <span class=\"token comment\">// x,y,z</span>\n    <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bufferGeometry</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>points</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>기하학 속성으로 우리가 전달할 것은 위치정보입니다<br>\n그래서 이는 <code class=\"language-text\">attributes</code> 중에서도 <code class=\"language-text\">position</code>에 해당하구요<br>\n<code class=\"language-text\">&lt;bufferAttribute></code>로 <code class=\"language-text\">&lt;bufferGeometry></code>에 속성을 선언적으로 전달할 수 있고요<br>\n<code class=\"language-text\">attach=\"attributes-position\"</code> props로 이게 위치 속성임을 알려줍니다.<br>\n<code class=\"language-text\">array</code>에 위치 배열을, <code class=\"language-text\">count</code>에 몇 개의 위치(xyz)들이 들었는지 알려줍니다.</p>\n<p>음.. 그리고 three.js에서 물체는 응당 기하학+재질이니<br>\n<code class=\"language-text\">&lt;pointsMaterial/></code>로 점의 재질을 정해줍시다 적당히</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>points</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>particles<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bufferGeometry</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bufferAttribute</span>\n      <span class=\"token attr-name\">attach</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>attributes-position<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">count</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">array</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>positions<span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">itemSize</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">3</span><span class=\"token punctuation\">}</span></span>\n    <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bufferGeometry</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pointsMaterial</span> <span class=\"token attr-name\">size</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">color</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>color<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">transparent</span> <span class=\"token attr-name\">opacity</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">0.8</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>points</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>그러면 이런 결과가 나옵니다 !!</p>\n<iframe src=\"https://codesandbox.io/embed/9vvlgp?view=preview&module=%2Fsrc%2FApp.tsx&hidenavigation=1\"\n     style=\"width:100%; height: 500px; border:0; border-radius: 4px; overflow:hidden;\"\n     title=\"React Three Fiber + TypeScript: Basic example (forked)\"\n     allow=\"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking\"\n     sandbox=\"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts\"\n   ></iframe>\n<p>쩝 근데 왜케 밍밍하죠? 색상을 단색으로 해서 그런가<br>\n뭔가 아쉬우니 좀 더 해봅시다</p>\n<h2 id=\"잠깐-코드를-정리해요\" style=\"position:relative;\"><a href=\"#%EC%9E%A0%EA%B9%90-%EC%BD%94%EB%93%9C%EB%A5%BC-%EC%A0%95%EB%A6%AC%ED%95%B4%EC%9A%94\" aria-label=\"잠깐 코드를 정리해요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>잠깐 코드를 정리해요</h2>\n<p><code class=\"language-text\">getRandomPositionFromCenter</code>같은거보다 그냥 입자를 초기화하는 함수를 만들어두고 콜하는게 더 나아보입니다</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> initParticle <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span>\n    particlesData<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>MutableRefObject<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">{</span>\n      positions<span class=\"token operator\">:</span> Float32Array<span class=\"token punctuation\">;</span>\n      velocities<span class=\"token operator\">:</span> Float32Array<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    i<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> positions <span class=\"token operator\">=</span> particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>positions<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> velocities <span class=\"token operator\">=</span> particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>velocities<span class=\"token punctuation\">;</span>\n    positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    positions<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    velocities<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">;</span>\n    velocities<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">;</span>\n    velocities<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>x, y, z 속도나 위치를 각각 다르게 하고싶을 수도 있으니깐여\n그럼 이제 처음에는</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> count<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">initParticle</span><span class=\"token punctuation\">(</span>particlesData<span class=\"token punctuation\">,</span> particlesColor<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 하고, 단일 입자가 너무 멀리가서 초기화할 때도</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> probability<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">initParticle</span><span class=\"token punctuation\">(</span>particlesData<span class=\"token punctuation\">,</span> particlesColor<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이러면 되겠어요. 이게 나은듯</p>\n<h1 id=\"색깔도-랜덤으로-해볼래요\" style=\"position:relative;\"><a href=\"#%EC%83%89%EA%B9%94%EB%8F%84-%EB%9E%9C%EB%8D%A4%EC%9C%BC%EB%A1%9C-%ED%95%B4%EB%B3%BC%EB%9E%98%EC%9A%94\" aria-label=\"색깔도 랜덤으로 해볼래요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>색깔도 랜덤으로 해볼래요</h1>\n<p>갑자기 입자들의 색깔이 랜덤으로 나오게 하고, 뿜어내듯이 나오게 해보고 싶어졌습니다\n입자들의 색을 하나씩 직접 정하려면 이것도 <code class=\"language-text\">&lt;bufferAttributes></code>를 사용해야할 것 같아요</p>\n<p>일단 300개 입자들의 위치/속도 배열을 만들었던 것처럼, 색상 배열도 만들어봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> particlesData <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  positions<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Float32Array</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  velocities<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Float32Array</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  colors<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Float32Array</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이번에도 <code class=\"language-text\">Float32Array</code>가 적당할 것 같아요.<br>\n색상은 <code class=\"language-text\">#ffffff</code>처럼 16진수 6개로 나타내니 한 자리에 16비트인데,<br>\nrgb로 자르면 32비트고, 그럼 Float32Array를 입자수 * 3만큼 만들어서 <code class=\"language-text\">itemSize=3</code>으로 하면 되겠어요<br>\n색상도 3차원인것임 ㄷㄷㄷ 근데 차원이라는 단어를 생각해보면 별로 놀랄 일은 아닌듯</p>\n<p>암튼 이제 <code class=\"language-text\">initParticle</code> 함수에서 컬러도 랜덤으로 넣게 짜봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> initParticle <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span>\n    particlesData<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>MutableRefObject<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">{</span>\n      positions<span class=\"token operator\">:</span> Float32Array<span class=\"token punctuation\">;</span>\n      velocities<span class=\"token operator\">:</span> Float32Array<span class=\"token punctuation\">;</span>\n      colors<span class=\"token operator\">:</span> Float32Array<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    i<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ... 위치, 속도를 초기화</span>\n    <span class=\"token keyword\">const</span> colors <span class=\"token operator\">=</span> particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>colors<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> color <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0xffffff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    colors<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> color<span class=\"token punctuation\">.</span>r<span class=\"token punctuation\">;</span>\n    colors<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> color<span class=\"token punctuation\">.</span>g<span class=\"token punctuation\">;</span>\n    colors<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> color<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">Math.random()</code>은 0~1범위를 랜덤으로 뽑으니까, <code class=\"language-text\">Math.random() * 0xffffff</code>라고 하면 <code class=\"language-text\">0x000000 ~ 0xffffff</code> 범위를 뽑아주겠죠?<br>\n이걸 r, g, b로 잘라서 잘 넣어줍시다</p>\n<p>이제 <code class=\"language-text\">bufferAttribute</code>를 사용하여 색상속성을 넣어줄 일만 남았는데</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bufferGeometry</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bufferAttribute</span>\n    <span class=\"token attr-name\">attach</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>attributes-position<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">count</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">array</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>positions<span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">itemSize</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">3</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bufferAttribute</span>\n    <span class=\"token attr-name\">attach</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>attributes-color<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">count</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">array</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>particlesData<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>colors<span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">itemSize</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">3</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bufferGeometry</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>대충 이런 식으로 <code class=\"language-text\">bufferGeometry</code> 밑에 추가로 attribute를 넣어줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pointsMaterial</span>\n  <span class=\"token attr-name\">size</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token attr-name\">transparent</span>\n  <span class=\"token attr-name\">opacity</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token attr-name\">vertexColors</span>\n<span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pointsMaterial</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>그리고 그 밑에 원래 있었던 <code class=\"language-text\">pointMaterial</code>에서는 <code class=\"language-text\">color</code> props를 제거하고,<br>\n꼭!!!!!!!!!!!!!!!1 <code class=\"language-text\">vertexColors=true</code>여야 합니다.<br>\n그래야 정점별로 색상을 달리 지정하게끔 할 수 있어욥</p>\n<p>이제 대충 <code class=\"language-text\">initParticle</code>의 속도값을 조정하고 중력가속도를 넣어줘서 아래처럼 완성해봤습니다</p>\n<iframe src=\"https://codesandbox.io/embed/frdv7k?view=preview&module=%2Fsrc%2FParticles.tsx&hidenavigation=1\"\n     style=\"width:100%; height: 500px; border:0; border-radius: 4px; overflow:hidden;\"\n     title=\"React Three Fiber + TypeScript: Basic example (forked)\"\n     allow=\"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking\"\n     sandbox=\"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts\"\n   ></iframe>\n<p>검은 배경에 하니까 좀 느낌나네요<br>\n뭔가를 축하해야할 것 같은 느낌?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 272px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8a2431b0a79a2039e0c75f57f99849f8/2aae8/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.35443037974683%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACPklEQVR42iWTWW9xYRSFzy933UiIC9QFJRJFSQzR1AVFDT3UTMxTS9VUs1A+fE97XJycs9+91l5r7Zfw/v4+HA4Hg0EulwuHw+Vyud1uf/79isViMBh8fn6m8vHx0e12+/1+Mpn0+/3pdDoUCgnf39+TyeR6vXJstVp9Ph9Eu93ufD7zYjabLRbLarUqlUqxWAwwROv1mkqtVhNarRbDAZ9Op9FoNB6Pl8tls9nkhSJHi8WCusFgeHp6qlQqUDQajWw2iy7h398vEAg8PDwgoVqtAgZGkSe68vk8dmazGTpfXl6QDSNgiATkYY+qy+WCcr/fI4FW5lDcbDZOp1Ov18NLAy6YjB30k5Sw3W4zmQwDC4UC2pAAAEtUqGOKIalUyuPxyGQyt9vNkwrOfz1Lk1FCgHd3d4g8HA6iKKL5crnwxDwsHBFENBrVaDSIqtfrv7IRiT273Y4kk8n0+PgIAPzX1xf0wPhkizc3N8DkcrlCoQBMitPpVEA9fchjw0ajEcpEIuFwOOggT5vNBhFFHCmVStbGLtFCBDyFXq8HDYa5D5LmSCRCYAwkGKZhGAmwMB+f8Xgcz5yyP+Hn54e3t7c3nU5HnoD5pAlAp9PBKnLm8zn6cceebm9vGUYPSQnshlZyZzEIg16KAC0oVKvVgAn5eDxyBV9fX9ElsWPzNzACxz2TVSoVmUPEqkhBuptEwN3EAgDuj3QdpS0IJI5tjN3f3xO11+tFsJQZM7VaLSvAJ4r4P6CFI+4SPaIo/geI7LCfIaLLlwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"얏호\"\n        title=\"\"\n        src=\"/static/8a2431b0a79a2039e0c75f57f99849f8/2aae8/image.png\"\n        srcset=\"/static/8a2431b0a79a2039e0c75f57f99849f8/c26ae/image.png 158w,\n/static/8a2431b0a79a2039e0c75f57f99849f8/2aae8/image.png 272w\"\n        sizes=\"(max-width: 272px) 100vw, 272px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"React-Three-Fiber 데모: 파티클 효과 구현하기","date":"March 25, 2025","description":"points + geometryBuffer + geometryAttributes","tag":["TIL","Three.js","react-three-fiber"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%A0%90%EC%9D%84-%EC%97%AC%EB%9F%AC%EA%B0%9C-%EC%83%9D%EC%84%B1%ED%95%98%EB%A0%A4%EB%A9%B4\">점을 여러개 생성하려면</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%8C%8C%ED%8B%B0%ED%81%B4%EB%93%A4%EC%9D%98-%EC%9C%84%EC%B9%98%EC%99%80-%EC%86%8D%EB%8F%84%EB%A5%BC-%EC%B4%88%EA%B8%B0%ED%99%94%ED%95%98%EA%B8%B0\">파티클들의 위치와 속도를 초기화하기</a></p>\n</li>\n<li>\n<p><a href=\"#useframe%EC%9C%BC%EB%A1%9C-%ED%8C%8C%ED%8B%B0%ED%81%B4%EB%93%A4%EC%9D%B4-%EC%9B%80%EC%A7%81%EC%9D%B4%EB%8F%84%EB%A1%9D-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8\">useFrame으로 파티클들이 움직이도록 업데이트</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%9D%B4%EC%A0%9C-buffergeometry%EC%97%90-%EC%9C%84%EC%B9%98%EA%B0%92%EC%9D%84-%EC%A0%84%EB%8B%AC%ED%95%B4%EC%9A%94\">이제 <code class=\"language-text\">bufferGeometry</code>에 위치값을 전달해요</a></p>\n<ul>\n<li><a href=\"#%EC%9E%A0%EA%B9%90-%EC%BD%94%EB%93%9C%EB%A5%BC-%EC%A0%95%EB%A6%AC%ED%95%B4%EC%9A%94\">잠깐 코드를 정리해요</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%83%89%EA%B9%94%EB%8F%84-%EB%9E%9C%EB%8D%A4%EC%9C%BC%EB%A1%9C-%ED%95%B4%EB%B3%BC%EB%9E%98%EC%9A%94\">색깔도 랜덤으로 해볼래요</a></p>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/look-into-react-18-streaming-and-rsc-payload/"},"frontmatter":{"title":"🤫 React(^18)와 Next.js(App Router)가 당신 몰래 하는 일"}},"next":null},"pageContext":{"id":"b0ae8c83-3748-5603-a96a-7347195a01d7","previousPostId":"7b15f256-1799-562a-8ba5-91dcd5317715","nextPostId":null}},"staticQueryHashes":["2841359383"],"slicesMap":{}}