{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/til/how-to-threejs-5/","result":{"data":{"site":{"siteMetadata":{"title":"조성개발실록"}},"markdownRemark":{"id":"77bc3fa2-909c-5f3a-bb6c-f0eacf4500f1","excerpt":"! 주의 : TIL 게시글입니다. 다듬지 않고 올리거나 기록을 통째로 복붙했을 수 있는 뒷고기 포스팅입니다. 오늘은 공식문서에서 Render Target과 물체를 마우스로 Picking하는 법에 대해 살펴보겠습니다 Picking에는 몇 가지 방법이 있는데, 그 중 하나가 Render…","html":"<blockquote>\n<p>! 주의 : TIL 게시글입니다. 다듬지 않고 올리거나 기록을 통째로 복붙했을 수 있는 뒷고기 포스팅입니다.</p>\n</blockquote>\n<p>오늘은 공식문서에서 Render Target과 물체를 마우스로 Picking하는 법에 대해 살펴보겠습니다<br>\nPicking에는 몇 가지 방법이 있는데, 그 중 하나가 Render Target을 사용하는 경우가 있어서 함께 보게 되었습니다</p>\n<p>공식문서에서 코드는 js로 작성하는데, 저는 이전에 들었던 <a href=\"&#x27;/til/threejs-with-typescript-01/&#x27;\">ts + three.js 강의</a>에서 했던 것처럼 TS + 클래스 객체지향처럼 작성해보겠습니다<br>\n그 강의에서 했던 코드베이스를 거의 유지(카메라, 씬, 이벤트 셋업 등)하면서요</p>\n<h1 id=\"render-target\" style=\"position:relative;\"><a href=\"#render-target\" aria-label=\"render target permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Render Target</h1>\n<p><a href=\"https://threejs.org/manual/#ko/rendertargets\">Render Target</a>이란 직접 렌더링할 수 있는 텍스쳐를 말합니다.<br>\n한 번 텍스쳐로 렌더링한 뒤에는 다른 텍스처처럼 사용할 수 있어요</p>\n<p>마치.. 장면을 렌더링하여 텍스처로 만든다고 해야 할까요?<br>\n새로운 렌더링 세계를 만들고 이를 텍스처로 만든다고 해야할까요?</p>\n<p>아무튼 먼저 봅시다<br>\n먼저 렌더 타겟을 셋업하는 코드를 작성하겠습니다</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">private</span> <span class=\"token function\">setupRenderTarget</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">const</span> rtWidth <span class=\"token operator\">=</span> <span class=\"token number\">512</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> rtHeight <span class=\"token operator\">=</span> <span class=\"token number\">512</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> renderTarget <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">WebGLRenderTarget</span><span class=\"token punctuation\">(</span>rtWidth<span class=\"token punctuation\">,</span> rtHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> rtCamera <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">PerspectiveCamera</span><span class=\"token punctuation\">(</span>\n  <span class=\"token number\">75</span><span class=\"token punctuation\">,</span>\n  rtWidth <span class=\"token operator\">/</span> rtHeight<span class=\"token punctuation\">,</span>\n  <span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">1000</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nrtCamera<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token number\">40</span><span class=\"token punctuation\">;</span>\nrtCamera<span class=\"token punctuation\">.</span><span class=\"token function\">lookAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> rtScene <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Scene</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// rtScene.background = new THREE.Color(\"red\");</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rtScene <span class=\"token operator\">=</span> rtScene<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rtCamera <span class=\"token operator\">=</span> rtCamera<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderTarget <span class=\"token operator\">=</span> renderTarget<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> light <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">AmbientLight</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x404040</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 부드러운 조명</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rtScene<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>light<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> directionalLight <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">DirectionalLight</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xffffff</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 강한 조명 추가</span>\ndirectionalLight<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rtScene<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>directionalLight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">...</span> <span class=\"token comment\">// 이 밑에서 렌더타겟 장면 내부에 물체들을 생성.</span></code></pre></div>\n<p>먼저 이렇게 렌더 타겟 세계를 만듭시다. => <code class=\"language-text\">new THREE.WebGLRenderTarget(w, h)</code><br>\n여기에 장면을 담겠습니다. => <code class=\"language-text\">rtCamera, rtScene</code><br>\n조명도 대충 생성해주고요 => <code class=\"language-text\">rtScene.add(light)</code></p>\n<p>여기는 마치 제 2의 렌더링 세계를 만들듯이, 렌더 타겟 내부를 비출 조명과 카메라, 장면, 물체, ...등을 내부에 생성해줘야 합니다.<br>\n그럼 이제 렌더타겟 장면 내부의 물체를 만들차례죠?</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setupRTModels</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> basicMaterial <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">MeshBasicMaterial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    color<span class=\"token operator\">:</span> <span class=\"token number\">0x808080</span><span class=\"token punctuation\">,</span>\n    side<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>DoubleSide\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> plane <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">createPlane</span><span class=\"token punctuation\">(</span>basicMaterial<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> hemiSphere <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">createHemiSphere</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rtScene<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>plane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//rtScene에 추가</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rtScene<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>hemiSphere<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//rtScene에 추가</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> torusSystem <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Object3D</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> torus <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">createTorus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    torusSystem<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>torus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    torus<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    torus<span class=\"token punctuation\">.</span>rotation<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    torusSystem<span class=\"token punctuation\">.</span>rotation<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rtScene<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>torusSystem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//rtScene에 추가</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> ballGeometry <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">SphereGeometry</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> ballMaterial <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">MeshPhongMaterial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> color<span class=\"token operator\">:</span> <span class=\"token number\">0xff0000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> ball <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Mesh</span><span class=\"token punctuation\">(</span>ballGeometry<span class=\"token punctuation\">,</span> ballMaterial<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> ballSystem <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Object3D</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  ballSystem<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ball<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  ball<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  ballSystem<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"ballSystem\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rtScene<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ballSystem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//rtScene에 추가</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">setupRTModels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이건 <a href=\"https://www.youtube.com/watch?v=QDPwVfiYu7g&#x26;list=PLe6NQuuFBu7F8tG1ZweG3pME3E4M-Q0LA&#x26;index=3\">TypeScript로 즐기는 Three.js 강의 - 3. Transform</a>에서 씬 그래프를 이해하고 트랜스폼 등을 이해하기 위한 예제입니다<br>\n아래와 같은 애니메이션이에요</p>\n<p><img src=\"https://github.com/sungpaks/sungpaks.github.io/blob/master/content/blog/til/how-to-threejs-5/spinning-ball.gif?raw=true\" alt=\"공 회전\"></p>\n<p>이제 이걸 마치 하나의 텍스처처럼 만들어버리겠다는 뜻인데<br>\n이제 렌더타겟이 완성되었으니, 원래 전체 장면의 모델을 셋업합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">private</span> <span class=\"token function\">setupModels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> material <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">MeshBasicMaterial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      map<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderTarget<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>texture<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 렌더 타겟을 텍스처로 갖는 재질</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> geometry <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">BoxGeometry</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> lineGeometry <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">EdgesGeometry</span><span class=\"token punctuation\">(</span>geometry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> lineMaterial <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">LineBasicMaterial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> color<span class=\"token operator\">:</span> <span class=\"token number\">0xffffff</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> line <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">LineSegments</span><span class=\"token punctuation\">(</span>lineGeometry<span class=\"token punctuation\">,</span> lineMaterial<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> box <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Mesh</span><span class=\"token punctuation\">(</span>geometry<span class=\"token punctuation\">,</span> material<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> group <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Group</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    group<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>box<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    group<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>group<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 렌더타겟을 텍스처로 갖는 정육면체를 생성했고, <code class=\"language-text\">lineSegments</code>로 선도 따줬습니다.</p>\n<p>이제 렌더함수에서 :</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">private</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>time<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderer<span class=\"token punctuation\">.</span><span class=\"token function\">setRenderTarget</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderTarget<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rtScene<span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rtCamera<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderer<span class=\"token punctuation\">.</span><span class=\"token function\">setRenderTarget</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>camera<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>먼저 업데이트함수를 호출하고,</p>\n<ol>\n<li>렌더러 타겟을 RenderTarget으로 설정하고 렌더링.</li>\n<li>렌더러 타겟을 다시 null로 설정하여 기본 장면을 대상으로 설정.</li>\n<li>이제 기본 장면을 렌더링.</li>\n</ol>\n<p>그럼 업데이트함수는 :</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">private</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>time<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    time <span class=\"token operator\">*=</span> <span class=\"token number\">0.001</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ms -> s</span>\n    <span class=\"token keyword\">const</span> ball <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rtScene<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token function\">getObjectByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ballSystem\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>Object3D<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ball<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      ball<span class=\"token punctuation\">.</span>rotation<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>time <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">*</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 <code class=\"language-text\">rtScene</code>에서 ball을 찾아와서 업데이트해줘야 합니다.</p>\n<p><img src=\"https://github.com/sungpaks/sungpaks.github.io/blob/master/content/blog/til/how-to-threejs-5/render-target-ex.gif?raw=true\" alt=\"렌더 타겟 예제\"></p>\n<p>이렇게 됐습니다.<br>\n정육면체의 텍스처로써 렌더 타겟을 렌더링하여,<br>\n마치 각 면에 렌더 타겟의 세상을 가둔 듯이.. 됐네요</p>\n<p>이 렌더 타겟은 활용이 많은데<br>\n그림자, 피킹, 후처리 등등에 사용처가 있고<br>\n차의 백미러나 모니터 화면 등을 표현할 때 요긴하게 쓰이겠습니다</p>\n<p>그럼 피킹에 어떻게 렌더 타겟을 사용하는지 보기 위해, 피킹에 대해 알아보겠습니다</p>\n<h1 id=\"피킹-picking\" style=\"position:relative;\"><a href=\"#%ED%94%BC%ED%82%B9-picking\" aria-label=\"피킹 picking permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>피킹 Picking</h1>\n<p><a href=\"https://threejs.org/manual/#ko/picking\">picking</a>이란:<br>\n사용자가 클릭 또는 터치한 물체를 가려내는 작업입니다. onclick에서 어떤 물체가 선택되었는지 판단하는거죠<br>\n피킹 구현 방법은 수없이 많고, 각자 장단점이 있습니다<br>\n여기서는, 공식문서에 소개된, 주로 사용되는 두 가지 방법을 살펴보려고 합니다</p>\n<h2 id=\"ray-casting--광선-투사\" style=\"position:relative;\"><a href=\"#ray-casting--%EA%B4%91%EC%84%A0-%ED%88%AC%EC%82%AC\" aria-label=\"ray casting  광선 투사 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ray casting : 광선 투사</h2>\n<p>포인터에서 장면의 절두체로 광선을 쏴 광선이 닿는 물체를 감지하는 기법인데<br>\n이론적으로 가장 간단한 방법입니다</p>\n<p>이 경우 먼저 포인터의 좌표를 구하고, 이 좌표를 카메라의 시선과 방향에 따라 3D좌표로 변환합니다.<br>\n그리고 near ~ far 절단면까지 쭉 직선(광선)을 구해 이 직선이 장면 내 각 물체의 삼각형과 교차하는지 확인합니다.</p>\n<p>이러면 만약 어떤 물체가 1000개의 삼각형을 가진 복잡한 물체가 1000개 존재하면 백만개의 삼각형을 모두 확인해야 하겠네요..<br>\n그래서 이를 최적화하기 위해, 물체의 경계 좌표가 광선과 교차하는지 확인하고 교차하지 않는다면 그 물체의 삼각형을 확인하지 않는 방식을 생각할 수 있습니다.<br>\nThree.js는 이와 같은 작업을 <strong>RayCater</strong> 클래스가 알아서 해줍니다.</p>\n<p>그럼 이제 레이 캐스팅으로 피킹을 해봅시다<br>\n먼저 공식문서대로 <code class=\"language-text\">PickHelper</code>라는 클래스를 먼저 작성해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">THREE</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"three\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PickHelper</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> raycaster<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>Raycaster<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">private</span> pickedObject<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>Object3D<span class=\"token operator\">&lt;</span><span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>Object3DEventMap<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">private</span> pickedObjectSavedColor<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>raycaster <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Raycaster</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">pick</span><span class=\"token punctuation\">(</span>\n    normalizedPosition<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>Vector2<span class=\"token punctuation\">,</span>\n    scene<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>Scene<span class=\"token punctuation\">,</span>\n    camera<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>Camera<span class=\"token punctuation\">,</span>\n    time<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 이미 다른 물체가 피킹된 경우 색을 복원</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject <span class=\"token operator\">&amp;&amp;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span>Mesh <span class=\"token operator\">&amp;&amp;</span>\n      <span class=\"token function\">isMeshStandardMaterial</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject<span class=\"token punctuation\">.</span>material<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject<span class=\"token punctuation\">.</span>material<span class=\"token punctuation\">.</span>emissive<span class=\"token punctuation\">.</span><span class=\"token function\">setHex</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObjectSavedColor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//절두체로 광선을 쏘자</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>raycaster<span class=\"token punctuation\">.</span><span class=\"token function\">setFromCamera</span><span class=\"token punctuation\">(</span>normalizedPosition<span class=\"token punctuation\">,</span> camera<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//그 광선과 교차하는 물체들을 배열로 반환받자</span>\n    <span class=\"token keyword\">const</span> intersectedObjects <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>raycaster<span class=\"token punctuation\">.</span><span class=\"token function\">intersectObjects</span><span class=\"token punctuation\">(</span>scene<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject <span class=\"token operator\">&amp;&amp;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span>Mesh <span class=\"token operator\">&amp;&amp;</span>\n      <span class=\"token function\">isMeshStandardMaterial</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject<span class=\"token punctuation\">.</span>material<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObjectSavedColor <span class=\"token operator\">=</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject<span class=\"token punctuation\">.</span>material<span class=\"token punctuation\">.</span>emissive<span class=\"token punctuation\">.</span><span class=\"token function\">getHex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 원본 색상을 저장해두고</span>\n\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject<span class=\"token punctuation\">.</span>material<span class=\"token punctuation\">.</span>emissive<span class=\"token punctuation\">.</span><span class=\"token function\">setHex</span><span class=\"token punctuation\">(</span>\n        <span class=\"token comment\">// 빛나게 만들기</span>\n        <span class=\"token punctuation\">(</span>time <span class=\"token operator\">*</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">2</span> <span class=\"token operator\">></span> <span class=\"token number\">1</span> <span class=\"token operator\">?</span> <span class=\"token number\">0x000000</span> <span class=\"token operator\">:</span> <span class=\"token number\">0xffffff</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">isMeshStandardMaterial</span><span class=\"token punctuation\">(</span>\n  material<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>Material\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> material <span class=\"token keyword\">is</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>MeshStandardMaterial <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>material <span class=\"token keyword\">as</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>MeshStandardMaterial<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>emissive <span class=\"token operator\">!==</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 다시 원래 있던 메인 클래스로 돌아갑시다.<br>\n먼저 <code class=\"language-text\">new PickHelper()</code>로 인스턴스를 만들어두고<br>\n다음과 같은 메서드들을 작성합시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">private</span> <span class=\"token function\">getCanvasRelativePosition</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> MouseEvent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> rect <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>domApp<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      x<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>clientX <span class=\"token operator\">-</span> rect<span class=\"token punctuation\">.</span>left<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>domApp<span class=\"token punctuation\">.</span>offsetWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> rect<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span>\n      y<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>clientY <span class=\"token operator\">-</span> rect<span class=\"token punctuation\">.</span>top<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>domApp<span class=\"token punctuation\">.</span>offsetHeight<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> rect<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">clearPickPosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickPosition<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">100000</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickPosition<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">100000</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">setPickPosition</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> MouseEvent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> pos <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getCanvasRelativePosition</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickPosition<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>pos<span class=\"token punctuation\">.</span>x <span class=\"token operator\">/</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>domApp<span class=\"token punctuation\">.</span>offsetWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickPosition<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>pos<span class=\"token punctuation\">.</span>y <span class=\"token operator\">/</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>domApp<span class=\"token punctuation\">.</span>offsetHeight<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token operator\">-</span><span class=\"token number\">2</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">getCanvasRelativePosition</code>은 클릭한 좌표가 캔버스(저같은 경우는 <code class=\"language-text\">domApp</code> div) 내에서의 위치가 어디인지 계산합니다.</li>\n<li><code class=\"language-text\">clearPickPosition</code>은 마우스가 캔버스 밖으로 나가는 등의 경우에 대해 임시 초기화를 위한 메서드입니다.</li>\n<li><code class=\"language-text\">setPickPosition</code>에서 클릭한 (캔버스 상대)위치를 정규화합니다 => NDC(Normalized Device Coord.)로 변환</li>\n</ul>\n<p>여기서 잠깐, 저는 <code class=\"language-text\">setPickPosition</code>에서</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickPosition<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>pos<span class=\"token punctuation\">.</span>x <span class=\"token operator\">/</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>domApp<span class=\"token punctuation\">.</span>offsetWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickPosition<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>pos<span class=\"token punctuation\">.</span>y <span class=\"token operator\">/</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>domApp<span class=\"token punctuation\">.</span>offsetHeight<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token operator\">-</span><span class=\"token number\">2</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이렇게 써둔게 이해가 바로 가지 않았는데요<br>\nNormalized Device Coord.가 뭔지 알아봐야겠습니다</p>\n<h3 id=\"ndc-normalized-device-coordinates로-변환\" style=\"position:relative;\"><a href=\"#ndc-normalized-device-coordinates%EB%A1%9C-%EB%B3%80%ED%99%98\" aria-label=\"ndc normalized device coordinates로 변환 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NDC (Normalized Device Coordinates)로 변환</h3>\n<p>캔버스(domApp)의 너비와 높이는 가변적이므로, 클릭한 위치도 가변적입니다.<br>\n이를 장치에 무관하게 정규화한 좌표를 Normalized Device Coordinates라고 합니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/61f937779cff21a3dd5f822d934db6e2/d4b10/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA1klEQVR42q1QMQ7CMAzs/yf+wsbYjRcgdaEDA0JCIk2bpLGTww6CoaESAixVSWPf+e4afFlEBGNM9d6klFZBMUas9XPOCCHIuSB0zoGZy8bEJHcq93meMQxDAa6VzlQKlUxBxAl2ZriYiip9y3qqSlmaBKyKWeakgdMtYtdZGE/ln4RH+2JZFWT0V49tF9D2DoN7bH6SZXUhnx1HAREyR7THCZv9hMN5kkGG96Fk+spQnZGQc0aVC97Y9uKku7gqkmL501qCSRxUGeKHUvt/I1Rn1tqK8A5RlMbAVEjV3QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"NDC\"\n        title=\"\"\n        src=\"/static/61f937779cff21a3dd5f822d934db6e2/f058b/image.png\"\n        srcset=\"/static/61f937779cff21a3dd5f822d934db6e2/c26ae/image.png 158w,\n/static/61f937779cff21a3dd5f822d934db6e2/6bdcf/image.png 315w,\n/static/61f937779cff21a3dd5f822d934db6e2/f058b/image.png 630w,\n/static/61f937779cff21a3dd5f822d934db6e2/40601/image.png 945w,\n/static/61f937779cff21a3dd5f822d934db6e2/78612/image.png 1260w,\n/static/61f937779cff21a3dd5f822d934db6e2/d4b10/image.png 1394w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>오른쪽같은, 범위가 <code class=\"language-text\">[-1, 1]</code>로 제한되는 데카르트좌표계로 옮긴다고 생각하면 될 듯 합니다\n그러려면 일단.. 0<del>w를 0</del>1까지 줄이고 => <code class=\"language-text\">pos.x / w</code>\n0<del>1을 0</del>2로 만들고 => <code class=\"language-text\">(pos.x/w)*2</code>\n0~2를 -1 ~ 1로 만들고 => <code class=\"language-text\">(pos.x/w)*2-1</code> => NDC 완성!!\ny축은 똑같이하지만, y축 양수 방향이 반대니까, <code class=\"language-text\">(pos.y/h) * -2 + 1</code> 이렇게 부호를 뒤집으면 됩니다.</p>\n<p>왜 NDC를 사용해야 할까요?</p>\n<ul>\n<li>말했듯이 화면상의 픽셀 좌표는 해상도나 캔버스 크기에 따라 달라질건데, NDC는 정규화하여 범위를 고정했으니 여러 디바이스에서 일관된 동작</li>\n<li>렌더링 파이프라인에서 WebGL과 같은 저수준 그래픽 API는 NDC를 사용해줘야 함</li>\n</ul>\n<p>아무튼 이렇게 하고 이벤트리스너를 등록하면 :</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\">window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mousemove\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setPickPosition</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mouseout\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">clearPickPosition</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mouseleave\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">clearPickPosition</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>그리고 마지막으로, 렌더 함수에서 PickHelper의 pick메서드를 호출하면 :</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">private</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>time<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    time <span class=\"token operator\">*=</span> <span class=\"token number\">0.001</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ms -> s</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickHelper<span class=\"token punctuation\">.</span><span class=\"token function\">pick</span><span class=\"token punctuation\">(</span>\n      <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Vector2</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickPosition<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickPosition<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">,</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>camera<span class=\"token operator\">!</span><span class=\"token punctuation\">,</span>\n      time\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>camera<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 여기서 공식문서에는 없는, 추가 동작으로 click해서 없어지게까지 한다면!!</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">click</span><span class=\"token punctuation\">(</span>scene<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>Scene<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject <span class=\"token operator\">&amp;&amp;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span>Mesh <span class=\"token operator\">&amp;&amp;</span>\n      <span class=\"token function\">isMeshStandardMaterial</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject<span class=\"token punctuation\">.</span>material<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject<span class=\"token operator\">?.</span>geometry<span class=\"token punctuation\">.</span><span class=\"token function\">dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject<span class=\"token operator\">?.</span>material<span class=\"token punctuation\">.</span><span class=\"token function\">dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      scene<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>주의 : 장면에서 어떤 물체를 제거할 때는 <code class=\"language-text\">geometry</code>와 <code class=\"language-text\">material</code>을 모두 <code class=\"language-text\">dispose</code>로 해제해줘야 합니다.</p>\n<p>결과</p>\n<iframe src=\"https://codesandbox.io/embed/qgjv7v?view=preview&module=%2Fsrc%2Fmain.ts\"\n     style=\"width:100%; height: 500px; border:0; border-radius: 4px; overflow:hidden;\"\n     title=\"sad-goldberg-qgjv7v\"\n     allow=\"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking\"\n     sandbox=\"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts\"\n   ></iframe>\n<p>근데 이 레이 캐스팅은 몇 가지 문제점이 있는데요</p>\n<ul>\n<li>CPU의 자원을 사용한다는 점.\n<ul>\n<li>자바스크립트 엔진은 각 요소를 돌며 광선이 요소의 경계 좌표 안에 교차하는지 확인해야 함.</li>\n<li>일단 교차하는 지점을 정확히 알고 이를 넘겨받을 수 있다는 점은 장점이다. 교차점에 특정 표시를 한다거나 이런게 가능</li>\n<li>대신 CPU가 많은 일을 해야한다는 것.. 요소가 가진 삼각형이 많을 수록 더 그렇겠다.</li>\n</ul>\n</li>\n<li>특이한 방식의 쉐이더나 변이를 감지하지 못함\n<ul>\n<li>Scene에서 Geometry를 변형하는 쉐이더가 사용된 경우, 자바스크립트는 이 변형을 감지하지 못함..</li>\n</ul>\n</li>\n<li>요소의 투명한 구멍을 처리하지 못함. 예를 들어 : 투명한 부분이 있는 텍스처를 적용하면</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/950020e6078490b1cb0d2fb72a212dab/7a4b2/image-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.41772151898735%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEMklEQVR42jWOaUyTBwCGv2W/th8mm0sWf8ws2eJchhqvSRwyHejMmEBqBbQcUqBcWspVKbS1rAe0UFpaekBrUQ45lUOgIOIB81pUPEC3aSa6QWI2mNmVbc49Y0v2/HqT90neV9iiklKhSuZoV4DR/qt41e10N5xHU3mMjHoXG5SlhOdXMHrjO05X5iM6/AbirBCWtaxgW3ccjaEmdMZh3j6+nSWHZAhppYcp2iciOT6F9gY309e+YqD3IiNjl3GcHWZVcTHyI/WYfOfwGGp5be8SXl7/EstzV7C0OwRxspgweQprqqII0TYiqLRq9PsTMBYdYLS1nn+58e0cMV1+1nuqiTdpMFTr8LY0M6QrxqBIJzJpFcmr17Jl+w6WeTYhnFhObIEExU4Vwq6IAAVZHeSlWuk7PsZPf/xJxfVRLIN9rNXJeUWVQZrVwKVBB1c6bEzaamhR5hG43YbYnMSbhat5L/8DlvrWEOGKRSgrucgPC8/QKG8g3T9CZk8HymE/Cz8vMH5nijDVASKb7Jx9eIenC78w13Ob36bnmXp6k7oHDj7tTGR91gY2J25DyHkVoaDgIt8/mcamchJeV4XC6+HR7BN212up7u4l4qiZnEYr0UMBMgfq8LQp0OjFpBTuwJKVy0FNFZJTcYQpk9FWdiJ4bIOYD67igCSJFKObd/WlJJgKyHdW8XpJGk1BJ6ltJl4wS9mkjUGZvgddaQZlLjGS5kgSFR/RPNiOrKqJbH8Qwe5PoMMaQ1uXkhp9Irss2YTbivjYUYL/dAeGoJ+VAS2Otm62WZRYV7opiUqm1BZHQ8CEr7mW8qZ+LNfG6b57E0Gvfh+bV8WV6wNoesykaz4kzJuOtLWKpAE/6xoquD/1kDN9U6zT7cehrkeeKUNkFxHwn2Bmfpa7j2ZouTPO7K8/IjSeMmGxp9E/4mNh9hYlphiyHGp2Dth50ZSA3XGIQUMLsXobcmkAk7WFsc7L1N4fZhonlyZ7UKgdiGwuEk66EQw9Os5MtnN5cgJXfSqSPBnlXffJqc9azJGLopLwot3skx2n2nuPz6/O8/w53Lo3w9w3Os4Pl1PpzCBucTC+wIPQPNzA9NU+3GNf03CyihKDCIVdhr81k8FTVvw+BXcX+8nb84x8McvEhcc06ydod53HllONq2yIsxM+lMXVFMrqEKaGHvPo0hyG8n7MPeeQ1xSSmbealqNG3K5O0g9FMX7tAv9za/wxdQcn8FcEOZzqRxt1hGNF2WwOlVJkOoLglrfRbxzDp+6l8/oM7cFWkiURxCq2kpglJUWyB3edm9+fPeP5339xc+IBRrUO0boMPLllyDcmIntLwb53xERHpyAM9wTxaArpdfbiCZ5ms9iMN9+CMTuUYlE8pdG5BIy1/72be/IlPmct8u01iDZspU23EUduCIboCGpCM/jsEw3/APEhFHY/Ee1eAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"투명 텍스처를 적용한 결과\"\n        title=\"\"\n        src=\"/static/950020e6078490b1cb0d2fb72a212dab/f058b/image-2.png\"\n        srcset=\"/static/950020e6078490b1cb0d2fb72a212dab/c26ae/image-2.png 158w,\n/static/950020e6078490b1cb0d2fb72a212dab/6bdcf/image-2.png 315w,\n/static/950020e6078490b1cb0d2fb72a212dab/f058b/image-2.png 630w,\n/static/950020e6078490b1cb0d2fb72a212dab/40601/image-2.png 945w,\n/static/950020e6078490b1cb0d2fb72a212dab/7a4b2/image-2.png 1240w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이렇게 될텐데요, 이렇게 일부가 투명한 경우 이를 뚫고 뒤에 있는 물체를 선택할 수 없습니다.<br>\nGeometry를 기반으로 피킹을 연산하므로, 그게 실제로 투명하든 아니든, Geometry는 그곳에 존재하기 때문입니다</p>\n<p>따라서 이런 경우 GPU 기반 피킹을 구현해야 하고, 이 때 <strong>렌더 타겟</strong>을 사용해볼 수 있습니다.</p>\n<h2 id=\"gpu-기반-피킹\" style=\"position:relative;\"><a href=\"#gpu-%EA%B8%B0%EB%B0%98-%ED%94%BC%ED%82%B9\" aria-label=\"gpu 기반 피킹 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GPU 기반 피킹</h2>\n<p>GPU 피킹을 구현하려면 각 요소를 별도의 화면에서 한번 더 렌더링하되, 고유한 색상(id로 사용)을 갖게 해야 합니다.<br>\n=> <strong>Render Target</strong>을 이용하는 것인데요<br>\n그럼 피킹할 때는 <strong>포인터 아래에 있는 픽셀의 색</strong>을 가져와 그 해당 색상값에 대응하는 물체가 선택됨을 알 수 있습니다.</p>\n<p>이러면 위에서 말한 2,3번(변형에 대응 못하고, 투명에 대응 못하고)을 해결할 수는 있는데,<br>\n피킹을 위한 렌더 타겟을 하나 더 덧대는거니까 렌더링이 2배가 되는 셈이긴 합니다.</p>\n<p>이 때 성능 최적화를 위해 사용 가능한 방법이 있는데<br>\n어차피 한 픽셀만 읽을거니까, 카메라를 픽셀 하나만 렌더링하도록 설정해줄 수 있겠습니다.<br>\nThree.js에서는 <code class=\"language-text\">PerspectiveCamera.setViewOffset</code> 으로 카메라의 특정 부분만 렌더링하도록 할 수 있어요</p>\n<p>이를 구현해보기 위해 장면 하나 더 추가해봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickingScene <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Scene</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickingScene<span class=\"token punctuation\">.</span>background <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Color</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>그리고 이제 각 큐브 생성에서, <code class=\"language-text\">pickingScene</code>의 같은 위치에 <strong>피킹용 정육면체</strong>를 추가해줍시다.<br>\n이 피킹용 정육면체에는 id로 쓸 고유 색상값을 지정하고, 이 id 색상값으로 재질을 만들어 추가할겁니다.<br>\n나중에 id색상값을 키값으로 매핑하여 이에 상응하는 정육면체를 바로 불러올 수 있겠어요</p>\n<p>먼저 <code class=\"language-text\">this.objects</code> 객체를 추가하고\n<code class=\"language-text\">private objects: Record&lt;string, THREE.Mesh> = {};</code></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">getNewBox</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>번호를 넘겨주세요. 박스 만들 때\n이제 <code class=\"language-text\">getNewBox</code>함수는</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">getNewBox</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token operator\">...</span> <span class=\"token comment\">// 이전 box생성코드</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> cube<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> pickingMaterial <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">MeshPhongMaterial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        emissive<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Color</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setHex</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>NoColorSpace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        color<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Color</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        specular<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Color</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        map<span class=\"token operator\">:</span> texture<span class=\"token punctuation\">,</span>\n        transparent<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        side<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>DoubleSide<span class=\"token punctuation\">,</span>\n        alphaTest<span class=\"token operator\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n        blending<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>NoBlending\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> pickingCube <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Mesh</span><span class=\"token punctuation\">(</span>geometry<span class=\"token punctuation\">,</span> pickingMaterial<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickingScene<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>pickingCube<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    pickingCube<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span><span class=\"token function\">copy</span><span class=\"token punctuation\">(</span>cube<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    pickingCube<span class=\"token punctuation\">.</span>rotation<span class=\"token punctuation\">.</span><span class=\"token function\">copy</span><span class=\"token punctuation\">(</span>cube<span class=\"token punctuation\">.</span>rotation<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    pickingCube<span class=\"token punctuation\">.</span>scale<span class=\"token punctuation\">.</span><span class=\"token function\">copy</span><span class=\"token punctuation\">(</span>cube<span class=\"token punctuation\">.</span>scale<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 id와 큐브 쌍을 저장해주고, pickingMaterial을 따로 만들어줍시다.</p>\n<p>이 때 <code class=\"language-text\">MeshPhongMaterial</code>로 편법을 쓴 셈인데</p>\n<ul>\n<li><code class=\"language-text\">emissive</code> 속성을 id색상값으로, <code class=\"language-text\">color</code>와 <code class=\"language-text\">specular</code>를 0으로 설정하면 => 텍스처의 <code class=\"language-text\">alphaTest</code>보다 큰 부분만 id색상값으로 표현됨</li>\n<li>그리고 <code class=\"language-text\">blending</code> 속성을 <code class=\"language-text\">THREE.NoBlending</code>으로 설정하여 id 색상값이 알파값의 영향을 받지 않도록</li>\n</ul>\n<p>그래도 최적은 아니긴합니다.. 여전히 조명 관련 연산이 실행될거다\n더 최적화하려면 <code class=\"language-text\">alphaTest</code>보다 높은 경우에 대해서만 id 색상을 렌더링하는 쉐이더를 손수 만들어버려야 한다고 하네요</p>\n<p>이제 이 방법으로는 광선 투사법때와 달리 픽셀을 하나(마우스 커서가 위치하는 딱 그 픽셀)만 사용하게 되므로, 위치값이 픽셀 하나만 가리키게 변경됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">function setPickPosition(event) {\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span> const pos = getCanvasRelativePosition(event);\n</span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span>  pickPosition.x = (pos.x / canvas.clientWidth ) *  2 - 1;\n<span class=\"token prefix deleted\">-</span>  pickPosition.y = (pos.y / canvas.clientHeight) * -2 + 1;  // Y 축을 뒤집었음\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span>  pickPosition.x = pos.x;\n<span class=\"token prefix inserted\">+</span>  pickPosition.y = pos.y;\n</span>}</code></pre></div>\n<p>이제 <code class=\"language-text\">PickerHelper</code>클래스도 <code class=\"language-text\">GPUPickHelper</code>로 변경됩니다.\n<code class=\"language-text\">WebGLRenderTarget</code>으로 구현하되, 이 렌더 타겟의 크기는 단 1픽셀로.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">GPUPickHelper</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> pickingTexture <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">THREE</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">WebGLRenderTarget</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">private</span> pixelBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>1픽셀의 렌더 타겟을 생성하고, rgb값을 담을 수 있는 길이 4짜리 Uint8Array버퍼를 생성해줍니다.</p>\n<p>이제 <code class=\"language-text\">pick</code> 메서드를 수정할건데</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">GPUPickHelper</span> <span class=\"token punctuation\">{</span>\n<span class=\"token function\">pick</span><span class=\"token punctuation\">(</span>\n    cssPosition<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>Vector2<span class=\"token punctuation\">,</span>\n    scene<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>Scene<span class=\"token punctuation\">,</span>\n    camera<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>PerspectiveCamera<span class=\"token punctuation\">,</span>\n    time<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>\n    renderer<span class=\"token operator\">:</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>WebGLRenderer<span class=\"token punctuation\">,</span>\n    idToObject<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">THREE</span><span class=\"token punctuation\">.</span>Mesh<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 이미 다른 물체가 피킹된 경우 색을 복원 - 그대로</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>먼저 인자를 좀 추가합니다.\n<code class=\"language-text\">normalizedPosition</code>은 이제 NDC가 아니니까 <code class=\"language-text\">cssPosition</code>으로 이름을 변경하고,\n<code class=\"language-text\">renderer</code>와 <code class=\"language-text\">idToObject</code>까지 넘겨받아줍니다.</p>\n<p>\"이미 다른 물체가 피킹된 경우 색을 복원\"은 그대로 두고</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\">\t<span class=\"token comment\">// pick 메서드</span>\n\t<span class=\"token operator\">...</span>\n\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> pickingTexture<span class=\"token punctuation\">,</span> pixelBuffer <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> pixelRatio <span class=\"token operator\">=</span> renderer<span class=\"token punctuation\">.</span><span class=\"token function\">getPixelRatio</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    camera<span class=\"token punctuation\">.</span><span class=\"token function\">setViewOffset</span><span class=\"token punctuation\">(</span>\n      renderer<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>drawingBufferWidth<span class=\"token punctuation\">,</span> <span class=\"token comment\">//전체 너비</span>\n      renderer<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>drawingBufferHeight<span class=\"token punctuation\">,</span> <span class=\"token comment\">//전체 높이</span>\n      <span class=\"token punctuation\">(</span>cssPosition<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> pixelRatio<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//사각 x좌표</span>\n      <span class=\"token punctuation\">(</span>cssPosition<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> pixelRatio<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//사각 y좌표</span>\n      <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//사각 좌표 width</span>\n      <span class=\"token number\">1</span> <span class=\"token comment\">//사각 좌표 height</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    renderer<span class=\"token punctuation\">.</span><span class=\"token function\">setRenderTarget</span><span class=\"token punctuation\">(</span>pickingTexture<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    renderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>scene<span class=\"token punctuation\">,</span> camera<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//1픽셀만큼만 렌더타겟을 렌더링</span>\n    renderer<span class=\"token punctuation\">.</span><span class=\"token function\">setRenderTarget</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 렌더링 대상을 다시 돌려놓고</span>\n    camera<span class=\"token punctuation\">.</span><span class=\"token function\">clearViewOffset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ViewOffset도 다시 돌려놓고</span>\n\n\t<span class=\"token comment\">// 렌더 타겟으로부터 픽셀 데이터를 읽어 버퍼(6번째 인자로 준)에 집어넣어준다</span>\n    renderer<span class=\"token punctuation\">.</span><span class=\"token function\">readRenderTargetPixels</span><span class=\"token punctuation\">(</span>\n      pickingTexture<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 읽을 렌더 타겟</span>\n      <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//x</span>\n      <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//y</span>\n      <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//width</span>\n      <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//height</span>\n      pixelBuffer <span class=\"token comment\">//여기에 넣어주세요</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>pixelBuffer<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span>pixelBuffer<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> pixelBuffer<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> intersectedObject <span class=\"token operator\">=</span> idToObject<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>intersectedObject<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pickedObject <span class=\"token operator\">=</span> intersectedObject<span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// 피킹한 오브젝트의 기존 색을 저장하고, 빛나게 만들기는 그대로</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">PerspectiveCamera.setViewOffset</code>은 ..\n<code class=\"language-text\">fullWidth, fullHeight, x, y, widht, height</code>을 받는데\nfullWidth, fullHeight 중에, x, y 위치에 width, height 크기로 서브카메라를 둔다는 뜻.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/264567e96b797717e6da7cbab1a24603/9cab2/image-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.56962025316456%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAACc0lEQVR42o1Ua3OaUBD1//+M/IR+6UzTaTXJOCYNUp8RjAYfaRtLEAGB+4DTvRc0MdBMduZ4B9x72D37aHDOkQPI8vyIXJ1ZBkb/xUmCB8eBQ5jNZphMJuj3+/pUPm+toQhfW05OmRR0SnrI9TvJGdIkRhrvNfZRAN/39YcrhIKc7395aI0f0bH/4GK4QLP3gMvhElejFWGJ9t0K15M1flhrdO01xs5vCCmLACoRpjGa/QfczF2MVh6Gax+jxx16i2cMlh76CxdDwmjpYkywH118ao/x14/qCVUq7Z4NJgo9VBpCcEjBK+nk5W97OIMXpchJmkrKgb/FpTlBlHISWepCBEGAMIyOTodiSa1Zhs7IQZBIrbMqTF4WUqHhPbtoGWNECdOXt9stzs7OYBgG4jjW5G8jvLlbIEwzTShLLU+KcvXTRpwWKaqqm6aJbreLNE1PCA+0t9YSISskCsMQruvqqitfahuGi1eEyna7nXastxxda4WIyaOv6tH5fI7NZlP0Yct8IVQyHfQ4FOktoWkvsdeEOWUkqo3dNE8jfN8owomDfSqOEp0UhTOG710iZB8lBG6G9wgTXkZ4eq/BSPhvhoWEiw/EVlinbyOImR7RSpVTao1zY1qmUGqXl9fz7AXUf9SN+rweWPCjmAhlzaTQsF/S/F4MHErdInJLPzd7M3w17CPOCV9uLbQGC3y+voMf1HeB1lClnTBBOhZQUxMlBcISgULM4e85tuFeb6V6wrJKgvNivxV9U1FPEUhRalaztir7UJFKusTpkiB4NIJPTxvCE01AqD+m57Zmw7y/YMuvq66fTqd6M3ue958mrxL+A0JPuuIfWkNlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"setViewOffset\"\n        title=\"\"\n        src=\"/static/264567e96b797717e6da7cbab1a24603/f058b/image-3.png\"\n        srcset=\"/static/264567e96b797717e6da7cbab1a24603/c26ae/image-3.png 158w,\n/static/264567e96b797717e6da7cbab1a24603/6bdcf/image-3.png 315w,\n/static/264567e96b797717e6da7cbab1a24603/f058b/image-3.png 630w,\n/static/264567e96b797717e6da7cbab1a24603/9cab2/image-3.png 864w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이렇게 PerspectiveCamera가 렌더링할 부분을 제한해버리고, 해당 장면을 렌더링합니다.</p>\n<p>그런 다음, 이 1픽셀짜리 렌더 타겟(<code class=\"language-text\">pickingTexture</code>)으로부터 픽셀을 감지하기 위해 renderer.readRenderTargetPixels()<br>\n=> 렌더 타겟으로부터 픽셀을 읽고 이를 버퍼(6번째 인자로 전달한 버퍼)에 넣어줍니다.</p>\n<p>그럼 이제 버퍼에는 <code class=\"language-text\">[r,g,b]</code>값이 들어있을것이고 => 비트연산을 활용하여 이를 id값으로 가져오면 :<br>\n그럼 이제 <code class=\"language-text\">idToObject[id]</code>가 교차한 오브젝트 (<code class=\"language-text\">intersectedObject</code>)입니다.</p>\n<iframe src=\"https://codesandbox.io/embed/phr7fy?view=preview&hidenavigation=1\"\n     style=\"width:100%; height: 500px; border:0; border-radius: 4px; overflow:hidden;\"\n     title=\"damp-worker-phr7fy\"\n     allow=\"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking\"\n     sandbox=\"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts\"\n   ></iframe>\n<p>요약하자면 아래와 같겠네요</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/78333be1d3a46908eea718a89a28df0c/d4b10/image-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.93670886075949%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6UlEQVR42pVS2Q6EIAzk/7/RmBj1xfuIBwh0ma4lxmiyW1OxtgzToYqCee/Zl2WhLMsoz3NqmobmeSbJr+tKSZJwDmtZltT3PbtzjsQUXsdxsFtrads22vediwCEf1rreChi1CIv38gLhkKRBE9mjGG/xgDC2nUdtW3L6ziO3BEzFDZPhs10plAnnbyZmqaJ6rqOp1yLfQDQgYnzjl0bHfUSCe6uiqJgzaCdiHzuCCBBswDkz8d6+9pJZFhVVQxwk8MwMDiEFiZigHb0J6CMAVr3N4CfANM05ZvC3GG2wDBqRN+WRcNfWv4A6sPDC7oXXjsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"렌더 타겟을 이용한 GPU피킹 요약\"\n        title=\"\"\n        src=\"/static/78333be1d3a46908eea718a89a28df0c/f058b/image-4.png\"\n        srcset=\"/static/78333be1d3a46908eea718a89a28df0c/c26ae/image-4.png 158w,\n/static/78333be1d3a46908eea718a89a28df0c/6bdcf/image-4.png 315w,\n/static/78333be1d3a46908eea718a89a28df0c/f058b/image-4.png 630w,\n/static/78333be1d3a46908eea718a89a28df0c/40601/image-4.png 945w,\n/static/78333be1d3a46908eea718a89a28df0c/78612/image-4.png 1260w,\n/static/78333be1d3a46908eea718a89a28df0c/d4b10/image-4.png 1394w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<hr>\n<p>급하게 나가야해서 이만 마칩니다</p>","frontmatter":{"title":"Three.js 공식문서로 시작해보기. - 5","date":"December 01, 2024","description":"Render Target과 Picking","tag":["TIL","Three.js"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#render-target\">Render Target</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%94%BC%ED%82%B9-picking\">피킹 Picking</a></p>\n<ul>\n<li>\n<p><a href=\"#ray-casting--%EA%B4%91%EC%84%A0-%ED%88%AC%EC%82%AC\">ray casting : 광선 투사</a></p>\n<ul>\n<li><a href=\"#ndc-normalized-device-coordinates%EB%A1%9C-%EB%B3%80%ED%99%98\">NDC (Normalized Device Coordinates)로 변환</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gpu-%EA%B8%B0%EB%B0%98-%ED%94%BC%ED%82%B9\">GPU 기반 피킹</a></p>\n</li>\n</ul>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/what-and-why-and-how-bundler/"},"frontmatter":{"title":"🎁 면접관께서 가로되, 번들러가 무엇이냐 물으니"}},"next":null},"pageContext":{"id":"77bc3fa2-909c-5f3a-bb6c-f0eacf4500f1","previousPostId":"3c50b37c-f75d-5a81-aad3-a6c09af067f7","nextPostId":null}},"staticQueryHashes":["2841359383"],"slicesMap":{}}