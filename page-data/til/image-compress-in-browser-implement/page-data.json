{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/til/image-compress-in-browser-implement/","result":{"data":{"site":{"siteMetadata":{"title":"조성개발실록"}},"markdownRemark":{"id":"05f4f31c-ad46-5899-9304-fff3db43b120","excerpt":"! 주의 : TIL…","html":"<blockquote>\n<p>! 주의 : TIL 게시글입니다. 다듬지 않고 올리거나 기록을 통째로 복붙했을 수 있는 뒷고기 포스팅입니다.</p>\n</blockquote>\n<p>혹시나 이미지 압축 그냥 긁어다 쓰시려고 들어온 바쁜 분들이라면 <a href=\"#%EC%B5%9C%EC%A2%85%EC%BD%94%EB%93%9C%EC%99%80-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\">최종코드와 사용하기</a>로, 반복 압축이 필요하시면 <a href=\"#%EC%9D%B4%EC%A0%9C-%EB%B0%98%EB%B3%B5%EC%95%95%EC%B6%95%EC%9D%84-%EA%B5%AC%ED%98%84%ED%95%B4%EC%9A%94\">이제 반복 압축을 구현해요</a> 이동하세요</p>\n<p>어느날 에러 로깅 시스템에서 <code class=\"language-text\">413 Content Too Large</code>를 발견했습니다<br>\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status/413\">413 Error</a>는 요청 엔티티의 용량이 서버에서 지정한 것보다 클 때 반환됩니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 233px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4533f8412a7f9259a498e7673f771c05/a1d58/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.40506329113923%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEVUlEQVR42gFKBLX7AJiXolZSXEM1PFhKTCocHyYZHhsWGGBgZlRWYEpHTl1gZWtvd2dja0Q0MysgIVA/OlpJRFlGQlA8Nk89NgCcm6ZcVmA2KzEtIiWFYmGDYmMeFRo1MTdPTlhSUV1qcHpye4NiY2g6KysuISJaRj5WQjpQPDVPOzROOjMAlpOcXlVfKSEoXUdJnXZxkmtpXUFGJx8nSEZQY2Nte4WLf4+Ta29xMyYoMCEhUjw0SjYvRjMrSzgvTToxAJiXn2RcZjIlMIptbaN7d5JraXZXVTApLyssNUdHUmFkbHV9g15eYS4hJC8iI1pKR1xLSUs6NjUjHzgoJQB/foY3LzgvIilzXWaVb3GFX1leR0wwLjciHyYhHiEkHyIoJyoqKCwWEBAoICF6cnp/dX1XSk8WDA4aEREAVlNcQjtGT0NOpJuxvqiwhWlplYqfcWZ+Niw6GhMZFhAUJR4iHhkfFBQSVlNNkIWMkIaGYVlVGBERGBMSAGtmcdHF239zhci/0rawvXltf83E4ZqMpHhrf3ZqexUOFCMcJBYRFy8mKpqRk8TAv8nDvYmHfx4bGwYBBgC5ssHh1Oh/coLZyuGqnrZZTV7Kvte5q8F+coSnlqkpHyUTDRMQDA4uJy+jnKbW0NuyoraPd3psV1xKOUMA29Dk3M3fjH6O4tPlmIqdZFFm08PYvrDGb2N1oI6jOS02HRUgGxMdMig0n6GpoaCthHOCq5eT5M/J6tTSAMq2vsq1vL6qsca0vK2Wnq6WoM24w66ZoXNfbpmCmYlzeMy2qr2pooVre6OIlIGEhYSOicnM1dbX3La2vQDKwsapp6nKxMi1r7S7tbu5s7i0sbW+sbWbipmllKmOfoHMvr2+qqyCY3VXPUNkYWKNl5TIz87Kz9CRmpYAsoCBt46XsJykyLu7ybe3r5ehya22knyDhmh2q4CHfnlvsbS0mZiaXlRRQ0A/WFVpkpGcw8PHpKaqa21wAJ4zLn5YRau5neHfxdbWvYiJfZx+jFk4Pl4kLIM9Ro9pa6mTk5SBgmBERzgsM1ZZZ4qMnqinspqWqFVPbQC6Q0SVYk3Rz6717dXe1LeQhWx4WVaMYFRfPTxHMD9vWG2skZ7d08XKvLiIYm+HZ2OknJaqqbCFiJNYVl0AczM3e0lKkVNQqXl4hlBPWjAwU0FFgFdMaEU6HxodUE1VgnuP08i+4K6K6L2S6bmdzaJ+zKuJrIFubkVAAIqBhjk7PGFjV21jXVxTTD0+Ny4mK2NDPGxORz0uLFpHR2ZMW25gdrp3YPLTqPft0fTlzufOuvbWu9SZgAC4op9VQkEyMjc0ODwpKiwdFho3LC1wXld3X1uWfG+vloKBYlp3V1d3VFmtd2fZtJXw3cbx28P54cPwtZYAm4J7g21gallSWkdDXU1DZFFLfWFjo4eDp4yGn4V9nIZ3h3VmZVBWbFdonoV8r4hsrIVstpCAp3pwhFNJBRLk6w2SL0YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"많이 못 먹어요\"\n        title=\"\"\n        src=\"/static/4533f8412a7f9259a498e7673f771c05/a1d58/image.png\"\n        srcset=\"/static/4533f8412a7f9259a498e7673f771c05/c26ae/image.png 158w,\n/static/4533f8412a7f9259a498e7673f771c05/a1d58/image.png 233w\"\n        sizes=\"(max-width: 233px) 100vw, 233px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>알고보니 유저들이 이미지 등록할 때 그냥 그걸 그대로 받아다 서버에 보내주고 있었습니다<br>\n기존에 서버가 50MB(...)를 최대로 받게 되어 있었는데, 그거마저 넘어버려서 오류가 났던 것인데요,,<br>\n그렇다고 <code class=\"language-text\">\"00MB 이상은 업로드 안되십니다~\"</code> 해버리면 아주 열받을거같아요<br>\n참나.. 특히나 모바일로 하실거면 용량이 얼마나 되는지도 모르고 올릴텐데</p>\n<p>그래서 업로드된 이미지는 압축을 한 번 하고 보내기로 했는데요</p>\n<h1 id=\"이미지-압축-전략-\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%95%95%EC%B6%95-%EC%A0%84%EB%9E%B5-\" aria-label=\"이미지 압축 전략  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이미지 압축 전략 ?</h1>\n<p>근데 그럼 이미지를 압축하려면 뭘 건드리면 좋을까요?</p>\n<h2 id=\"폰으로-찍으면-이미지-크기가-너무-커요\" style=\"position:relative;\"><a href=\"#%ED%8F%B0%EC%9C%BC%EB%A1%9C-%EC%B0%8D%EC%9C%BC%EB%A9%B4-%EC%9D%B4%EB%AF%B8%EC%A7%80-%ED%81%AC%EA%B8%B0%EA%B0%80-%EB%84%88%EB%AC%B4-%EC%BB%A4%EC%9A%94\" aria-label=\"폰으로 찍으면 이미지 크기가 너무 커요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>폰으로 찍으면 이미지 크기가 너무 커요</h2>\n<p>아무거나 하나 사진 찍어서 탐색해봅시다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/945f7e1e87a8bcd1d51a3e80725a6e70/0786c/%EC%B9%A8%EC%B0%A9%EB%A7%A8%ED%8C%A8%EB%93%9C.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 124.0506329113924%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"폰카 이미지 예시\"\n        title=\"\"\n        src=\"/static/945f7e1e87a8bcd1d51a3e80725a6e70/f058b/%EC%B9%A8%EC%B0%A9%EB%A7%A8%ED%8C%A8%EB%93%9C.png\"\n        srcset=\"/static/945f7e1e87a8bcd1d51a3e80725a6e70/c26ae/%EC%B9%A8%EC%B0%A9%EB%A7%A8%ED%8C%A8%EB%93%9C.png 158w,\n/static/945f7e1e87a8bcd1d51a3e80725a6e70/6bdcf/%EC%B9%A8%EC%B0%A9%EB%A7%A8%ED%8C%A8%EB%93%9C.png 315w,\n/static/945f7e1e87a8bcd1d51a3e80725a6e70/f058b/%EC%B9%A8%EC%B0%A9%EB%A7%A8%ED%8C%A8%EB%93%9C.png 630w,\n/static/945f7e1e87a8bcd1d51a3e80725a6e70/0786c/%EC%B9%A8%EC%B0%A9%EB%A7%A8%ED%8C%A8%EB%93%9C.png 663w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>제 마우스패드인데요 ㅋㅋ<br>\n일단 이미지 크기가 너무 큽니다<br>\n데스크탑 모니터라고 하더라도 제 프로젝트같은 경우에는 최대 너비가 1600px을 넘지 않습니다<br>\n게다가 모바일로 이 사진 볼거면 큰 낭비가 따로 없습니다</p>\n<p>실제로 나중에 살펴보겠지만 <a href=\"https://github.com/Donaldcwl/browser-image-compression\">browser-image-compression</a>같은 라이브러리 보면 이미지 사이즈 조절부터 합니다</p>\n<h2 id=\"이미지-포맷---jpeg-png-webp\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%ED%8F%AC%EB%A7%B7---jpeg-png-webp\" aria-label=\"이미지 포맷   jpeg png webp permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이미지 포맷 - JPEG, PNG, WEBP</h2>\n<p>이미지 하면 가장 먼저 떠오르는 포맷은 <code class=\"language-text\">JPEG</code>(<code class=\"language-text\">JPG</code>)와 <code class=\"language-text\">PNG</code>인 것 같아요<br>\n두 개 먼저 알아봅시다.</p>\n<h3 id=\"jpeg-vs-png\" style=\"position:relative;\"><a href=\"#jpeg-vs-png\" aria-label=\"jpeg vs png permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JPEG vs PNG</h3>\n<p>이런 분야에 아주 전문이신 <a href=\"https://www.adobe.com/kr/creativecloud/file-types/image/comparison/jpeg-vs-png.html\">Adobe라는 스타트업의 글</a>을 참고하겠습니다</p>\n<blockquote>\n<p>JPEG는 Joint Photographic Experts Group의 약자로, 디지털 사진을 저장하는 가장 일반적인 형식입니다. JPEG는 압축을 통해 이미지 파일 크기를 줄여 저장하고, 웹 페이지에 쉽게 업로드 할 수 있게 합니다.</p>\n</blockquote>\n<blockquote>\n<p>PNG는 Portable Network Graphics의 약자로, 웹 그래픽, 로고, 차트, 일러스트레이션 등에 사용됩니다. PNG는 압축 가능하지만 JPEG보다는 저장공간을 더 차지합니다. JPEG와 달리 PNG는 투명도를 나타낼 수 있습니다.</p>\n</blockquote>\n<p>이제 JPEG와 PNG의 차이점을 알아보자면,</p>\n<ul>\n<li>JPEG는 <strong>손실 압축 방식</strong>을 사용합니다.\n<ul>\n<li>손실 압축이란 파일이 압축될 때 이미지의 일부 데이터가 <em>영구적으로 삭제</em> 되는 경우를 말합니다.</li>\n<li>이러한 특성으로 JPEG는 품질이 저하되고 왜곡될 수 있지만, 이미지를 효율적으로 저장할 수 있습니다.</li>\n</ul>\n</li>\n<li>PNG는 <strong>무손실 압축 방식</strong>을 사용합니다.\n<ul>\n<li>이미지가 압축될 때 손실되는 데이터가 없어서 이미지 품질을 유지할 수 있습니다.</li>\n<li>덕분에 로고, 그래프, 등등 퀄리티가 중요한 경우에 자주 사용해요</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 356px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f0741c23c370419ca8fa8ec19e19fd16/50ac3/%EB%94%B0%EB%B4%89%EB%8F%84%EC%B9%98.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 123.41772151898734%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"디지털풍화\"\n        title=\"\"\n        src=\"/static/f0741c23c370419ca8fa8ec19e19fd16/50ac3/%EB%94%B0%EB%B4%89%EB%8F%84%EC%B9%98.png\"\n        srcset=\"/static/f0741c23c370419ca8fa8ec19e19fd16/c26ae/%EB%94%B0%EB%B4%89%EB%8F%84%EC%B9%98.png 158w,\n/static/f0741c23c370419ca8fa8ec19e19fd16/6bdcf/%EB%94%B0%EB%B4%89%EB%8F%84%EC%B9%98.png 315w,\n/static/f0741c23c370419ca8fa8ec19e19fd16/50ac3/%EB%94%B0%EB%B4%89%EB%8F%84%EC%B9%98.png 356w\"\n        sizes=\"(max-width: 356px) 100vw, 356px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이런 디지털풍화는 위와 같은 JPEG 특성때문에 생깁니다<br>\n대충 정리해보면, 화질구지여도 괜찮으면 JPEG로 꾸겨버리고, 퀄리티를 남겨둬야 한다면 PNG로 해야겠네요</p>\n<h3 id=\"webp쓰면됨-ㅋㅋㅋ\" style=\"position:relative;\"><a href=\"#webp%EC%93%B0%EB%A9%B4%EB%90%A8-%E3%85%8B%E3%85%8B%E3%85%8B\" aria-label=\"webp쓰면됨 ㅋㅋㅋ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WebP쓰면됨 ㅋㅋㅋ</h3>\n<p>근데 PNG, JPEG 고민할 거 없이 요새 사실상 치트키로 쓰이는 차세대 이미지 포맷이 있는데요<br>\n<a href=\"https://developers.google.com/speed/webp?hl=ko\">웹용 이미지 형식 WebP</a>입니다</p>\n<blockquote>\n<p>WebP는 웹 이미지에 뛰어난 <strong>무손실 및 손실 압축</strong>을 제공하는 최신 이미지 형식입니다.</p>\n</blockquote>\n<p>WebP 무손실 이미지는 PNG보다 26% 작고, WebP 손실 이미지는 JPEG보다 25~34% 작다고 하네요<br>\n게다가 WebP는 PNG처럼 투명도를 넣을 수도 있고, 압축 후에도 JPEG보다 높은 이미지 퀄리티를 가집니다<br>\n<a href=\"https://developers.google.com/speed/webp/docs/c_study?hl=ko\">비교 연구</a>에 따르면 WebP를 무손실 압축해도 JPEG보다 압축 품질이 평균 30% 더 좋다고 하네요</p>\n<p>사실상 퀄리티와 파일 크기 간의 <del>황밸</del> 절충안입니다<br>\n이미 크롬 브라우저에서는 webp 사용하라고 등떠밀고 권장합니다<br>\n그래서 저도 이거 쓰기로 함</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 182px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d8f99e2df9bba652917e84cacdc3221c/a51ee/webp_meme.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 151.8987341772152%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"webp meme\"\n        title=\"\"\n        src=\"/static/d8f99e2df9bba652917e84cacdc3221c/a51ee/webp_meme.png\"\n        srcset=\"/static/d8f99e2df9bba652917e84cacdc3221c/c26ae/webp_meme.png 158w,\n/static/d8f99e2df9bba652917e84cacdc3221c/a51ee/webp_meme.png 182w\"\n        sizes=\"(max-width: 182px) 100vw, 182px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>근데 webp meme 치면 왜 이런거 나옴?</p>\n<h1 id=\"압축-구현해보기\" style=\"position:relative;\"><a href=\"#%EC%95%95%EC%B6%95-%EA%B5%AC%ED%98%84%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"압축 구현해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>압축 구현해보기</h1>\n<p>아무튼 일단 주로 이미지 사이즈를 적절히 줄이고, webp로도 바꾸고, 해서 압축을 구현하기로 했습니다<br>\n이제 압축을 어디서 할건지 정해야겠는데요..<br>\n프로젝트가 Next.js를 사용하니 서버 사이드도 가능하고, 클라이언트 사이드도 가능합니다</p>\n<ul>\n<li>서버 사이드에서는 <a href=\"https://www.npmjs.com/package/sharp\">sharp</a>라는 라이브러리가 유명합니다. Next.js Image 컴포넌트에서 내부적으로 sharp를 사용하는 것으로도 많이 알려져 있습니다</li>\n<li>클라이언트 사이드에서는 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API\">Canvas API</a>를 사용해볼 수 있을 것 같네요. 이미지를 캔버스에 그려내고, 너비높이를 줄이고, 다시 이미지로 변환하면 될 것 같아요</li>\n<li>또한 <a href=\"https://www.npmjs.com/package/canvas/v/2.0.0-alpha.7\">node-canvas</a>같은 패키지도 있어서, 서버 사이드에서도 canvas api를 사용해볼 수 있습니다</li>\n<li>또또한 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/OffscreenCanvas\">OffscreenCanvas</a>라는 것도 있는데요\n<ul>\n<li>OffscreenCanvas는 화면을 그려내야 하는 책임을 덜어내고 DOM과 완전히 손절한 친구입니다</li>\n<li>DOM에 의존하지 않아 가볍고 빠르며, Service Worker에서 작업하여 별도 스레드에서 작업할 수 있습니다</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 182px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a7a56649319563c28ab6e3189ef6ed67/a51ee/choice.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 151.8987341772152%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAIAAACjcKk8AAAACXBIWXMAAAsTAAALEwEAmpwYAAAG1UlEQVR42i1SaUxbVxZ+0vwYaUbq/Gwmaauoo0adzoyiKUjNj/mRThW1FR1CoGC2pElLSYE60ACBFBIgMJQthC3sBmLA6/OO7We/591+XvBu4wXwgm1ssyasIYRlHjDnHl195+ice8757gFcLi+FDdGmJFSOmMIRU7liGg+mcREqF6ZwETIHIXEQIgMic2ASk9/SNdjcNdz6nFDX0m00WQCpEqVrglO2V2zzOsu0BhpWKWiUqo2CukU66uMbfGJLSOkIcVQurmWlpJWU8nNzdmXftTuPQY4AkKq0FKWPZ4zy9QHY5NM5gi5/XGv18GTavTfY2dnf3zs+Po7F4jxDiKYJ3qns/qF25HphI4snBgSwVKg0rq5v7O7uHB4eHB0dHp+KUmtZWlnDwBHmOjrx6J0Bvm2tcQzOKe9OLmxkcEWAEFbLDY6zoLP7DIQicbnWgoEDDAsFc9XV8YUg1xjkGONFDWNJdxsYHAiAFTqyxLG1vXXy+NFJ6PLs7Mt4HLMQ9fT6q63NjY3pxMTQ73+3QCG745sC4/KwwPr1DzUMngiA5ZoJ2ZzbFznr1guCgcv/8CR99eblWiC6pDHYMOd0VQ109cbKrH9zdxuUO6ZMSzllT6lMAQBJlBQ0ghhn9/deY3GK/AL3H96xfHQpMjODmRLUMuNyByNhhy+sdQVYcvu42M7WBQprBkggFxBKlKAuytaFQ5EYFr3sC7CLGyRE9v5pI0ab6wUDgRUGj9tFYKuIUj9J7mMZFvH1w2T6WbI2zLGsq61zp1OfCMZ4OLYsn54hQSaSfJYgdGpMdpdnjg7pWDILVeoqqBuknFRGFDQ0JHRssFB/fGl5/eUro32OLXWMQnaixENVB+hq3wTsnGCJtre33u7vHx2+XVpZuVXaRGYJ/p8scm5wjfFJ0fSk2PJC5CLJfHRVgKLwjSMz42LbuNTVSoTmQ4tYU28PsA85ngR5RDITgBAFqAmwDVEQDYG6MKgNMXWLDDREUc7TNT6GPkKFzZ5AWGHybGztnEx0eLJF0WhUoVACXIG4fVIyKrT1s/X9bN0Ax9DDQIe4xgG2fkxoIyHuQbaeKlRbbfbllZX4qayurnq9XrPZDAQWglKpAkakfL4ARiSQSMwXQBAi40Mwtrl8qQKSoUIRwmKz5TKZCiunkKuVSrlcEotFAQiW5pU1Ftd23nvcga9uL6puL6t9VlXb+qStv6qkpC7t86I7+QXVXfja/vyKpvyyxp8qWgor2zLzyzR6PUBhcJJ/brn562B2RW92ZX92+XOrc87r9tidbrfDrB7tFHfUVX955afcvIzSztSipqT8uszSZ//OLhfCUoDK5H1b3PZ99WDeo8H0+931z0kYH5vbW3arKex1mqbARb1C/rSy519/xt8tz6roybjXmPlL2xdZpRAsA8gMblpxa37tSEZZz93afvecH+PTZjVTqipDPIGun9D/sFrPYw4lfVKaezOn5kVGcXNOece13AcYLwAV5N4obE7Ft//6lBiOnWzozOw8JJRyunvNdGpQCs2oJWGNvOeLT/C5t7+rGc0p7cgq67yaVSoQS4EJKvv7+gGWBA36A1hmOL5KoAslWse60zgvEy2Z0T2PdZ7PI5YWttc0fPeIkFnSfreWUFA3JNfoABaNCVV3vfZH3hweRGPx5mEWXaRW2KJWiI8MDynoFL8GeWlS73pNXb91Zj3sxf3S1sc2TiIercEMICOTqj9dk3+YFkPNs4vxVHwLH1bLnJFptUFHGnPBgtd+1/GKf8M9Xf6kN7WkA//fEdi5MQY5Ub0JQIZIigvX7e+mmjOqiBCadb/rzsPeHx8PySTqowX7QcS7M2u1siheIYsDcpIKfnvwlDw1HeuiqTRaA4AMk5Tnkpwf4hSf5d1/Mppb0Xe7hoAx39VLNImElkmKuL4JamjaNKEbAUdp1bOWQYFgfqdfZFejWDKBpDr3jecirvEqPrWecKuiN6+o9faDzlv4tgpcuZY4vqVRHs07D18F5xhszac3VYl54vzW5wNctdECwCMk+fn/CD5I7bny46P0SnLibdVHOMrlLP5f0nTf3Ntcnj1eW9iNek19I9KPcbr30lQXUywXkmnnv1KJEEBCILHf+Rx5/4b/vQzbu8nW8yne9zNdF9JN568rLmWY+4gzE1RJerHk3JfaCynoxTTTB+nuS7nwH6+ijCkAIdMm/5bM/ywXTMAxEzPpiTgwEcdIwDESM5n/TCdc/nbo7ym0vybTEtLBhEzmpzgwIYN7JXvg46/1kBTY2d1dXI5jGl6KhpdikXgU01N8YkaXotGl+OJKzLMQsvt8M4GAw+d3+IK2ucDu673/AU623VwruugmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"선택,,\"\n        title=\"\"\n        src=\"/static/a7a56649319563c28ab6e3189ef6ed67/a51ee/choice.png\"\n        srcset=\"/static/a7a56649319563c28ab6e3189ef6ed67/c26ae/choice.png 158w,\n/static/a7a56649319563c28ab6e3189ef6ed67/a51ee/choice.png 182w\"\n        sizes=\"(max-width: 182px) 100vw, 182px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이중에서 저는 canvas api를 사용하기로 했는데요</p>\n<ul>\n<li>서버 사이드로 구현하려면, 업로드한 파일을 클라이언트 사이드와 서버 사이드 간에 그냥 주고받을 수가 없겠더라구요. fetch같은 것으로 한 번 옮겨야 하는데, 이 과정은 좀 부담일 수 있겠다고 생각했어요</li>\n<li>또한 서버 리소스를 쓰는 것보다는 브라우저 단에서 책임지게 하는게 더 낫겠다 싶었습니다.</li>\n<li>브라우저 단에서 기다리게 되더라도, 유저가 파일을 업로드할 때마다 압축을 진행해두면 실제로 <code class=\"language-text\">제출</code> 버튼을 누르기 전까지 압축을 진행해둘 수 있겠다는 생각이었어요</li>\n<li>OffscreenCanvas는 매력적이긴 한데요, canvas와 비슷한 새 친구이니 레퍼런스가 더 많은 canvas로 먼저 만들어보고 나중에 필요하면 개선해볼 수 있을 것 같았습니다\n<ul>\n<li>OffscreenCanvas의 브라우저 호환성도 걱정은 살짝 됐어요, 2023년부터 사파리, 파이어폭스, 엣지, 크롬 모두 지원하게 되었는데, 구버전을 사용하는 경우 호환되지 않을 수 있습니다</li>\n</ul>\n</li>\n</ul>\n<p>이제 canvas로 구현을 한번 해봅시다</p>\n<h2 id=\"canvas-api를-사용한-구현\" style=\"position:relative;\"><a href=\"#canvas-api%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-%EA%B5%AC%ED%98%84\" aria-label=\"canvas api를 사용한 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>canvas api를 사용한 구현</h2>\n<p>인자로 <code class=\"language-text\">File</code> 객체를 받고, 압축하여 <code class=\"language-text\">File</code> 객체를 다시 Promise로 반환하는 함수 <code class=\"language-text\">processImage</code>를 만들어봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">processImage</span><span class=\"token punctuation\">(</span>file<span class=\"token operator\">:</span> File<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>File<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>먼저 파일 컨텐츠를 DataURL로 읽어냅니다.<br>\n<a href=\"https://developer.mozilla.org/ko/docs/Web/URI/Reference/Schemes/data\">DataURL 또는 DataURI</a>는 데이터를 Base64 인코딩하여 URI형식의 문자열로 표현한 형태입니다</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nreader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsDataURL</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">readAsDataURL</code>에 <code class=\"language-text\">onload</code> 콜백을 추가합시다.<br>\n데이터를 다 읽어낸 후, 그 데이터를 이미지로 바꿉니다</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\">reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  image<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>target<span class=\"token operator\">?.</span>result <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 이 이미지에 또 <code class=\"language-text\">onload</code> 콜백을 추가하여, 이제 진짜 canvas를 사용해 리사이징합시다</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\">image<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> context <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ... 이미지 원본 width, height를 가져와서</span>\n  <span class=\"token comment\">// ... 원본 비율을 유지하며 원하는 수치까지 줄인 newWidth, newHeight를 계산합니다</span>\n\n  canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> width<span class=\"token punctuation\">;</span>\n  canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height<span class=\"token punctuation\">;</span>\n  context<span class=\"token operator\">?.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이제 이 canvas를 Blob으로 변환하고 마침내 File을 다시 만들어냅니다</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\">canavs<span class=\"token punctuation\">.</span><span class=\"token function\">toBlob</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>blob<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> compressedFile <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>blob<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">\"image/webp\"</span><span class=\"token punctuation\">,</span>\n      lastModified<span class=\"token operator\">:</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"image/webp\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 이 자리에 QUALITY를 지정 가능.</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>우리는 차세대 개짱쎈 이미지포맷인 webp로 변환하기로 했으니 webp 형식으로 지정해줍니다\n이 때, <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob\">toBlob</a>에는 세 번째 인자로 QUALITY를 넣을 수 있는데</p>\n<blockquote>\n<p>이미지 포맷이 손실 압축을 지원하는 경우 이미지 퀄리티 비율을 0과 1 사이의 수로 지정할 수 있습니다.</p>\n</blockquote>\n<p>필요에 따라 정하시면 되곘습니다<br>\n좀 해보니까 어지간하면 QUALITY는 많이 안 건드리고 이미지 사이즈로 승부보는게 결과물이 좀 괜찮은 듯</p>\n<h3 id=\"최종코드와-사용하기\" style=\"position:relative;\"><a href=\"#%EC%B5%9C%EC%A2%85%EC%BD%94%EB%93%9C%EC%99%80-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"최종코드와 사용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>최종코드와 사용하기</h3>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token constant\">MAX_SIZE</span> <span class=\"token operator\">=</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">QUALITY</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">FORMAT</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"image/webp\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">processImage</span><span class=\"token punctuation\">(</span>file<span class=\"token operator\">:</span> File<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>File<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"image/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"File is not an image\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsDataURL</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> event <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      image<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>target<span class=\"token operator\">?.</span>result <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n      image<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> context <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">let</span> width <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2000</span>\n        <span class=\"token keyword\">let</span> height <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 200</span>\n        <span class=\"token keyword\">const</span> aspectRatio <span class=\"token operator\">=</span> width <span class=\"token operator\">/</span> height<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>width <span class=\"token operator\">></span> <span class=\"token constant\">MAX_SIZE</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          width <span class=\"token operator\">=</span> <span class=\"token constant\">MAX_SIZE</span><span class=\"token punctuation\">;</span>\n          height <span class=\"token operator\">=</span> <span class=\"token constant\">MAX_SIZE</span> <span class=\"token operator\">/</span> aspectRatio<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>height <span class=\"token operator\">></span> <span class=\"token constant\">MAX_SIZE</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          width <span class=\"token operator\">=</span> <span class=\"token constant\">MAX_SIZE</span> <span class=\"token operator\">*</span> aspectRatio<span class=\"token punctuation\">;</span>\n          height <span class=\"token operator\">=</span> <span class=\"token constant\">MAX_SIZE</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> width<span class=\"token punctuation\">;</span>\n        canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height<span class=\"token punctuation\">;</span>\n\n        context<span class=\"token operator\">?.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        canvas<span class=\"token punctuation\">.</span><span class=\"token function\">toBlob</span><span class=\"token punctuation\">(</span>\n          blob <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>blob<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Blob 데이터 생성 중 에러가 발생했습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n              <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">const</span> compressedFile <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>blob<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n              type<span class=\"token operator\">:</span> <span class=\"token constant\">FORMAT</span><span class=\"token punctuation\">,</span>\n              lastModified<span class=\"token operator\">:</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>compressedFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token constant\">FORMAT</span><span class=\"token punctuation\">,</span>\n          <span class=\"token constant\">QUALITY</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n      image<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"이미지 로드 중 에러가 발생하였습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"파일을 읽는 중 에러가 발생하였습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>대충 이렇게 만들어서</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> processedFileArray <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token builtin\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>\n  fileArray<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> file <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> processedImage <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">processImage</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> processedImage<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>업로드한 파일을 모두 압축 돌리고 기다려줍니다.</p>\n<h1 id=\"정해진-크기-이하로-압축하고-싶어요\" style=\"position:relative;\"><a href=\"#%EC%A0%95%ED%95%B4%EC%A7%84-%ED%81%AC%EA%B8%B0-%EC%9D%B4%ED%95%98%EB%A1%9C-%EC%95%95%EC%B6%95%ED%95%98%EA%B3%A0-%EC%8B%B6%EC%96%B4%EC%9A%94\" aria-label=\"정해진 크기 이하로 압축하고 싶어요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정해진 크기 이하로 압축하고 싶어요</h1>\n<p>근데 문제는 이렇게 압축 한번 맡기면, 결과물이 몇 바이트로 줄어드는지 예상이 안 됩니다<br>\n근데 혹시나 진짜 혹시나, 압축을 한 번 했는데 서버 허용치를 아직도 넘어간다면???????<br>\n실제로 그런일이 있었습니다 ;;</p>\n<h2 id=\"라이브러리에서는-어떻게-구현함\" style=\"position:relative;\"><a href=\"#%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%EC%97%90%EC%84%9C%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EA%B5%AC%ED%98%84%ED%95%A8\" aria-label=\"라이브러리에서는 어떻게 구현함 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>라이브러리에서는 어떻게 구현함?</h2>\n<p>그래서 이미지를 <strong>일정 크기 이하</strong>로 보장하며 압축하려면 어떻게 해야 하지? 라는 생각을 하다가<br>\n<a href=\"https://github.com/Donaldcwl/browser-image-compression\">broswer-image-compression</a>이라는 오픈소스 라이브러리 구현을 뜯어봤습니다<br>\n알짜배기는 <a href=\"https://github.com/Donaldcwl/browser-image-compression/blob/master/lib/image-compression.js\">lib/image-compression.js</a>에 있더라구요</p>\n<p>그래서 한번 열어보니 ..</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> shouldReduceResolution <span class=\"token operator\">=</span> <span class=\"token operator\">!</span>options<span class=\"token punctuation\">.</span>alwaysKeepResolution <span class=\"token operator\">&amp;&amp;</span> origExceedMaxSize<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>remainingTrials<span class=\"token operator\">--</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>currentSize <span class=\"token operator\">></span> maxSizeByte <span class=\"token operator\">||</span> currentSize <span class=\"token operator\">></span> sourceSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> newWidth <span class=\"token operator\">=</span> shouldReduceResolution <span class=\"token operator\">?</span> canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">*</span> <span class=\"token number\">0.95</span> <span class=\"token operator\">:</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> newHeight <span class=\"token operator\">=</span> shouldReduceResolution <span class=\"token operator\">?</span> canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">*</span> <span class=\"token number\">0.95</span> <span class=\"token operator\">:</span> canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">[</span>newCanvas<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">getNewCanvasAndCtx</span><span class=\"token punctuation\">(</span>newWidth<span class=\"token punctuation\">,</span> newHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>outputFileType <span class=\"token operator\">===</span> <span class=\"token string\">'image/png'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      quality <span class=\"token operator\">*=</span> <span class=\"token number\">0.85</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      quality <span class=\"token operator\">*=</span> <span class=\"token number\">0.95</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> newWidth<span class=\"token punctuation\">,</span> newHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ... canvas를 file로 변환</span></code></pre></div>\n<p>ㅋㅋㅋ 그냥 될 때까지 quality나 resolution(이미지 크기)를 줄입니다<br>\n반복해서 압축하는거 말고 더 우아한 방법이 있으려나? 해서 찾아봤는데 어쩔 수 없나봐요</p>\n<h2 id=\"이제-반복압축을-구현해요\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EC%A0%9C-%EB%B0%98%EB%B3%B5%EC%95%95%EC%B6%95%EC%9D%84-%EA%B5%AC%ED%98%84%ED%95%B4%EC%9A%94\" aria-label=\"이제 반복압축을 구현해요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이제 반복압축을 구현해요</h2>\n<p>그럼 이제 이미지 반복 압축을 구현해볼텐데요<br>\nwhile을 돌리려면 코드를 좀 묶어서 간결하게 만들 필요가 있을 것 같아요<br>\n위에서 봤던 라이브러리 코드에서도, <code class=\"language-text\">getNewCanvasAndCtx</code>같이 공통 작업들을 묶어놨으니 저도 좀 묶어버려야겠어요</p>\n<p>먼저 canvas를 blob으로 변환하는 함수를 만들겠습니다</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">canvasToBlob</span><span class=\"token punctuation\">(</span>canvas<span class=\"token operator\">:</span> HTMLCanvasElement<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Blob<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      canvas<span class=\"token punctuation\">.</span><span class=\"token function\">toBlob</span><span class=\"token punctuation\">(</span>blob <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>blob<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Blob 데이터 생성 중 에러가 발생했습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Blob 변환 중 에러가 발생했습니다 : \"</span> <span class=\"token operator\">+</span> error<span class=\"token operator\">?.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">canvas.toBlob</code>은 콜백형식이라서 좀 귀찮게 생겼어요.. 그래서 Promise 함수를 만들고 이 내부에서 <code class=\"language-text\">resolve</code>하게 했습니다</p>\n<p>그리고 이미지를 canvas에 그려내는 작업도 함수로 따로 뺄게요</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">function</span> <span class=\"token function\">drawImageInCanvas</span><span class=\"token punctuation\">(</span>image<span class=\"token operator\">:</span> HTMLImageElement<span class=\"token punctuation\">,</span> targetSize<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> context <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ... 또 이미지를 원본 비율을 유지하며 targetSize까지 크기 줄이기 ..</span>\n  context<span class=\"token operator\">?.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> newWidth<span class=\"token punctuation\">,</span> newHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> canvas<span class=\"token punctuation\">;</span></code></pre></div>\n<p>그러면 이제 반복하기 완전 쉬워졌네요 !!</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// ... 동일하게 파일을 DataUrl로 읽고, 이미지로 로드 ..</span>\n<span class=\"token keyword\">let</span> trialCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\nimage<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>trialCount<span class=\"token operator\">++</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">MAX_TRIAL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 원하는 감소곡선에 따라 사이즈를 또 줄임</span>\n    <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token function\">drawImageInCanvas</span><span class=\"token punctuation\">(</span>\n      image<span class=\"token punctuation\">,</span>\n      <span class=\"token constant\">MAX_SIZE</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token constant\">DAMPING_FACTOR</span><span class=\"token punctuation\">,</span> trialCount <span class=\"token operator\">*</span> trialCount<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Blob데이터로 변환(image/webp)</span>\n    <span class=\"token keyword\">const</span> blob <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">canvasToBlob</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>targetSize <span class=\"token operator\">&amp;&amp;</span> blob<span class=\"token punctuation\">.</span>size <span class=\"token operator\">></span> targetSize<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//targetSize가 지정되었고 아직 이거보다 크면 다시 압축</span>\n      <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//targetSize가 정해지지 않았거나(이 경우 webp변환 겸 1회 압축), targetSize보다 작게 압축했으면 반환</span>\n      <span class=\"token keyword\">const</span> compressedFile <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>blob<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token constant\">FORMAT</span><span class=\"token punctuation\">,</span>\n        lastModified<span class=\"token operator\">:</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>compressedFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"이미지가 너무 큰거같은데요?\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//...</span></code></pre></div>\n<p>라이브러리에서는 이미지 크기를 선형으로 압축하는데요,<br>\n저는 입맛에 따라 좀 변경해봤습니다<br>\n적당히 0.95정도의 factor를 둬서, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0.9</mn><msup><mn>5</mn><msup><mi>x</mi><mn>2</mn></msup></msup></mrow><annotation encoding=\"application/x-tex\">0.95^{x^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9869em;\"></span><span class=\"mord\">0.9</span><span class=\"mord\"><span class=\"mord\">5</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9869em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-2.931em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> 이런식으로 감소하게 만들어줬습니다<br>\n아 물론 처음 한 번은 기준 크기(ex. 서비스에서 뭘 해도 이미지가 1200px을 넘지 않으면 1200px까지 일단 줄임)까지 줄인 다음 이 수식이 적용됩니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4e099446569cbe92cde2e0b799c236fe/c391c/graph.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.9620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaElEQVR42p1SS3bCMAzMCfqAOD/LdmLnBxTYsGo3vf+pVEm2IfC66mLyHGlmJMsqhvmG4XjHabng1/cPNl2PH7sad4f2XygaHbDuBgQTMEwnrBqLB6Xf0GFZ6T/iGssNDmWHxXq6Ye+XmKxADOv2iao2lD+jn69yfsm9cJ3oizCd0Q4zqmTGIkFjJKbdjP2wEmdBbYmX84TtmbViyG2qGmKVJkGqG2y1R3ALOiqoYRDzFsKj06rZalKHKrmzwRaKYPtViOACauOFZ/ojZo2qtxqbDeFZJYFj2owIckWQDsEGGQG4SXLVu65NhvxRMg+IoNfkrqw/Spcc4w3gDlXiGpoprxe/fNSAjOFxZU524BMCOn+SWJ6R5a7Ap38jBZnD3JZmy2A+exXcfpgutNg3HNcrnT/lisaNYmT7Sa6bYxmun9ETd1yuAvboyKvg/duXjE4WU5B2Mi9zfoQYj7moi/x92VLMkGHAX2gDHmse7ZE3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"감소곡선 그래프\"\n        title=\"\"\n        src=\"/static/4e099446569cbe92cde2e0b799c236fe/f058b/graph.png\"\n        srcset=\"/static/4e099446569cbe92cde2e0b799c236fe/c26ae/graph.png 158w,\n/static/4e099446569cbe92cde2e0b799c236fe/6bdcf/graph.png 315w,\n/static/4e099446569cbe92cde2e0b799c236fe/f058b/graph.png 630w,\n/static/4e099446569cbe92cde2e0b799c236fe/c391c/graph.png 673w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이렇게 생겼는데요, 횟수는 자연수니까 y축 기준 오른쪽만 해당합니다<br>\n처음에는 보수적으로 접근해서 최대한 덜 줄여보고, 압축이 반복될 수록 어쩔 수 없이 많이 줄이는 방향성을 구현하고 싶었어요\n최대 반복 회수를 10으로 잡는다고 하면 약 0.006%까지 사이즈가 줄어들어버리니.. 사실 여기까지는 갈 상황이 있지도 않을 것 같아요</p>\n<hr>\n<p><br>\n이번에는 이미지 압축에 대해 알아봤고요<br>\n오픈소스 라이브러리를 뜯어서 이게 잘하는 짓인지도 한번 봤습니다<br>\ncanvas 쓰는거는 항상 재밌는 듯</p>","frontmatter":{"title":"JavaScript에서 이미지를 일정 크기 이하로 압축하려면","date":"April 22, 2025","description":"50MB짜리 이미지같은거 올려버리면 서버가 아파요","tag":["TIL","JavaScript"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%95%95%EC%B6%95-%EC%A0%84%EB%9E%B5-\">이미지 압축 전략 ?</a></p>\n<ul>\n<li>\n<p><a href=\"#%ED%8F%B0%EC%9C%BC%EB%A1%9C-%EC%B0%8D%EC%9C%BC%EB%A9%B4-%EC%9D%B4%EB%AF%B8%EC%A7%80-%ED%81%AC%EA%B8%B0%EA%B0%80-%EB%84%88%EB%AC%B4-%EC%BB%A4%EC%9A%94\">폰으로 찍으면 이미지 크기가 너무 커요</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%ED%8F%AC%EB%A7%B7---jpeg-png-webp\">이미지 포맷 - JPEG, PNG, WEBP</a></p>\n<ul>\n<li><a href=\"#jpeg-vs-png\">JPEG vs PNG</a></li>\n<li><a href=\"#webp%EC%93%B0%EB%A9%B4%EB%90%A8-%E3%85%8B%E3%85%8B%E3%85%8B\">WebP쓰면됨 ㅋㅋㅋ</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%95%95%EC%B6%95-%EA%B5%AC%ED%98%84%ED%95%B4%EB%B3%B4%EA%B8%B0\">압축 구현해보기</a></p>\n<ul>\n<li>\n<p><a href=\"#canvas-api%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-%EA%B5%AC%ED%98%84\">canvas api를 사용한 구현</a></p>\n<ul>\n<li><a href=\"#%EC%B5%9C%EC%A2%85%EC%BD%94%EB%93%9C%EC%99%80-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\">최종코드와 사용하기</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%ED%95%B4%EC%A7%84-%ED%81%AC%EA%B8%B0-%EC%9D%B4%ED%95%98%EB%A1%9C-%EC%95%95%EC%B6%95%ED%95%98%EA%B3%A0-%EC%8B%B6%EC%96%B4%EC%9A%94\">정해진 크기 이하로 압축하고 싶어요</a></p>\n<ul>\n<li><a href=\"#%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%EC%97%90%EC%84%9C%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EA%B5%AC%ED%98%84%ED%95%A8\">라이브러리에서는 어떻게 구현함?</a></li>\n<li><a href=\"#%EC%9D%B4%EC%A0%9C-%EB%B0%98%EB%B3%B5%EC%95%95%EC%B6%95%EC%9D%84-%EA%B5%AC%ED%98%84%ED%95%B4%EC%9A%94\">이제 반복압축을 구현해요</a></li>\n</ul>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/til/implement-threejs-particles/"},"frontmatter":{"title":"React-Three-Fiber 데모: 파티클 효과 구현하기"}},"next":{"fields":{"slug":"/winning-as-a-teammate/"},"frontmatter":{"title":"🏆 팀으로서 승리하기"}}},"pageContext":{"id":"05f4f31c-ad46-5899-9304-fff3db43b120","previousPostId":"b0ae8c83-3748-5603-a96a-7347195a01d7","nextPostId":"fad73596-fb0f-5718-a737-04cdc0c3585e"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}