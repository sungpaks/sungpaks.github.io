{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/til/throw-on-hydration-mismatch-error-and-validate-dom-nesting-error/","result":{"data":{"site":{"siteMetadata":{"title":"조성개발실록","siteUrl":"https://sungpaks.github.io"}},"markdownRemark":{"id":"544a048b-06f7-598d-8a37-adc640a4809b","excerpt":"! 주의 : TIL…","html":"<blockquote>\n<p>! 주의 : TIL 게시글입니다. 다듬지 않고 올리거나 기록을 통째로 복붙했을 수 있는 뒷고기 포스팅입니다.</p>\n</blockquote>\n<p>블로그 글 쓰려고 여느 때처럼 <code class=\"language-text\">gatsby develop</code>으로 개발 모드를 열었는데<br>\n띠용~</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/07636075318d2313d5024b17662fdfe2/ae694/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 94.30379746835443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAACtklEQVR42m1TyW7TUBT1lwAb1kggQNAvAFFgw7Bgw4qpLAC1SHwEYhBKUDogNuwQpN9AQU2QaBdJS7cZ7dhvfrafh3CeX5NKwNHNzfHzu/O1t3J9bfnKxsq1jZWrh7K8uA55dnn16aX/y5NLjeeLH1/c+ODdPfXu3pnG0sL644X1h+dXH11Ye3Cucf9s487Jt7eOv7p9AvK60nN5c/PYy6XTn5Yubnhf6j+a9Z9fa625NGvtZr29+b7ddFI/IptzXWt/rn3ztNaJSdIsTTPoJMtNlqdZYazkVpsszUvLLSkykNQk0+lUCulxLuM41SpWUgshGeWCS84EJQzaCheUMjySiEYRwc00MXle4qbnj/39/f29vb1ut7u7u7s9Q6vV+r61NRwOCSGDwWA0GvV6vX6/j0ynFRDJkxU4qJRKKbxzJ+BQRVGUZZkXhSMASJZllbGAsbIXlYa1kNYADlAC/tw5TirPCCApY/aakIjBGLeRKSHhZBKGUFb/S6IoAgmCwLrgnDEG/2iEh+jj8RhV9Xs9V9UcOOzN0B/0UT+l1HmEB0KoF+vYGIPg0DmAWWQWeZY7AS/ywnHcse8wwaIQXFjjWOvA97lS+E24JFEYhUGIUpBsNAEJacgkwzR1gq2wY8VqIHkY6xhmvo8ecBVTFUvBteJEEaoo0wwaHMI1d0IlFYkglHhxHCdJYo2xK+YQSZqm9vc3bNrGpl0WpU0bATEQ9IBwEVAeUobeuq7YVk9sq7FgkKrJGpHgBYXbUWmlcRWdxA6NRyN/BozAabg47FMFcJcsOu8hujGpe8YYoxmqNWCYKokIq0ArYLRoNTYMO+8FfvD74KDT7XY6nZ2dXy2LbeTiaoEXhK+ILQS54ORot/FhsIiEgS0QM8LoKaGccRCOMimC49vCVvGqavsRoAH48oaD4R9I6OQ5no1ojQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hydration mismatch 에러\"\n        title=\"\"\n        src=\"/static/07636075318d2313d5024b17662fdfe2/f058b/image.png\"\n        srcset=\"/static/07636075318d2313d5024b17662fdfe2/c26ae/image.png 158w,\n/static/07636075318d2313d5024b17662fdfe2/6bdcf/image.png 315w,\n/static/07636075318d2313d5024b17662fdfe2/f058b/image.png 630w,\n/static/07636075318d2313d5024b17662fdfe2/ae694/image.png 850w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이런 런타임 에러가 떴습니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 495px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dc6eda9f7a4039335d5dc8b513e98c85/a4d88/image-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 113.9240506329114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEAElEQVR42jWTh27rOBBF8/9/9BYLbJotqxeKEtUbSYlFsmzHdlyzdJIHEAQF6PLOzD18Otq2sG0aQex7LIrGPJ+KnIZAoHiqMQpxgUgE2gTi0G8ziGnZxzGfsLjuNk83zgffTV6ey+Wi1rXWMlpTp763q8o5z3sYi1TdFfMkozBmcbKpmxOXl4Gd5/XTdRz3lPVRSmDSeGFuOJUHWYwwiHCY7En/tdnc5/V9mn7WTcqrEFfOz/P8pD5YzVLQJF4BTOSvYvMNpE7ka+HqBVRuuMnTj7q6CnaT/Cr4TYrbKG7ir3ioWOSWwEicBbQXof4KkAmhicxVWYelLBpZ4S3mM+bHgW+JOrDT8C2+Snmkw67F67LiKJVpPqb5Ok12TcVqTks+1KLNWJMOBRpEzep0SON+i9l18y1WxazzjHhua1m97+IMQyiTmPsehQF1HFqivsn6EPRljI9D/7WWNyF+ne/jOCZJa5m1YeTLRet6vgaSoNEMatpEt4hhEXWRYVHfp67T9cWwx/Sy2TzEqm2JUOfYSpm9v3WWkfqF49KV1b/p9F0n/7xidYtpkX/fFQ3t1NLTIyrlLIQaoCq7B0Fjmq0CxrVJAPwVDLRAja1LcJsNKhHZsCplfdlf2PBb9m2e+0pEXuObmVqukWl6GwfYd5qVVkKn2CgfIdWQt5RdBPuaxH36G9WpLPeEyDznCRJJMtd1iToUtl3Rd80cp1OcyCIfg0hGSEoij3IeuvWBT5fd7ukYQxaCznUUkmogqnjVM/Ud6rmqeGhGqRMjJ0vcxHlzoQ4LLzHfgrHEt+3m6TJNStNYZqXrLAwZDFvH3ta1jOEQuHOGJhRui2RbZhy4Yww2RcbDQDF32W4fhO3qegCAeB6DUCA0F8VYkybnuBBtzpuM1+lj563MEKuz4dCzu5Tn9fwbFY+i9PU1+POnXmmhiVYm0QzyusQvGlbxuC6xHbrQiW01oiQKqt+H8SCM8++cHfVX51i17aQOKqLOdVXjVMkUG55Hw6CHgAIP9+XwSen5B08VGodhbeiFtkxfX3rfQ16pNLpFH/4aUf5KrFB7XnQZaFTZF8bOP4SptyKznASwMu3WDdTehamnRaGV5qCixYDzQb08Xj+eh2wUIVz5HcfxISbFkINStQqMGOhxYKDCgdY7WD37lRffBLuP4msUP7vCUUGpBrYZhodY0Yf8MrCy0M59Iw3ssgjLwC6sVV6B4oGx8hnEJ+MX8VBevsVbxlRU4oOwLohy3Qmf32sPLnX835K6Xr8w6NIgukkq1C90rEa974gqWDV8F2KrnC/H0/30edl/nHbb/STPu816OvRiP04HMR6EPPT8MP2cx8P54/D1+Xk7Hr/O5908/w/N57pQk8B5jAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"콘솔에서는\"\n        title=\"\"\n        src=\"/static/dc6eda9f7a4039335d5dc8b513e98c85/a4d88/image-1.png\"\n        srcset=\"/static/dc6eda9f7a4039335d5dc8b513e98c85/c26ae/image-1.png 158w,\n/static/dc6eda9f7a4039335d5dc8b513e98c85/6bdcf/image-1.png 315w,\n/static/dc6eda9f7a4039335d5dc8b513e98c85/a4d88/image-1.png 495w\"\n        sizes=\"(max-width: 495px) 100vw, 495px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>콘솔에서는 이런 에러가 났구요</p>\n<p>근데 제가 쓴 코드를 지적해주는게 아니라..<br>\n그냥 저런 모듈 내부 코드에서의 에러 위치만 나오니까<br>\n아주 미칠노릇. 일 뻔 했습니다</p>\n<h1 id=\"hydration이-뭔가요\" style=\"position:relative;\"><a href=\"#hydration%EC%9D%B4-%EB%AD%94%EA%B0%80%EC%9A%94\" aria-label=\"hydration이 뭔가요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>hydration이 뭔가요?</h1>\n<p>먼저 에러에서 hydration이라는게 있는데, hydration이 뭔지 알아보고 갑시다.<br>\n<a href=\"https://www.gatsbyjs.com/docs/conceptual/react-hydration/\">Understanding React Hydration - Gatsbyjs.com</a></p>\n<p>Gatsby.js는 정적 사이트 생성(SSG)과 서버 사이드 렌더링(SSR)을 지원하는 프레임워크입니다. Next.js와 비슷하게요<br>\n이는 즉, <strong>정적 HTML 뼈대</strong>를 서버 측에서 먼저 조립하고, 이걸 <strong>클라이언트 사이드</strong>에 넘기는 셈입니다.<br>\n제가 \"HTML 뼈대\"라고 말한 것처럼, 이 자체로는 interactive하지 않습니다. 딱딱하고 메마른 뼈대 그 잡채인 셈인데<br>\n클라이언트 사이드에서 <strong>React는 이 뼈대에다 JavaScript 코드를 집어넣어 살아 움직일 수 있게</strong> 만듭니다.<br>\n마치 물을 주는 것 같네요. 이 과정이 hydrating입니다.</p>\n<h1 id=\"이유를-찾아보자\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EC%9C%A0%EB%A5%BC-%EC%B0%BE%EC%95%84%EB%B3%B4%EC%9E%90\" aria-label=\"이유를 찾아보자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이유를 찾아보자</h1>\n<p>구글에 throwOnHydrationMismatch같은 검색어로 좀 검색을 해봤는데<br>\nSSG, SSR의 대표주자인 Next.js에서 <a href=\"https://nextjs.org/docs/messages/react-hydration-error\">관련 공식문서</a>를 발견할 수 있었습니다</p>\n<p>Gatsby는 Next.js처럼 SSG, SSR을 지원하는 프레임워크예요.<br>\n에러에서 \"rendered on the server\"라고 말하니까, 관련 문제임이 틀림없었습니다</p>\n<p>결과적으로, <strong>서버 사이드 렌더링 결과물과 클라이언트 사이드 렌더링 결과물이 다르다</strong>는게 원인이었습니다.<br>\n저 링크에서 가능한 원인 후보군으로 몇 개 집어줬는데</p>\n<ul>\n<li><code class=\"language-text\">window</code>, <code class=\"language-text\">localStorage</code>같은 browser-only 기능을 사용함</li>\n<li><code class=\"language-text\">&lt;ul>,&lt;ol></code> 없이 독립적인 <code class=\"language-text\">&lt;li></code> 사용</li>\n<li><code class=\"language-text\">&lt;p></code> 태그 밑에 중첩된 <code class=\"language-text\">&lt;div></code>나 <code class=\"language-text\">&lt;p></code> 사용</li>\n</ul>\n<p>제 경우, 알고 보니 <em><strong><code class=\"language-text\">&lt;p></code>요소 밑에 <code class=\"language-text\">&lt;p></code>요소가 또 중첩</strong></em>되어 있어서 문제였습니다.<br>\n그렇지 않게끔 만들어주고나서 해결됐어요.</p>\n<h1 id=\"p-밑에-왜-p-있으면-안-됨\" style=\"position:relative;\"><a href=\"#p-%EB%B0%91%EC%97%90-%EC%99%9C-p-%EC%9E%88%EC%9C%BC%EB%A9%B4-%EC%95%88-%EB%90%A8\" aria-label=\"p 밑에 왜 p 있으면 안 됨 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">&lt;p></code> 밑에 왜 <code class=\"language-text\">&lt;p></code> 있으면 안 됨?</h1>\n<p>사실 이건 아예 DOM 규칙 자체를 위반하는 경우입니다.<br>\n원래 <code class=\"language-text\">&lt;p></code> 밑에는 다른 블록 요소들이 존재하기를 기대하지 않습니다.\n<a href=\"https://developer.mozilla.org/ko/docs/Web/HTML/Element/p\">The Paragraph element - MDN</a>을 한번 보시면,<br>\n<code class=\"language-text\">&lt;p></code> 요소 내에서 다른 블록 요소가 등장하는 순간 해당 <code class=\"language-text\">&lt;p></code>요소는 자동으로 닫힙니다.</p>\n<p>즉 아래처럼 쓰면</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>\n\t\tp 중첩했지롱~\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>아래처럼 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>\n\tp 중첩했지롱~\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>React는 이런 경우에 대해 <code class=\"language-text\">Warning: validateDOMNesting(...): &lt;p> cannot appear as a descendant of &lt;p></code> 와 같은 경고를 줍니다.<br>\np 요소가 p의 하위 요소로 나타나면 안 된다고 하네요.</p>\n<p>그리고 이게 결과적으로 서버 사이드의 사전 렌더링에 비해 다른 결과를 내버릴 수 있어서, hydration mismatch 오류까지 찾아왔네요.</p>\n<hr>\n<p>원래 딱히 에러 한 번 난거 가지고 글까지는 잘 쓰지 않는데요<br>\n이건 SSR, SSG, hydration에 대해서도 다룰 수 있었고,<br>\n저런 validateDOMNesting에 대해서도 알아보는 기회였어서<br>\n얻어가는 것이 많은 것 같아서 써봤습니다.</p>\n<p>그리고 사실 <code class=\"language-text\">&lt;p></code> 내부에서 블록요소 중첩 안 되는거 처음 알았음;<br>\n이만 마칩니다.</p>","frontmatter":{"title":"onThrowHydrationMismatch 에러.. 근데 이제 validateDOMNesting 경고를 곁들인. (Gatsby.js)","date":"September 21, 2024","description":"평화롭던 개발 블로그에 런타임에러 등장","tag":["TIL","trouble shooting","Gatsby","React"],"ogImage":null},"tableOfContents":"<ul>\n<li><a href=\"#hydration%EC%9D%B4-%EB%AD%94%EA%B0%80%EC%9A%94\">hydration이 뭔가요?</a></li>\n<li><a href=\"#%EC%9D%B4%EC%9C%A0%EB%A5%BC-%EC%B0%BE%EC%95%84%EB%B3%B4%EC%9E%90\">이유를 찾아보자</a></li>\n<li><a href=\"#p-%EB%B0%91%EC%97%90-%EC%99%9C-p-%EC%9E%88%EC%9C%BC%EB%A9%B4-%EC%95%88-%EB%90%A8\"><code class=\"language-text\">&lt;p></code> 밑에 왜 <code class=\"language-text\">&lt;p></code> 있으면 안 됨?</a></li>\n</ul>"},"previous":{"fields":{"slug":"/til/react-life-hacks-3/"},"frontmatter":{"title":"96년차 개발자도 모르는 리액트 잡기술 (3)"}},"next":{"fields":{"slug":"/render-props-and-dynamic-key-and-debouncing/"},"frontmatter":{"title":"🔍 리액트 검색창 구현 : Render Props + 동적 key 설정 + Debouncing"}}},"pageContext":{"id":"544a048b-06f7-598d-8a37-adc640a4809b","previousPostId":"6c582294-b9b1-5b81-b2f7-1eafca5ed446","nextPostId":"04e848cd-c54d-543c-803d-0bdc160ad5f3"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}