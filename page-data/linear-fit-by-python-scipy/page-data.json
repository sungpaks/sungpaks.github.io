{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/linear-fit-by-python-scipy/","result":{"data":{"site":{"siteMetadata":{"title":"조성개발실록"}},"markdownRemark":{"id":"bef85955-7b50-5eb3-924f-e75629a2f0ff","excerpt":"…","html":"<p>그 왜 이런거 본적 있으시죠?</p>\n<p><a href=\"https://www.analyticsvidhya.com/blog/2021/10/everything-you-need-to-know-about-linear-regression/\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 626px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.645569620253163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDElEQVR42kVQTXODIBT0//+jHpuZHhI704PTaZ18YKKJKKCAGoUH0kc8lAs7y+7bfSTGGCllCGGNB+8AAP9MJMI8z1rrFwywBrAQvEOc4APjfJP6l9gB1I+6GeHpgnGRmaap7/vNLJb1/aeFxUQzJiupEGnrbxpSIj1YUtHDiaeFZM+YgJotGWOzevz4bRcfByXWGNari/K7Y3fIaVbKyTjRy6t2X1e5y0VG525clNZkCGk5vH0z0putRYIlL0WVHtvPM2sGZFcLljG2ejcYd+RzRtpRqXvD93m7z+mJPxdwFtdGM+45KskaeipuhJCqqoQQWLKm9FYUyDwe906ITvDycj5fI3cvy+0L/gChvFKxEYSv1AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fitting 예시\"\n        title=\"\"\n        src=\"/static/694cad11b5e1532fd028d26c555d4941/af590/image.png\"\n        srcset=\"/static/694cad11b5e1532fd028d26c555d4941/c26ae/image.png 158w,\n/static/694cad11b5e1532fd028d26c555d4941/6bdcf/image.png 315w,\n/static/694cad11b5e1532fd028d26c555d4941/af590/image.png 626w\"\n        sizes=\"(max-width: 626px) 100vw, 626px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></a></p>\n<p>위와 같이 데이터들 막.. 찍어놓고, 적당한 선 쭈욱 그어서 \"이런 분포를 따릅니다\" 라고 하는 것 말입니다<br>\n당연하지만 그냥 사람이 대강 선을 그어내는게 아니라<br>\n적당한 수학적 방법으로 데이터를 가장 잘 표현하는 함수를 구하게 됩니다</p>\n<p>그런 과정을 두고 <em>데이터를 fitting한다</em>라고 하는데</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 273px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bc8f292e8038dd3a80a177cac7d8162b/0217c/image-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.72151898734178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAADWElEQVR42gXB608aBwAA8EuXdKvLtvbbkn3aPjVNltWkNsaqra5rKfJSKO+XHpb3Q44DOR4nd8fjeEhB3qCACAiIWmWIaR0aobVJZ/yyL8v+mP1+AOUVe2xi5uHYhByEEQhTi+RvOGwlX7DM46uEYqNM4VIo7Ysyj1qn4fENAm7AYEDfLFtEogzhA6af8x4+mvx1dJzD0/iQiJQ+r3vNgcQSo0BoFIghicwFatZAeVgPwSIJLBL5VBqfRuteVKRdHoDBVIw9eTE2/pQ5r8hFqs5lLQqCAa2e1GqdoD6s/KNheVCHfltfgVFQEdSboisQqdOH9MakwwbQFrTjU5TxJ7NzdFk0uJtwhqJGUxy2JmCE0Ntr5vtDN9BH7yZgE6mDUjZHzoFGDKb4iiVOrANUtmFyhjb1jPLyldDlLuK2SAK2Jaz2ktueBJ+W1Hc/k3d68L28RZywmDOrzqzdGTNDW4hrM5QHFKDj2XM25eUChSrGsUocT6dgW2oVa61xyhQgMfltmTKSnvj+wvNVzSXPu3xZBNlEiYwr0EiWgVVzeI6+yJwTUGmSgK++5dvI2qxZBK0g6g/2e2fQN3vSkQPVd0ceSo3w5xFXNVSoJg/K8f1B5wvgcRcXOBoWTcxkyBDHZilS3LLbi27fPsq7Im599o9ch4ATz2iVLFRQTwnFd8LlRuqwle1+Of8XCPvqQpF5niFl0aVK3Xozf9zAvU1/rONXXuG3rog7wzWgh003yfiO21HFvAVfuhJMt2Llmw9/AyRWFIogDkPKpInlS2i79L5NkrsEsUsEOvafB2u3L9HbJcNjcnkJk7IQLlXL5Vv4XFyx9K7aBTB38bXIQaHJWAyxRGrdr34aNDrvi/XLvct+3nmK/tL3P3jn5Za98SRk8IJCC/uFjjG7OPso4w0BO5FsAt9QqoNzXBOVpWxu9m7+vBg2O4Pdo37W3cNGu6s/nhew6/P/bvr/fDz466xUP99udGOpXiYN1HDsrFgatE+T4apKG0hFD8+29z612h8rpX5uY7Bd6b3Fe4nYsHlwdXhyfdwf1ltlC93KvF/ziIHjVPqtagrn/JRZmWnl2o3CaS5SrwWC3WTsslhIGgWk9HHbr7zIZ06ixBFp3UKktt+/tk78UDdO/w/78ZWzqGtxTwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"옷입기\"\n        title=\"\"\n        src=\"/static/bc8f292e8038dd3a80a177cac7d8162b/0217c/image-1.png\"\n        srcset=\"/static/bc8f292e8038dd3a80a177cac7d8162b/c26ae/image-1.png 158w,\n/static/bc8f292e8038dd3a80a177cac7d8162b/0217c/image-1.png 273w\"\n        sizes=\"(max-width: 273px) 100vw, 273px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>물론 이렇게 옷 입는 그 피팅은 아닙니다</p>\n<p>아무튼 그런 방법들 중 가장 기초적인 임플란트가 <strong>Least Square</strong> Method 입니다\n<a href=\"https://youngji.medium.com/%EC%B5%9C%EC%86%8C%EC%A0%9C%EA%B3%B1%EB%B2%95-least-squared-method-f7357990329f\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 280px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.55696202531645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpUlEQVR42nVSXY+bMBDM//9TlfpQqQ/p9Q6ii5pLiOAI4cPG2AYbm9gdMOnldOqIh11rZ2d32I1zTik1DINaMNyhHhFSvcZ936NgmqYNyEIIa+1tAVLvfYinf1jiUWl8g+yrNOsYW8nohFJwEMRxHEVRWZahReilpGzynFPC2xbKLWnqopzsQpZSBjKaIeaca63n1E74Rjm0ddVci/J0SveHOi+vWVGkOYbdoAgLBJGgEzSNHjlpurrhTVNkWbJ9Tl7/5ElGrxUhFCbMY6MBdl4XntVsLyRmw5yXY1LmRRLtk6cduVZ5koiWor7O3qXgM5kxhlFnTeesMbTI3+NdlV9Ov+NztCd1fTkeOaWM1MXhjZc1aGgBx20wbPbdTtXpfH56efuxPf7cptGu7zgnRLTsZieDPySEUdrdblAGZdQ67Ow6IdNf8eHb946wvm2N1pMx2Hz2YLXiE2b/lZrJCDF5sXs1w+A/8GGe/xp4r+/KvmsZ7zpcCZ7GO8wDxs8IHuN9E9pgbZSEqwzpuKSUUhSFsw3voQDntF6Ye5jnEUHB/wfOub+nA+tWrGd8RQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"최소제곱법\"\n        title=\"\"\n        src=\"/static/200c92cb34804c5c0c5209cd2b6a26b7/908b1/image-2.png\"\n        srcset=\"/static/200c92cb34804c5c0c5209cd2b6a26b7/c26ae/image-2.png 158w,\n/static/200c92cb34804c5c0c5209cd2b6a26b7/908b1/image-2.png 280w\"\n        sizes=\"(max-width: 280px) 100vw, 280px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></a>\n이런 식으로, 그냥 쉽게 말해서 함수로부터 각 지점들까지의 차이를 최소화하려는 방법입니다<br>\n자세한 설명은 나무위키같은거나 <a href=\"https://www.geeksforgeeks.org/least-square-method/\">이런 데를</a>확인해보세요</p>\n<p>아무튼 이런거 하려면 수식을 막 세워야할 것 같지만<br>\n우리에게는 콤푸타가 있습니다<br>\nPython을 쓸거고,<br>\n그래프 그리는 데는 Matplot 라이브러리를,<br>\n수학통계적인 계산은 scipy한테 맡겨버리기로 합시다</p>\n<h1 id=\"예제\" style=\"position:relative;\"><a href=\"#%EC%98%88%EC%A0%9C\" aria-label=\"예제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예제</h1>\n<p>1부터 10까지의 x값과 그에 대응하는 y, 그리고 yerr(y값의 오차)가 아래와 같이 주어졌다고 해봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1 0.000105532 5.12821e-05\n2 0.000281377 5.12821e-05\n3 0.000437138 5.12821e-05\n4 0.000595329 5.12821e-05\n5 0.000623162 5.12821e-05\n6 0.000735304 5.12821e-05\n7 0.000838319 5.12821e-05\n8 0.000911662 5.12821e-05\n9 0.00124201 5.12821e-05\n10 0.00137106 5.12821e-05</code></pre></div>\n<p>x y yerr(또는 uncertainty) 와 같은 형태입니다<br>\n일단 이거 가져다가 파싱을 좀 해봅시다 :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">import</span> scipy<span class=\"token punctuation\">.</span>optimize <span class=\"token keyword\">as</span> opt\n<span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt\n\n<span class=\"token comment\"># 데이터 불러오기 및 파싱</span>\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"linear.dat\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">:</span>\n    lines <span class=\"token operator\">=</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">.</span>readlines<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nx <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\ny <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\nuncertainty <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> lines<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        parts <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>parts<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">raise</span> ValueError<span class=\"token punctuation\">(</span><span class=\"token string\">\"Invalid format: Insufficient data\"</span><span class=\"token punctuation\">)</span>\n\n        x<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>parts<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        y<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>parts<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        uncertainty<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>parts<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span> ValueError <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span> <span class=\"token comment\"># 혹시 빈 문자열 등 포맷에 맞지 않는 행이 나오면 넘김</span>\n      <span class=\"token comment\"># 별 일 안할 것임</span></code></pre></div>\n<p>이런거 매번 기억 안 나도 GPT한테 \"\"linear.dat\"파일 열어서 저런 포맷 파싱해줘\" 하면 알아서 짜줍니다.<br>\n이렇게 해서 각 x, y, uncertainty 배열들을 만들어두도록 합시다</p>\n<p>근데 데이터가 대충 어떻게 생겨먹었는지 알아야 어떤 모양에 맞출지도 알 수 있겠죠?<br>\n점을 찍어봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">plt<span class=\"token punctuation\">.</span>errorbar<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">,</span> yerr<span class=\"token operator\">=</span>uncertainty<span class=\"token punctuation\">,</span> fmt<span class=\"token operator\">=</span><span class=\"token string\">'o'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이러면 y오차와 함께 데이터 그래프를 찍어주고, <code class=\"language-text\">fmt='o'</code> 옵션으로 인해 데이터가 그냥 똥골뱅이로 표현됩니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 573px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4a60ec78304b5af2f533f3dc808654b5/3c024/image-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.15189873417721%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/0lEQVR42pWS63KEIAyFff/3dNauIAHkTrDHcUq7tjNL4w+C4UsOCZP3Xghhrc05pzGrOSvrlTYT4HVdnXPHcbTWjnfGrRVmCmXTdtr3fVmWcTjk+jQRjnN+KqVAM+of/zQgkzFmnmfwbysjqH3ux044xog7Q/wNviV6Guhluac7jG7/hDt0OZtL5DNIfk13wmjV4/G4VcYibIJIkNhWbl35C/xbtksFq0u1ttaxvxsGDA274EvYhw48MLMTxsPqo6IvnW1g5t+j2rTZU+3FR+ccQpBSiI2US41rwTdgzIybnm9bKYUUKUYiDYOPn1JKDAI+okQEB1u0FqGrx0T0CU7NNh+6wyPuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"original data\"\n        title=\"\"\n        src=\"/static/4a60ec78304b5af2f533f3dc808654b5/3c024/image-3.png\"\n        srcset=\"/static/4a60ec78304b5af2f533f3dc808654b5/c26ae/image-3.png 158w,\n/static/4a60ec78304b5af2f533f3dc808654b5/6bdcf/image-3.png 315w,\n/static/4a60ec78304b5af2f533f3dc808654b5/3c024/image-3.png 573w\"\n        sizes=\"(max-width: 573px) 100vw, 573px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>직선 긋고 싶게 생겼죠?</p>\n<h1 id=\"scipyoptimizecurve_fit\" style=\"position:relative;\"><a href=\"#scipyoptimizecurve_fit\" aria-label=\"scipyoptimizecurve_fit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>scipy.optimize.curve_fit</h1>\n<p>이제 이 데이터들을 가장 잘 표현하는 함수를 알고 싶은건데</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 150px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/67c2b1db0c98d93fbf3bb46915892c52/8a4e8/image-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEhklEQVR42h2SWVMaCRSF+y/N42TixKCGBI1GFo1LHCSRhIpJEImDCxo1bkSirA2KSEBRlgYRRlAWhabpZuumV4hb1fyTIXPq3Kpb934P5+EAuQkBOvUC03SXPguzimfp8facmo9968K+9MCqXnROWNT2YBtdWW1bfr4jp2zPDLelpe3pV+2wkg9kFDxY+RRVd6Oq7ivZ05S8A1Y8o9YEuJaPKvilSQExLSivtmZnW+H5J+ejrQnhwwvR4+Qg7/JTGxAd/P1K2VH4JECUXSlZR+av1vOxJz8W36wvzS4uLCwsaTe+TDqWRuKaNkzDi4ke/CN4mHjekhnhJWR/AlHBg/QHHqzqzE88v3rTYX43JN8w9pmCEmtYuBMW2cNCW0RiPh7Tg1saxSn/93jnH2e9j85HeWd9LUDsRUtC2oLMd6Lqnu/Tk2KzX7ITFtuDYot/wBqQmI8kZv8QGHhpg8TW0MwH9ZmwJfmy/Wz4Ueo1D7j8+Pisv7W82nX4VSExHjW5frPvlcHzfscvNh982o9M7B5Jtj1DYHAQ9Avt0Nb4u+xwW0LGK2qFQH6p62r8WU7Trdo2iewRkRXqN3qjKRhF8yu7vkwWwYuFaWeke9s3AAb67JHXOntELqjMiyqrAwCmkxDr4tDc6IDhqFd/KDN717yxn42fdZbOpDPVSvn+uhFL5VUuaMTgFW0d9llCzuWJa/Mwrn8JUKCUA4d8BnW/IWAKxXJIPo9gt9fXe3sum2PXaDbVSApBCwiKYGhRFzjtNEAW6/Kd8x1plQE0OHZ/8N5jnp7Zh244jqaoQgGp4LjFYNDJlYa5pUIJy8NwtVplGIooYwrbsQ5cufeN16xyoKyX3fhVp06NN5YoYVg6kyFwnG00ctGz+d/40BbI3VwzNF2pVAoYVudYW/hix754B6lI13uA3P3IBjR4cPY0EkCL5VKpSBAE+79SsThRxbl6nWGY5rH5a9odiad9X29jWvb4b4A6VNPReS61no3Z8nCOIHCKqjVpjmEJimyquTPsr0ELKIIWIchOZ76x54tMVA2wwRkmscJdbbMF8DzuLxarLPeL5Vi2Ui6TZK0ZgaLoMoEztRqcTZKws4GY6cs1JjkFcKdLTErfKJhw1PHW4ppxh5PJVLVYrLF0Ca8RJEsyZLlSwS5S1uMTucWJIO7rsp2BdezFV4CJr7BX2w18F0H2h4wHvSAkXQVN6mXP3Fpox3ziMR2tbu5q9W/V6y++u0Sm45PUj3v6B41a6YweYJKbTB6sV10M5Z3ac0rAkz7jgT+SzngObAtPXcvtUdtmDsZGmyW3Q1LbAYz5G9QhiTnIrBHgMvoGZmcJ9/110HHiFm56ure9K1Ds5oZ2bEi/z/Fr5fM4Soi3DnsMPqXDeXcXubuF7mkPjZgA5srAlfbYmuff25DndF+65f7sDs86w6UKns9dJi9iNEXshOKfHdCkI/RmE7Q7VzcNWq9nnUJAgM0a2coeR3nrde/SkXvQEoieJ6vlSrNSRI0kKRrHCYoiS1hhyhUUrjk+fNGNyD8KB0YVY0P/AcfC6DiOvXJ7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"도라에몽\"\n        title=\"\"\n        src=\"/static/67c2b1db0c98d93fbf3bb46915892c52/8a4e8/image-4.png\"\n        srcset=\"/static/67c2b1db0c98d93fbf3bb46915892c52/8a4e8/image-4.png 150w\"\n        sizes=\"(max-width: 150px) 100vw, 150px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>마침 도라에몽이 scipy 라이브러리에 <code class=\"language-text\">curve_fit</code>이라는 좋은 도구를 찾아줬습니다~<br>\n<a href=\"https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html\">공식문서</a>는 에 따르면 <code class=\"language-text\">curve_fit</code>은 least square로 fitting해주는 함수라고 하네요<br>\nleast square에 대해서는 아까 소개했죠?</p>\n<p>인자로는 <code class=\"language-text\">scipy.optimize.curve_fit(f, xdata, ydata, ...)</code> 이런 식인데 (...는 optional들)</p>\n<ul>\n<li><code class=\"language-text\">f</code> : 모델 함수\n<ul>\n<li>직선으로 할거니까 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi><mo>=</mo><mi>a</mi><mi>x</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">y=ax+b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span>라는 직선을 가정해봅시다</li>\n<li>그럼 그냥 <code class=\"language-text\">def fit_function(x,a,b) : return a*x+b</code>와 같이 작성해두고, 이 함수를 넘기면 됩니다</li>\n</ul>\n</li>\n<li><code class=\"language-text\">xdata</code>와 <code class=\"language-text\">ydata</code>를 준비해야겠죠? 배열 상태로 준비해둡시다</li>\n<li><code class=\"language-text\">sigma</code> (<em>optional</em>) : 이건 <em>uncertainty in ydata</em>라는데 마침 우리 데이터에는 yerr에 해당하는 <code class=\"language-text\">uncertainty</code>가 있었으니 이걸 넣어줍시다</li>\n</ul>\n<p>그럼 이제 이렇게 쓰면 됩니다</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 선형 모델 함수 정의</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">fit_function</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> a <span class=\"token operator\">*</span> x <span class=\"token operator\">+</span> b\n\n<span class=\"token comment\"># 선형 모델 fitting</span>\npopt<span class=\"token punctuation\">,</span> pcov <span class=\"token operator\">=</span> opt<span class=\"token punctuation\">.</span>curve_fit<span class=\"token punctuation\">(</span>fit_function<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> sigma<span class=\"token operator\">=</span>uncertainty<span class=\"token punctuation\">)</span></code></pre></div>\n<p>리턴값이 궁금한데요</p>\n<ul>\n<li><code class=\"language-text\">popt</code> : 아까 우리가 모델함수로 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi><mo>=</mo><mi>a</mi><mi>x</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">y=ax+b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span>를 정의했고, <code class=\"language-text\">curve_fit</code>을 사용하여 그 모델함수의 <code class=\"language-text\">a</code>값과 <code class=\"language-text\">b</code>값을 정하고 싶었던 것인데, 이 <code class=\"language-text\">a</code>와 <code class=\"language-text\">b</code>에 해당하는 값들입니다.</li>\n<li><code class=\"language-text\">pcov</code> : 이건 <code class=\"language-text\">covariance matrix</code>라는 것인데요.. <em>\"둘 이상 변수들 간의 흩어진 정도(분산)의 상관관계를 나타내는 행렬</em>\" 정도로 이해하고 넘어갑시다.</li>\n</ul>\n<p><img src=\"https://i.imgur.com/LoLbvho.png\" alt=\"\"><br>\n공분산행렬은 대충 이렇게 생겼습니다.</p>\n<p>이 <code class=\"language-text\">pcov</code>에서 얻고자 하는 것은 우리가 얻은 fitting 결과의 오차범위인데</p>\n<blockquote>\n<p>To compute one standard deviation errors on the parameters, use <code class=\"language-text\">perr = np.sqrt(np.diag(pcov))</code></p>\n</blockquote>\n<p>라는 친절한 설명이 있습니다.<br>\n그럼 이 결과들을 이용해서 fitting 결과를 그려봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># pcov로부터 perr값 계산</span>\nperr <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>sqrt<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>diag<span class=\"token punctuation\">(</span>pcov<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 데이터와 fitting된 모델 그래프 그리기</span>\nplt<span class=\"token punctuation\">.</span>errorbar<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> yerr<span class=\"token operator\">=</span>uncertainty<span class=\"token punctuation\">,</span> fmt<span class=\"token operator\">=</span><span class=\"token string\">'o'</span><span class=\"token punctuation\">,</span> label<span class=\"token operator\">=</span><span class=\"token string\">\"original data\"</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> fit_function<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>popt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> label<span class=\"token operator\">=</span><span class=\"token string\">\"fitted model\"</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>fill_between<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>\n                 fit_function<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>popt <span class=\"token operator\">-</span> perr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                 fit_function<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>popt <span class=\"token operator\">+</span> perr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                 alpha<span class=\"token operator\">=</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> label<span class=\"token operator\">=</span><span class=\"token string\">\"error band\"</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>legend<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>xlabel<span class=\"token punctuation\">(</span><span class=\"token string\">\"x\"</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>ylabel<span class=\"token punctuation\">(</span><span class=\"token string\">\"y\"</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">(</span><span class=\"token string\">\"Linear Fitting with Error Band\"</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>적당히 matplot으로 그래프를 그리는 코드를 작성합니다.<br>\n제가 지금 matplot(<code class=\"language-text\">plt.plot</code> 등등..)에 대해 별 설명을 하지 않고 있는데<br>\n저도 그냥 <a href=\"https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.plot.html\">공식문서</a>에서 매번 찾아봅니다.<br>\n아무튼 이렇게 적당히 그려보면</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 593px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9dc19a3c844a1f82b27720bc54c65bb2/0b5b1/image-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.58227848101265%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABp0lEQVR42o2S+3KjIBjF8/5v1Qdo+kcb7RpFrbE13hG8YEB68JJkM92dnnEcBvh9N85Oz5qmaYQuFymlUiqOY9d1fd93HIcQEoZhEATH47EoClwQo5AXox2wLMvOaVqncZ7Etv1uWdbpdBJC9H3fdV2/qZs/IQYpx6+Sf6aFgXHQcpbVvKDMJ8TzvKqq9D80Kk1S9kpOWUUNXJZlVZVlw1nXZ1maF0Vd1/fANAsLLpQVfD3t7fBcoiYDc84ppcMw/JhqpjR+ScVeHf9AopwNSmt0ZGCQSLXA06YFWxbdKC0/3lvuC0l7OS1BDYyh5XmOmT1kXnmto7R6sd29EyXNILegK4ypPpQ9Y9Nl0qwf39yPZ9sL0mY9mr9bZlzF6yH5tezlwiFIkPAQJkKqrZ2/ZrHCTdNce4Yy2iIbiWI+iPuZPWiFUTZgMZgZ/vlI3j3/XNL7zn/UrWzz1JSRMMJc4E/9C93Kbig9Rgkchl2lpLH4fwX/o97V2xgYIsG3dV1hgf7RSNu2eAvG2PIW2Mfm9RQW3j0Ug6jXxeIWXFVbIzDF6vBxlFJ+A4YPYdmSNr5tAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"결과\"\n        title=\"\"\n        src=\"/static/9dc19a3c844a1f82b27720bc54c65bb2/0b5b1/image-5.png\"\n        srcset=\"/static/9dc19a3c844a1f82b27720bc54c65bb2/c26ae/image-5.png 158w,\n/static/9dc19a3c844a1f82b27720bc54c65bb2/6bdcf/image-5.png 315w,\n/static/9dc19a3c844a1f82b27720bc54c65bb2/0b5b1/image-5.png 593w\"\n        sizes=\"(max-width: 593px) 100vw, 593px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이렇게 있어보이는 결과가 나왔습니다~</p>\n<hr>\n<p><br>\n되게 뜬금없는 주제였는데요<br>\n데이터분석기법이라는 물리천문학과 수업을 듣다가 그냥 써봤습니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 300px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9090dbdc2f9ec746b6598718687cee23/5a46d/image-6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVR42gGfAmD9AP///8Xl45rQytbq6OLo6sPNyWJhVT0nFV9LNHtzY4WAcXdwYXhvYbWjbrKbgZKViHSHhp93YqGea4uYgADl5uWhzMiYzcjN6OTm8fHE0c2JjHp0ZFFvYU6Vj32smImlfWileWGNbVSMfGqkpJl+g32hgGmjoHOJl38AHB8rKCMuMCgxQDxFR0ZOOzk7MSokMzArKikjiH93s5OCp3ploHJckWtSnox2qpyFoZZ/npuJn5eIo5uHADgbKRQMHxALHwUEFwEADwAACgAABQYGCAAAAGtSTLyNfJ1tXIdbSn9cRoBmU5qIc5eNdZ2WhZ+YhJ+ZhgBHIzQnGCgWESUTEiQnIigwKSE/MyggGRUAAABbSEDOoZGfcmWEWEOCWz57YVOUgnGThW6alIOblIKel4UARzQqJB0jCggeFxQfVkUvb1g4dWFIQzgvOjEudWherI15iWJPc083kntlkoF2mIZ6jYN0lY59lo9+mZKBAItGOgoMFwgKGAwKFGhcT4p7bHdpXnJjVWdXSWZWS3hpWHNiS2dVP21eUINzY5WEeY6FeJqUhpuThpqShwB0ODc5EhkqCA8PBQqKhYaMg35gUUdsW01cSztbTUFpXEeRf15+bVFeTTtlVUJvXk91bGVybm5ycHBvbnAAgD47YxMvU0FkhYaSqLm9mquvj5qahY6WfYOKe46UgZSZmZuWmaSckqOaip2XiZyUgJydkLC2SlBTJCorANJhVXRCNYGkmcrt9sPi5r/c38bg4qe9zp6yy6GxyZKjw5iryKK70MPo5rbi37fi4rHl65zP1l5iZTc9PgDfZE/DXTWafjWWlIOIi45wbGlZWFVycm9oZWFsaWNpaFySjXeXknljYlVjZFlWWE1bZV0oNDM+Pz5fY2Ab+SP6m8RR5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"몰라요\"\n        title=\"\"\n        src=\"/static/9090dbdc2f9ec746b6598718687cee23/5a46d/image-6.png\"\n        srcset=\"/static/9090dbdc2f9ec746b6598718687cee23/c26ae/image-6.png 158w,\n/static/9090dbdc2f9ec746b6598718687cee23/5a46d/image-6.png 300w\"\n        sizes=\"(max-width: 300px) 100vw, 300px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>빅데이터나 AI처럼 데이터를 다루는 분야에서 이런 것들이 되게 기초인 것 같고<br>\n물리천문학과에서도 실험이나 관측 데이터 셋들을 다룰 때 이런게 기초로 많이들 쓰이는 것 같습니다</p>\n<p>좀 대충 쓴 것 같은데<br>\nscipy의 <code class=\"language-text\">curve_fit</code>에 대해 더 알아보고싶다면<br>\n<a href=\"https://www.geeksforgeeks.org/scipy-curve-fitting/\">GeeksforGeeks</a>같은데서 자세히 써놨으니까 참고하십셔</p>\n<p>이만 마칩니다</p>","frontmatter":{"title":"🪢 scipy의 curve_fit 적당히 써보기","date":"May 09, 2024","description":"5분이면 데이터 분석가(인 척)할 수 있습니다","tag":["Python","Data Analysis"]},"tableOfContents":"<ul>\n<li><a href=\"#%EC%98%88%EC%A0%9C\">예제</a></li>\n<li><a href=\"#scipyoptimizecurve_fit\">scipy.optimize.curve_fit</a></li>\n</ul>"},"previous":{"fields":{"slug":"/producer-consumer-problem-and-readers-writers-problem/"},"frontmatter":{"title":"✍️ Producer-Consumer Problem 그리고 Readers-Writers Problem"}},"next":{"fields":{"slug":"/latex-in-gatsby-blog-by-katex/"},"frontmatter":{"title":"💲 Gatsby Blog에서 마크다운 수식(LaTex) 표현하기 - KaTeX 플러그인"}}},"pageContext":{"id":"bef85955-7b50-5eb3-924f-e75629a2f0ff","previousPostId":"fdea2e54-3b29-55c2-8bd8-021cfabb8b4c","nextPostId":"648bae67-6413-5ac7-93f8-37d07176ca83"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}