{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/mutual-exclusion-by-os/","result":{"data":{"site":{"siteMetadata":{"title":"성훈 블로그"}},"markdownRemark":{"id":"4731dcc2-6182-51ca-9f5c-da0807f06419","excerpt":"Software 로직으로 이리 보고 Hardware Instruction으로 저리 봐도 로 가짜로 대기하는 Busy-Waiting이슈를 피할 수는 없었고 이외에도 다른 이슈가 생기기 마련이었습니다 그럼 어떡하면 좋죠..?  사실 프로세스 다루는 일은 OS가 전문입니다 그런 OS…","html":"<p>Software 로직으로 이리 보고<br>\nHardware Instruction으로 저리 봐도<br>\n<code class=\"language-text\">while</code>로 가짜로 대기하는 <strong>Busy-Waiting</strong>이슈를 피할 수는 없었고<br>\n이외에도 다른 이슈가 생기기 마련이었습니다<br>\n그럼 어떡하면 좋죠..?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 527px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b44a7c601af199c2b2ebd24b10bba70f/44385/image-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.79746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACjUlEQVR42kVT30uaYRT+7rf/Yexv2O6322CDbrb/YcFgo92MVkYrSfFiTgURZmtSJmaF5fz8sYj6VPz5qWVphvZDyaxUikwoeXbOC2svvDfnnPec5zzP80qZTAbFYhGlUgmKomBubg7pdBper1fE9vf3Hy7X8a1Wq7BYLDAajVBVFZFIBIXtbcTjcUjNZhN8er2eaCjLMg4ODhAMBnF/f49yuYzd3V0Rq9frohmfUCgkcrVaDTWKd25uUKah0tnZmSiIxWKIRqMPaCuVCjjHyHZ2drC3t4dCoSAQtVttKFtb6FKTAsUrVO8Zeo+MmoV0cXGBZDIJn88nUITDYTF5m1bgRtfX1+h0Omg0Gjg+PsYRITw/P0ckFsUf2qJyegrvh4/4JUn4/uo1pPn5ebhcLrEWI9TpdBgfH4fBYBDNLy8v0W630af17+h2ul3IYxpEllcQJyDVeg0xhwPud0OwvXgJiblyOp24vb1FKpUSBE9MTIAHMZJsNotgIIBZEuubTo+vz57D8egxhp88hUf2o1wsYXl1FSvEadjjgcSPGF2XJjNn+XweVqsVbrdbcMucKjQkxIPfvIVMjQKDg/g8MADN9DS+jIxAMzYG7eQkNjY2/qv8j0tWeWFhQYgkEJKtXGShqm8NYeIpa/+BLtUHVtcEELbP6Ogo/H6/EE66uroSCbZMq9WCVqvF4uKiSPb7fWxtbuI3DXH9nIXyaRi5UAAuWi2jZgQIpshutwsR2VYSK8gccoDP0tKS8BhTwD7kNWw2G1okTJ5ccHRyApVQT01NwUFi5HI56PV6zMzMIJFIQGIkrPImIWHT8s/h1dk6rDo3ZxSHh4dI0k9gkThnMplgNpvFqvyeaVpfX8dfb3LRtQeJflYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"이렇게 된 이상\"\n        title=\"\"\n        src=\"/static/b44a7c601af199c2b2ebd24b10bba70f/44385/image-2.png\"\n        srcset=\"/static/b44a7c601af199c2b2ebd24b10bba70f/c26ae/image-2.png 158w,\n/static/b44a7c601af199c2b2ebd24b10bba70f/6bdcf/image-2.png 315w,\n/static/b44a7c601af199c2b2ebd24b10bba70f/44385/image-2.png 527w\"\n        sizes=\"(max-width: 527px) 100vw, 527px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>사실 프로세스 다루는 일은 OS가 전문입니다<br>\n그런 OS가 미리 만들어두고 제공하는, Mutual Exclusion을 위한 툴이 있는데<br>\n<strong>Semaphore</strong>와 <strong>Monitor</strong>입니다</p>\n<p>바로 알아봅시다</p>\n<h1>Semaphore</h1>\n<p><strong>Semaphore</strong>는 하나의 구조체 변수로, 정수 변수 하나와 큐를 가집니다.<br>\n또한 이 semaphore는 세 가지의 <em>atomic</em>한 operation을 가지는데,</p>\n<ul>\n<li>Semaphore 정수 변수를 초기화</li>\n<li><code class=\"language-text\">SemWait</code> : 정수 변수의 값을 하나 빼고, 결과가 0보다 작으면 현재 프로세스(값을 하나 뺀 프로세스)를 block시킨다 => 큐로 이동</li>\n<li><code class=\"language-text\">SemSignal</code> : 정수 변수의 값을 하나 더하고, 결과가 0보다 작거나 같으면 큐에서 (블락되었던) 프로세스를 하나 꺼내준다.</li>\n</ul>\n<p>Semaphore의 구조와 operation을 코드처럼 나타내보면 다음과 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">semaphore</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> count<span class=\"token punctuation\">;</span>\n\tqueueType queue<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">semWait</span><span class=\"token punctuation\">(</span>semahore s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\ts<span class=\"token punctuation\">.</span>count<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 하나 빼고,</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span>count <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">//뺀 결과가 0보다 작으면,</span>\n\t\t<span class=\"token comment\">/* place this process in s.queue */</span> <span class=\"token comment\">//큐에 넣고</span>\n\t\t<span class=\"token comment\">/* block this process */</span> <span class=\"token comment\">//블락</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">semSignal</span><span class=\"token punctuation\">(</span>semaphore s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\ts<span class=\"token punctuation\">.</span>count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//하나 더하고,</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span>count <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">//결과가 0보다 작거나 같으면,</span>\n\t\t<span class=\"token comment\">/* remove a process P from s.queue */</span> <span class=\"token comment\">//큐에서 아무거나 하나 제거하고</span>\n\t\t<span class=\"token comment\">/* place process P on ready list */</span> <span class=\"token comment\">//레디 큐로 보낸다 (실행하라고 보냄)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">semWait</code>을 실행하면, <code class=\"language-text\">s.count</code>값에 따라 <em>블락되어 <code class=\"language-text\">s.queue</code>로 들어갈 수도, 넘어갈 수도</em> 있습니다.</li>\n<li><code class=\"language-text\">semSignal</code>을 실행하면, <code class=\"language-text\">s.count</code>값에 따라 <em><code class=\"language-text\">s.queue</code>에서 프로세스를 하나 꺼내 실행가능하게</em> 할 수 있습니다.</li>\n</ul>\n<p>그럼, <code class=\"language-text\">s.count</code>값을 2으로 초기화한 경우 <code class=\"language-text\">semWait</code>과 <code class=\"language-text\">semSignal</code>에 따라 어떻게 되는지 생각해봅시다</p>\n<ul>\n<li><code class=\"language-text\">s.count==2</code>이고, <code class=\"language-text\">semWait</code>: <code class=\"language-text\">s.count--</code> 이후 값이 1이므로 블락되지 않음</li>\n<li><code class=\"language-text\">s.count==1</code>이고, <code class=\"language-text\">semWait</code>: <code class=\"language-text\">s.count--</code> 이후 값이 0이므로 블락되지 않음</li>\n<li><code class=\"language-text\">s.count==0</code>이고, <code class=\"language-text\">semSignal</code>: <code class=\"language-text\">s.count++</code> 이후 값이 1이므로, 큐에서 프로세스를 꺼내지 않음(사실은, 큐에 프로세스가 하나도 없음)</li>\n<li><code class=\"language-text\">s.count==1</code>이고, <code class=\"language-text\">semWait</code>: 위에서와 동일하게, 블락되지 않음</li>\n<li><code class=\"language-text\">s.count==0</code>이고, <code class=\"language-text\">semWait</code>: <code class=\"language-text\">s.count--</code> 이후 값이 -1이므로, <u>해당 프로세스는 블락되어 큐에 들어감</u>\n<ul>\n<li><code class=\"language-text\">s.queue</code>에는 프로세스가 1개</li>\n</ul>\n</li>\n<li><code class=\"language-text\">s.count==-1</code>이고, <code class=\"language-text\">semWait</code>: <code class=\"language-text\">s.count--</code> 이후 값이 -2이므로, 해당 프로세스는 블락되어 큐에 들어감\n<ul>\n<li><code class=\"language-text\">s.queue</code>에는 프로세스가 2개</li>\n</ul>\n</li>\n<li><code class=\"language-text\">s.count==-2</code>이고, <code class=\"language-text\">semSignal</code>: <code class=\"language-text\">s.count++</code> 이후 값이 -1이므로, <u>큐에서 프로세스를 하나 해방</u>\n<ul>\n<li><code class=\"language-text\">s.queue</code>에는 프로세스가 1개</li>\n</ul>\n</li>\n<li><code class=\"language-text\">s.count==-1</code>이고, <code class=\"language-text\">semSignal</code>: <code class=\"language-text\">s.count++</code> 이후 값이 0이므로, 큐에서 프로세스를 하나 해방\n<ul>\n<li><code class=\"language-text\">s.queue</code>에는 프로세스가 0개</li>\n</ul>\n</li>\n<li><code class=\"language-text\">s.count==0</code>이고, <code class=\"language-text\">semSignal</code>: <code class=\"language-text\">s.count++</code> 이후 값이 1이므로, 큐에서 프로세스를 꺼내지 않음(사실은, 큐에 프로세스가 하나도 없음)</li>\n</ul>\n<p>구구절절 썼는데요.. 규칙이 보이시나요?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/21c49c01b21e0334ed2ec892ca13a372/01e7c/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.12658227848101%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC50lEQVR42gHcAiP9AIeMjj9FSTAyNTAzNSsvNCMpMS4uMzQ2OjAzNi0yNC40NRYbHUdLSqmpoXJuboV8e5WQh5OKgqWQh7ikmgA3PUEyNjoqLTAvMzI7RWVkbplUVlk4PENSWGBGTFFXW1t3fICIjIyjpJpnaF1qa2ibk4h9dG11cGt7dnEARkpLREdFOTo5LS8wTVJdiYqXT1NVHiUubnaGQ0hROD48eYB+hIiBmpqXTUw6V11GPkM+EBMXFBkcHyMnAE5YREtNUDU5OE9RTl9kZkpMUD9ERy40O2JwdkhhYDE4Ph0kLUNNQIGRYTY5OB8kITs/QVFUV09TVlNXWgAqNyUkKSsfIiNNTUxiYGBdYWhIT1MyNzlAY1sykXBAUE0WISYsOx9WeA06QDErMDE6Pz9iZmmEiYuYnaAAKDUuJzUvGSolO0pIjI6Tmp2mWGFoLzU1bXBrS41wKFI+Rl1XTF5DWnsSSlxEO0NEFxgWJSYmYmlsgnh4AKmuq7/Dw93Exu20ufi6wNe1uUZRVy0zNXNxcWCRfDFXQ2JuaE9gSmZvGX5rNWtZQD0/QCElLA8ZI045OADu6/Dg3OK4pKiSf39tZ2tTVFdFTE4oMDNTW15BgmpEZ1F3fHBQYlE4SiZRUSdKUDg6TkI0SUQuTlJsTkgA6OLk3t3eWmRWSkcoPkE6FB4jFx8jHycnP0lHLmtQPWVMcHxsbHxrYHVhSGVWW1xMR1A6IUIuMk07VlhHAM3Q0HeDgkxaUGFcR3BeMjs7MS8uIxMaHRMfJQ8fJS5HOTlVQTpZRExnUVBuXJyRhoeHdj9lUj9gTThXRABqd3FNXFU5T0ZJWkxjZl6Ic0S9ixVbSBtPRCKhfA+LhkdFZFxLY1FJYE02V0F9fW6Vk4Zrhnd9k4R3kIAAbX1zV2ZcPUxCKz8zPVJEcHdrq4xI56oQ+cAb9cQ/ybmTm6ahZYFyTW1cQGRQhXpniX9qM2JLS3NeXoRxuM/+UEI4XGwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"주차장\"\n        title=\"\"\n        src=\"/static/21c49c01b21e0334ed2ec892ca13a372/01e7c/image.png\"\n        srcset=\"/static/21c49c01b21e0334ed2ec892ca13a372/c26ae/image.png 158w,\n/static/21c49c01b21e0334ed2ec892ca13a372/6bdcf/image.png 315w,\n/static/21c49c01b21e0334ed2ec892ca13a372/01e7c/image.png 512w\"\n        sizes=\"(max-width: 512px) 100vw, 512px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>결국 semaphore의 값, 즉<br>\n<code class=\"language-text\">s.count</code>의 값은 음수냐 양수냐에 따라서</p>\n<ul>\n<li><code class=\"language-text\">s.count &lt;= 0</code> : <code class=\"language-text\">s.count</code>값 == <strong>블락되어 큐에 들어가 있는 프로세스 개수</strong></li>\n<li><code class=\"language-text\">s.count >= 0</code> : <code class=\"language-text\">s.count</code>값 == <strong>블락되지 않고 지나갈 수 있는 프로세스 개수</strong></li>\n</ul>\n<p>라는 결론에 도달합니다</p>\n<p>그럼 이제, Semaphore로 C.S에 한 번에 한 프로세스만 진입하도록<br>\nMutual Exclusion을 보장하려면..</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">semaphore s <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token function\">semWait</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/* Critical Section */</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">semSignal</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>이렇게, semaphore 값을 1로 초기화하여 단 하나의 프로세스만 <code class=\"language-text\">semWait</code>를 통과할 수 있도록 하고,<br>\nC.S에 들어가기 전에 <code class=\"language-text\">semWait</code>를 실행하여 semaphore 값이 1이었다면 진입, 0 이하였다면 대기하도록 하며,<br>\nC.S를 나오면 <code class=\"language-text\">semSignal</code>로 대기하던 프로세스를 하나 깨워줍니다.</p>\n<p>매우 간단해졌죠??<br>\n마치 C.S에 혼자 들어가기 위해<br>\nC.S 전에는 문을 걸어잠그고<br>\nC.S를 빠져나올 때는 열쇠를 두고 가는 셈입니다</p>\n<h2>Binary Semaphore</h2>\n<p>위에서 이야기한 semaphore는 굳이 따지면 <em>Counting Semaphore</em>이고,<br>\n<em>Binary Semaphore</em>도 있는데요<br>\n이 경우 정수 변수인 <code class=\"language-text\">int count</code> 대신 <code class=\"language-text\">enum {zero, one} value;</code>와 같은 ON/OFF값을 가집니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 225px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b32bc46d44680817f9d75ed7dad959f2/3684f/image-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD+klEQVR42n2U60+aVxzH+27/xJK9abIu65ZdrLMKyAMi1+cCwnPjIgID0VK5CPLwcPXxAsqwOHVLNucEFHYxcVuWzBdbuy7Zur2A6mLii85YK/aiqGmMNVPXgZK+WNZ+c87JyTn5nG9+Oed8zz091T8v1NPn6NwZeVLpJ8+DTyr6734V3t/fz+fzDx88WF1dLW5uFgqFpaWllZWVv+7cWVy8vby8fHR09P/Ox8fHPywsTKdT2S9ymdnZ3MzMTDpTblOTk5lUam5u/vuFn278cuvmr3/8duv3fL6wuPhn+fDN4v0KXNrZURGYQCIGmgV8fqOIzVKAMAQiMimoREm0VW+nGLov2enwdtpsPpoOhcPObs9MNluBt0slUk0iMIyrUEQixBFIo9OTJrPW/D5hbNNaTOGh0cRE2hNkKNpHB/xemrJ0Wqcz6Qq8W9oh5ApIKCSxMggrCRw3GhCttvWKRaVVawxtwWgimvyEYgapUMDl9bgpyuZ0fPb51Knz1jauUCoQuRzDIAKVt5HKdgOk02Fms5TASL3OHexj4hPe3gEH7aX7In3xISoSyH395anz7t6VbgdIqEANKSIVslYUMWqEWq2SJ4q9Vt/A5hhs3Ux83BUIu4P+ULQ/HBtwh+jZM7hUKoFkCwCLII0aUEr4OCjT4YBGo3+P+/PL9YBY0kEzkcR4f2JkKDk6NPrh8NhoJBad+3a+Am+VtsSojAs2y0icDYs4LWKxlhCq1Wxek4THfbMFMvrDgWsTnuhgYHigLxGPXksy0dj8N9+d1rxTkqAwW8KX4CiAwFwFLFDjdUrFO3YTcf2rl4wI7g8Ekh+ZvD1tbquXCQb6GTvlSefOrmq7JEXlbGkTgEjYkLgWFLK02HkSedVnMRZ+fMXequ/2hkc+bnM5ja6OYD8TGGTsPncqN3tW806jVPB6Qw1HDr4r4r3RxKlXKS5higuw6LxMUAOCJqcvMjxmdDqtlMMZ8Xb39ljcHalspvq2r9+84fL7QA3xFpd1sb62QSZhIfClRqCmjlXLBkwOb+/wOGm1IibS6rN30S6jzfxpaqoKHz45PHhyYHE6LjZcfpvTwJZJOSB0mdtUz+UDUrjd7e+Nj5scLlW7wey22309ZsfVyfR0BS5/rcPDw/KoMugv1NbU8rg8COZKwToWwOLwoBbM0uXx939A0SHa5wuFQgzDlCe5XK7qnL9dyOSyli4bqtMIRBIFSoyOjcXjCRRFuQBw1R2IxJIYhkmbOSqQR8ibZfy6sZFYFd4obhSLxd3d3aOjv4sb99bX1w8ODsrre3t7a3fX7z/aevhoe7O4ea+su2sb62tra6uPH+9V4Wd6ljjl4Cj/8xcE0FkY/AuWOtVaEMbtZAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"신호등\"\n        title=\"\"\n        src=\"/static/b32bc46d44680817f9d75ed7dad959f2/3684f/image-1.png\"\n        srcset=\"/static/b32bc46d44680817f9d75ed7dad959f2/c26ae/image-1.png 158w,\n/static/b32bc46d44680817f9d75ed7dad959f2/3684f/image-1.png 225w\"\n        sizes=\"(max-width: 225px) 100vw, 225px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">binary_semaphore</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">enum</span> <span class=\"token punctuation\">{</span>zero<span class=\"token punctuation\">,</span> one<span class=\"token punctuation\">}</span> value<span class=\"token punctuation\">;</span>\n\tqueueType queue<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">semWaitB</span><span class=\"token punctuation\">(</span>binary_semaphore s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span>value <span class=\"token operator\">==</span> one<span class=\"token punctuation\">)</span>\n\t\ts<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> zero<span class=\"token punctuation\">;</span> <span class=\"token comment\">//1인 경우에만 0으로 바꾼다 (통과)</span>\n\t<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">//0인 경우, 이 프로세스를 블락.</span>\n\t\t<span class=\"token comment\">/* place this process in s.queue */</span>\n\t\t<span class=\"token comment\">/* block this process */</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">semSignalB</span><span class=\"token punctuation\">(</span>binary_semaphore s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span>queue is <span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//큐가 비었는지 확인하고,</span>\n\t\ts<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> one<span class=\"token punctuation\">;</span> <span class=\"token comment\">//큐가 비어있으면 1로 돌린다</span>\n\t<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">//큐에 프로세스가 남아있다면 레디 큐로 하나 풀어준다</span>\n\t\t<span class=\"token comment\">/* remove a process P from s.queue */</span>\n\t\t<span class=\"token comment\">/* place process P on ready list */</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 경우 큐에 프로세스가 얼마나 있다거나, 몇 개나 통과할 수 있다거나, 이런 것은 알 수없지만<br>\n<code class=\"language-text\">count</code>변수를 따로 유지하거나 할 수도 있긴 합니다<br>\n그리고 <a href=\"https://www.geeksforgeeks.org/mutex-vs-semaphore/\">geeksforgeeks</a>에 따르면<br>\n전에 썼던 <a href=\"https://sungpaks.github.io/multi-threading-in-cpp/\">C++에서 멀티스레딩 써보는 포스팅</a>에서 사용했던 <strong>Mutex</strong>가 이러한 Binary Semaphore의 일종이라는 것 같습니다.<br>\n딱 하나만 지나갈 수 있게 허락하는 Semaphore로 상호배제를 구현하는 셈.</p>\n<p>확실히 좋아진 것 같긴한데, 아직도 Semaphore로는 부족한게<br>\n아직도 자꾸 몽총한 제가 관리하라고 떠넘기죠?<br>\n<code class=\"language-text\">count</code> 값도 그렇고.. 알아서 잠그고 들어가서 열쇠 놓고 가라고 하고..<br>\n이러다 제가 실수로 열쇠 두고 가는 것을 깜빡하면 어쩌죠?<br>\n변기칸을 잠그고 도망가버리는 어글리 코리안이 되기 십상입니다</p>\n<p>그래서 나온게</p>\n<h1>Monitors</h1>\n<p><strong>Monitor</strong>는 Program-Language Construct, 즉 동기화를 위한 어떤 라이브러리 함수나 패키지같은 것이라고 보면 되는데<br>\n구조는 일단 아래와 같이 생겨먹습니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 463px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2a8b224eaee2f17cae054ceb7f5685a6/71ce0/image-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 137.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEX0lEQVR42pVVx24jRxTk/3+AsbAN2IAP6wDtwQfvGlhLtgAxzTAMJ4l5OAxiFikGUVQoVzU1hLSWD9vAA4f9Xle/WJ3C166nR/zuVfFbycdqucBoNMRiuTyqU09PT3h8fHxTpEvE7Ol3v8eJE+BnAgYVB2dnZ/CD0IDJJvXVHj484JeSh3fnGQz7PTRbTcxm84PzvDC1uL5GqVSC6/kIwxCFYpE3Bmg0m1it11hvNtjv79But1Aql+G5Lor1Jux6A1vqpF+vVri5ucF2u0UqncnAsm0jZR4o5HOwczm4joNMNotsNoMiLykUCsYmjmMEBA09F1dXV+h2u0Z6vZ45n3I9D0uiD6ksVuv46Ib40wvxOazB8X3kCNjt9tBo1FGt1nB3d4f5fI7xZILd7S1W9G7NSLRa7fYBcECwNkM8d328u7Dw3UUeP1plWE7F3HrLg/1+n6HvMRj0ETH8qNPBaDzGhiHL691ux98uUh4B+4MBOtzs8dDZ32f46/SU4VmwGWqHB+/v75nDtjl0NRyiXq9R6phMp9TtzWXSKXTj4XA0QrVWQ5OHwmrVfNd4oMhiCVDVa7Za6Pa69HDA3A2NCCiKIrSo05JtqsIEz5gT3TyktNoRInorj6VT4u/vH4yxvNSeQlROPT/AhpUd0SGlxXgog2kCSIXyElMxv56bA1F08DCOOwQf0Mue8VJV7XRiXLPtkvzGbwGqQOHlpdnzWGUlWkvfjUbD5E6eCrBPkbfHkPn9X0D+Kn+T2cyAKAwVxbIsgjUQhJeYsGXUPirEAydHHpuQecGrHI4Z7vV0gsV8huViDp8h61YdUn6T8TryxPP3lNU+VjkBlHd1Jj5HD/KUUrMFhzpVUflRiFr61gUiAv1qHYsiD5O2aTE/n4tlfJMt4ttcCd/bFdgVF1mO5va5gopAh1V5halv7Ul3KFx8aOwelUp+sxPhw6dPOPnjI06zeeTylmmXL0PVdIgMkv1Ep2iOoyd26ZOOxCptVk1t4j73nJZhlc2aoW0NXY2fx07AmmcDmDT2lBXVHw13hRd4pDEvDDgpZZM75S2dTsNxyEaFoqn2jGdEEovFwkQhm1dFUUMbI1Z5xra4oWFAXpTxA9tGxiqCkq82epkGtdGrtlHP9box0mSb93YZv1JOyh6KrkevHBOaCvB/bTOZTAm4M7N+zKEoKe2H+CGdx08ZC+9FX2UHFQLqdk3Dko+RwtS4SfStPUWhRjchv6QvjdbF+T8oWHnYZGubLK1Z1hLAgq/cDQEEotzptUvAj0WRh8pfjRzXZtlrBNXI+SyM0pGMnjxU78U8pL0BCUH8KeZOODP+clIEbLylgYwDPo9JlQUSRW04lYp50Jpssyq5c7O9NflVng9VpsGcLr+kL4n25KmYRUvTkeRMsysQ/VeFkzmXbcrmSyZQVfOlqKn16pWeWVuisANeIr1vqC0205HoHb5BKYUjpnhLEorSe6tKy7sanwf1mzyWXqFKL5Htv/7HEdKA/tpnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Monitor 구조\"\n        title=\"\"\n        src=\"/static/2a8b224eaee2f17cae054ceb7f5685a6/71ce0/image-4.png\"\n        srcset=\"/static/2a8b224eaee2f17cae054ceb7f5685a6/c26ae/image-4.png 158w,\n/static/2a8b224eaee2f17cae054ceb7f5685a6/6bdcf/image-4.png 315w,\n/static/2a8b224eaee2f17cae054ceb7f5685a6/71ce0/image-4.png 463w\"\n        sizes=\"(max-width: 463px) 100vw, 463px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>자세히는 이어 설명하겠지만<br>\n해당 그림에서 <em>MONITOR</em> 영역, 즉 하얀 색 영역은 그 자체로 Critical Section으로,<br>\n사실상 하나의 <em>성역</em>같은 것이라<br>\n그 안에는 단 하나의 프로세스만 들어갈 수 있고<br>\n그 안에 있는 지역 변수는 그 안에서만 접근 가능하며<br>\n미리 정의된 Procedure(≈ function)로만 그 지역 변수를 읽고 쓸 수 있습니다</p>\n<p>좀 더 친숙하게는<br>\n🚽 화장실 변기칸 같아서<br>\n🚶 그 안에 사람은 한 명만 들어가서 문을 걸어잠그고<br>\n🧻 그 안에 있는 휴지는 그 안에 들어간 사람만 쓸 수 있고<br>\n💩 그 안에서 할 수 있는 일은..<br>\n;;</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 300px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/614753d3fd99ff7d1c5409285e722d3d/5a46d/image-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACoUlEQVR42hWO207TAABA+xVcFIOSGBM0chn3MYcbi1wGShiDgDDcxqCjK13XtevWtfTC2q67VhgMGBkZiAwQESUYfMDwYuILmhDjk1F/RHw7L+fkAEcnF3vHn5PZHR+TsNmmEA+kRPhMWsmmlVU1Viy+kcV4Q30zgYf39492d/fPPp2fnp4dfzg5fPsOyK1vbWweqEv5aCwLzkBzHndc5FbU2KoaXUnK3PwCQYTFSGwtV2BoTpISm4Xi7t4RTc1LogSkZWk1m9/a2D7YOmCIIAxdy3xWVVbT8nIyEgxQEIQSBCVHkzwfidAUCzv8s9M+BCWDYSDBkpnF7FZu+yD/OuzFZsGZ/9spaSUlqlHWjxEkSTPzEVlOUDTPE1AGH0uGIJrhMCwEiAS8GFeXoy9ziWXEjVz3Imw4rQhLcUFhSVN7m7ZBo2tuMLS3NtXWuEYHogFXJIyDbm8+vweEILvCMcebBSFAGUzdOE7SAVTmwskFWqDQLn2bsa3R0KrpM7Y3PKh+btbLuIPwTPFC/PuPP4BEzP38cnFe2Ji1jNjGbRiG+yAng8FiGGdJxNpj6DfpuvSt/Z06bZNm0voMd7+QReny6m/x8CPQWNfIEoFDgVUR2IvAzkkHAbsYn4vzg5TXZe0xPu181GfUjg6YW2ofTjtnLq9+f/32q7DzHoYxoKSs4s6typB9HEc90y7H+MhQEIUEEuEwkAAnevTang5dn0FvNT8xaZstAxZuIe0EA9Og1+8PASWl5TdvVAyaTbB7ymW3DfV3+SEnH/TxpJeA7Nr6mnuVt+uq748NDvR29U5MTPkDHCskfSgRVVJAWWm5oUUz3P140KQbNndazCYUnKRQiMag68rdqiqttkOSUolEJhRiZTm1lnt1DQwtZJbX/wGZki0jxYEStQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"변기\"\n        title=\"\"\n        src=\"/static/614753d3fd99ff7d1c5409285e722d3d/5a46d/image-5.png\"\n        srcset=\"/static/614753d3fd99ff7d1c5409285e722d3d/c26ae/image-5.png 158w,\n/static/614753d3fd99ff7d1c5409285e722d3d/5a46d/image-5.png 300w\"\n        sizes=\"(max-width: 300px) 100vw, 300px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>아무튼 예.. 그렇습니다<br>\n아예 Scope를 분리해서 C.S로 만들어버리고, 접근은 정해진 함수로만 하는 의존성 역전 like한 발상<br>\n좋은데요</p>\n<p>그래서 Monitor는 아래와 같은 구성요소들을 포함하는데</p>\n<ul>\n<li>한 개 이상의 <strong>procedure</strong> (≈ functino)</li>\n<li>모니터만의 <strong>지역 변수</strong></li>\n<li><strong>Condition 변수</strong></li>\n<li><strong>초기화</strong>를 위한 코드</li>\n</ul>\n<p>이 <strong>Condition 변수</strong>는 Semaphore와 되게 비슷한 친구인데<br>\n얘도 큐를 가지고 있고, <code class=\"language-text\">cwait(c), csignal(c)</code> 함수를 가집니다<br>\nSemaphore랑 다른 점은 Condition 변수는 <strong>값이 없다</strong>라는 점인데<br>\n따라서 <code class=\"language-text\">cwait</code>은 값이고 뭐고 블락시켜 큐에 집어넣고,<br>\n<code class=\"language-text\">csignal</code>은 값이고 뭐고 해당하는 큐에서 하나 꺼내옵니다</p>\n<p>그리고 아까 Monitor 구조 그림에서 좌측 하단에 <code class=\"language-text\">urgent queue</code>라는게 있는데<br>\n요거는 이제 어떤 procedure에서 중간에 <code class=\"language-text\">csignal(c)</code>가 실행되면 프로세스를 깨우게 되니까<br>\nMonitor 내에는 단 하나의 프로세스만 존재한다는 철칙을 지키기 위해<br>\n깨어난 프로세스를 위한 자리를 내주고 <code class=\"language-text\">csignal(c)</code>를 실행한 프로세스는 여기에서 잠시 숨는 곳입니다</p>\n<p><a href=\"https://entertain.daum.net/tv/948839/video/392827640\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACnElEQVR42g3C+08ScQAA8Pvj2nLrZVmtZWlrWS1/qKlTN3U+yjJXPALi4XkonCIqlwqiwHF3HHAHB3iAeKeI31NOBc0H4GtT2/KzDzQ50tnRXKVRPWztqutqe2zSNXvntJRPTROqgF9J48owrkkxcJoxCdxwhkOEuFkSsOzKRJo3QXPooKqnYaC3uk35yQA3To11WYe6LXAP5das8UiOR8SYcZnRpSKK5civFcaYjcC5hFWMIwKnh4JuU8Q7HPNZ2EW1Z37QiX1lAj9pUkEuKkKLulTYKiXtuYQtHbKJnE1eHt1bsxVWR6XMMOtVQFHCkKBgPojEA0iMRBhcH8LVfFQXi6qBMMJx1tml2ZtTHJaKYELEsZme3xZcF4X5nYwDCi1oGUIbJtURUpcJWbIsmqQQ19SvGDVSlhcu9mkp6wRr7jzwHQCyIHj/5qiSzF4dJa5LSWiFRjMhBMTHi5npQ3HmUvYJ4bGO1sZvvS2dbR9cUyaQcJ4B8iznr2wQp8B/DnyX21Rp3bO37ILWwlbA2csSeVVauj5J/jtNmY0DiElvMRs1/Z0/elvfv63VKHsN2n6dssdmVnDENOMdr2yHz2UW2oo7ADd9mPWdbFGnm0QZ4B1NDfXPHrypf+IxKfs/vqq+d+v1y5q654/qa2tq7lfduV3V1d5yIAXO9jlog51IeoyAndhLO4vp2e2EA1a0v3txt6nhqelLk03bPQkP2Ayf3Ta1H9MH5oxjv/tcqEoMomJwDNrl/xR5bD81U0xiIGzl3frk4pBIjGRws0ijuzwmsePrtLWw5DgSnEV+WmJQwKCbUftqwAKVZeoYeE7yZCVPHANvWQ4c3cwTJZk6LTKVHXp/3Xu4ge+mZiXWvuJDCHTQCffh6PfgpPI/U+fTXXZ4RsgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"혼자있고싶어요\"\n        title=\"\"\n        src=\"/static/584a6e97fc49d9418a635965cabba648/f058b/image-7.png\"\n        srcset=\"/static/584a6e97fc49d9418a635965cabba648/c26ae/image-7.png 158w,\n/static/584a6e97fc49d9418a635965cabba648/6bdcf/image-7.png 315w,\n/static/584a6e97fc49d9418a635965cabba648/f058b/image-7.png 630w,\n/static/584a6e97fc49d9418a635965cabba648/40601/image-7.png 945w,\n/static/584a6e97fc49d9418a635965cabba648/78612/image-7.png 1260w,\n/static/584a6e97fc49d9418a635965cabba648/21b4d/image-7.png 1280w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></a></p>\n<hr>\n<p>이제 이 OS에서 제공하는 Semaphore나 Monitor라는 툴을 써서<br>\n다른 새로운 문제들을 기깔나게 해결하는 방법을 알아보려고 하는데</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 308px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e9bdf6269bd7c3cf690f67cc78e6de30/2ece4/image-8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVR42gGfAmD9AGBka1lYXFBQU0FARkpJT0xLUU1OVFI4NUApKSklKquAbuWwm7OShjsyNR8eJRoZHhEQFj88Q0A9QhgYHgBBQkhPTlNKSU8xMTU2Njo7OkAyMzl5ZGJSQUZaRUHlqJPlqZbGlINPPzwUFh0cGSAKDBBJOk5vXHBRUlYAHyAmIyEnHx4lGRgeJSQqFhUcCQgOgH2EcW56j2de3qOQzZWFq3xySTM0GBceGhkeEhEWGRgic4uYm5icACckKisrMCMhKCgnKykoLhIRFxsZHxMUHRAOFbiFeN6ejMiNf7mEd25QTzMvNxAQFxUUGhwaH0tUXHmFjABHMi4lJy0nJiovLzMlJCoREBYZGB5TRkUsKCx0XFiTXlqEVVZ3UEZ/b3Z9f40NDBIkIyooJy4yMjo/SFEAQCwnJigvKikuLi0yHh0jDQ4VUEA+4qeSgWNmTEhUl2RghE1OXEE9QDtMnJutLCwyJyQrQDk+LSkvZl5nACwmLR0cIispLiopLxcVGxMVHG9YUrB8cDkrOJaXo8++v4hta6GZoTEvQl5ac0hHWT8yN3VdXVZBQsK2ugBPXHdibo04OkYWFRpEQkdTVFltXmCAXlkyL0azsbvGwMnKx8+ZlqQzMElPTGpMSGZRTV5KS1BjYGnz6+gAUmaScIm6WmqPGhomcG9wkpSZh3h8gmtqQUJSd3V8s6+1m5ifXFpsWFdsTkxgPDpUNjREGhgfqqWq//rzAFBhj0tdiEBSejQ5TFJRUWpqbXZ1e25ubn9/f4uLi4aGhZKQk4mIln6AgnJyeT07VSMhMk9OV/ju6v3n4ABHWYg7SWs+TnEgJTYnJShNTFo/P1RAPk41Mz88OkhmZXJiYG5WVHFLSmBUUmI3NUxoZHHy7u//9/X14N0miuFngl7TNQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"지루해\"\n        title=\"\"\n        src=\"/static/e9bdf6269bd7c3cf690f67cc78e6de30/2ece4/image-8.png\"\n        srcset=\"/static/e9bdf6269bd7c3cf690f67cc78e6de30/c26ae/image-8.png 158w,\n/static/e9bdf6269bd7c3cf690f67cc78e6de30/2ece4/image-8.png 308w\"\n        sizes=\"(max-width: 308px) 100vw, 308px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이쯤되면 그거까지 고봉밥으로 담기에는 양이 많아지는 것 같으니<br>\n다음 포스팅에 쓰겠습니다?</p>\n<p>이만 마칩니다</p>","frontmatter":{"title":" 🕹️ OS 툴로 Critical Section 통제하기 : Mutual Exclusion By Semaphore & Monitor","date":"April 20, 2024","description":"OS에몽 도와줘~","tag":["OS"]}},"previous":{"fields":{"slug":"/mutual-exclusion-hardware-approach/"},"frontmatter":{"title":"🙋 선착순 한 명 Critical Section!! : Mutual Exclusion Hardware Approach"}},"next":null},"pageContext":{"id":"4731dcc2-6182-51ca-9f5c-da0807f06419","previousPostId":"b60ea0f0-b4fe-55cb-8688-8f0aa372e139","nextPostId":null}},"staticQueryHashes":["2841359383"],"slicesMap":{}}