{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/chrome-extension-feature-updates/","result":{"data":{"site":{"siteMetadata":{"title":"조성개발실록"}},"markdownRemark":{"id":"b2fa23f1-8513-5c44-a654-f6895cd98d8e","excerpt":"안녕하세요 오늘은 귀여운 햄부기로 다시 돌아왔습니다 햄부기 1.2.…","html":"<p>안녕하세요<br>\n오늘은 귀여운 햄부기로 다시 돌아왔습니다<br>\n<a href=\"https://chromewebstore.google.com/detail/bugi-and-friends-121/cidndoahplamogkfaimmahedcnakjnag?hl=ko\">햄부기 1.2.1</a> 👈👈 즉시시작</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/db3bc84500a92da394f208e359363cc5/c6d67/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.17721518987341%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAABNklEQVR42q2UPUvDQBjH+yncnP0ijuIofga/gCI46OLm5NTJLlJFJIPRqS1kEkVEKA7i0JSmtXnTtDW5S+7u7zUxhUKFpN7BcW/P/e7/3HP3VKC4VIoaCiEgOJt21ADVKfxVNPFt9B80kMCdmy8N5FM3ZWndnONoYwVPhj43XxooBE/bfreLxrUG+2M4u9OSQLlBwqKIIJgQEEJBkwRhGMLzPMRxXA6YK3CsDt7vdYyDL3z6PqxeD6ZpyoOihUr/BMaUwu+0cVs9wPHmKlp3VyAxk+rcVCGV64UUcp7d2Wv7GSdba6jubcPQLuEOrFkwcptCwNyFcRCgeXGGt5fHdMxoiOR79P93KHiStkbtEPXdddjDwfJR5ky6xzKgXq/hdH8HjmMvC1z4YVQmB55VVUDl6aso8AeuUy/cNw6KkAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"햄부기 분신술!!\"\n        title=\"\"\n        src=\"/static/db3bc84500a92da394f208e359363cc5/f058b/image.png\"\n        srcset=\"/static/db3bc84500a92da394f208e359363cc5/c26ae/image.png 158w,\n/static/db3bc84500a92da394f208e359363cc5/6bdcf/image.png 315w,\n/static/db3bc84500a92da394f208e359363cc5/f058b/image.png 630w,\n/static/db3bc84500a92da394f208e359363cc5/c6d67/image.png 734w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>근데 이제 다중그림자분신술을 곁들인..</p>\n<figure>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/74d4c0f114199206356a1d0a3f95b2c0/21b4d/image-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.9493670886076%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADG0lEQVR42h1SZ1MaXRjdH5l8T2b8ppPyxhTTLSNComhiErEEdpEmfZeahbgLOkZYAVlE0DcBFJQiRaWMgJozYXbuPPPcOeWeA8FxXLPZLJVKmUy2VqvV6/WLiwtsrq6uDg8POY7vdrvYnJ+fn/37FQqF4+Pjk5OTTCZDPHjwkFvn4nExf5y/vb1t1BvNy8ubmxvM9Vp9N7bb7/dB1G63sQER8J1OB1w4iYGBgaHBoZGREdCfnp6CslKphMPh4mmxXCrzfABuksnk0dERwMVisVwu53K5/eQ+qInBwaH79+5rNNper4e7RqMRi0ZfvXxltVjDoTBs1+uNRGKvedmEnWg0ltxLiqJYKJx0Wh3i0aPHz589j0Si2WwWz4CaRCK5c/cuy7Jjo2NLS8sQA/WUVGq306FQWBB2DtIHtWoNJ7GyvOKgHQkxEYvGQtshMS5+/fIV+Ldv3z35b1ihWPT7/OPjE5OTk7PyuXQ6jRRSKZxxk9FMAAAnyMzj9tI0YzFZYNi4ZlSpSLlc/uLFyPcVpVq9SlHqhW8KmVQmnZItfFtQflfqtDpienpGJvsglco+Ts/Mzc7Nf5qXTE69fz/65vWb4eGnE+MTO8JOaj8FX9CM78ZdThfYVUqSttPEzIwcE6mitBqtxWyhVNTnT/Ozs3Ms64MpfAi5Wq3m8/nqWbVULLdbbfwdQBTgAwQwcE+qSIPOoNcZYGZRsbS0uNxqtVCeKCYARsmYr6+v+71+t9urVM7+/P7jdXsJm9Vmt9Grag37gzWbLDqNbs1gBJ3T4YLD9XUul83FYrE9NBQXwyEB36+tbR/rxxMIhnbQdsa4ZnLQDElSft9Pg96gplbNJjN6Gh0d0+v02NA2miIpzaqWVJKIE5DNjU3C4/Y4GafNAn271WJj7Izb5YERzHjFlETqYJwQ2Ahs/PSvBwNBlOJyuoN8UAgJBDDbv7ZxbbPaUSkGgBEEz/EQ/yj7gMwiQkQICztCBFbTqTSIUC1uCYgE+YDHBX0XzGMFca/HizBRr2JhEcEeHvyf3Ntnf/i2NrcCfFCn1SNXB+P4C5FHoQ36TydeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"다중그림자분신술!\"\n        title=\"\"\n        src=\"/static/74d4c0f114199206356a1d0a3f95b2c0/f058b/image-5.png\"\n        srcset=\"/static/74d4c0f114199206356a1d0a3f95b2c0/c26ae/image-5.png 158w,\n/static/74d4c0f114199206356a1d0a3f95b2c0/6bdcf/image-5.png 315w,\n/static/74d4c0f114199206356a1d0a3f95b2c0/f058b/image-5.png 630w,\n/static/74d4c0f114199206356a1d0a3f95b2c0/40601/image-5.png 945w,\n/static/74d4c0f114199206356a1d0a3f95b2c0/78612/image-5.png 1260w,\n/static/74d4c0f114199206356a1d0a3f95b2c0/21b4d/image-5.png 1280w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<figcaption>만화 나루토 中</figcaption>\n</figure>\n<p>이 글에서는 햄부기 기능 업데이트에 대해 아래와 같은 내용을 다룹니다.</p>\n<ol>\n<li>햄부기가 나오지 못하는 페이지에서는 별도의 안내 팝업을 띄우기</li>\n<li>햄부기를 생성하고 삭제하는 등 상호작용할 수 있는 팝업 패널을 추가하기</li>\n<li>다중 그림자분신술!!</li>\n<li>관성운동(던지기) 구현</li>\n</ol>\n<h1 id=\"크롬-확장프로그램은-실행할-수-없는-페이지가-있어요\" style=\"position:relative;\"><a href=\"#%ED%81%AC%EB%A1%AC-%ED%99%95%EC%9E%A5%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8%EC%9D%80-%EC%8B%A4%ED%96%89%ED%95%A0-%EC%88%98-%EC%97%86%EB%8A%94-%ED%8E%98%EC%9D%B4%EC%A7%80%EA%B0%80-%EC%9E%88%EC%96%B4%EC%9A%94\" aria-label=\"크롬 확장프로그램은 실행할 수 없는 페이지가 있어요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>크롬 확장프로그램은 실행할 수 없는 페이지가 있어요</h1>\n<p>햄부기 뿐만 아니라 모든 크롬 확장프로그램들은 실행할 수 없는 페이지가 정해져 있습니다.<br>\n이를테면 <code class=\"language-text\">chrome://</code> 으로 시작하는 url이거나 등등..<br>\n특히 아래와 같은 크롬 기본페이지에서 그렇습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/beb9e1b5235852ce74926132861bafd1/f1f01/image-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.78481012658228%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAv0lEQVR42n2QQQqDMBREo6jgDcSFK8GNh6hiUfAK3sEzKEbULAxRqLedNr/WloIuHn9+mMyEMMYYznAcB7ZtH7tpmrjy77yFYRiwLIvQQfosTVNUVYWyLFEUBeq6Jv3r1fwVnbe5rgvP8xAEAeI4Rp7n8H3/+oW6TYswDDGOI/q+B+ccfJ9d16FpGpp6b9sWQghiGEZIqXBLku+XfAKjKMI8zxQ6TQLT64KUEuu6EsuyEForpQjt3x4bsux+BD4BFZ6cmzxwy8gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"크롬 기본 페이지\"\n        title=\"\"\n        src=\"/static/beb9e1b5235852ce74926132861bafd1/f058b/image-2.png\"\n        srcset=\"/static/beb9e1b5235852ce74926132861bafd1/c26ae/image-2.png 158w,\n/static/beb9e1b5235852ce74926132861bafd1/6bdcf/image-2.png 315w,\n/static/beb9e1b5235852ce74926132861bafd1/f058b/image-2.png 630w,\n/static/beb9e1b5235852ce74926132861bafd1/40601/image-2.png 945w,\n/static/beb9e1b5235852ce74926132861bafd1/78612/image-2.png 1260w,\n/static/beb9e1b5235852ce74926132861bafd1/f1f01/image-2.png 2212w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>유저들은 보통 이런 사실을 모르니까 냅다 눌러보고 \"어라 왜 안되는거징;;\" 이라고 느낍니다</p>\n<p>보통 잘 만들어진 크롬 익스텐션들은 아래와 같이 합니다 :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/46ac4ffbb066618db2c0e6127af0559c/82158/image-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.848101265822784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABJ0lEQVR42l1Q22rCUBA8+O6FgJTWPiQkIhrjKfWWuzaRWEUTSUggUNqX+v+fMHUXItKHYWdmD3N2V3ieB9/3GY/8Ue92O6zXNmazGZJwiTcpEXlzLN8lPg8HJEmC1WqFzWYDEYYhE8J2u+VKXuOTV1UVa3kLLKM5pLSQfyzgLSS+vn9Q1zVcx8XhFi6m0ykmkwlGoxGDtGma90q98XjMPcMwoGoGdF3H0/MLBoNXqKoKTdNgWRZvIM7nM9I0xX6/59XKssTlcuGpiGdZhjzPURQFjscjrtdfnE4n9Pt9RqfTgaIoHChvpxBxHPNadK+GB0EA13URRRFs22ZN3HEcrrQ+DUG61+tx8HA4ZIhutwsC/URoND387xFvt9v3fvOGvFarBSEE/gAusr0gc69ksgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"React Dev Tools는 이렇게 알려줌\"\n        title=\"\"\n        src=\"/static/46ac4ffbb066618db2c0e6127af0559c/f058b/image-3.png\"\n        srcset=\"/static/46ac4ffbb066618db2c0e6127af0559c/c26ae/image-3.png 158w,\n/static/46ac4ffbb066618db2c0e6127af0559c/6bdcf/image-3.png 315w,\n/static/46ac4ffbb066618db2c0e6127af0559c/f058b/image-3.png 630w,\n/static/46ac4ffbb066618db2c0e6127af0559c/82158/image-3.png 696w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>근데 햄부기는 그런게 없어서 유저들이 잘 모르겠네요.<br>\n적당히 저런 안내 팝업을 띄울 수 있도록 해주려고 합니다.</p>\n<h2 id=\"그런-경우에는-안내-팝업을-띄워줍시다\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9F%B0-%EA%B2%BD%EC%9A%B0%EC%97%90%EB%8A%94-%EC%95%88%EB%82%B4-%ED%8C%9D%EC%97%85%EC%9D%84-%EB%9D%84%EC%9B%8C%EC%A4%8D%EC%8B%9C%EB%8B%A4\" aria-label=\"그런 경우에는 안내 팝업을 띄워줍시다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그런 경우에는 안내 팝업을 띄워줍시다.</h2>\n<p>이거 하려고 React Dev Tools Extensions의 코드베이스를 뜯어봤어요 - <a href=\"https://github.com/facebook/react/blob/main/packages/react-devtools-extensions/src/background/tabsManager.js\">이거</a> 그리고 <a href=\"https://github.com/facebook/react/blob/main/packages/react-devtools-extensions/chrome/manifest.json\">이거</a> 등.<br>\n그랬더니 React Dev Tools는 아래와 같이 써서 제한된 페이지를 판별하는 것을 발견했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">isRestrictedBrowserPage</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>url<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> urlProtocol <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>protocol<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> urlProtocol <span class=\"token operator\">===</span> <span class=\"token string\">\"chrome:\"</span> <span class=\"token operator\">||</span> urlProtocol <span class=\"token operator\">===</span> <span class=\"token string\">\"about:\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그대로 긁어주면 되겠네요 ㅋㅋㅎ</p>\n<p>이제 이 경우 띄워줄 팝업을 위한 html을 적당히 하나 만듭시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>shared.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>shared.css<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n  <span class=\"token selector\">html,\n  body</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">min-width</span><span class=\"token punctuation\">:</span> 286px<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">min-height</span><span class=\"token punctuation\">:</span> 33px<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>b</span><span class=\"token punctuation\">></span></span>Sorry, Bugi is not supported here.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>b</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span>\n  Extension cannot be activated on this type of page.\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>이제 서비스워커로 등록한 스크립트(<code class=\"language-text\">manifest.json</code>에서 > <code class=\"language-text\">\"background\": {}</code>에서 > <code class=\"language-text\">\"service_worker\":</code> 로 등록한)에서</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">setPopup</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">type<span class=\"token punctuation\">,</span> tabId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  chrome<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span><span class=\"token function\">setPopup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    tabId<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">popup</span><span class=\"token operator\">:</span> chrome<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span><span class=\"token function\">getURL</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">popups/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>type<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.html</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  chrome<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span><span class=\"token function\">openPopup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 팝업을 오픈하는 유틸함수를 정의합시다.<br>\n이렇게 하면 <code class=\"language-text\">tabId</code>(현재 탭을 의미)에다 특정 팝업 html을 오픈해줍니다.</p>\n<p>이제 <code class=\"language-text\">chrome.action.onClicked</code>에서 :</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">chrome<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">tab</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> currentUrl <span class=\"token operator\">=</span> tab<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> isRestricted <span class=\"token operator\">=</span> <span class=\"token function\">isRestrictedBrowserPage</span><span class=\"token punctuation\">(</span>currentUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>isRestricted<span class=\"token punctuation\">)</span> <span class=\"token function\">setPopup</span><span class=\"token punctuation\">(</span><span class=\"token string\">'restricted'</span><span class=\"token punctuation\">,</span> tab<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token keyword\">await</span> chrome<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span><span class=\"token function\">setBadgeText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">tabId</span><span class=\"token operator\">:</span> tab<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> isRestricted <span class=\"token operator\">?</span> <span class=\"token string\">'⚠️'</span> <span class=\"token operator\">:</span> nextState<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>제한된 url인 경우 이 팝업을 띄우게 해줍시다.<br>\n내친김에 뱃지도 달아줬어요.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 618px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/870018fc924851684122feec0675eda3/6e6fb/image-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.58227848101266%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABDUlEQVR42m1NO2uDYBT153RIoGl3FenSViEOodSl+MChWzv0B3TpT9JBghKquPhEXBOSQMAURRAX7Wn8QFraHjj33Hvui+I4DgzDgGVZomM+8mdN0zR4nsdiscDs4hLnkzPcX80wnU7w+HAHQZRASZIEXdehqio0TSOUZZno4P32FUUh83NRhHB7A2nOQ+Cv8fzyCvXpDZTneQiCAEmSIIoixHGM9XqNLMuQ5znCMCR+mqbYbrcY0Pc9RvSf3/Vq5YDyfR/L5ZLQcRyYpkmOD48sy4Jt26fBFXa7HcqyxH8YD7quC+r9FD6OR7JwOByw3+9RFAXJN5sN0aHXti2apkFd139YVRW6roNhGPgCnUwog3vvkYYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"제한된 페이지에서 팝업\"\n        title=\"\"\n        src=\"/static/870018fc924851684122feec0675eda3/6e6fb/image-4.png\"\n        srcset=\"/static/870018fc924851684122feec0675eda3/c26ae/image-4.png 158w,\n/static/870018fc924851684122feec0675eda3/6bdcf/image-4.png 315w,\n/static/870018fc924851684122feec0675eda3/6e6fb/image-4.png 618w\"\n        sizes=\"(max-width: 618px) 100vw, 618px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>문구는 좀 바꾸긴했는데 아무튼 잘됩니다. 야호</p>\n<p>이게 되는거면 아예 햄부기를..<br>\n옛날처럼 저 아이콘을 누르면 하나 띵 나오는게 아니라<br>\n팝업 패널을 띄워서 거기서 하나 더 추가 주문하든, 하나 없애버리든, 우짜든, 할 수 있을 것 같은데요?</p>\n<h1 id=\"확장프로그램을-누르면-상호작용할-수-있는패널이-나오게-하기\" style=\"position:relative;\"><a href=\"#%ED%99%95%EC%9E%A5%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8%EC%9D%84-%EB%88%84%EB%A5%B4%EB%A9%B4-%EC%83%81%ED%98%B8%EC%9E%91%EC%9A%A9%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8A%94%ED%8C%A8%EB%84%90%EC%9D%B4-%EB%82%98%EC%98%A4%EA%B2%8C-%ED%95%98%EA%B8%B0\" aria-label=\"확장프로그램을 누르면 상호작용할 수 있는패널이 나오게 하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>확장프로그램을 누르면 (상호작용할 수 있는)패널이 나오게 하기</h1>\n<p>무슨 말이냐면요</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 614px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/49e0c12f8c6f3b6d457abc5f99552692/e9131/image-6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 102.53164556962024%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAADFElEQVR42n1U205TURA9f2Ji8MWoCTYqF60FoQQCDyS++e6X8BlAuIWgMSHQF3iRAGoBay+UUopQ29IeKJRegN4odHnWwG4OpWEnk9l7zpo5M7P2bK27uxtdXV2gVnvz2WazifT29qKjowN2ux2dnZ1obn6Jt62v8OHdG7S0tuLTx35Yre+g9fT0iCMd+vr6xIG2gYEBOVutVlgsFgwODqK9vV1wNtt7PHrchLYXT2C3NOHps+f43N+GtpbX0GZmZjA9PY2pqSlMTk6KTExMiHBP+/j4OMbGxu5gRkdHMTxiyPCIfPvy9RuGhoag5QMOeN0uxA4OcGBIKpXC/Pw8FhYWsLGxgdXVVbjdbjgcDqTTaXBVq1WY1/X1teh1A69VCmkBFgoFVCoVlMtlZDIZXFxciC2XyyGfz4u+vLysBaSoQEo7nU5ogUAQe3t72N/fRyQSgdfrRTgclvPm5qbYdnZ2sL29LZmGQiHs7u5ia2tLcD6fT87n5+dwuVzQUicnSGfSUurp6SkSiQSOj48la13XJdsTA0M7W3J0dITDw0PRtPOH3JdKJTjXWbJRJqOzREqxWMTZ2dmdPUtmuapUc8nm0sN/PdBWVlawtLQk9XO/vLyMxcVFrK2tSclzc3NiDwaDNcf6Va3e2EM+o4fmppobXp+JyqbRUv4/fv66CUhmWZISxTY1g1xdXYnm2YxTQiy/kyit0b1SZzadd5Hk+P1+Ia0RXi1yIQH5Z2ZhFpbBe8igJIWsU9Nej6U/7cRIQBXALMyCpWSzWWGc14fnepz6AfHEPlhyMpkU9uPxODwej0zLQ3h+1xhdEVEvjRhvhKM/47CKexmqPcvkXeR4cew4kgGDxbIxEffv4Y1PNpdtTAr7wr8qQtgbMkxdviWgnhQu3giNDkyVYAr7QGc+DrFYTK4M5zUSjSEZ/4esHjbYzNbwFPVaccJklhmUBmoOOR8K/o3Ccv8Yr4jb50fY40Tm93fkjIDFUhGFWz+2h5lyhDW+IswgGo3WhJkl9IQIGabWDVw8oSMa1+9gKfTnCzQ7O4v/iM/XiMnzyv0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"이런거 할거임\"\n        title=\"\"\n        src=\"/static/49e0c12f8c6f3b6d457abc5f99552692/e9131/image-6.png\"\n        srcset=\"/static/49e0c12f8c6f3b6d457abc5f99552692/c26ae/image-6.png 158w,\n/static/49e0c12f8c6f3b6d457abc5f99552692/6bdcf/image-6.png 315w,\n/static/49e0c12f8c6f3b6d457abc5f99552692/e9131/image-6.png 614w\"\n        sizes=\"(max-width: 614px) 100vw, 614px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이렇게 만들어서, 햄부기를 나오게 하고 또는 없애고를 이 패널에서 버튼으로 해결하게 하고 싶다는 뜻입니다.</p>\n<p>이게 저는 처음에 <code class=\"language-text\">manifest.json</code>에서 <code class=\"language-text\">defaultPopup</code>과 <code class=\"language-text\">scripting</code> 권한은 양립할 수 없다고 봤어서 구현못하나? 싶었는데<br>\n찾다보니 <a href=\"https://stackoverflow.com/questions/20764517/execute-script-after-click-in-popup-html-chrome-extension\">스택오버플로우</a>에서 답을 찾을 수 있었습니다.</p>\n<p>한 마디로 <strong>팝업 html에 삽입하는 자바스크립트와 서비스워커 자바스크립트 간에 메세지를 보내 통신</strong>하면 됩니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 604px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e77ed3c19f6eac14cb8107fb6b865b79/87254/image-7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.075949367088604%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVR42n2QSw6DMAxEc/9DcQU2rBACxKeEPwgBQiG0T7HURUs7C2tie8aO1XEcaZq2bfv8i8vhg6txHB8O27ZJ4VYp5DxPY8w7qWQmyr7vIdba6wvkp2mq65qeeZ6ZR8RINU1Dbd93cbmdTDfKoihohsdx3HUdeqW1ZpNlWXjzf1bAJQzDsixxJCZJ4nleVVXCoyiCoCIqefu+HwQBu6EchoFImSHGAVOsuWuWZXmeawfGKLFkE5S/1pY851jXlTbs5Nov/6CP8fjkAeUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"팝업 -&gt; 서비스워커 메세지통신 모식도\"\n        title=\"\"\n        src=\"/static/e77ed3c19f6eac14cb8107fb6b865b79/87254/image-7.png\"\n        srcset=\"/static/e77ed3c19f6eac14cb8107fb6b865b79/c26ae/image-7.png 158w,\n/static/e77ed3c19f6eac14cb8107fb6b865b79/6bdcf/image-7.png 315w,\n/static/e77ed3c19f6eac14cb8107fb6b865b79/87254/image-7.png 604w\"\n        sizes=\"(max-width: 604px) 100vw, 604px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>일단 그럼 <code class=\"language-text\">popup.html</code>부터 만들어봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n  <span class=\"token comment\">/* 대충 스타일 작성 */</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>create-new-bugi<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>햄부기 주문<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>destroy-bugi<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>햄부기 폐기<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>popup.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>여기에 바로 인라인 스크립트를 작성할 수는 없더라구요<br>\n그래서 <code class=\"language-text\">popup.js</code>를 따로 만들어 삽입해줍니다</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">document\n  <span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"create-new-bugi\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    chrome<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">action</span><span class=\"token operator\">:</span> <span class=\"token string\">\"create-new-bugi\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndocument\n  <span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"destroy-bugi\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    chrome<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">action</span><span class=\"token operator\">:</span> <span class=\"token string\">\"destroy-bugi\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>각 버튼에 이렇게 클릭 이벤트리스너를 등록해줍니다.<br>\n<code class=\"language-text\">chrome.runtime.sendMessage</code>로 적절한 메시지를 보내면 됩니다</p>\n<p>이제 서비스워커인 <code class=\"language-text\">scripting.js</code>에서는..</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">chrome<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span>onMessage<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message<span class=\"token punctuation\">,</span> sender<span class=\"token punctuation\">,</span> sendResponse</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>message<span class=\"token punctuation\">.</span>action <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>currentTabId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>action <span class=\"token operator\">===</span> <span class=\"token string\">\"create-new-bugi\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">createNewBugi</span><span class=\"token punctuation\">(</span>currentTabId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>action <span class=\"token operator\">===</span> <span class=\"token string\">\"destroy-bugi\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">destroyBugi</span><span class=\"token punctuation\">(</span>currentTabId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이런 식으로 메시지를 받을 수 있게 구독해둡시다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 259px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1b78d058fad89a56079522bba56846a4/a2ead/image-9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.68354430379746%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADh0lEQVR42hXO2VMaBwCA8Z1pasdIRWI4RXAXlmuBBQEDAygoiwhyCiw3CMoZDkFFRYtRvGhjqJ0QTbwyrU2nhyGZdtqXvrf/VdOZ7/33AVzKQz6NyKcPwlQCl9rPovSP0YYkXDYKj0lhtoTDGqM9SumVz2vhtUquWs7rEFrcgC6ouBMaCPBakZHhQRrpIWOYwKISIBpRyR9DIDZvlC6GGDIeUwrS7UZtNmi1zU62W+tHa7jBKMb9hnwhDmA6PosyyKYOQpQBEf1LFBp5IhbJBTyYSeEwHiPgCAqDCkTkwvRWTLdSTNbykWACn9DLufJJgEnq4zAGBaNDYgZBQO4XsWhyoUAEgmwqGWYx5QiiVijlYtkEIorgjq2dnQWbc3Y2QQF1MOoE4NHhkcdf0Ib6IPIAm9QP0x/J+BAMgjwQUkhkqACRiMclqErKHUvF8dPuq5Nm06yyWTyl9x//BGChiD9KtevGISqJNvC5BqJnrJPWJ1K9DBFAIJvJBEEOCAk1EnivHDvYLuezqXIyfXl923nxAmBxhPpx1KNXcqgkYt9nIS36fMnbjNk75VjBhcEQOC6Ecw5sN+m8/6Z8dnl68f7+7a+9QmXDb3MCJqNGIZNhMh5IJg70PYhqkYti6CTte3dQ/feq3crFW8uh3n715Wb2/LB488fHD73fb25uO68uLptZoBgxRD2TmEIAkYkP/pel/3SPftmt/Pas9Hen2Ttc+3BQv2qUKqnw693aUWv1/O5N9/urs/ZW7+sisOTVLro1aa+ByxjikAkVi+y6nHi7ln1Xz9w/W/m5Vf1hr3J3WAvYzKeN1ZNSopGYP6kmTquL3a0skFzQleJzX5X85ZDhu+WZ47B63aa7rWZ+2i7cbee768s/tuvX+xXPvG13JXe2XV2NujZSeKuS2ismgGk1x2NCKinn+WG+89S97tXjSqiTCX77NLoasO5nA91GtrORxszWQsT3+qhxUE1n/JZ6OlBPhwCLDrVohTNKdsKt3km7KrjZooKdn9KIZSI46cSO88FGyutw+N2mqQxu38wl8mFHIeoox9xAcN7kN6nqMawUnF6N2Yu4OWGfck+iPkzjNKptRv12bnG/ENfrpoLW6bDHEnKZFxdmcyF7MeIAFFKBz6z967J9ebwZts/Ukr5PV0sezD8/nQm5AjaTCEGMpjmDYSruNK4kQ6VFPOWzZfD5XHDuP4MEF8u1cCTaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"귀 쫑긋\"\n        title=\"\"\n        src=\"/static/1b78d058fad89a56079522bba56846a4/a2ead/image-9.png\"\n        srcset=\"/static/1b78d058fad89a56079522bba56846a4/c26ae/image-9.png 158w,\n/static/1b78d058fad89a56079522bba56846a4/a2ead/image-9.png 259w\"\n        sizes=\"(max-width: 259px) 100vw, 259px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>아, 원래 <code class=\"language-text\">chrome.action.onClicked</code>는 바로 햄부기소환이었는데, 이제 바꿔야겠죠? <code class=\"language-text\">popup.html</code>을 띄울 수 있도록.<br>\n아까 <code class=\"language-text\">setPopup()</code>함수를 만들어뒀으니, <code class=\"language-text\">type</code>값을 <code class=\"language-text\">popup</code>이라고 이름을 넣어서 사용하면 됩니다</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">chrome<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">tab</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  currentTabId <span class=\"token operator\">=</span> tab<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> currentUrl <span class=\"token operator\">=</span> tab<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> isRestricted <span class=\"token operator\">=</span> <span class=\"token function\">isRestrictedBrowserPage</span><span class=\"token punctuation\">(</span>currentUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> prevState <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> chrome<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span><span class=\"token function\">getBadgeText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">tabId</span><span class=\"token operator\">:</span> tab<span class=\"token punctuation\">.</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isRestricted<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setPopup</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"restricted\"</span><span class=\"token punctuation\">,</span> tab<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> <span class=\"token function\">setBadgeText</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"⚠️\"</span><span class=\"token punctuation\">,</span> tab<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setPopup</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"popup\"</span><span class=\"token punctuation\">,</span> tab<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">chrome.action.onMessage</code>에서 tabid를 써야하니까 <code class=\"language-text\">tab.id</code>를 따로 전역변수로 저장합시다.<br>\n이제 <code class=\"language-text\">isRestricted</code>가 아닌 경우에는 <code class=\"language-text\">popup.html</code>을 띄우게 해주면 되겠습니다.</p>\n<p>마지막으로 할 일은 <code class=\"language-text\">createBugi</code>와 <code class=\"language-text\">destroyBugi</code>함수를 작성해주는 것인데요</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">createNewBugi</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tabId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  chrome<span class=\"token punctuation\">.</span>scripting<span class=\"token punctuation\">.</span><span class=\"token function\">insertCSS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">tabId</span><span class=\"token operator\">:</span> tabId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">files</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"bugi.css\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  chrome<span class=\"token punctuation\">.</span>scripting<span class=\"token punctuation\">.</span><span class=\"token function\">executeScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">tabId</span><span class=\"token operator\">:</span> tabId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">files</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"bugi.js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">destroyBugi</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tabId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  chrome<span class=\"token punctuation\">.</span>scripting<span class=\"token punctuation\">.</span><span class=\"token function\">executeScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">tabId</span><span class=\"token operator\">:</span> tabId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">function</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> bugiToDestroy <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>bugi<span class=\"token punctuation\">;</span>\n      bugi<span class=\"token punctuation\">.</span><span class=\"token function\">_destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">delete</span> window<span class=\"token punctuation\">.</span>bugi<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이러면 끝입니다.</p>\n<h1 id=\"다중그림자분신술-구현하기\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%A4%91%EA%B7%B8%EB%A6%BC%EC%9E%90%EB%B6%84%EC%8B%A0%EC%88%A0-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0\" aria-label=\"다중그림자분신술 구현하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다중그림자분신술 구현하기</h1>\n<p>사실 bugi를 클래스로 만들어둔 덕에 여기서 살짝 잡기술만 넣어주면 끝인데요<br>\n먼저 <code class=\"language-text\">bugi.js</code>에서..</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">window<span class=\"token punctuation\">.</span>bugi <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">window<span class=\"token punctuation\">.</span>Bugi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이렇게였나.. 햄부기 인스턴스를 하나 만들게 되어있었는데요<br>\n아래와 같이 배열로 관리될 수 있게끔 해줍시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>window<span class=\"token punctuation\">.</span>bugiArray<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  window<span class=\"token punctuation\">.</span>bugiArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nwindow<span class=\"token punctuation\">.</span>bugiArray<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">window<span class=\"token punctuation\">.</span>Bugi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>그리고 이제... 다시 <code class=\"language-text\">scripting.js</code>에서,<br>\n<code class=\"language-text\">createNewBugi()</code>와 <code class=\"language-text\">destroyBugi()</code>는 아래처럼 생겨먹으면 되겠죠?</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">createNewBugi</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tabId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bugiCount <span class=\"token operator\">>=</span> bugiMaxCount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  chrome<span class=\"token punctuation\">.</span>scripting<span class=\"token punctuation\">.</span><span class=\"token function\">insertCSS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">tabId</span><span class=\"token operator\">:</span> tabId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">files</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"bugi.css\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  chrome<span class=\"token punctuation\">.</span>scripting<span class=\"token punctuation\">.</span><span class=\"token function\">executeScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">tabId</span><span class=\"token operator\">:</span> tabId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">files</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"bugi.js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  bugiCount<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">destroyBugi</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tabId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bugiCount <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  chrome<span class=\"token punctuation\">.</span>scripting<span class=\"token punctuation\">.</span><span class=\"token function\">executeScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">tabId</span><span class=\"token operator\">:</span> tabId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">function</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> bugiToDestroy <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>bugiArray<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      bugiToDestroy<span class=\"token punctuation\">.</span><span class=\"token function\">_destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// delete window.bugi;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  bugiCount<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">destroyAllBugis</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tabId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bugiCount <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  chrome<span class=\"token punctuation\">.</span>scripting<span class=\"token punctuation\">.</span><span class=\"token function\">executeScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">tabId</span><span class=\"token operator\">:</span> tabId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">function</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      window<span class=\"token punctuation\">.</span>bugiArray<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">bugi</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        bugi<span class=\"token punctuation\">.</span><span class=\"token function\">_destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      window<span class=\"token punctuation\">.</span>bugiArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  bugiCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>서비스워커 스크립트는 <code class=\"language-text\">window</code>객체에 접근해서 <code class=\"language-text\">bugiArray.length</code>를 가져오기 귀찮으니, 따로 변수를 관리해주게 했습니다.<br>\n이 <code class=\"language-text\">bugiCount</code>는 <code class=\"language-text\">chrome.runtime.onMessage</code>에서 <code class=\"language-text\">setBadgeText(bugiCount.toString(), currentTabId);</code> 이렇게 해서 현재 화면에 나온 햄부기 수를 알 수 있게 해뒀습니다.</p>\n<p>내친김에 햄부기 전량폐기까지 해주면..</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">destroyAllBugis</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tabId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bugiCount <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  chrome<span class=\"token punctuation\">.</span>scripting<span class=\"token punctuation\">.</span><span class=\"token function\">executeScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">tabId</span><span class=\"token operator\">:</span> tabId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">function</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      window<span class=\"token punctuation\">.</span>bugiArray<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">bugi</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        bugi<span class=\"token punctuation\">.</span><span class=\"token function\">_destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      window<span class=\"token punctuation\">.</span>bugiArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  bugiCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그럼 이제 \"햄부기 주문\" 버튼을 막 눌러보면</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9025a3dd74b7cc921b25a1cf79b85d69/b5a09/image-8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.74683544303798%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAADF0lEQVR42nVT2U4UQRSdz/HBB3jkhUWWiMqX+eSjiZoYl6hoohlAgzpsAQQhEEIEZnq2nu7pvXrvnu4Z5nirBhQMVuekqqtvnbr3nNuFoaEhjIyMYGZmBtPT0xgfH8fY2BhGR0cF7kxO4t79B5idncXc3BwmJiZEzGXs5OQUpqbvYvj2LQwND6Pw6sVLvH83j89LS1haXMJicUFgoVhE8VMRq9++YHdzBbs/91AqlbC8vIy1tTWUy2WBWq2Ora0dfJh/h9evXqOwsbmOerMGoI9ev4fzKw8faRrDsUx4ngfbsuA4DgzDAGNM7IVhiLybi9ij4yMUnMSG6rahEHSvDdNVYTiKgMZaaBkyKhXpIpsarSvQNA1JkiCKInTSDljgQGUy3A5DIc8yNDUL1ZYGtVqDWZbgSHV4UgNuU4ZJ2aRpKgj4HASBmK+OhIhDz0X//JwIOymiwEND1XBMZJrehsMsuFSeH7iI4xDnFNjv98VsmqZAr9e72AfiKETgMXrvocA3fXoxbRPMd+GabXjMQEhkKd0ak078ML+dz7ZtCx3/S3jw9Q2Otr+jfnyKxi8Ji88eovT8MZisobK3D1OWya7ByEgeizK3yCS+vsz8GqF0+AOKdIJII+dIu5ZUQV2SoGsquarD1nUwZ+CooiiQ6FujVoWjNOD7AcEnxx0idC5KphvShFrDJA2PDlA9O0Xz5BfqJyd0SEGo6SSJRxe0YZkGbNLPsUljksgjIg7fZcjy7sCUjEwJSbs0TdBWFViUWUjO+gYncsEoy9U3j+A55HYcIQ79K/CQxAECZmL30xNk1LOFbtYhA3xsfnyKw+0SlFYL1WoFzUaNMtJh6SoOVhbgk/OchHfEVfA9m6pbX3xLiXlEmGdwmY3D9S8wWlVRfkyBSRT8OZTn+Y1kHLw6m0xK0kzoXOjRb6OpMmSZo0kZUdvoBqKQBzOkJElKTc0P3kQ4IPUQuLyVuoM/hVvOwQ9d6hNRH2aUWXn3O852vok137uu4XUIl3kf8Sb9i66YeZl8nO5v4HRvXaxzkod/63a7Av+uOddvzO+EglG040EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"분신술 완성\"\n        title=\"\"\n        src=\"/static/9025a3dd74b7cc921b25a1cf79b85d69/f058b/image-8.png\"\n        srcset=\"/static/9025a3dd74b7cc921b25a1cf79b85d69/c26ae/image-8.png 158w,\n/static/9025a3dd74b7cc921b25a1cf79b85d69/6bdcf/image-8.png 315w,\n/static/9025a3dd74b7cc921b25a1cf79b85d69/f058b/image-8.png 630w,\n/static/9025a3dd74b7cc921b25a1cf79b85d69/40601/image-8.png 945w,\n/static/9025a3dd74b7cc921b25a1cf79b85d69/78612/image-8.png 1260w,\n/static/9025a3dd74b7cc921b25a1cf79b85d69/b5a09/image-8.png 1360w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>햄부기가 가득한데요~<br>\n진짜 화면가득 채우실 분들도 있을까? 싶지만 일단 50개까지 맥스를 해뒀습니다 ㅎㅎ;;</p>\n<h1 id=\"관성운동을-구현해서-햄부기를-던져요\" style=\"position:relative;\"><a href=\"#%EA%B4%80%EC%84%B1%EC%9A%B4%EB%8F%99%EC%9D%84-%EA%B5%AC%ED%98%84%ED%95%B4%EC%84%9C-%ED%96%84%EB%B6%80%EA%B8%B0%EB%A5%BC-%EB%8D%98%EC%A0%B8%EC%9A%94\" aria-label=\"관성운동을 구현해서 햄부기를 던져요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>관성운동을 구현해서 햄부기를 던져요</h1>\n<p>이건 1.1.0 업데이트에서 추가된 기능인데요<br>\n햄부기를 잡아다 드래그해서 탁! 놓으면 그대로 쭉 던져집니다!!</p>\n<p><img src=\"https://i.imgur.com/T2CRIeH.gif\" alt=\"햄부기 던지기\"></p>\n<p>구현하러 갑시다.</p>\n<p>일단 이런걸 구현하려면 <code class=\"language-text\">dx, dy, dt</code>같은 순간변화량들을 계산해야겠어요<br>\n그럼 먼저 <code class=\"language-text\">mousemove</code>(그리고 <code class=\"language-text\">touchmove</code>) 리스너에서</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 기존 mousemove리스너 코드</span>\n<span class=\"token operator\">...</span>\n<span class=\"token comment\">// 관성운동량 계산</span>\n<span class=\"token keyword\">const</span> currentTimestamp <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>timeStamp<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> dx <span class=\"token operator\">=</span> clickX <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lastPosition<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> dy <span class=\"token operator\">=</span> clickY <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lastPosition<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> dt <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>currentTimestamp <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lastTimestamp<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> dx <span class=\"token operator\">/</span> dt<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> dy <span class=\"token operator\">/</span> dt<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lastPosition <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> clickX<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> clickY <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lastTimestamp <span class=\"token operator\">=</span> currentTimestamp<span class=\"token punctuation\">;</span></code></pre></div>\n<p>일단 먼저 <code class=\"language-text\">this.lastPosition</code>과 <code class=\"language-text\">this.lastTimestamp</code>를 미리 저장해두고 있어야겠습니다<br>\ntimestamp는 이벤트객체로부터 얻어옵니다.<br>\n이 직전 물리량들로부터 매 순간 <code class=\"language-text\">dx, dy, dt</code>를 계산하고,<br>\n이로부터 매 순간의 속도를 계산해둡시다.</p>\n<p>이제 <code class=\"language-text\">mouseup</code>(그리고 <code class=\"language-text\">touchend</code>) 리스너에서는, <code class=\"language-text\">isDragging</code>인 채로 끝났고, 실제로 움직였는지 확인하고 <code class=\"language-text\">startInertiaAnimation()</code>메서드를 호출하게 하겠습니다<br>\n=> <code class=\"language-text\">if (this.moved) this.startInertiaAnimation();</code></p>\n<p><code class=\"language-text\">startInertiaAnimation</code>은.. 좀 긴데요</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">startInertiaAnimation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> decay <span class=\"token operator\">=</span> <span class=\"token number\">0.95</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 감쇠상수 decay</span>\n  <span class=\"token keyword\">const</span> easeFactor <span class=\"token operator\">=</span> <span class=\"token number\">0.0075</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> rotationFactor <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setPose</span><span class=\"token punctuation\">(</span><span class=\"token string\">'standing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// requestAnimationFrame에 넣을 콜백 animate함수</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">animate</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">timestamp<span class=\"token punctuation\">,</span> currentVelocity</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 1. 속도 감소</span>\n    currentVelocity<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*=</span> decay<span class=\"token punctuation\">;</span>\n    currentVelocity<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*=</span> decay<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 2. 다음 위치 계산</span>\n    <span class=\"token keyword\">let</span> nextLeft <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span>left <span class=\"token operator\">+</span> currentVelocity<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> easeFactor<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> nextTop <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span>top <span class=\"token operator\">+</span> currentVelocity<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> easeFactor<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 3. 브라우저를 벗어나게 생겼으면 방향 반전 (반사)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n      nextLeft <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span>\n      nextLeft <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>imgOffsetWidth <span class=\"token operator\">></span> window<span class=\"token punctuation\">.</span>innerWidth\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      currentVelocity<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n      nextTop <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span>\n      nextTop <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>imgOffsetHeight <span class=\"token operator\">></span> window<span class=\"token punctuation\">.</span>innerHeight\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      currentVelocity<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 4. 반사를 적용해서 다시 다음 위치 계산, 위치 업데이트</span>\n    nextLeft <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span>left <span class=\"token operator\">+</span> currentVelocity<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> easeFactor<span class=\"token punctuation\">;</span>\n    nextTop <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span>top <span class=\"token operator\">+</span> currentVelocity<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> easeFactor<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span>left <span class=\"token operator\">=</span> nextLeft<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span>top <span class=\"token operator\">=</span> nextTop<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 5. 회전하면서 날아가게 함</span>\n    <span class=\"token keyword\">const</span> rotateDegree <span class=\"token operator\">=</span>\n      Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>currentVelocity<span class=\"token punctuation\">.</span>x <span class=\"token operator\">**</span> <span class=\"token number\">2</span> <span class=\"token operator\">+</span> currentVelocity<span class=\"token punctuation\">.</span>y <span class=\"token operator\">**</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span>\n      rotationFactor<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>degree <span class=\"token operator\">=</span> rotateDegree<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updatePosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setFlipped</span><span class=\"token punctuation\">(</span>currentVelocity<span class=\"token punctuation\">.</span>x <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 6-1. 속도가 충분히 작아지면 애니메이션 끝</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n      Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>currentVelocity<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.1</span> <span class=\"token operator\">&amp;&amp;</span>\n      Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>currentVelocity<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.1</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inertiaRAF<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">cancelAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inertiaRAF<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inertiaRAF <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setPose</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sitting'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 6-2. 속도가 아직 남아있으면 계속 진행</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inertiaRAF <span class=\"token operator\">=</span> <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">newTimestamp</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      <span class=\"token function\">animate</span><span class=\"token punctuation\">(</span>newTimestamp<span class=\"token punctuation\">,</span> currentVelocity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 애니메이션 시작!!</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inertiaRAF <span class=\"token operator\">=</span> <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">timestamp</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token function\">animate</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol>\n<li>일단 먼저 감쇠계수인 <code class=\"language-text\">decay</code>를 적당히 0.95정도로 정하고, 다른 상수들도 적당히 조정해가며 정해줬습니다.</li>\n<li><code class=\"language-text\">requestAnimationFrame</code>에 넘길 콜백함수 <code class=\"language-text\">animate</code>을 선언합니다.</li>\n<li><code class=\"language-text\">requestAnimationFrame</code> 호출!!</li>\n</ol>\n<p><code class=\"language-text\">animate()</code> 함수는..</p>\n<ol>\n<li>먼저 속도를 decay</li>\n<li>다음 위치를 일단 계산</li>\n<li>다음 위치가 브라우저 밖으로 나가려 하면 방향을 반전 (벽에 튕기기)</li>\n<li>방향이 변했을 수 있으니 다시 다음 위치 계산</li>\n<li>날아가며 회전하게 하고자 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msqrt><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>v</mi><mi>x</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>v</mi><mi>y</mi><mn>2</mn></msubsup><mo stretchy=\"false\">)</mo><mo>∗</mo><mi>f</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">\\sqrt{(v_x^2 + v_y^2) * factor}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.84em;vertical-align:-0.6716em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1684em;\"><span class=\"svg-align\" style=\"top:-3.8em;\"><span class=\"pstrut\" style=\"height:3.8em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.453em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.453em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3831em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">or</span></span></span><span style=\"top:-3.1284em;\"><span class=\"pstrut\" style=\"height:3.8em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.88em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.88em\" viewBox=\"0 0 400000 1944\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M983 90\nl0 -0\nc4,-6.7,10,-10,18,-10 H400000v40\nH1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7\ns-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744\nc-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30\nc26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722\nc56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5\nc53.7,-170.3,84.5,-266.8,92.5,-289.5z\nM1001 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6716em;\"><span></span></span></span></span></span></span></span></span></span>\n<ul>\n<li>속도라는 2차원 벡터의 크기를 구한다.. 어쩌구. 근데 너무 빙글빙글돌아서 ease-factor를 곱해 회전수를 적게 가져가줍니다.</li>\n<li>생각해보니 360deg 기준에 맞게 정규화?했어야 하는 듯</li>\n</ul>\n</li>\n<li>속도가 일정 이하로 작아지면 애니메이션 끝, 아니면 계속 진행.</li>\n</ol>\n<p>사실 <code class=\"language-text\">timestamp</code>는 유지할 필요 없었네요.</p>\n<p>아무튼 이렇게 해주면 이제 햄부기를 막 던질 수 있게 됩니다~<br>\n나중에는 햄부기끼리도 튕겨서 당구가 되게 하고 싶은데요 ㅋㅋㅋ</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 256px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1466c08a9440be070efe8c6bf79f71aa/6f3f2/image-10.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.21518987341771%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADcklEQVR42o2OXUxadwDF/w9rsmRLs7TJXpYmS7ZkL61pXOYyU9vMLF2r1dpYlYKUWq5UoFgEQQThWvkScHLlYxYtUwbGWnW9VFC3ifRD2k7caBl2eLlXKthMKZJIt+HmxLE97Lm/p/NwfjkHrK+ve71ev9+/sLCAYZjH49na2tp9BbLZLMhkMhsbG+l0enNz87eXLxOJxPb2Xzs72Z3/yO7u/p//3t7O1WLxeCy2kkqlcj7YfWVyU8lkMvcuvLT04kXyX3nrz0w0Fo2uRCNLYQKPEDhGEHgYx3/GlrCV6O9/ZOLPE8GnRCgUIcLE8vKznIz/EiKWFzdSCbCGP3V/bR7vQzqbGpUioRaWwTIpG26vk0ikpp7VX5PX7a7zDUoao5XJaqIwmHVkEudcOZtdMWg1guehHx/2a/1mtYPT0MeCerlMGfcKo1lI4zerrlnieERvtldSBHSmwHpjUKLoqD1zCjp7kkQq7kU0YA1bfDLY42lvGmKcH5dLxzVKE597iUql0Wg6/RfhB7NtLbITJRQ9cm1+zjVx08imnCaXHaPUfoqoYJBeJXxa8YwOvu9y9RgNnVo10qXiQfQLp0oMbS3T3mG+gHP5UuO0d04i5Nj0PERMP1p4KP/DAwohHzz76aEPaQtPo4EI3jdghehUjU71/TfjHSyGRSoy24w1587CglZ0xAbzoYHuJpuSzaKUQZWfaSRCkCQW7+rFnmHrY3w5uBi4MeqYQkechi4D7/LklwislH6UX6BQaS1qESJmWOWsMc2VOw5N1ScfXOVzwFokOKbgDHe2ok6nwYzItXJEyBnqhE3d6hl7v7S9o4pCm38SdFjUAzqulUdtKS0sfv/tAwCoJVwQCTywiS5O6QS9Aia7qrz6+DFSUYGwmYNYur+bHBFL2mSarvuzkwo2VS+gck98XLD/zcP73nhvD5C3cgH2aPY2zPD2iNyKxls8qINOqmfWXWyAmBDF3K0gk2tb2uXu4esS8mmTqL668GDe3teL3t1/5J3XjFf5IP7Y51Gw7nTxnXK2qPJ49ZmS0oqSz0uLK8qPqGSNRUeLKmtqxr5SXziZL2WUyZlleXtBTd5b9Yf33DJJQCadigd8q8FHwXsz3imXZ+Zbl3tiwo26Jkb9P9xFUfS2E42GA46B/lG7FQt4fW77/NTQHDoYi4T+Ac7UN9Fcg8yYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"날아간다\"\n        title=\"\"\n        src=\"/static/1466c08a9440be070efe8c6bf79f71aa/6f3f2/image-10.png\"\n        srcset=\"/static/1466c08a9440be070efe8c6bf79f71aa/c26ae/image-10.png 158w,\n/static/1466c08a9440be070efe8c6bf79f71aa/6f3f2/image-10.png 256w\"\n        sizes=\"(max-width: 256px) 100vw, 256px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<hr>\n<p><br>\n다음번 글은 성능개선에 관해 쓸건데요<br>\n지금은 위치 업데이트를 <code class=\"language-text\">position</code>속성을 직접 바꿔서 하고 있습니다만<br>\n근데 그것보단 <code class=\"language-text\">transform</code>을 이용한다면 layout 재배치(reflow)단계를 확 줄일 수 있는거 아닌가? 라고 생각했습니다<br>\n이를 검증하고.. 성능지표를 수집/분석해보고.. 실제로 개선해보는 과정에 대해 써보려고 합니다</p>\n<p>커밍쑨.</p>","frontmatter":{"title":"🔨 햄부기 기능 업데이트 - 팝업 패널, 다중그림자분신술, 관성운동","date":"January 06, 2025","description":"크롬 확장프로그램이 제한된 페이지는 경고팝업을 띄우기, 팝업에서 스크립트 실행하기, 여러 객체 생성하기, 관성운동 구현하기","tag":["JavaScript","Chrome Extension"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%ED%81%AC%EB%A1%AC-%ED%99%95%EC%9E%A5%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8%EC%9D%80-%EC%8B%A4%ED%96%89%ED%95%A0-%EC%88%98-%EC%97%86%EB%8A%94-%ED%8E%98%EC%9D%B4%EC%A7%80%EA%B0%80-%EC%9E%88%EC%96%B4%EC%9A%94\">크롬 확장프로그램은 실행할 수 없는 페이지가 있어요</a></p>\n<ul>\n<li><a href=\"#%EA%B7%B8%EB%9F%B0-%EA%B2%BD%EC%9A%B0%EC%97%90%EB%8A%94-%EC%95%88%EB%82%B4-%ED%8C%9D%EC%97%85%EC%9D%84-%EB%9D%84%EC%9B%8C%EC%A4%8D%EC%8B%9C%EB%8B%A4\">그런 경우에는 안내 팝업을 띄워줍시다.</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%99%95%EC%9E%A5%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8%EC%9D%84-%EB%88%84%EB%A5%B4%EB%A9%B4-%EC%83%81%ED%98%B8%EC%9E%91%EC%9A%A9%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8A%94%ED%8C%A8%EB%84%90%EC%9D%B4-%EB%82%98%EC%98%A4%EA%B2%8C-%ED%95%98%EA%B8%B0\">확장프로그램을 누르면 (상호작용할 수 있는)패널이 나오게 하기</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%8B%A4%EC%A4%91%EA%B7%B8%EB%A6%BC%EC%9E%90%EB%B6%84%EC%8B%A0%EC%88%A0-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0\">다중그림자분신술 구현하기</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B4%80%EC%84%B1%EC%9A%B4%EB%8F%99%EC%9D%84-%EA%B5%AC%ED%98%84%ED%95%B4%EC%84%9C-%ED%96%84%EB%B6%80%EA%B8%B0%EB%A5%BC-%EB%8D%98%EC%A0%B8%EC%9A%94\">관성운동을 구현해서 햄부기를 던져요</a></p>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/2024-recap-and-starting-2025/"},"frontmatter":{"title":"🚀 마지막 학기, 인턴 끝, 정규직 시작"}},"next":null},"pageContext":{"id":"b2fa23f1-8513-5c44-a654-f6895cd98d8e","previousPostId":"f7b42397-39f8-507a-b5c5-63a7136cdae2","nextPostId":null}},"staticQueryHashes":["2841359383"],"slicesMap":{}}